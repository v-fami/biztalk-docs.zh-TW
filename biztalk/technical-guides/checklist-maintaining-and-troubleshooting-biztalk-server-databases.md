---
title: "檢查清單： 維護和疑難排解 BizTalk Server 資料庫 |Microsoft 文件"
ms.custom: 
ms.date: 06/29/2017
ms.prod: biztalk-server
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 58931faf-fc84-46fe-8359-506da94c3756
caps.latest.revision: "4"
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 3e5ef7cdc4fb136a9fc80b04a04cdbe4f1e064e3
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 09/20/2017
---
# <a name="checklist-maintaining-and-troubleshooting-biztalk-server-databases"></a>檢查清單： 維護和疑難排解 BizTalk Server 資料庫
[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]資料庫與它們的健全狀況是非常重要的成功[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]資料庫傳訊環境。 本主題列出維護或進行疑難排解時，必須遵循的步驟[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]資料庫。  
  
-   [維護 BizTalk Server 資料庫](../technical-guides/checklist-maintaining-and-troubleshooting-biztalk-server-databases.md#BKMK_MaintainDB)  
  
-   [疑難排解 BizTalk Server 資料庫](../technical-guides/checklist-maintaining-and-troubleshooting-biztalk-server-databases.md#BKMK_Troubleshoot)  
  
<a name="BKMK_MaintainDB"></a>   
## <a name="maintaining-biztalk-server-databases"></a>維護 BizTalk Server 資料庫  
  
|步驟|參考|  
|-----------|---------------|  
|停用**自動更新統計資料**和**自動建立統計資料**選項 (僅適用於[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]MessageBox 資料庫)。|**注意：**這些設定會依預設的一部分進行[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]組態。 您不應該對這些設定進行變更。 <br /><br /> 您必須停用**自動建立統計資料**和**自動更新統計資料**選項。 若要判斷這些設定會停用，請在 SQL Server 中執行下列預存程序：<br /><br /> exec sp_dboption 'BizTalkMsgBoxDB'，'自動建立統計資料' exec sp_dboption 'BizTalkMsgBoxDB'，'自動更新統計資料'<br /><br /> 傳回值**CurrentSetting**應設為 OFF。 如果此值傳回**CurrentSetting**是 ON 時，由 SQL Server 中執行下列預存程序將它變更為 OFF:<br /><br /> exec sp_dboption 'BizTalkMsgBoxDB'，'自動建立統計資料'、 'off' exec sp_dboption 'BizTalkMsgBoxDB'、 '自動更新統計資料，' 'off'<br /><br /> 如需這些設定的詳細資訊，請參閱下列 Microsoft 知識庫文件：<br /><br /> -   **917845**—["您遇到封鎖，死結狀況或其他 SQL Server 問題，當您嘗試連接到 BizTalk Server 中的 BizTalkMsgBoxDb 資料庫"](http://go.microsoft.com/fwlink/?LinkId=153429) (http://go.microsoft.com/fwlink/?LinkId=153429)。<br />-   **912262**—[「 自動更新統計資料選項、 自動建立統計資料選項和平行處理原則設定關閉的裝載 BizTalk Server BizTalkMsgBoxDB 資料庫的 SQL Server 資料庫執行個體 」](http://go.microsoft.com/fwlink/?LinkId=153430)(http://go.microsoft.com/fwlink/?LinkId=153430)。|  
|設定平行處理原則屬性的最大程度|**注意：**這些設定會依預設的一部分進行[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]組態。 您不應該對這些設定進行變更。 <br /><br /> 設定 Max Degree of Parallelism **run_value**和**config_value**屬性，以值為一 (1) 上[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]該主控件執行個體[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]Messagebox 資料庫。 檢查平行處理原則設定的最大程度，請執行下列預存程序針對 Master 資料庫中[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]:<br /><br /> exec sp_configure 'max degree of parallelism'<br /><br /> 如果**run_value**和**config_value**都不設定為一 (1) 的值時，SQL Server 中執行下列預存程序：<br /><br /> exec sp_configure 'max degree of parallelism'，'1' 的重新設定，以覆寫<br /><br /> 如需有關如何設定平行處理原則的最大程度的影響[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]，請參閱下列 Microsoft 知識庫文章：<br /><br /> -   **899000**—[「 平行處理原則設定執行個體的 SQL Server，當您設定 BizTalk Server 」](http://go.microsoft.com/fwlink/?LinkId=153432) (http://go.microsoft.com/fwlink/?LinkId=153432)。<br />-   **917845**—["您遇到封鎖，死結狀況或其他 SQL Server 問題，當您嘗試連接到 BizTalk Server 中的 BizTalkMsgBoxDb 資料庫"](http://go.microsoft.com/fwlink/?LinkId=153429) (http://go.microsoft.com/fwlink/?LinkId=153429)。|  
|決定當您可以重建[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]索引|中的索引，大部分[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]資料庫已叢集化 (索引識別碼： 1)。 DBCC SHOWCONTIG 命令可以用來顯示資料表中的片段資訊[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]資料庫。 這些索引是以 GUID 為基礎因此，這是正常的分散程度發生。 如果 DBCC SHOWCONTIG 掃描密度值為小於 30%，就可以重建索引期間的停機時間。 在許多資料表[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]資料庫包含使用線上檢索索引無法完成之資料型別定義的資料行。 因此，資料表中的索引[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]BizTalk 處理資料時，應該永遠不會重建資料庫。 如需有關如何重建 BizTalk 索引的詳細資訊，請參閱下列 Microsoft 知識庫文件：<br /><br /> -   **917845**—["您遇到封鎖，死結狀況或其他 SQL Server 問題，當您嘗試連接到 BizTalk Server 中的 BizTalkMsgBoxDb 資料庫"](http://go.microsoft.com/fwlink/?LinkId=153429) (http://go.microsoft.com/fwlink/?LinkId=153429)。<br /><br /> 如需索引片段和工作負載類型的詳細資訊，請參閱技術白皮書[Microsoft SQL Server 2000 索引重組最佳作法](http://go.microsoft.com/fwlink/?LinkId=101580)(http://go.microsoft.com/fwlink/?LinkId=101580)。 **注意：**您也可以使用 sys.dm_db_index_physical_stats 函數來查詢中的片段資訊[!INCLUDE[btsSQLServer2005](../includes/btssqlserver2005-md.md)]和[!INCLUDE[btsSQLServer2008](../includes/btssqlserver2008-md.md)]。 如需詳細資訊，請參閱[sys.dm_db_index_physical_stats (TRANSACT-SQL)](http://go.microsoft.com/fwlink/?LinkId=158493) (http://go.microsoft.com/fwlink/?LinkId=158493)。|  
|監控資料庫的鎖定、 區塊或死結|它會鎖定和區塊上發生的預期的行為[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]所使用的資料庫[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]。 不過，不應該有這些鎖定或區塊長的時間繼續。 擴充封鎖及死結上[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]所使用的資料庫[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]是指標的潛在問題。 針對目前的已知會造成死結與封鎖的[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]所使用的資料庫[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]，請檢閱下列 Microsoft 知識庫文件：<br /><br /> -   **917845**—["您遇到封鎖，死結狀況或其他 SQL Server 問題，當您嘗試連接到 BizTalk Server 中的 BizTalkMsgBoxDb 資料庫"](http://go.microsoft.com/fwlink/?LinkId=153429) (http://go.microsoft.com/fwlink/?LinkId=153429)。|  
|監視資料庫和資料表的大小|大小[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]Messagebox 資料庫通常都是不超過約 5 GB。  BizTalkMsgBoxDb 資料庫不能保存任何資料，且應該被視為緩衝區，直到處理或移到 BizTalkDTADb 資料庫資料。 具有功能強大的 SQL Server 後端和許多長時間執行的協調流程的環境可能有 BizTalkMsgBoxDb 資料庫大於 5 GB。 任何長時間執行的協調流程的高容量環境應該有[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]遠低於 5 GB 的 Messagebox 資料庫。 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]追蹤資料庫有極大的大小，但是，如果查詢效能大幅降低，然後追蹤資料庫可能是太大。 根據經驗法則，請為[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]追蹤資料庫大於 15 20 GB 會被視為太大，而且可能會對效能造成負面影響。 下列問題可能是能歸因於[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]而言太大的資料庫：<br /><br /> - [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] Messagebox 資料庫會繼續成長的資料大小 （不只是記錄檔） 仍為大型時。 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]會比正常處理更簡單的訊息流程案例更長的時間。<br />群組中樞的查詢需要較長的時間比正常，而且可能甚至逾時。<br />-資料庫記錄檔永遠不會遭到截斷。<br />-BizTalk SQL Agent 作業執行速度比正常。<br />-某些資料表相當大或太多資料列比較為 normal。<br /><br /> [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]資料庫會變得大有數種原因包括：<br /><br /> BizTalk SQL 代理程式作業未執行<br />-過多的擱置的訊息或服務執行個體<br />磁碟失敗<br />-高的層級的追蹤<br />-   [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]節流設定<br />-不佳[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]效能<br />網路延遲問題<br /><br /> 同樣地，您可以在資料表中有太多資料列。 沒有任何數目過多的資料列。 此外，此資料列數目會因何種資料儲存在資料表。 例如， *dta_DebugTrace*可能有超過 1 百萬個資料列的資料表有太多資料列。 A *HostNameQ_Suspended*可能有 200,000 以上的資料列的資料表有太多資料列。<br /><br /> 請確定您知道預期的環境中以判斷是否要進行資料問題。|  
|在啟用追蹤[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]主機|根據預設，在預設主機上已啟用追蹤。 BizTalk 需要**允許主控件追蹤**單一主機上檢查選項。 追蹤資料解碼 Service (TDDS) 啟用追蹤時，將追蹤事件資料從[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]Messagebox 資料庫[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]追蹤資料庫。 如果沒有[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]主機都設定的選項**允許主控件追蹤**，或者如果停止追蹤主控件，則不會執行 TDDS 和 TrackingData_x_x 資料表中的[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]Messagebox 資料庫會成長未檢查. 因此，專用[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]應該使用的選項設定主控件**允許主控件追蹤**。 如需設定專用的追蹤主控件的詳細資訊，請參閱[專用的追蹤主控件設定](~/technical-guides/configuring-a-dedicated-tracking-host.md)。 **注意：**允許 TDDS 來維護新的追蹤事件，在高容量的情況下，您可以建立多個單一追蹤主控件執行個體，但不是能超過一部主機應該設定的追蹤。|  
|使用正確的 BizTalk SQL Server Agent 作業|執行[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]SQL Agent 作業很重要的管理[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]資料庫和維護最佳效能。<br /><br /> -**備份[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]**  SQL Server Agent 作業是唯一支援的方法來備份[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]資料庫。 這項作業會要求您設定所有[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]資料庫以使用完整復原模式。 您應該設定為狀況良好的這項作業[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]環境。 您可以使用 SQL Server 方法來備份[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]資料庫只有當 SQL Server 服務已停止且所有[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]處理程序會停止。 **注意：**如需有關設定 SQL 代理程式備份時，使用 SQL Server 完整復原模式[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]作業，請參閱[記錄傳送](http://go.microsoft.com/fwlink/?LinkId=153450)(http://go.microsoft.com/fwlink/?LinkId = 153450) 或[完整復原模式下備份](http://go.microsoft.com/fwlink/?LinkId=156509)(http://go.microsoft.com/fwlink/?LinkId = 156509)。<br />- **MessageBox_Message_ManageRefCountLog_BizTalkMsgBoxDb** SQL Server Agent 作業可無限期地執行。 因此 SQL Agent 作業記錄可能不會指出，此 SQL 代理程式作業已順利完成。此行為是預設設計。 如果失敗，作業會在 1 分鐘內重新啟動，並繼續執行而每況愈下。 因此，通常可以忽略此工作的失敗通知。 如果 MessageBox_Message_ManageRefCountLog_BizTalkMsgBoxDb SQL Server Agent 作業的作業記錄指出此工作經常失敗和重新啟動失敗/重新啟動週期的進一步調查原因可能需要。<br />- **MessageBox_Message_Cleanup_BizTalkMsgBoxDb** SQL Server Agent 作業是應以手動方式啟用，因為它由 MessageBox_Message_ManageRefCountLog_BizTalkMsgBoxDb 工作啟始的唯一工作。<br />- **DTA 清除與封存**SQL Server Agent 作業會維護[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]追蹤資料庫清除和封存追蹤的訊息。 這項作業會讀取資料表中的每個資料列，並比較每個資料列，以判斷是否應該移除該記錄的時間戳記。 **注意：**進行疑難排解時[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]SQL Server Agent 作業，請確認 MessageBox_Message_ManageRefCountLog_BizTalkMsgBoxDb 以外的所有 SQL Agent 作業所都完成無誤。 <br /><br /> 如需有關[!INCLUDE[btsBizTalkServer2006r3](../includes/btsbiztalkserver2006r3-md.md)]SQL Agent 作業中使用[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]:<br /><br /> -了解[資料庫結構與工作](http://go.microsoft.com/fwlink/?LinkId=153451)(http://go.microsoft.com/fwlink/?LinkId=153451)。<br />-了解[描述 SQL Server Agent 的作業在 BizTalk Server](http://go.microsoft.com/fwlink/?LinkId=153452) (http://go.microsoft.com/fwlink/?LinkId=153452)。|  
|監視並終止擱置的執行個體|服務執行個體可以擱置 （可繼續） 或已擱置 （不可繼續）。 這些服務執行個體可能訊息、 協調流程或連接埠。 [!INCLUDE[btsBizTalkServer2006r3](../includes/btsbiztalkserver2006r3-md.md)]使用中的 [群組中樞] 頁面會終止，並移除這些執行個體的調節[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]管理主控台或透過 Terminate.vbs 指令碼使用。 如需 Terminate.vbs 指令碼的詳細資訊，請參閱[移除已擱置服務執行個體](http://go.microsoft.com/fwlink/?LinkId=153453)(http://go.microsoft.com/fwlink/?LinkId=153453)。 **提示：**您也可以使用 [結束字元] 工具來移除已擱置的執行個體。 [結束字元工具](http://go.microsoft.com/fwlink/?LinkId=151931)位於[http://go.microsoft.com/fwlink/?LinkId=151931](http://go.microsoft.com/fwlink/?LinkId=151931)。 使用此工具不支援的 Microsoft，Microsoft 並不保證此程式的適用性。 請自行承擔使用這個程式的一切風險。 <br /><br /> 詞彙 「 孤立項目 」 以及 「 zombie"經常交換使用。 被遺棄或 zombie 的訊息是沒有相關聯的服務執行個體，通常是因為服務執行個體已終止之前收到訊息的訊息。 被遺棄或 zombie 服務是一項服務，並沒有任何相關聯的訊息。 如需有關廢止訊息與服務執行個體中的[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]看到[BizTalk Server 中的 Zombie](http://go.microsoft.com/fwlink/?LinkId=153454) (http://go.microsoft.com/fwlink/?LinkId=153454)。|  
|監視效能計數器的**PhysicalDisk**效能物件|[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]在一分鐘內對 SQL Server 大量簡短、 非常快速的交易。 如果 SQL Server 無法承受此活動，您可能會遇到[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]效能問題。 監視**avg.Disk sec/Read**， **avg.Disk sec/Transfer**，和**avg.Disk sec/Write**效能監視器計數器**PhysicalDisk**效能物件。 最佳值仍小於 10 毫秒 （毫秒）。 20 毫秒或更大的值會被視為不佳的效能。<br /><br /> -如需有關 SQL Server 2005 效能的詳細資訊，請參閱[效能問題的疑難排解 SQL Server 2005](http://go.microsoft.com/fwlink/?LinkID=153585) (http://go.microsoft.com/fwlink/?LinkID=153585)。<br />-如需有關 SQL Server 2008 效能的詳細資訊，請參閱[效能問題的疑難排解 SQL Server 2008](http://go.microsoft.com/fwlink/?LinkID=153586) (http://go.microsoft.com/fwlink/?LinkID=153586)。<br />-如需有關[!INCLUDE[btsBizTalkServer2006r3](../includes/btsbiztalkserver2006r3-md.md)]資料庫高可用性，請參閱[的 BizTalk Server 資料庫提供高可用性](http://go.microsoft.com/fwlink/?LinkId=153587)(http://go.microsoft.com/fwlink/?LinkId=153587)。<br /><br /> 您也可以參考下列 Microsoft 知識庫文件，如需有關 SQL Server 效能：<br /><br /> -   **298475** – [< 如何疑難排解 SQL Server 效能問題 >](http://go.microsoft.com/fwlink/?LinkId=153588) (http://go.microsoft.com/fwlink/?LinkId=153588)。<br />-   **271509** – [「 如何監視 SQL Server 2005 中封鎖 」](http://go.microsoft.com/fwlink/?LinkId=153589) (http://go.microsoft.com/fwlink/?LinkId=153589)。|  
|請遵循最佳作法[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]資料庫。|請參閱[維護 BizTalk Server 資料庫的最佳作法](~/technical-guides/best-practices-for-maintaining-biztalk-server-databases.md)。|  
  
<a name="BKMK_Troubleshoot"></a>   
## <a name="troubleshooting-biztalk-server-databases"></a>疑難排解 BizTalk Server 資料庫  
 執行下列工作，以疑難排解任何問題[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]資料庫。  
  
|步驟|參考|  
|-----------|---------------|  
|請確定所有必要的 BizTalk SQL Server Agent 作業已啟用且正在執行|所有 BizTalk SQL Server Agent 都作業，除了**MessageBox_Message_ManageRefCountLog_BizTalkMsgBoxDb**作業應該啟用且正在執行成功。 請勿停用任何其他工作。<br /><br /> 如果發生失敗，使用**檢視記錄**檢視錯誤的資訊，並據以解決惡意軟體移除失敗的 SQL Server 中的選項。 請記住， **MessageBox _Message_ManageRefCountLog_BizTalkMsgBoxDb**持續執行 SQL Server Agent 作業。 因此，您應該只是在意作業歷程記錄報告工作經常失敗，並重新啟動。|  
|使用 MsgBoxViewer 工具來分析 BizTalk MessageBox 資料庫與其他資料庫|**重要事項：**使用此工具不支援的 Microsoft 和 Microsoft 並不保證此程式的適用性。 請自行承擔使用這個程式的一切風險。 <br /><br /> MsgBoxViewer 工具會從[http://go.microsoft.com/fwlink/?LinkId=151930](http://go.microsoft.com/fwlink/?LinkId=151930) (http://go.microsoft.com/fwlink/?LinkId=151930)。 MsgBoxViewer 工具可用於疑難排解，因為它會提供 HTML 報表，詳細資料表的大小和資料列計數資訊。 報表也可以協助判斷是否[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]正在進行節流。 此外，此工具提供的快照集[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]資料庫和[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]組態。<br /><br /> 當[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]是執行速度比平常更久，執行 MsgBoxViewer 工具中，按一下以選取所有的查詢上**選擇性查詢**索引標籤，然後再檢閱產生的 HTML 報告，如有任何問題。 **摘要報表**區段會列出中以紅色的黃色和潛在問題的警告。<br /><br /> 此外，您可以使用 MsgBoxViewer 工具來判斷哪些資料表是最大和大部分的記錄。 通常擴大 larges 的資料表清單以及如何管理這些資料表上的指示，請參閱[大成長 BizTalk Server 資料庫資料表](~/technical-guides/large-growing-biztalk-server-database-tables.md)。|  
|如果任何，由 MsgBoxViewer 工具，來解決問題，使用結束字元工具|**重要事項：**使用此工具不支援的 Microsoft 和 Microsoft 並不保證此程式的適用性。 請自行承擔使用這個程式的一切風險。 <br /><br /> 執行位於結束字元工具[結束字元](http://go.microsoft.com/fwlink/?LinkId=151931)(http://go.microsoft.com/fwlink/?LinkId=151931)。 此工具可讓使用者輕鬆地解決 BizTalk MsgBoxViewer 工具所識別的任何問題。 如需有關結束字元工具如何與 BizTalk MsgBoxViewer 工具整合的詳細資訊，請參閱[解決 BizTalk MsgBoxViewer 所識別的問題使用 BizTalk 結束字元](http://go.microsoft.com/fwlink/?LinkId=151932)(http://go.microsoft.com/fwlink/?LinkId=151932)。|  
|調查死結狀況|在死結案例中，啟用 SQL Server 上的 DBCC 追蹤讓死結資訊寫入 SQLERROR 記錄檔。<br /><br /> 在 SQL Server 2008 或 SQL Server 2005 中，執行下列陳述式啟用 DBCC 追蹤死結案例：<br /><br /> DBCC TRACEON (1222，-1)<br /><br /> 您也可以使用 PSSDIAG 公用程式收集資料**Lock: Deadlock**事件和**Lock: Deadlock Chain**事件。 如需 PSSDIAG 公用程式的詳細資訊，請參閱[PSSDIAG 資料收集公用程式](http://go.microsoft.com/fwlink/?LinkId=153627)(http://go.microsoft.com/fwlink/?LinkId=153627)。<br /><br /> 高容量和高交易的線上交易處理 (OLTP) 資料庫 BizTalkMsgBoxDB 資料庫。 使用這類資料庫時，預期某些死結，而且這個死結會在內部處理[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]引擎。 當這個行為發生時，沒有錯誤會列在錯誤記錄檔。 當您調查死結案例時，死結輸出中，您正在調查的必須與事件記錄檔中的死結錯誤相互關聯。|  
|尋找封鎖處理序|您可以使用 SQL Server 中的活動監視器來取得鎖定的系統處理序的伺服器處理序識別碼 (SPID)。 然後，您可以執行 SQL Profiler，以判斷在鎖定 SPID 中執行的 SQL 陳述式。 PSSDIAG 公用程式可用來疑難排解 SQL Server 中的鎖定和封鎖問題。 此公用程式會擷取已啟用的封鎖指令碼的所有 TRANSACT-SQL 事件。 如需 PSSDIAG 公用程式的詳細資訊，請參閱[PSSDIAG 資料收集公用程式](http://go.microsoft.com/fwlink/?LinkId=153627)(http://go.microsoft.com/fwlink/?LinkId=153627)。<br /><br /> 在 SQL Server 2005 和更新版本，您可以指定**已封鎖處理序臨界值**設定來判斷哪一個 SPID 或 Spid 封鎖時間比您指定的臨界值還要長。 如需 blocked 的 process threshold 選項的詳細資訊，請參閱[已封鎖處理序臨界值選項](http://go.microsoft.com/fwlink/?LinkId=153628)(http://go.microsoft.com/fwlink/?LinkId=153628)。 **注意：**當您遇到 SQL Server 中的鎖定或封鎖問題時，我們建議您連絡 Microsoft 客戶支援服務。 Microsoft 客戶支援服務，可協助您設定正確的 PSSDiag 公用程式選項。|  
|刪除所有不必要的資料|如果資料庫已經成長變得太大，而且包含在資料庫中的資料將不需要再，慣用的方法是刪除的資料。 **注意：**請勿使用這個方法在任何環境中重要商務資料，或如果所需的資料，資料的所在。 <br /><br /> **若要清除 BizTalkMsgBox 資料庫**<br /> 1.下載並安裝在結束字元工具[Biztalk 結束字元](http://go.microsoft.com/fwlink/?LinkId=220869)(http://go.microsoft.com/fwlink/?LinkId=220869)。<br />2.遵循本主題中的步驟[如何從測試環境中的 MessageBox 資料庫手動清除資料](http://go.microsoft.com/fwlink/?LinkID=158064)(http://go.microsoft.com/fwlink/?LinkID=158064) 建立 bts_CleanupMsgbox 預存程序，在 BizTalk MessageBox 資料庫。<br />3.使用結束字元工具執行 bts_CleanupMsgbox 預存程序，並清除 BizTalk MessageBox 資料庫。 **警告：**是否正在執行 BizTalk Server 在實際伺服器上執行 bts_CleanupMsgbox 預存程序。 您應該只在測試環境中執行 bts_CleanupMsgbox 預存程序。 不支援在實際執行環境中執行 bts_CleanupMsgbox 預存程序。<br />4.重新啟動所有主機和[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]服務。<br /><br /> **若要清除 BizTalkDTADb 資料庫**<br /> <ul><li>**方法 1**<br /><br /> <ol><li>備份所有[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]資料庫。</li><li>執行**[dtasp_purgeallcompletedtrackingdata]**預存程序。 如需有關預存程序的詳細資訊，請參閱[如何從 BizTalk 追蹤資料庫手動清除資料](http://go.microsoft.com/fwlink/?LinkId=153635)(http://go.microsoft.com/fwlink/?LinkId=153635)。</li></ol></li><li>**方法 2**。 只有當 BizTalkDTADb 資料庫包含許多未完成的執行個體，必須先移除，請使用此選項。<br /><br /> <ol><li>備份所有[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]資料庫。</li><li>停止所有 BizTalk 主控件、 服務和自訂的外掛式配接器。 如果您使用 HTTP 或 SOAP 配接器，請重新啟動 IIS 服務。</li><li>執行**dtasp_CleanHMData** BizTalkDTADb 資料庫上預存程序。</li><li>重新啟動所有主機和[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]服務。</li></ol></li></ul> **注意：**如果您的追蹤資料，BizTalkDTADb 資料庫，必須將資料庫還原到另一個的 SQL Server，然後清除 原始 BizTalkDTADb 資料庫。|  
  
 如果您需要分析 MsgBoxViewer 資料或 PSSDIAG 輸出的說明，請連絡 Microsoft 客戶支援服務。 連絡客戶支援服務之前，壓縮 MsgBoxViewer 資料、 PSSDIAG 輸出和更新的事件記錄檔 （.evt 檔案）。 您可能要傳送這些檔案，以[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]支援工程師  
  
## <a name="in-this-section"></a>本節內容  
  
-   [維護 BizTalk Server 資料庫的最佳作法](~/technical-guides/best-practices-for-maintaining-biztalk-server-databases.md)  
  
-   [大型成長的情況的 BizTalk Server 資料庫資料表](~/technical-guides/large-growing-biztalk-server-database-tables.md)  
  
-   [工具和公用程式進行疑難排解](../technical-guides/tools-and-utilities-for-troubleshooting.md)  
  
## <a name="see-also"></a>另請參閱  
 [不應該變更的 SQL Server 設定](~/technical-guides/sql-server-settings-that-should-not-be-changed.md)