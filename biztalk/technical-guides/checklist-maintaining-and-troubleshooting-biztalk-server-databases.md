---
title: "檢查清單： 維護和疑難排解 BizTalk Server 資料庫 |Microsoft 文件"
ms.custom: 
ms.date: 06/29/2017
ms.prod: biztalk-server
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 58931faf-fc84-46fe-8359-506da94c3756
caps.latest.revision: "4"
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 3e5ef7cdc4fb136a9fc80b04a04cdbe4f1e064e3
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 09/20/2017
---
# <a name="checklist-maintaining-and-troubleshooting-biztalk-server-databases"></a><span data-ttu-id="3e1ce-102">檢查清單： 維護和疑難排解 BizTalk Server 資料庫</span><span class="sxs-lookup"><span data-stu-id="3e1ce-102">Checklist: Maintaining and Troubleshooting BizTalk Server Databases</span></span>
[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]<span data-ttu-id="3e1ce-103">資料庫與它們的健全狀況是非常重要的成功[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]資料庫傳訊環境。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-103"> databases and their health are very important for a successful [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] database messaging environment.</span></span> <span data-ttu-id="3e1ce-104">本主題列出維護或進行疑難排解時，必須遵循的步驟[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]資料庫。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-104">This topic lists the steps that you must follow when maintaining or troubleshooting the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] databases.</span></span>  
  
-   [<span data-ttu-id="3e1ce-105">維護 BizTalk Server 資料庫</span><span class="sxs-lookup"><span data-stu-id="3e1ce-105">Maintaining BizTalk Server Databases</span></span>](../technical-guides/checklist-maintaining-and-troubleshooting-biztalk-server-databases.md#BKMK_MaintainDB)  
  
-   [<span data-ttu-id="3e1ce-106">疑難排解 BizTalk Server 資料庫</span><span class="sxs-lookup"><span data-stu-id="3e1ce-106">Troubleshooting BizTalk Server Databases</span></span>](../technical-guides/checklist-maintaining-and-troubleshooting-biztalk-server-databases.md#BKMK_Troubleshoot)  
  
<a name="BKMK_MaintainDB"></a>   
## <a name="maintaining-biztalk-server-databases"></a><span data-ttu-id="3e1ce-107">維護 BizTalk Server 資料庫</span><span class="sxs-lookup"><span data-stu-id="3e1ce-107">Maintaining BizTalk Server Databases</span></span>  
  
|<span data-ttu-id="3e1ce-108">步驟</span><span class="sxs-lookup"><span data-stu-id="3e1ce-108">Steps</span></span>|<span data-ttu-id="3e1ce-109">參考</span><span class="sxs-lookup"><span data-stu-id="3e1ce-109">Reference</span></span>|  
|-----------|---------------|  
|<span data-ttu-id="3e1ce-110">停用**自動更新統計資料**和**自動建立統計資料**選項 (僅適用於[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]MessageBox 資料庫)。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-110">Disable the **Auto Update Statistics** and **Auto Create Statistics** Options (applicable only to [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] MessageBox databases).</span></span>|<span data-ttu-id="3e1ce-111">**注意：**這些設定會依預設的一部分進行[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]組態。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-111">**Note:**  These settings are done by default as part of the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] configuration.</span></span> <span data-ttu-id="3e1ce-112">您不應該對這些設定進行變更。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-112">You should not make changes to these settings.</span></span> <br /><br /> <span data-ttu-id="3e1ce-113">您必須停用**自動建立統計資料**和**自動更新統計資料**選項。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-113">You must disable the **Auto Create Statistics** and the **Auto Update Statistics** options.</span></span> <span data-ttu-id="3e1ce-114">若要判斷這些設定會停用，請在 SQL Server 中執行下列預存程序：</span><span class="sxs-lookup"><span data-stu-id="3e1ce-114">To determine if these settings are disabled, execute the following stored procedures in SQL Server:</span></span><br /><br /> <span data-ttu-id="3e1ce-115">exec sp_dboption 'BizTalkMsgBoxDB'，'自動建立統計資料' exec sp_dboption 'BizTalkMsgBoxDB'，'自動更新統計資料'</span><span class="sxs-lookup"><span data-stu-id="3e1ce-115">exec sp_dboption 'BizTalkMsgBoxDB', 'auto create statistics'                 exec sp_dboption 'BizTalkMsgBoxDB', 'auto update statistics'</span></span><br /><br /> <span data-ttu-id="3e1ce-116">傳回值**CurrentSetting**應設為 OFF。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-116">The value returned for **CurrentSetting** should be OFF.</span></span> <span data-ttu-id="3e1ce-117">如果此值傳回**CurrentSetting**是 ON 時，由 SQL Server 中執行下列預存程序將它變更為 OFF:</span><span class="sxs-lookup"><span data-stu-id="3e1ce-117">If this value returned for **CurrentSetting** is ON, change it to OFF by executing the following stored procedures in SQL Server:</span></span><br /><br /> <span data-ttu-id="3e1ce-118">exec sp_dboption 'BizTalkMsgBoxDB'，'自動建立統計資料'、 'off' exec sp_dboption 'BizTalkMsgBoxDB'、 '自動更新統計資料，' 'off'</span><span class="sxs-lookup"><span data-stu-id="3e1ce-118">exec sp_dboption 'BizTalkMsgBoxDB', 'auto create statistics', 'off'                 exec sp_dboption 'BizTalkMsgBoxDB', 'auto update statistics', 'off'</span></span><br /><br /> <span data-ttu-id="3e1ce-119">如需這些設定的詳細資訊，請參閱下列 Microsoft 知識庫文件：</span><span class="sxs-lookup"><span data-stu-id="3e1ce-119">For more information about these settings see the following Microsoft Knowledge Base articles:</span></span><br /><br /> <span data-ttu-id="3e1ce-120">-   **917845**—["您遇到封鎖，死結狀況或其他 SQL Server 問題，當您嘗試連接到 BizTalk Server 中的 BizTalkMsgBoxDb 資料庫"](http://go.microsoft.com/fwlink/?LinkId=153429) (http://go.microsoft.com/fwlink/?LinkId=153429)。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-120">-   **917845**—["You experience blocking, deadlock conditions, or other SQL Server issues when you try to connect to the BizTalkMsgBoxDb database in BizTalk Server"](http://go.microsoft.com/fwlink/?LinkId=153429) (http://go.microsoft.com/fwlink/?LinkId=153429).</span></span><br /><span data-ttu-id="3e1ce-121">-   **912262**—[「 自動更新統計資料選項、 自動建立統計資料選項和平行處理原則設定關閉的裝載 BizTalk Server BizTalkMsgBoxDB 資料庫的 SQL Server 資料庫執行個體 」](http://go.microsoft.com/fwlink/?LinkId=153430)(http://go.microsoft.com/fwlink/?LinkId=153430)。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-121">-   **912262**—["The auto update statistics option, the auto create statistics option, and the Parallelism setting are turned off in the SQL Server database instance that hosts the BizTalk Server BizTalkMsgBoxDB database"](http://go.microsoft.com/fwlink/?LinkId=153430) (http://go.microsoft.com/fwlink/?LinkId=153430).</span></span>|  
|<span data-ttu-id="3e1ce-122">設定平行處理原則屬性的最大程度</span><span class="sxs-lookup"><span data-stu-id="3e1ce-122">Set the Max Degree of Parallelism property</span></span>|<span data-ttu-id="3e1ce-123">**注意：**這些設定會依預設的一部分進行[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]組態。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-123">**Note:**  These settings are done by default as part of the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] configuration.</span></span> <span data-ttu-id="3e1ce-124">您不應該對這些設定進行變更。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-124">You should not make changes to these settings.</span></span> <br /><br /> <span data-ttu-id="3e1ce-125">設定 Max Degree of Parallelism **run_value**和**config_value**屬性，以值為一 (1) 上[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]該主控件執行個體[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]Messagebox 資料庫。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-125">Set the Max Degree of Parallelism **run_value** and **config_value** properties to a value of one (1) on the [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] instances that host the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] Messagebox databases.</span></span> <span data-ttu-id="3e1ce-126">檢查平行處理原則設定的最大程度，請執行下列預存程序針對 Master 資料庫中[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]:</span><span class="sxs-lookup"><span data-stu-id="3e1ce-126">To check the Max Degree of Parallelism setting, execute the following stored procedure against the Master database in [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]:</span></span><br /><br /> <span data-ttu-id="3e1ce-127">exec sp_configure 'max degree of parallelism'</span><span class="sxs-lookup"><span data-stu-id="3e1ce-127">exec sp_configure 'max degree of parallelism'</span></span><br /><br /> <span data-ttu-id="3e1ce-128">如果**run_value**和**config_value**都不設定為一 (1) 的值時，SQL Server 中執行下列預存程序：</span><span class="sxs-lookup"><span data-stu-id="3e1ce-128">If the **run_value** and **config_value** are not set to a value of one (1), execute the following stored procedure in SQL Server:</span></span><br /><br /> <span data-ttu-id="3e1ce-129">exec sp_configure 'max degree of parallelism'，'1' 的重新設定，以覆寫</span><span class="sxs-lookup"><span data-stu-id="3e1ce-129">exec sp_configure 'max degree of parallelism', '1'                 reconfigure with override</span></span><br /><br /> <span data-ttu-id="3e1ce-130">如需有關如何設定平行處理原則的最大程度的影響[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]，請參閱下列 Microsoft 知識庫文章：</span><span class="sxs-lookup"><span data-stu-id="3e1ce-130">For more information about how the Max Degree of Parallelism setting affects [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)], see the following Microsoft Knowledge Base articles:</span></span><br /><br /> <span data-ttu-id="3e1ce-131">-   **899000**—[「 平行處理原則設定執行個體的 SQL Server，當您設定 BizTalk Server 」](http://go.microsoft.com/fwlink/?LinkId=153432) (http://go.microsoft.com/fwlink/?LinkId=153432)。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-131">-   **899000**—["The Parallelism setting for the instance of SQL Server when you configure BizTalk Server"](http://go.microsoft.com/fwlink/?LinkId=153432) (http://go.microsoft.com/fwlink/?LinkId=153432).</span></span><br /><span data-ttu-id="3e1ce-132">-   **917845**—["您遇到封鎖，死結狀況或其他 SQL Server 問題，當您嘗試連接到 BizTalk Server 中的 BizTalkMsgBoxDb 資料庫"](http://go.microsoft.com/fwlink/?LinkId=153429) (http://go.microsoft.com/fwlink/?LinkId=153429)。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-132">-   **917845**—["You experience blocking, deadlock conditions, or other SQL Server issues when you try to connect to the BizTalkMsgBoxDb database in BizTalk Server"](http://go.microsoft.com/fwlink/?LinkId=153429) (http://go.microsoft.com/fwlink/?LinkId=153429).</span></span>|  
|<span data-ttu-id="3e1ce-133">決定當您可以重建[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]索引</span><span class="sxs-lookup"><span data-stu-id="3e1ce-133">Determine when you can rebuild [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] indexes</span></span>|<span data-ttu-id="3e1ce-134">中的索引，大部分[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]資料庫已叢集化 (索引識別碼： 1)。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-134">Most of the indexes in [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] databases are clustered (index ID: 1).</span></span> <span data-ttu-id="3e1ce-135">DBCC SHOWCONTIG 命令可以用來顯示資料表中的片段資訊[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]資料庫。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-135">The DBCC SHOWCONTIG command can be used to display fragmentation information for tables in the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] databases.</span></span> <span data-ttu-id="3e1ce-136">這些索引是以 GUID 為基礎因此，這是正常的分散程度發生。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-136">These indexes are GUID-based so it is normal for fragmentation to occur.</span></span> <span data-ttu-id="3e1ce-137">如果 DBCC SHOWCONTIG 掃描密度值為小於 30%，就可以重建索引期間的停機時間。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-137">If the Scan Density value of DBCC SHOWCONTIG is less than 30%, the indexes can be rebuilt during downtime.</span></span> <span data-ttu-id="3e1ce-138">在許多資料表[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]資料庫包含使用線上檢索索引無法完成之資料型別定義的資料行。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-138">Many tables in the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] databases contain columns that use DataType definitions where online indexing cannot be done.</span></span> <span data-ttu-id="3e1ce-139">因此，資料表中的索引[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]BizTalk 處理資料時，應該永遠不會重建資料庫。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-139">Therefore, the indexes for tables in the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] databases should never be rebuilt while BizTalk is processing data.</span></span> <span data-ttu-id="3e1ce-140">如需有關如何重建 BizTalk 索引的詳細資訊，請參閱下列 Microsoft 知識庫文件：</span><span class="sxs-lookup"><span data-stu-id="3e1ce-140">For more information on how to rebuild the BizTalk indexes, see the following Microsoft Knowledge Base article:</span></span><br /><br /> <span data-ttu-id="3e1ce-141">-   **917845**—["您遇到封鎖，死結狀況或其他 SQL Server 問題，當您嘗試連接到 BizTalk Server 中的 BizTalkMsgBoxDb 資料庫"](http://go.microsoft.com/fwlink/?LinkId=153429) (http://go.microsoft.com/fwlink/?LinkId=153429)。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-141">-   **917845**—["You experience blocking, deadlock conditions, or other SQL Server issues when you try to connect to the BizTalkMsgBoxDb database in BizTalk Server"](http://go.microsoft.com/fwlink/?LinkId=153429) (http://go.microsoft.com/fwlink/?LinkId=153429).</span></span><br /><br /> <span data-ttu-id="3e1ce-142">如需索引片段和工作負載類型的詳細資訊，請參閱技術白皮書[Microsoft SQL Server 2000 索引重組最佳作法](http://go.microsoft.com/fwlink/?LinkId=101580)(http://go.microsoft.com/fwlink/?LinkId=101580)。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-142">For more information about index fragmentation and workload types, see the white paper [Microsoft SQL Server 2000 Index Defragmentation Best Practices](http://go.microsoft.com/fwlink/?LinkId=101580) (http://go.microsoft.com/fwlink/?LinkId=101580).</span></span> <span data-ttu-id="3e1ce-143">**注意：**您也可以使用 sys.dm_db_index_physical_stats 函數來查詢中的片段資訊[!INCLUDE[btsSQLServer2005](../includes/btssqlserver2005-md.md)]和[!INCLUDE[btsSQLServer2008](../includes/btssqlserver2008-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-143">**Note:**  You can also use the sys.dm_db_index_physical_stats function to look for fragmentation information in [!INCLUDE[btsSQLServer2005](../includes/btssqlserver2005-md.md)] and [!INCLUDE[btsSQLServer2008](../includes/btssqlserver2008-md.md)].</span></span> <span data-ttu-id="3e1ce-144">如需詳細資訊，請參閱[sys.dm_db_index_physical_stats (TRANSACT-SQL)](http://go.microsoft.com/fwlink/?LinkId=158493) (http://go.microsoft.com/fwlink/?LinkId=158493)。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-144">For more information, see [sys.dm_db_index_physical_stats (Transact-SQL)](http://go.microsoft.com/fwlink/?LinkId=158493) (http://go.microsoft.com/fwlink/?LinkId=158493).</span></span>|  
|<span data-ttu-id="3e1ce-145">監控資料庫的鎖定、 區塊或死結</span><span class="sxs-lookup"><span data-stu-id="3e1ce-145">Monitor the database for locks, blocks, or deadlocks</span></span>|<span data-ttu-id="3e1ce-146">它會鎖定和區塊上發生的預期的行為[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]所使用的資料庫[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-146">It is an expected behavior for locks and blocks to occur on the [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] databases used by [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)].</span></span> <span data-ttu-id="3e1ce-147">不過，不應該有這些鎖定或區塊長的時間繼續。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-147">However, it is not expected to have these locks or blocks to continue for an extended period of time.</span></span> <span data-ttu-id="3e1ce-148">擴充封鎖及死結上[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]所使用的資料庫[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]是指標的潛在問題。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-148">Extended blocking and deadlocking on the [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] databases used by [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] are indicators of a potential problem.</span></span> <span data-ttu-id="3e1ce-149">針對目前的已知會造成死結與封鎖的[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]所使用的資料庫[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]，請檢閱下列 Microsoft 知識庫文件：</span><span class="sxs-lookup"><span data-stu-id="3e1ce-149">For the current known causes of deadlocking and blocking on the [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] databases used by [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)], review the following Microsoft Knowledge Base article:</span></span><br /><br /> <span data-ttu-id="3e1ce-150">-   **917845**—["您遇到封鎖，死結狀況或其他 SQL Server 問題，當您嘗試連接到 BizTalk Server 中的 BizTalkMsgBoxDb 資料庫"](http://go.microsoft.com/fwlink/?LinkId=153429) (http://go.microsoft.com/fwlink/?LinkId=153429)。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-150">-   **917845**—["You experience blocking, deadlock conditions, or other SQL Server issues when you try to connect to the BizTalkMsgBoxDb database in BizTalk Server"](http://go.microsoft.com/fwlink/?LinkId=153429) (http://go.microsoft.com/fwlink/?LinkId=153429).</span></span>|  
|<span data-ttu-id="3e1ce-151">監視資料庫和資料表的大小</span><span class="sxs-lookup"><span data-stu-id="3e1ce-151">Monitor the size of databases and tables</span></span>|<span data-ttu-id="3e1ce-152">大小[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]Messagebox 資料庫通常都是不超過約 5 GB。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-152">The size of the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] Messagebox database should typically be no more than approximately 5GB.</span></span>  <span data-ttu-id="3e1ce-153">BizTalkMsgBoxDb 資料庫不能保存任何資料，且應該被視為緩衝區，直到處理或移到 BizTalkDTADb 資料庫資料。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-153">The BizTalkMsgBoxDb database should not be holding any data, and should be considered a buffer until the data is processed or moved to the BizTalkDTADb database.</span></span> <span data-ttu-id="3e1ce-154">具有功能強大的 SQL Server 後端和許多長時間執行的協調流程的環境可能有 BizTalkMsgBoxDb 資料庫大於 5 GB。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-154">An environment with a powerful SQL Server backend and numerous long running orchestrations may have a BizTalkMsgBoxDb database larger than 5GB.</span></span> <span data-ttu-id="3e1ce-155">任何長時間執行的協調流程的高容量環境應該有[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]遠低於 5 GB 的 Messagebox 資料庫。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-155">A high volume environment with no long-running orchestrations should have a [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] Messagebox database much smaller than 5GB.</span></span> <span data-ttu-id="3e1ce-156">[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]追蹤資料庫有極大的大小，但是，如果查詢效能大幅降低，然後追蹤資料庫可能是太大。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-156">The [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] tracking database can vary greatly in size but if query performance decreases dramatically, then the tracking database is probably too large.</span></span> <span data-ttu-id="3e1ce-157">根據經驗法則，請為[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]追蹤資料庫大於 15 20 GB 會被視為太大，而且可能會對效能造成負面影響。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-157">As a rule of thumb, a [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] tracking database larger than 15-20 GB is considered too large and may adversely impact performance.</span></span> <span data-ttu-id="3e1ce-158">下列問題可能是能歸因於[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]而言太大的資料庫：</span><span class="sxs-lookup"><span data-stu-id="3e1ce-158">The following issues may be attributable to [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] databases that are too large:</span></span><br /><br /> <span data-ttu-id="3e1ce-159">- [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] Messagebox 資料庫會繼續成長的資料大小 （不只是記錄檔） 仍為大型時。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-159">-   The [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] Messagebox database continues to grow while the data size (not just the log file) remains large.</span></span> [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]<span data-ttu-id="3e1ce-160">會比正常處理更簡單的訊息流程案例更長的時間。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-160"> takes a longer time than normal to process even a simple message flow scenario.</span></span><br /><span data-ttu-id="3e1ce-161">群組中樞的查詢需要較長的時間比正常，而且可能甚至逾時。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-161">-   Group Hub queries take a longer time than normal and may even timeout.</span></span><br /><span data-ttu-id="3e1ce-162">-資料庫記錄檔永遠不會遭到截斷。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-162">-   The database log file never gets truncated.</span></span><br /><span data-ttu-id="3e1ce-163">-BizTalk SQL Agent 作業執行速度比正常。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-163">-   The BizTalk SQL Agent jobs run slower than normal.</span></span><br /><span data-ttu-id="3e1ce-164">-某些資料表相當大或太多資料列比較為 normal。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-164">-   Some tables are considerably large or have too many rows compared to normal.</span></span><br /><br /> <span data-ttu-id="3e1ce-165">[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]資料庫會變得大有數種原因包括：</span><span class="sxs-lookup"><span data-stu-id="3e1ce-165">The [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] databases can become large for several reasons including:</span></span><br /><br /> <span data-ttu-id="3e1ce-166">BizTalk SQL 代理程式作業未執行</span><span class="sxs-lookup"><span data-stu-id="3e1ce-166">-   BizTalk SQL Agent Jobs not running</span></span><br /><span data-ttu-id="3e1ce-167">-過多的擱置的訊息或服務執行個體</span><span class="sxs-lookup"><span data-stu-id="3e1ce-167">-   Excessive suspended message or service instances</span></span><br /><span data-ttu-id="3e1ce-168">磁碟失敗</span><span class="sxs-lookup"><span data-stu-id="3e1ce-168">-   Disk failures</span></span><br /><span data-ttu-id="3e1ce-169">-高的層級的追蹤</span><span class="sxs-lookup"><span data-stu-id="3e1ce-169">-   High levels of tracking</span></span><br /><span data-ttu-id="3e1ce-170">-   [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]節流設定</span><span class="sxs-lookup"><span data-stu-id="3e1ce-170">-   [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] throttling</span></span><br /><span data-ttu-id="3e1ce-171">-不佳[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]效能</span><span class="sxs-lookup"><span data-stu-id="3e1ce-171">-   Poor [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] performance</span></span><br /><span data-ttu-id="3e1ce-172">網路延遲問題</span><span class="sxs-lookup"><span data-stu-id="3e1ce-172">-   Network latency issues</span></span><br /><br /> <span data-ttu-id="3e1ce-173">同樣地，您可以在資料表中有太多資料列。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-173">Similarly, you can have too many rows in a table.</span></span> <span data-ttu-id="3e1ce-174">沒有任何數目過多的資料列。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-174">There is no set number of rows that are too many.</span></span> <span data-ttu-id="3e1ce-175">此外，此資料列數目會因何種資料儲存在資料表。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-175">Additionally, this number of rows varies by what kind of data is stored in the table.</span></span> <span data-ttu-id="3e1ce-176">例如， *dta_DebugTrace*可能有超過 1 百萬個資料列的資料表有太多資料列。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-176">For example, a *dta_DebugTrace* table that has more than 1 million rows probably has too many rows.</span></span> <span data-ttu-id="3e1ce-177">A *HostNameQ_Suspended*可能有 200,000 以上的資料列的資料表有太多資料列。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-177">A *HostNameQ_Suspended* table that has more than 200,000 rows probably has too many rows.</span></span><br /><br /> <span data-ttu-id="3e1ce-178">請確定您知道預期的環境中以判斷是否要進行資料問題。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-178">Make sure that you know what is expected in your environment to determine whether a data issue is occurring.</span></span>|  
|<span data-ttu-id="3e1ce-179">在啟用追蹤[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]主機</span><span class="sxs-lookup"><span data-stu-id="3e1ce-179">Enable tracking on [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] host</span></span>|<span data-ttu-id="3e1ce-180">根據預設，在預設主機上已啟用追蹤。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-180">By default, tracking is enabled on the default host.</span></span> <span data-ttu-id="3e1ce-181">BizTalk 需要**允許主控件追蹤**單一主機上檢查選項。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-181">BizTalk requires the **Allow Host Tracking** option be checked on a single HOST.</span></span> <span data-ttu-id="3e1ce-182">追蹤資料解碼 Service (TDDS) 啟用追蹤時，將追蹤事件資料從[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]Messagebox 資料庫[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]追蹤資料庫。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-182">When tracking is enabled, the Tracking Data Decode Service (TDDS) moves the tracking event data from the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] Messagebox database to the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] tracking database.</span></span> <span data-ttu-id="3e1ce-183">如果沒有[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]主機都設定的選項**允許主控件追蹤**，或者如果停止追蹤主控件，則不會執行 TDDS 和 TrackingData_x_x 資料表中的[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]Messagebox 資料庫會成長未檢查.</span><span class="sxs-lookup"><span data-stu-id="3e1ce-183">If no [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] hosts are configured with the option to **Allow Host Tracking** or if the tracking host is stopped, then TDDS will not run and the TrackingData_x_x tables in the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] Messagebox database will grow unchecked.</span></span> <span data-ttu-id="3e1ce-184">因此，專用[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]應該使用的選項設定主控件**允許主控件追蹤**。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-184">Therefore, a dedicated [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] host should be configured with the option to **Allow Host Tracking**.</span></span> <span data-ttu-id="3e1ce-185">如需設定專用的追蹤主控件的詳細資訊，請參閱[專用的追蹤主控件設定](~/technical-guides/configuring-a-dedicated-tracking-host.md)。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-185">For more information about configuring a dedicated tracking host see [Configuring a Dedicated Tracking Host](~/technical-guides/configuring-a-dedicated-tracking-host.md).</span></span> <span data-ttu-id="3e1ce-186">**注意：**允許 TDDS 來維護新的追蹤事件，在高容量的情況下，您可以建立多個單一追蹤主控件執行個體，但不是能超過一部主機應該設定的追蹤。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-186">**Note:**  To allow TDDS to maintain new tracking events in high volume scenarios, you can create multiple instances of a single tracking host but no more than one host should be configured for tracking.</span></span>|  
|<span data-ttu-id="3e1ce-187">使用正確的 BizTalk SQL Server Agent 作業</span><span class="sxs-lookup"><span data-stu-id="3e1ce-187">Use the correct BizTalk SQL Server Agent jobs</span></span>|<span data-ttu-id="3e1ce-188">執行[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]SQL Agent 作業很重要的管理[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]資料庫和維護最佳效能。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-188">Execution of the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] SQL Agent jobs are crucial for managing the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] databases and for maintaining optimal performance.</span></span><br /><br /> <span data-ttu-id="3e1ce-189">-**備份[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]**  SQL Server Agent 作業是唯一支援的方法來備份[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]資料庫。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-189">-   The  **Backup [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]** SQL Server Agent job is the only supported method to back up the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] databases.</span></span> <span data-ttu-id="3e1ce-190">這項作業會要求您設定所有[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]資料庫以使用完整復原模式。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-190">This job requires you to set up all [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] databases to use a Full Recovery Model.</span></span> <span data-ttu-id="3e1ce-191">您應該設定為狀況良好的這項作業[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]環境。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-191">You should configure this job for a healthy [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] environment.</span></span> <span data-ttu-id="3e1ce-192">您可以使用 SQL Server 方法來備份[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]資料庫只有當 SQL Server 服務已停止且所有[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]處理程序會停止。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-192">You can use the SQL Server methods to back up the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] databases only if the SQL Server service is stopped and if all [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] processes are stopped.</span></span> <span data-ttu-id="3e1ce-193">**注意：**如需有關設定 SQL 代理程式備份時，使用 SQL Server 完整復原模式[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]作業，請參閱[記錄傳送](http://go.microsoft.com/fwlink/?LinkId=153450)(http://go.microsoft.com/fwlink/?LinkId = 153450) 或[完整復原模式下備份](http://go.microsoft.com/fwlink/?LinkId=156509)(http://go.microsoft.com/fwlink/?LinkId = 156509)。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-193">**Note:**      For more information about using the SQL Server full recovery model when configuring the SQL Agent Backup [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] job, see [Log Shipping](http://go.microsoft.com/fwlink/?LinkId=153450) (http://go.microsoft.com/fwlink/?LinkId=153450) or [Backup Under the Full Recovery Model](http://go.microsoft.com/fwlink/?LinkId=156509) (http://go.microsoft.com/fwlink/?LinkId=156509).</span></span><br /><span data-ttu-id="3e1ce-194">- **MessageBox_Message_ManageRefCountLog_BizTalkMsgBoxDb** SQL Server Agent 作業可無限期地執行。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-194">-   The **MessageBox_Message_ManageRefCountLog_BizTalkMsgBoxDb** SQL Server Agent job is designed to run indefinitely.</span></span> <span data-ttu-id="3e1ce-195">因此 SQL Agent 作業記錄可能不會指出，此 SQL 代理程式作業已順利完成。此行為是預設設計。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-195">As a result the SQL Agent job history may not indicate that this SQL Agent job has successfully completed; this behavior is by design.</span></span> <span data-ttu-id="3e1ce-196">如果失敗，作業會在 1 分鐘內重新啟動，並繼續執行而每況愈下。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-196">If there is a failure, the job will restart within 1 minute and continue running unabated.</span></span> <span data-ttu-id="3e1ce-197">因此，通常可以忽略此工作的失敗通知。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-197">Therefore, failure notifications for this job can typically be ignored.</span></span> <span data-ttu-id="3e1ce-198">如果 MessageBox_Message_ManageRefCountLog_BizTalkMsgBoxDb SQL Server Agent 作業的作業記錄指出此工作經常失敗和重新啟動失敗/重新啟動週期的進一步調查原因可能需要。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-198">If the job history for the MessageBox_Message_ManageRefCountLog_BizTalkMsgBoxDb SQL Server Agent job indicates that this job is constantly failing and restarting then further investigation into the cause of the failure/restart cycle may be required.</span></span><br /><span data-ttu-id="3e1ce-199">- **MessageBox_Message_Cleanup_BizTalkMsgBoxDb** SQL Server Agent 作業是應以手動方式啟用，因為它由 MessageBox_Message_ManageRefCountLog_BizTalkMsgBoxDb 工作啟始的唯一工作。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-199">-   The **MessageBox_Message_Cleanup_BizTalkMsgBoxDb** SQL Server Agent job is the only job that should not be manually enabled because it is initiated by the MessageBox_Message_ManageRefCountLog_BizTalkMsgBoxDb job.</span></span><br /><span data-ttu-id="3e1ce-200">- **DTA 清除與封存**SQL Server Agent 作業會維護[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]追蹤資料庫清除和封存追蹤的訊息。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-200">-   The **DTA Purge and Archive** SQL Server Agent job maintains the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] tracking database by purging and archiving tracked messages.</span></span> <span data-ttu-id="3e1ce-201">這項作業會讀取資料表中的每個資料列，並比較每個資料列，以判斷是否應該移除該記錄的時間戳記。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-201">This job reads every row in the table and compares the timestamp of each row to determine if the record should be removed.</span></span> <span data-ttu-id="3e1ce-202">**注意：**進行疑難排解時[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]SQL Server Agent 作業，請確認 MessageBox_Message_ManageRefCountLog_BizTalkMsgBoxDb 以外的所有 SQL Agent 作業所都完成無誤。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-202">**Note:**  When troubleshooting the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] SQL Server Agent jobs, verify that all SQL Agent jobs except the MessageBox_Message_ManageRefCountLog_BizTalkMsgBoxDb are completing without errors.</span></span> <br /><br /> <span data-ttu-id="3e1ce-203">如需有關[!INCLUDE[btsBizTalkServer2006r3](../includes/btsbiztalkserver2006r3-md.md)]SQL Agent 作業中使用[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]:</span><span class="sxs-lookup"><span data-stu-id="3e1ce-203">For more information about the [!INCLUDE[btsBizTalkServer2006r3](../includes/btsbiztalkserver2006r3-md.md)] SQL Agent Jobs used in [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]:</span></span><br /><br /> <span data-ttu-id="3e1ce-204">-了解[資料庫結構與工作](http://go.microsoft.com/fwlink/?LinkId=153451)(http://go.microsoft.com/fwlink/?LinkId=153451)。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-204">-   See [Database Structure and Jobs](http://go.microsoft.com/fwlink/?LinkId=153451) (http://go.microsoft.com/fwlink/?LinkId=153451).</span></span><br /><span data-ttu-id="3e1ce-205">-了解[描述 SQL Server Agent 的作業在 BizTalk Server](http://go.microsoft.com/fwlink/?LinkId=153452) (http://go.microsoft.com/fwlink/?LinkId=153452)。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-205">-   See [Description of the SQL Server Agent jobs in BizTalk Server](http://go.microsoft.com/fwlink/?LinkId=153452) (http://go.microsoft.com/fwlink/?LinkId=153452).</span></span>|  
|<span data-ttu-id="3e1ce-206">監視並終止擱置的執行個體</span><span class="sxs-lookup"><span data-stu-id="3e1ce-206">Monitor and terminate suspended instances</span></span>|<span data-ttu-id="3e1ce-207">服務執行個體可以擱置 （可繼續） 或已擱置 （不可繼續）。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-207">Service instances can be suspended (resumable) or suspended (not resumable).</span></span> <span data-ttu-id="3e1ce-208">這些服務執行個體可能訊息、 協調流程或連接埠。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-208">These service instances may be Messaging, Orchestration, or Port.</span></span> [!INCLUDE[btsBizTalkServer2006r3](../includes/btsbiztalkserver2006r3-md.md)]<span data-ttu-id="3e1ce-209">使用中的 [群組中樞] 頁面會終止，並移除這些執行個體的調節[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]管理主控台或透過 Terminate.vbs 指令碼使用。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-209"> accommodates termination and removal of these instances by using the Group Hub page in the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] Administration Console or through the use of the Terminate.vbs script.</span></span> <span data-ttu-id="3e1ce-210">如需 Terminate.vbs 指令碼的詳細資訊，請參閱[移除已擱置服務執行個體](http://go.microsoft.com/fwlink/?LinkId=153453)(http://go.microsoft.com/fwlink/?LinkId=153453)。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-210">For more information about the Terminate.vbs script, see [Removing Suspended Service Instance](http://go.microsoft.com/fwlink/?LinkId=153453) (http://go.microsoft.com/fwlink/?LinkId=153453).</span></span> <span data-ttu-id="3e1ce-211">**提示：**您也可以使用 [結束字元] 工具來移除已擱置的執行個體。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-211">**Tip:**  You can also use the Terminator tool to remove suspended instances.</span></span> <span data-ttu-id="3e1ce-212">[結束字元工具](http://go.microsoft.com/fwlink/?LinkId=151931)位於[http://go.microsoft.com/fwlink/?LinkId=151931](http://go.microsoft.com/fwlink/?LinkId=151931)。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-212">The [Terminator tool](http://go.microsoft.com/fwlink/?LinkId=151931) is available at [http://go.microsoft.com/fwlink/?LinkId=151931](http://go.microsoft.com/fwlink/?LinkId=151931).</span></span> <span data-ttu-id="3e1ce-213">使用此工具不支援的 Microsoft，Microsoft 並不保證此程式的適用性。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-213">Use of this tool is not supported by Microsoft, and Microsoft makes no guarantees about the suitability of this programs.</span></span> <span data-ttu-id="3e1ce-214">請自行承擔使用這個程式的一切風險。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-214">Use of this program is entirely at your own risk.</span></span> <br /><br /> <span data-ttu-id="3e1ce-215">詞彙 「 孤立項目 」 以及 「 zombie"經常交換使用。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-215">The terms "orphans” and "zombies" are often used interchangeably.</span></span> <span data-ttu-id="3e1ce-216">被遺棄或 zombie 的訊息是沒有相關聯的服務執行個體，通常是因為服務執行個體已終止之前收到訊息的訊息。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-216">An orphaned or zombie message is a message that does not have an associated service instance, typically because the service instance has terminated before the message was received.</span></span> <span data-ttu-id="3e1ce-217">被遺棄或 zombie 服務是一項服務，並沒有任何相關聯的訊息。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-217">An orphaned or zombie service is a service that does not have any associated messages.</span></span> <span data-ttu-id="3e1ce-218">如需有關廢止訊息與服務執行個體中的[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]看到[BizTalk Server 中的 Zombie](http://go.microsoft.com/fwlink/?LinkId=153454) (http://go.microsoft.com/fwlink/?LinkId=153454)。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-218">For more information about zombie messages and service instances in [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] see [Zombies in BizTalk Server](http://go.microsoft.com/fwlink/?LinkId=153454) (http://go.microsoft.com/fwlink/?LinkId=153454).</span></span>|  
|<span data-ttu-id="3e1ce-219">監視效能計數器的**PhysicalDisk**效能物件</span><span class="sxs-lookup"><span data-stu-id="3e1ce-219">Monitor the performance counters of the **PhysicalDisk** performance object</span></span>|[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]<span data-ttu-id="3e1ce-220">在一分鐘內對 SQL Server 大量簡短、 非常快速的交易。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-220"> makes a large number of short, very quick transactions to SQL Server within one minute.</span></span> <span data-ttu-id="3e1ce-221">如果 SQL Server 無法承受此活動，您可能會遇到[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]效能問題。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-221">If the SQL Server cannot sustain this activity, you may experience [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] performance issues.</span></span> <span data-ttu-id="3e1ce-222">監視**avg.Disk sec/Read**， **avg.Disk sec/Transfer**，和**avg.Disk sec/Write**效能監視器計數器**PhysicalDisk**效能物件。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-222">Monitor the **Avg. Disk sec/Read**, **Avg. Disk sec/Transfer**, and **Avg. Disk sec/Write** performance monitor counters in the **PhysicalDisk** performance object.</span></span> <span data-ttu-id="3e1ce-223">最佳值仍小於 10 毫秒 （毫秒）。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-223">The optimal value is less than 10 ms (milliseconds).</span></span> <span data-ttu-id="3e1ce-224">20 毫秒或更大的值會被視為不佳的效能。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-224">A value of 20 ms or larger is considered poor performance.</span></span><br /><br /> <span data-ttu-id="3e1ce-225">-如需有關 SQL Server 2005 效能的詳細資訊，請參閱[效能問題的疑難排解 SQL Server 2005](http://go.microsoft.com/fwlink/?LinkID=153585) (http://go.microsoft.com/fwlink/?LinkID=153585)。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-225">-   For more information about SQL Server 2005 performance, see [Troubleshooting Performance Problems in SQL Server 2005](http://go.microsoft.com/fwlink/?LinkID=153585) (http://go.microsoft.com/fwlink/?LinkID=153585).</span></span><br /><span data-ttu-id="3e1ce-226">-如需有關 SQL Server 2008 效能的詳細資訊，請參閱[效能問題的疑難排解 SQL Server 2008](http://go.microsoft.com/fwlink/?LinkID=153586) (http://go.microsoft.com/fwlink/?LinkID=153586)。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-226">-   For more information about SQL Server 2008 performance, see [Troubleshooting Performance Problems in SQL Server 2008](http://go.microsoft.com/fwlink/?LinkID=153586) (http://go.microsoft.com/fwlink/?LinkID=153586).</span></span><br /><span data-ttu-id="3e1ce-227">-如需有關[!INCLUDE[btsBizTalkServer2006r3](../includes/btsbiztalkserver2006r3-md.md)]資料庫高可用性，請參閱[的 BizTalk Server 資料庫提供高可用性](http://go.microsoft.com/fwlink/?LinkId=153587)(http://go.microsoft.com/fwlink/?LinkId=153587)。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-227">-   For more information about [!INCLUDE[btsBizTalkServer2006r3](../includes/btsbiztalkserver2006r3-md.md)] database high availability, see [Providing High Availability for BizTalk Server Databases](http://go.microsoft.com/fwlink/?LinkId=153587) (http://go.microsoft.com/fwlink/?LinkId=153587).</span></span><br /><br /> <span data-ttu-id="3e1ce-228">您也可以參考下列 Microsoft 知識庫文件，如需有關 SQL Server 效能：</span><span class="sxs-lookup"><span data-stu-id="3e1ce-228">You can also refer to the following Microsoft Knowledge Base articles for more information about SQL Server performance:</span></span><br /><br /> <span data-ttu-id="3e1ce-229">-   **298475** – [< 如何疑難排解 SQL Server 效能問題 >](http://go.microsoft.com/fwlink/?LinkId=153588) (http://go.microsoft.com/fwlink/?LinkId=153588)。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-229">-   **298475** – ["How to troubleshoot SQL Server performance issues”](http://go.microsoft.com/fwlink/?LinkId=153588) (http://go.microsoft.com/fwlink/?LinkId=153588).</span></span><br /><span data-ttu-id="3e1ce-230">-   **271509** – [「 如何監視 SQL Server 2005 中封鎖 」](http://go.microsoft.com/fwlink/?LinkId=153589) (http://go.microsoft.com/fwlink/?LinkId=153589)。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-230">-   **271509** – ["How to monitor blocking in SQL Server 2005"](http://go.microsoft.com/fwlink/?LinkId=153589) (http://go.microsoft.com/fwlink/?LinkId=153589).</span></span>|  
|<span data-ttu-id="3e1ce-231">請遵循最佳作法[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]資料庫。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-231">Follow best practices for [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] databases.</span></span>|<span data-ttu-id="3e1ce-232">請參閱[維護 BizTalk Server 資料庫的最佳作法](~/technical-guides/best-practices-for-maintaining-biztalk-server-databases.md)。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-232">See [Best Practices for Maintaining BizTalk Server Databases](~/technical-guides/best-practices-for-maintaining-biztalk-server-databases.md).</span></span>|  
  
<a name="BKMK_Troubleshoot"></a>   
## <a name="troubleshooting-biztalk-server-databases"></a><span data-ttu-id="3e1ce-233">疑難排解 BizTalk Server 資料庫</span><span class="sxs-lookup"><span data-stu-id="3e1ce-233">Troubleshooting BizTalk Server Databases</span></span>  
 <span data-ttu-id="3e1ce-234">執行下列工作，以疑難排解任何問題[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]資料庫。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-234">Perform the following tasks to troubleshoot any issues with [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] databases.</span></span>  
  
|<span data-ttu-id="3e1ce-235">步驟</span><span class="sxs-lookup"><span data-stu-id="3e1ce-235">Steps</span></span>|<span data-ttu-id="3e1ce-236">參考</span><span class="sxs-lookup"><span data-stu-id="3e1ce-236">Reference</span></span>|  
|-----------|---------------|  
|<span data-ttu-id="3e1ce-237">請確定所有必要的 BizTalk SQL Server Agent 作業已啟用且正在執行</span><span class="sxs-lookup"><span data-stu-id="3e1ce-237">Ensure all required BizTalk SQL Server Agent jobs are enabled and running</span></span>|<span data-ttu-id="3e1ce-238">所有 BizTalk SQL Server Agent 都作業，除了**MessageBox_Message_ManageRefCountLog_BizTalkMsgBoxDb**作業應該啟用且正在執行成功。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-238">All the BizTalk SQL Server Agent jobs except the **MessageBox_Message_ManageRefCountLog_BizTalkMsgBoxDb** job should be enabled and running successfully.</span></span> <span data-ttu-id="3e1ce-239">請勿停用任何其他工作。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-239">Do not disable any other job.</span></span><br /><br /> <span data-ttu-id="3e1ce-240">如果發生失敗，使用**檢視記錄**檢視錯誤的資訊，並據以解決惡意軟體移除失敗的 SQL Server 中的選項。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-240">If a failure occurs, use the **View History** option in SQL Server to view the error information, and then troubleshoot the failure accordingly.</span></span> <span data-ttu-id="3e1ce-241">請記住， **MessageBox _Message_ManageRefCountLog_BizTalkMsgBoxDb**持續執行 SQL Server Agent 作業。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-241">Remember that the **MessageBox _Message_ManageRefCountLog_BizTalkMsgBoxDb** SQL Server Agent job runs infinitely.</span></span> <span data-ttu-id="3e1ce-242">因此，您應該只是在意作業歷程記錄報告工作經常失敗，並重新啟動。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-242">Therefore, you should only be concerned if the job history reports that the job constantly fails and restarts.</span></span>|  
|<span data-ttu-id="3e1ce-243">使用 MsgBoxViewer 工具來分析 BizTalk MessageBox 資料庫與其他資料庫</span><span class="sxs-lookup"><span data-stu-id="3e1ce-243">Use the MsgBoxViewer tool to analyze the BizTalk MessageBox and other databases</span></span>|<span data-ttu-id="3e1ce-244">**重要事項：**使用此工具不支援的 Microsoft 和 Microsoft 並不保證此程式的適用性。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-244">**Important:**  Use of this tool is not supported by Microsoft, and Microsoft makes no guarantees about the suitability of this programs.</span></span> <span data-ttu-id="3e1ce-245">請自行承擔使用這個程式的一切風險。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-245">Use of this program is entirely at your own risk.</span></span> <br /><br /> <span data-ttu-id="3e1ce-246">MsgBoxViewer 工具會從[http://go.microsoft.com/fwlink/?LinkId=151930](http://go.microsoft.com/fwlink/?LinkId=151930) (http://go.microsoft.com/fwlink/?LinkId=151930)。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-246">The MsgBoxViewer tool is available from [http://go.microsoft.com/fwlink/?LinkId=151930](http://go.microsoft.com/fwlink/?LinkId=151930) (http://go.microsoft.com/fwlink/?LinkId=151930).</span></span> <span data-ttu-id="3e1ce-247">MsgBoxViewer 工具可用於疑難排解，因為它會提供 HTML 報表，詳細資料表的大小和資料列計數資訊。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-247">The MsgBoxViewer tool is useful for troubleshooting because it provides an HTML report that has detailed information about table sizes and the row count.</span></span> <span data-ttu-id="3e1ce-248">報表也可以協助判斷是否[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]正在進行節流。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-248">The report can also help determine whether [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] is throttling.</span></span> <span data-ttu-id="3e1ce-249">此外，此工具提供的快照集[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]資料庫和[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]組態。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-249">Additionally, the tool provides a snapshot of the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] databases and the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] configuration.</span></span><br /><br /> <span data-ttu-id="3e1ce-250">當[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]是執行速度比平常更久，執行 MsgBoxViewer 工具中，按一下以選取所有的查詢上**選擇性查詢**索引標籤，然後再檢閱產生的 HTML 報告，如有任何問題。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-250">When [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] is running slower than usual, run the MsgBoxViewer tool, click to select all queries on the **Optional Queries** tab, and then review the generated HTML report for any problems.</span></span> <span data-ttu-id="3e1ce-251">**摘要報表**區段會列出中以紅色的黃色和潛在問題的警告。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-251">The **Summary Report** section lists warnings in yellow and potential problems in red.</span></span><br /><br /> <span data-ttu-id="3e1ce-252">此外，您可以使用 MsgBoxViewer 工具來判斷哪些資料表是最大和大部分的記錄。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-252">Additionally, you can use the MsgBoxViewer tool to determine which tables are the largest and have the most records.</span></span> <span data-ttu-id="3e1ce-253">通常擴大 larges 的資料表清單以及如何管理這些資料表上的指示，請參閱[大成長 BizTalk Server 資料庫資料表](~/technical-guides/large-growing-biztalk-server-database-tables.md)。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-253">For a list of tables that typically grow the larges and for instructions on how to manage those tables, see [Large-growing BizTalk Server Database Tables](~/technical-guides/large-growing-biztalk-server-database-tables.md).</span></span>|  
|<span data-ttu-id="3e1ce-254">如果任何，由 MsgBoxViewer 工具，來解決問題，使用結束字元工具</span><span class="sxs-lookup"><span data-stu-id="3e1ce-254">Use the Terminator tool to resolve issues, if any, identified by the MsgBoxViewer tool</span></span>|<span data-ttu-id="3e1ce-255">**重要事項：**使用此工具不支援的 Microsoft 和 Microsoft 並不保證此程式的適用性。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-255">**Important:**  Use of this tool is not supported by Microsoft, and Microsoft makes no guarantees about the suitability of this programs.</span></span> <span data-ttu-id="3e1ce-256">請自行承擔使用這個程式的一切風險。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-256">Use of this program is entirely at your own risk.</span></span> <br /><br /> <span data-ttu-id="3e1ce-257">執行位於結束字元工具[結束字元](http://go.microsoft.com/fwlink/?LinkId=151931)(http://go.microsoft.com/fwlink/?LinkId=151931)。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-257">Run the Terminator tool available at [Terminator](http://go.microsoft.com/fwlink/?LinkId=151931) (http://go.microsoft.com/fwlink/?LinkId=151931).</span></span> <span data-ttu-id="3e1ce-258">此工具可讓使用者輕鬆地解決 BizTalk MsgBoxViewer 工具所識別的任何問題。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-258">This tool enables users to easily resolve any issues identified by the BizTalk MsgBoxViewer tool.</span></span> <span data-ttu-id="3e1ce-259">如需有關結束字元工具如何與 BizTalk MsgBoxViewer 工具整合的詳細資訊，請參閱[解決 BizTalk MsgBoxViewer 所識別的問題使用 BizTalk 結束字元](http://go.microsoft.com/fwlink/?LinkId=151932)(http://go.microsoft.com/fwlink/?LinkId=151932)。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-259">For more information on how the Terminator tool integrates with the BizTalk MsgBoxViewer tool, see [Using BizTalk Terminator to resolve issues identified by BizTalk MsgBoxViewer](http://go.microsoft.com/fwlink/?LinkId=151932) (http://go.microsoft.com/fwlink/?LinkId=151932).</span></span>|  
|<span data-ttu-id="3e1ce-260">調查死結狀況</span><span class="sxs-lookup"><span data-stu-id="3e1ce-260">Investigate deadlock scenarios</span></span>|<span data-ttu-id="3e1ce-261">在死結案例中，啟用 SQL Server 上的 DBCC 追蹤讓死結資訊寫入 SQLERROR 記錄檔。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-261">In a deadlock scenario, enable DBCC tracing on the SQL Server so that the deadlock information is written to the SQLERROR log.</span></span><br /><br /> <span data-ttu-id="3e1ce-262">在 SQL Server 2008 或 SQL Server 2005 中，執行下列陳述式啟用 DBCC 追蹤死結案例：</span><span class="sxs-lookup"><span data-stu-id="3e1ce-262">In SQL Server 2008 or SQL Server 2005, execute the following statement to enable DBCC tracing for deadlock scenarios:</span></span><br /><br /> <span data-ttu-id="3e1ce-263">DBCC TRACEON (1222，-1)</span><span class="sxs-lookup"><span data-stu-id="3e1ce-263">DBCC TRACEON (1222,-1)</span></span><br /><br /> <span data-ttu-id="3e1ce-264">您也可以使用 PSSDIAG 公用程式收集資料**Lock: Deadlock**事件和**Lock: Deadlock Chain**事件。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-264">You can also use the PSSDIAG utility to collect data on the **Lock:Deadlock** event and the **Lock:Deadlock Chain** event.</span></span> <span data-ttu-id="3e1ce-265">如需 PSSDIAG 公用程式的詳細資訊，請參閱[PSSDIAG 資料收集公用程式](http://go.microsoft.com/fwlink/?LinkId=153627)(http://go.microsoft.com/fwlink/?LinkId=153627)。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-265">For more information about the PSSDIAG utility, see [PSSDIAG data collection utility](http://go.microsoft.com/fwlink/?LinkId=153627) (http://go.microsoft.com/fwlink/?LinkId=153627).</span></span><br /><br /> <span data-ttu-id="3e1ce-266">高容量和高交易的線上交易處理 (OLTP) 資料庫 BizTalkMsgBoxDB 資料庫。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-266">The BizTalkMsgBoxDB database is a high-volume and high-transaction Online Transaction Processing (OLTP) database.</span></span> <span data-ttu-id="3e1ce-267">使用這類資料庫時，預期某些死結，而且這個死結會在內部處理[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]引擎。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-267">With such databases, some deadlocking is expected and this deadlocking is handled internally by the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] engine.</span></span> <span data-ttu-id="3e1ce-268">當這個行為發生時，沒有錯誤會列在錯誤記錄檔。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-268">When this behavior occurs, no errors are listed in the error logs.</span></span> <span data-ttu-id="3e1ce-269">當您調查死結案例時，死結輸出中，您正在調查的必須與事件記錄檔中的死結錯誤相互關聯。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-269">When you investigate a deadlock scenario, the deadlock that you are investigating in the output must be correlated with a deadlock error in the event logs.</span></span>|  
|<span data-ttu-id="3e1ce-270">尋找封鎖處理序</span><span class="sxs-lookup"><span data-stu-id="3e1ce-270">Look for blocked processes</span></span>|<span data-ttu-id="3e1ce-271">您可以使用 SQL Server 中的活動監視器來取得鎖定的系統處理序的伺服器處理序識別碼 (SPID)。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-271">You can use Activity Monitor in SQL Server to obtain the server process identifier (SPID) of a locking system process.</span></span> <span data-ttu-id="3e1ce-272">然後，您可以執行 SQL Profiler，以判斷在鎖定 SPID 中執行的 SQL 陳述式。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-272">You can then run the SQL Profiler to determine the SQL statement that is executing in the locking SPID.</span></span> <span data-ttu-id="3e1ce-273">PSSDIAG 公用程式可用來疑難排解 SQL Server 中的鎖定和封鎖問題。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-273">You can use the PSSDIAG utility to troubleshoot locking and blocking issues in SQL Server.</span></span> <span data-ttu-id="3e1ce-274">此公用程式會擷取已啟用的封鎖指令碼的所有 TRANSACT-SQL 事件。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-274">The utility captures all the Transact-SQL events that have the blocking script enabled.</span></span> <span data-ttu-id="3e1ce-275">如需 PSSDIAG 公用程式的詳細資訊，請參閱[PSSDIAG 資料收集公用程式](http://go.microsoft.com/fwlink/?LinkId=153627)(http://go.microsoft.com/fwlink/?LinkId=153627)。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-275">For more information about the PSSDIAG utility, see [PSSDIAG data collection utility](http://go.microsoft.com/fwlink/?LinkId=153627) (http://go.microsoft.com/fwlink/?LinkId=153627).</span></span><br /><br /> <span data-ttu-id="3e1ce-276">在 SQL Server 2005 和更新版本，您可以指定**已封鎖處理序臨界值**設定來判斷哪一個 SPID 或 Spid 封鎖時間比您指定的臨界值還要長。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-276">In SQL Server 2005 and later versions, you can specify the **blocked process threshold** setting to determine which SPID or SPIDs are blocking longer than the threshold that you specify.</span></span> <span data-ttu-id="3e1ce-277">如需 blocked 的 process threshold 選項的詳細資訊，請參閱[已封鎖處理序臨界值選項](http://go.microsoft.com/fwlink/?LinkId=153628)(http://go.microsoft.com/fwlink/?LinkId=153628)。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-277">For more information about the blocked process threshold option, see [blocked process threshold Option](http://go.microsoft.com/fwlink/?LinkId=153628) (http://go.microsoft.com/fwlink/?LinkId=153628).</span></span> <span data-ttu-id="3e1ce-278">**注意：**當您遇到 SQL Server 中的鎖定或封鎖問題時，我們建議您連絡 Microsoft 客戶支援服務。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-278">**Note:**  When you experience a locking or blocking issue in SQL Server, we recommend that you contact Microsoft Customer Support Services.</span></span> <span data-ttu-id="3e1ce-279">Microsoft 客戶支援服務，可協助您設定正確的 PSSDiag 公用程式選項。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-279">Microsoft Customer Support Services can help you configure the correct PSSDiag utility options.</span></span>|  
|<span data-ttu-id="3e1ce-280">刪除所有不必要的資料</span><span class="sxs-lookup"><span data-stu-id="3e1ce-280">Delete all unwanted data</span></span>|<span data-ttu-id="3e1ce-281">如果資料庫已經成長變得太大，而且包含在資料庫中的資料將不需要再，慣用的方法是刪除的資料。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-281">If the databases have grown to become too large and if the data contained in the databases will not be required any longer, the preferred method is to delete the data.</span></span> <span data-ttu-id="3e1ce-282">**注意：**請勿使用這個方法在任何環境中重要商務資料，或如果所需的資料，資料的所在。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-282">**Caution:**  Do not use this method in any environment where the data is business critical or if the data is needed.</span></span> <br /><br /> <span data-ttu-id="3e1ce-283">**若要清除 BizTalkMsgBox 資料庫**</span><span class="sxs-lookup"><span data-stu-id="3e1ce-283">**To purge the BizTalkMsgBox database**</span></span><br /> <span data-ttu-id="3e1ce-284">1.下載並安裝在結束字元工具[Biztalk 結束字元](http://go.microsoft.com/fwlink/?LinkId=220869)(http://go.microsoft.com/fwlink/?LinkId=220869)。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-284">1.  Download and install the Terminator tool at [Biztalk Terminator](http://go.microsoft.com/fwlink/?LinkId=220869) (http://go.microsoft.com/fwlink/?LinkId=220869).</span></span><br /><span data-ttu-id="3e1ce-285">2.遵循本主題中的步驟[如何從測試環境中的 MessageBox 資料庫手動清除資料](http://go.microsoft.com/fwlink/?LinkID=158064)(http://go.microsoft.com/fwlink/?LinkID=158064) 建立 bts_CleanupMsgbox 預存程序，在 BizTalk MessageBox 資料庫。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-285">2.  Follow the steps in the topic [How to Manually Purge Data from the MessageBox Database in a Test Environment](http://go.microsoft.com/fwlink/?LinkID=158064) (http://go.microsoft.com/fwlink/?LinkID=158064) to create the bts_CleanupMsgbox stored procedure in the BizTalk MessageBox database.</span></span><br /><span data-ttu-id="3e1ce-286">3.使用結束字元工具執行 bts_CleanupMsgbox 預存程序，並清除 BizTalk MessageBox 資料庫。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-286">3.  Use the Terminator tool to execute the bts_CleanupMsgbox stored procedure and purge the BizTalk MessageBox database.</span></span> <span data-ttu-id="3e1ce-287">**警告：**是否正在執行 BizTalk Server 在實際伺服器上執行 bts_CleanupMsgbox 預存程序。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-287">**Warning:**      Do not run the bts_CleanupMsgbox stored procedure on a production server that is running BizTalk Server.</span></span> <span data-ttu-id="3e1ce-288">您應該只在測試環境中執行 bts_CleanupMsgbox 預存程序。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-288">You should only run the bts_CleanupMsgbox stored procedure in a test environment.</span></span> <span data-ttu-id="3e1ce-289">不支援在實際執行環境中執行 bts_CleanupMsgbox 預存程序。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-289">Running the bts_CleanupMsgbox stored procedure in a production environment is not supported.</span></span><br /><span data-ttu-id="3e1ce-290">4.重新啟動所有主機和[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]服務。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-290">4.  Restart all hosts and [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] services.</span></span><br /><br /> <span data-ttu-id="3e1ce-291">**若要清除 BizTalkDTADb 資料庫**</span><span class="sxs-lookup"><span data-stu-id="3e1ce-291">**To purge the BizTalkDTADb database**</span></span><br /> <ul><li><span data-ttu-id="3e1ce-292">**方法 1**</span><span class="sxs-lookup"><span data-stu-id="3e1ce-292">**Method 1**</span></span><br /><br /> <ol><li><span data-ttu-id="3e1ce-293">備份所有[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]資料庫。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-293">Back up all [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] databases.</span></span></li><li><span data-ttu-id="3e1ce-294">執行**[dtasp_purgeallcompletedtrackingdata]**預存程序。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-294">Execute the **dtasp_PurgeAllCompletedTrackingData** stored procedure.</span></span> <span data-ttu-id="3e1ce-295">如需有關預存程序的詳細資訊，請參閱[如何從 BizTalk 追蹤資料庫手動清除資料](http://go.microsoft.com/fwlink/?LinkId=153635)(http://go.microsoft.com/fwlink/?LinkId=153635)。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-295">For more information about the stored procedure, see [How to Manually Purge Data from the BizTalk Tracking Database](http://go.microsoft.com/fwlink/?LinkId=153635) (http://go.microsoft.com/fwlink/?LinkId=153635).</span></span></li></ol></li><li><span data-ttu-id="3e1ce-296">**方法 2**。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-296">**Method 2**.</span></span> <span data-ttu-id="3e1ce-297">只有當 BizTalkDTADb 資料庫包含許多未完成的執行個體，必須先移除，請使用此選項。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-297">Use this option only if the BizTalkDTADb database contains many incomplete instances that must be removed.</span></span><br /><br /> <ol><li><span data-ttu-id="3e1ce-298">備份所有[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]資料庫。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-298">Back up all [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] databases.</span></span></li><li><span data-ttu-id="3e1ce-299">停止所有 BizTalk 主控件、 服務和自訂的外掛式配接器。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-299">Stop all BizTalk hosts, services, and custom isolated adapters.</span></span> <span data-ttu-id="3e1ce-300">如果您使用 HTTP 或 SOAP 配接器，請重新啟動 IIS 服務。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-300">If you use HTTP or the SOAP adapter, restart the IIS services.</span></span></li><li><span data-ttu-id="3e1ce-301">執行**dtasp_CleanHMData** BizTalkDTADb 資料庫上預存程序。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-301">Execute the **dtasp_CleanHMData** stored procedure on the BizTalkDTADb database.</span></span></li><li><span data-ttu-id="3e1ce-302">重新啟動所有主機和[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]服務。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-302">Restart all hosts and [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] services.</span></span></li></ol></li></ul> <span data-ttu-id="3e1ce-303">**注意：**如果您的追蹤資料，BizTalkDTADb 資料庫，必須將資料庫還原到另一個的 SQL Server，然後清除 原始 BizTalkDTADb 資料庫。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-303">**Note:**  If you must have the tracking data, back up the BizTalkDTADb database, restore the database to another SQL Server, and then purge the original BizTalkDTADb database.</span></span>|  
  
 <span data-ttu-id="3e1ce-304">如果您需要分析 MsgBoxViewer 資料或 PSSDIAG 輸出的說明，請連絡 Microsoft 客戶支援服務。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-304">If you want help analyzing the MsgBoxViewer data or PSSDIAG output, contact Microsoft Customer Support Services.</span></span> <span data-ttu-id="3e1ce-305">連絡客戶支援服務之前，壓縮 MsgBoxViewer 資料、 PSSDIAG 輸出和更新的事件記錄檔 （.evt 檔案）。</span><span class="sxs-lookup"><span data-stu-id="3e1ce-305">Before you contact Customer Support Services, compress the MsgBoxViewer data, the PSSDIAG output, and the updated event logs (.evt files).</span></span> <span data-ttu-id="3e1ce-306">您可能要傳送這些檔案，以[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]支援工程師</span><span class="sxs-lookup"><span data-stu-id="3e1ce-306">You may have to send these files to a [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] support engineer</span></span>  
  
## <a name="in-this-section"></a><span data-ttu-id="3e1ce-307">本節內容</span><span class="sxs-lookup"><span data-stu-id="3e1ce-307">In This Section</span></span>  
  
-   [<span data-ttu-id="3e1ce-308">維護 BizTalk Server 資料庫的最佳作法</span><span class="sxs-lookup"><span data-stu-id="3e1ce-308">Best Practices for Maintaining BizTalk Server Databases</span></span>](~/technical-guides/best-practices-for-maintaining-biztalk-server-databases.md)  
  
-   [<span data-ttu-id="3e1ce-309">大型成長的情況的 BizTalk Server 資料庫資料表</span><span class="sxs-lookup"><span data-stu-id="3e1ce-309">Large-growing BizTalk Server Database Tables</span></span>](~/technical-guides/large-growing-biztalk-server-database-tables.md)  
  
-   [<span data-ttu-id="3e1ce-310">工具和公用程式進行疑難排解</span><span class="sxs-lookup"><span data-stu-id="3e1ce-310">Tools and Utilities for Troubleshooting</span></span>](../technical-guides/tools-and-utilities-for-troubleshooting.md)  
  
## <a name="see-also"></a><span data-ttu-id="3e1ce-311">另請參閱</span><span class="sxs-lookup"><span data-stu-id="3e1ce-311">See Also</span></span>  
 [<span data-ttu-id="3e1ce-312">不應該變更的 SQL Server 設定</span><span class="sxs-lookup"><span data-stu-id="3e1ce-312">SQL Server Settings That Should Not Be Changed</span></span>](~/technical-guides/sql-server-settings-that-should-not-be-changed.md)