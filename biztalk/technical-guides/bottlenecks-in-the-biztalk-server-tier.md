---
title: BizTalk Server 層中的瓶頸 |Microsoft 文件
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: 3ad36897-4e4a-43b9-9cb7-0bf22bd954fb
caps.latest.revision: 12
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: cd2eddf6cc88737375998237db97ca699a676170
ms.sourcegitcommit: 5abd0ed3f9e4858ffaaec5481bfa8878595e95f7
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 11/28/2017
ms.locfileid: "25976772"
---
# <a name="bottlenecks-in-the-biztalk-server-tier"></a><span data-ttu-id="93414-102">BizTalk Server 層中的瓶頸</span><span class="sxs-lookup"><span data-stu-id="93414-102">Bottlenecks in the BizTalk Server Tier</span></span>
<span data-ttu-id="93414-103">BizTalk 層可以區分為下列功能區域：</span><span class="sxs-lookup"><span data-stu-id="93414-103">The BizTalk tier can be divided into the following functional areas:</span></span>  
  
-   <span data-ttu-id="93414-104">接收</span><span class="sxs-lookup"><span data-stu-id="93414-104">Receiving</span></span>  
  
-   <span data-ttu-id="93414-105">Processing</span><span class="sxs-lookup"><span data-stu-id="93414-105">Processing</span></span>  
  
-   <span data-ttu-id="93414-106">傳輸</span><span class="sxs-lookup"><span data-stu-id="93414-106">Transmitting</span></span>  
  
-   <span data-ttu-id="93414-107">追蹤</span><span class="sxs-lookup"><span data-stu-id="93414-107">Tracking</span></span>  
  
-   <span data-ttu-id="93414-108">其他</span><span class="sxs-lookup"><span data-stu-id="93414-108">Other</span></span>  
  
 <span data-ttu-id="93414-109">對於這些區域，如果似乎已經飽和，藉由向上擴充平台升級伺服器的系統資源 （CPU、 記憶體和磁碟），或逾時根據您的應用程式的特性。</span><span class="sxs-lookup"><span data-stu-id="93414-109">For these areas, if the system resources (CPU, memory, and disk) appear to be saturated, upgrade the server by scaling the platform up or out based on the characteristics of your application.</span></span> <span data-ttu-id="93414-110">如果系統資源尚未飽和，請執行在此節中描述的步驟。</span><span class="sxs-lookup"><span data-stu-id="93414-110">If the system resources are not saturated, perform the steps described in this section.</span></span>  
  
## <a name="bottlenecks-in-the-receive-location"></a><span data-ttu-id="93414-111">接收位置中的瓶頸</span><span class="sxs-lookup"><span data-stu-id="93414-111">Bottlenecks in the receive location</span></span>  
 <span data-ttu-id="93414-112">如果訊息在接收位置累積 （例如，檔案接收資料夾變得龐大），這表示系統是否無法跟上內送的載入速度不夠快吸收資料。</span><span class="sxs-lookup"><span data-stu-id="93414-112">If messages build up at the receive location (for example, file receive folder grows large), this indicates that the system is unable to absorb data fast enough to keep up with the incoming load.</span></span> <span data-ttu-id="93414-113">這是因為內部的節流。</span><span class="sxs-lookup"><span data-stu-id="93414-113">This is due to internal throttling.</span></span> <span data-ttu-id="93414-114">也就是 BizTalk Server 可以降低接收速率，如果 「 訂閱者 」 無法處理資料快速不足導致積存資料庫資料表中的。</span><span class="sxs-lookup"><span data-stu-id="93414-114">That is, BizTalk Server reduces the receiving rate if the subscribers are unable to process data fast enough causing backlog buildup in the database tables.</span></span> <span data-ttu-id="93414-115">如果瓶頸因為硬體限制，請嘗試向上擴充。</span><span class="sxs-lookup"><span data-stu-id="93414-115">If the bottleneck is caused by hardware limitations, try scaling up.</span></span> <span data-ttu-id="93414-116">如需向上延展的詳細資訊，請參閱 BizTalk Server 2010 文件中的下列主題：</span><span class="sxs-lookup"><span data-stu-id="93414-116">For more information about scaling up, see the following topics in the BizTalk Server 2010 documentation:</span></span>  
  
-   <span data-ttu-id="93414-117">[向上擴充 BizTalk Server 層](http://go.microsoft.com/fwlink/?LinkId=158073)(http://go.microsoft.com/fwlink/?LinkId=158073)。</span><span class="sxs-lookup"><span data-stu-id="93414-117">[Scaling Up the BizTalk Server Tier](http://go.microsoft.com/fwlink/?LinkId=158073) (http://go.microsoft.com/fwlink/?LinkId=158073).</span></span>  
  
-   <span data-ttu-id="93414-118">[向上擴充 SQL Server 層](http://go.microsoft.com/fwlink/?LinkId=158077)(http://go.microsoft.com/fwlink/?LinkId=158077)。</span><span class="sxs-lookup"><span data-stu-id="93414-118">[Scaling Up the SQL Server Tier](http://go.microsoft.com/fwlink/?LinkId=158077) (http://go.microsoft.com/fwlink/?LinkId=158077).</span></span>  
  
 <span data-ttu-id="93414-119">它也可向外延展，方法是加入主機對應到接收處理常式的主控件執行個體 （伺服器）。</span><span class="sxs-lookup"><span data-stu-id="93414-119">It is also possible to scale out by adding a host instance (server) to the host mapped to the receive handler.</span></span> <span data-ttu-id="93414-120">如需有關向外延展的詳細資訊，請參閱 BizTalk Server 2010 文件中的下列主題：</span><span class="sxs-lookup"><span data-stu-id="93414-120">For more information about scaling out, see the following topics in the BizTalk Server 2010 documentation:</span></span>  
  
-   <span data-ttu-id="93414-121">[向外擴充 BizTalk Server 層](http://go.microsoft.com/fwlink/?LinkId=158076)(http://go.microsoft.com/fwlink/?LinkId=158076)。</span><span class="sxs-lookup"><span data-stu-id="93414-121">[Scaling Out the BizTalk Server Tier](http://go.microsoft.com/fwlink/?LinkId=158076) (http://go.microsoft.com/fwlink/?LinkId=158076).</span></span>  
  
-   <span data-ttu-id="93414-122">[向外擴充 SQL Server 層](http://go.microsoft.com/fwlink/?LinkId=158075)(http://go.microsoft.com/fwlink/?LinkId=158075)。</span><span class="sxs-lookup"><span data-stu-id="93414-122">[Scaling Out the SQL Server Tier](http://go.microsoft.com/fwlink/?LinkId=158075) (http://go.microsoft.com/fwlink/?LinkId=158075).</span></span>  
  
 <span data-ttu-id="93414-123">使用 Perfmon 來監視系統上的資源使用。</span><span class="sxs-lookup"><span data-stu-id="93414-123">Use Perfmon to monitor the resource use on the system.</span></span> <span data-ttu-id="93414-124">確認外部的接收位置並非瓶頸肇因，這點很重要。</span><span class="sxs-lookup"><span data-stu-id="93414-124">It is important to confirm that the external receive location is not the cause of the bottleneck.</span></span> <span data-ttu-id="93414-125">例如，確認是否遠端檔案共用已飽和由於高磁碟 I/O、 裝載遠端外寄佇列的伺服器尚未飽和，或用戶端用來產生 HTTP 負載尚未用完執行緒。</span><span class="sxs-lookup"><span data-stu-id="93414-125">For example, confirm whether the remote file share is saturated due to high disk I/O, the server hosting the remote outgoing queue is not saturated, or the client used to generate HTTP load is not starved on threads.</span></span>  
  
## <a name="processing-bottlenecks"></a><span data-ttu-id="93414-126">處理瓶頸</span><span class="sxs-lookup"><span data-stu-id="93414-126">Processing bottlenecks</span></span>  
 <span data-ttu-id="93414-127">如果主控件佇列 – 長度 」 效能計數器正在攀升，則表示該協調流程沒有完成速度不夠快。</span><span class="sxs-lookup"><span data-stu-id="93414-127">If the Host Queue – Length performance counter is climbing, it indicates that the orchestrations are not completing fast enough.</span></span> <span data-ttu-id="93414-128">如需詳細資訊，請參閱本主題中的 Perfmon 計數器表格。</span><span class="sxs-lookup"><span data-stu-id="93414-128">For more information, see the Perfmon counter table in this topic.</span></span> <span data-ttu-id="93414-129">這可能是由於記憶體爭用或 CPU 飽和而導致。</span><span class="sxs-lookup"><span data-stu-id="93414-129">This could be due to memory contention or CPU saturation.</span></span>  
  
 <span data-ttu-id="93414-130">如果協調流程伺服器是瓶頸所在，請使用 Perfmon 以識別來源。</span><span class="sxs-lookup"><span data-stu-id="93414-130">If the orchestration servers are the bottleneck, use Perfmon to identify the source.</span></span>  
  
 <span data-ttu-id="93414-131">如果伺服器受限於 CPU 處理能力，請考慮下列各項：</span><span class="sxs-lookup"><span data-stu-id="93414-131">If the server is CPU bound, consider the following:</span></span>  
  
-   <span data-ttu-id="93414-132">如果工作流程很複雜，請考慮將分割成多個較小的協調流程的協調流程</span><span class="sxs-lookup"><span data-stu-id="93414-132">If the workflow is complex, consider splitting the orchestration into multiple smaller orchestrations</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="93414-133">將協調流程切割為多個工作流程，可能會導致額外的延遲狀況，並增加複雜度。</span><span class="sxs-lookup"><span data-stu-id="93414-133">Splitting an orchestration into multiple workflows can cause additional latency and add complexity.</span></span> <span data-ttu-id="93414-134">多個工作流程也可能導致增加在發行至及從 BizTalkMsgBoxDb 取用訊息的數目將額外的壓力放在資料庫上。</span><span class="sxs-lookup"><span data-stu-id="93414-134">Multiple workflows can also cause an increase in the number of messages published to and consumed from the BizTalkMsgBoxDb, putting additional pressure on the database.</span></span>  
  
-   <span data-ttu-id="93414-135">如果您使用複雜的對應，請考慮是否他們可以移至的接收/傳送埠。</span><span class="sxs-lookup"><span data-stu-id="93414-135">If you use complex maps, consider whether they can be moved to the Receive/Send ports.</span></span> <span data-ttu-id="93414-136">請務必確認哪些連接埠有額外的頻寬。</span><span class="sxs-lookup"><span data-stu-id="93414-136">Be sure to verify which ports have additional bandwidth.</span></span>  
  
-   <span data-ttu-id="93414-137">請考慮向上擴充硬體，或藉由設定額外的處理伺服器向外延展。</span><span class="sxs-lookup"><span data-stu-id="93414-137">Consider scaling up the hardware or scaling out by configuring an additional processing server.</span></span>  
  
## <a name="transmitting-bottlenecks"></a><span data-ttu-id="93414-138">傳輸瓶頸</span><span class="sxs-lookup"><span data-stu-id="93414-138">Transmitting bottlenecks</span></span>  
 <span data-ttu-id="93414-139">如果伺服器裝載傳送配接器已飽和的資源 （例如，磁碟、 記憶體或 CPU），請考慮向上擴充伺服器或向外擴充到其他傳送主機伺服器。</span><span class="sxs-lookup"><span data-stu-id="93414-139">If the server hosting the send adapters is saturated on resources (for example, disk, memory, or CPU), consider scaling-up the server or scaling-out to additional send host servers.</span></span> <span data-ttu-id="93414-140">如果目的地 (在 BizTalk 外部) 無法以夠快的速率接收資料，則傳送層可能會成為瓶頸。</span><span class="sxs-lookup"><span data-stu-id="93414-140">The sending tier could become the bottleneck if the destination (external to BizTalk) is unable to receive data fast enough.</span></span> <span data-ttu-id="93414-141">這會導致訊息在 MessageBox 資料庫 (Application SendHostQ) 中累積。</span><span class="sxs-lookup"><span data-stu-id="93414-141">This will cause messages to buildup in the MessageBox database (Application SendHostQ).</span></span>  
  
 <span data-ttu-id="93414-142">如果所有端點都拓樸的範圍內，找出目的地的原因。</span><span class="sxs-lookup"><span data-stu-id="93414-142">If all the endpoints are within the scope of the topology, isolate the cause at the destination.</span></span> <span data-ttu-id="93414-143">例如，判斷 HTTP 位置已最佳化設定成接收負載。</span><span class="sxs-lookup"><span data-stu-id="93414-143">For example, determine if the HTTP location is optimally configured to receive load.</span></span> <span data-ttu-id="93414-144">如果沒有，請考慮向外延展。也可以決定是否不斷增加由於 BizTalk 傳遞的過多的輸出訊息的目的地。</span><span class="sxs-lookup"><span data-stu-id="93414-144">If not, consider scaling out. Also determine if the destination is growing due to excessive output messages delivered by BizTalk.</span></span> <span data-ttu-id="93414-145">如果是，您可能需要維護計畫來封存及清除目的地訊息。</span><span class="sxs-lookup"><span data-stu-id="93414-145">If yes, you might need a maintenance plan to archive and purge the destination messages.</span></span> <span data-ttu-id="93414-146">大量的目的地資料夾中的檔案可能會嚴重影響 BizTalk 服務的資料認可到磁碟機的能力。</span><span class="sxs-lookup"><span data-stu-id="93414-146">Large numbers of files in a destination folder can severely impact the ability of the BizTalk service to commit data to the disk drive.</span></span>  
  
## <a name="tracking-bottlenecks"></a><span data-ttu-id="93414-147">追蹤瓶頸</span><span class="sxs-lookup"><span data-stu-id="93414-147">Tracking bottlenecks</span></span>  
 <span data-ttu-id="93414-148">追蹤主控件執行個體負責將商務活動監控 (BAM) 和健全狀況與活動追蹤 (HAT) 資料從 MessageBox 資料庫 （TrackingData 資料表） 移到 BizTalk 追蹤 」 和/或 BAM 主要匯入資料庫資料表。</span><span class="sxs-lookup"><span data-stu-id="93414-148">The Tracking host instance is responsible for moving the Business Activity Monitoring (BAM) and Health and Activity Tracking (HAT) data from the MessageBox database (TrackingData table) to the BizTalk Tracking and/or BAM Primary Import database tables.</span></span> <span data-ttu-id="93414-149">如果已設定多個 MessageBox 資料庫，則追蹤主控件執行個體使用四個執行緒，每個 MessageBox 資料庫。</span><span class="sxs-lookup"><span data-stu-id="93414-149">If multiple MessageBox databases are configured, the tracking host instance uses four threads per MessageBox database.</span></span>  
  
 <span data-ttu-id="93414-150">它是可能的追蹤主控件執行個體為 CPU 繫結。</span><span class="sxs-lookup"><span data-stu-id="93414-150">It is possible that the Tracking host instance is CPU bound.</span></span> <span data-ttu-id="93414-151">如果是，請考慮向上擴充伺服器，或向外延展藉由設定額外的伺服器與主控件追蹤已啟用。</span><span class="sxs-lookup"><span data-stu-id="93414-151">If it is, consider scaling-up the server or scale-out by configuring an additional server with Host Tracking enabled.</span></span> <span data-ttu-id="93414-152">多個主控件執行個體將會自動載入平衡多個 MessageBox 資料庫設定。</span><span class="sxs-lookup"><span data-stu-id="93414-152">The multiple host instances will automatically load balance for the multiple MessageBox databases configured.</span></span> <span data-ttu-id="93414-153">如需縮放比例的詳細資訊，請參閱主題[調整您的方案](http://go.microsoft.com/fwlink/?LinkId=158078)(http://go.microsoft.com/fwlink/?LinkId=158078)。</span><span class="sxs-lookup"><span data-stu-id="93414-153">For more information about scaling, see the topic [Scaling Your Solutions](http://go.microsoft.com/fwlink/?LinkId=158078) (http://go.microsoft.com/fwlink/?LinkId=158078).</span></span>  
  
 <span data-ttu-id="93414-154">如果 MessageBox 資料庫中的 TrackingData 資料表成長，通常是因為依照設定導致成長的 BizTalk 追蹤 」 和/或 BAM 主要 BizTalk 追蹤 」 和/或 BAM 主要匯入資料庫上的資料維護工作未執行匯入的資料庫。</span><span class="sxs-lookup"><span data-stu-id="93414-154">If the TrackingData table in the MessageBox database grows large, it is usually because the data maintenance jobs on the BizTalk Tracking and/or BAM Primary Import database are not running as configured, causing growth of the BizTalk Tracking and/or BAM Primary Import databases.</span></span> <span data-ttu-id="93414-155">這些資料庫會變得太大之後，可以將資料插入 TrackingData 資料表追蹤主控件的能力有負面影響。</span><span class="sxs-lookup"><span data-stu-id="93414-155">After these databases grow too large it can have a negative impact on the ability of the Tracking host to insert data into the TrackingData table.</span></span> <span data-ttu-id="93414-156">這會導致備份 MessageBox 資料庫資料表中的追蹤的資料。</span><span class="sxs-lookup"><span data-stu-id="93414-156">This causes tracked data to back up in the MessageBox database tables.</span></span> <span data-ttu-id="93414-157">TrackingData 資料表成長會促使節流開始。</span><span class="sxs-lookup"><span data-stu-id="93414-157">The growth of the TrackingData table cause throttling to start.</span></span>  
  
 <span data-ttu-id="93414-158">您應該只啟用最小追蹤所需的應用程式，因為這會減少記錄的資料量，並降低追蹤瓶頸的風險。</span><span class="sxs-lookup"><span data-stu-id="93414-158">You should only enable the minimum tracking required for your application, as this will reduce the amount of data logged and lower the risk of tracking bottlenecks.</span></span> <span data-ttu-id="93414-159">停用個別的項目，例如協調流程和傳送/接收埠的追蹤設定的相關資訊，請參閱[如何停用追蹤](http://go.microsoft.com/fwlink/?LinkId=160064)(http://go.microsoft.com/fwlink/?LinkId=160064)。</span><span class="sxs-lookup"><span data-stu-id="93414-159">For information about disabling tracking settings for individual items such as orchestrations and send/receive ports, see [How to Disable Tracking](http://go.microsoft.com/fwlink/?LinkId=160064) (http://go.microsoft.com/fwlink/?LinkId=160064).</span></span>  
  
## <a name="other"></a><span data-ttu-id="93414-160">其他</span><span class="sxs-lookup"><span data-stu-id="93414-160">Other</span></span>  
 <span data-ttu-id="93414-161">設定部署拓撲，使不同的功能可在專用的外掛式主控件執行個體中執行。</span><span class="sxs-lookup"><span data-stu-id="93414-161">Configure the deployment topology such that different functionality runs in dedicated isolated host instances.</span></span> <span data-ttu-id="93414-162">如此一來每個主控件執行個體取得自己的資源 （例如，在 32 位元系統、 2 GB 虛擬記憶體位址空間、 控制代碼、 執行緒） 集。</span><span class="sxs-lookup"><span data-stu-id="93414-162">This way each host instance gets its own set of resources (for example, on a 32-bit system, 2GB virtual memory address space, handles, threads).</span></span> <span data-ttu-id="93414-163">如果伺服器是具有足夠的 cup 空間和記憶體來裝載多個主控件執行個體時，他們可以設定在同一部實體電腦上執行。</span><span class="sxs-lookup"><span data-stu-id="93414-163">If the server is has sufficient CPU headroom and memory to host multiple host instances, they can be configured to run on the same physical computer.</span></span> <span data-ttu-id="93414-164">如果沒有，請考慮將功能移至專用伺服器向外延展。</span><span class="sxs-lookup"><span data-stu-id="93414-164">If not, consider scaling out by moving the functionality to dedicated servers.</span></span> <span data-ttu-id="93414-165">在多個伺服器上執行相同的功能，也可以提供具有高度可用性的組態。</span><span class="sxs-lookup"><span data-stu-id="93414-165">Running the same functionality on multiple servers also serves to provide a highly available configuration.</span></span>  
  
## <a name="biztalk-system-performance-counters"></a><span data-ttu-id="93414-166">BizTalk 系統效能計數器</span><span class="sxs-lookup"><span data-stu-id="93414-166">BizTalk system performance counters</span></span>  
  
|<span data-ttu-id="93414-167">物件</span><span class="sxs-lookup"><span data-stu-id="93414-167">Object</span></span>|<span data-ttu-id="93414-168">執行個體</span><span class="sxs-lookup"><span data-stu-id="93414-168">Instance</span></span>|<span data-ttu-id="93414-169">計數器</span><span class="sxs-lookup"><span data-stu-id="93414-169">Counter</span></span>|<span data-ttu-id="93414-170">監控目的</span><span class="sxs-lookup"><span data-stu-id="93414-170">Monitoring Purpose</span></span>|  
|------------|--------------|-------------|------------------------|  
|<span data-ttu-id="93414-171">處理器</span><span class="sxs-lookup"><span data-stu-id="93414-171">Processor</span></span>|<span data-ttu-id="93414-172">_Total</span><span class="sxs-lookup"><span data-stu-id="93414-172">_Total</span></span>|<span data-ttu-id="93414-173">% 處理器時間</span><span class="sxs-lookup"><span data-stu-id="93414-173">% Processor Time</span></span>|<span data-ttu-id="93414-174">資源爭用</span><span class="sxs-lookup"><span data-stu-id="93414-174">Resource Contention</span></span>|  
|<span data-ttu-id="93414-175">處理</span><span class="sxs-lookup"><span data-stu-id="93414-175">Process</span></span>|<span data-ttu-id="93414-176">BTSNTSvc</span><span class="sxs-lookup"><span data-stu-id="93414-176">BTSNTSvc</span></span>|<span data-ttu-id="93414-177">虛擬位元組</span><span class="sxs-lookup"><span data-stu-id="93414-177">Virtual Bytes</span></span>|<span data-ttu-id="93414-178">記憶體流失/膨脹</span><span class="sxs-lookup"><span data-stu-id="93414-178">Memory Leak/Bloat</span></span>|  
|<span data-ttu-id="93414-179">處理</span><span class="sxs-lookup"><span data-stu-id="93414-179">Process</span></span>|<span data-ttu-id="93414-180">BTSNTSvc</span><span class="sxs-lookup"><span data-stu-id="93414-180">BTSNTSvc</span></span>|<span data-ttu-id="93414-181">私用位元組</span><span class="sxs-lookup"><span data-stu-id="93414-181">Private Bytes</span></span>|<span data-ttu-id="93414-182">記憶體流失/膨脹</span><span class="sxs-lookup"><span data-stu-id="93414-182">Memory Leak/Bloat</span></span>|  
|<span data-ttu-id="93414-183">處理</span><span class="sxs-lookup"><span data-stu-id="93414-183">Process</span></span>|<span data-ttu-id="93414-184">BTSNTSvc</span><span class="sxs-lookup"><span data-stu-id="93414-184">BTSNTSvc</span></span>|<span data-ttu-id="93414-185">控制碼計數</span><span class="sxs-lookup"><span data-stu-id="93414-185">Handle Count</span></span>|<span data-ttu-id="93414-186">資源爭用</span><span class="sxs-lookup"><span data-stu-id="93414-186">Resource Contention</span></span>|  
|<span data-ttu-id="93414-187">處理</span><span class="sxs-lookup"><span data-stu-id="93414-187">Process</span></span>|<span data-ttu-id="93414-188">BTSNTSvc</span><span class="sxs-lookup"><span data-stu-id="93414-188">BTSNTSvc</span></span>|<span data-ttu-id="93414-189">執行緒計數</span><span class="sxs-lookup"><span data-stu-id="93414-189">Thread Count</span></span>|<span data-ttu-id="93414-190">資源爭用</span><span class="sxs-lookup"><span data-stu-id="93414-190">Resource Contention</span></span>|  
|<span data-ttu-id="93414-191">實體磁碟</span><span class="sxs-lookup"><span data-stu-id="93414-191">Physical Disk</span></span>|<span data-ttu-id="93414-192">_ 執行個體</span><span class="sxs-lookup"><span data-stu-id="93414-192">_Instance</span></span>|<span data-ttu-id="93414-193">% 閒置時間</span><span class="sxs-lookup"><span data-stu-id="93414-193">% Idle Time</span></span>|<span data-ttu-id="93414-194">資源爭用</span><span class="sxs-lookup"><span data-stu-id="93414-194">Resource Contention</span></span>|  
|<span data-ttu-id="93414-195">實體磁碟</span><span class="sxs-lookup"><span data-stu-id="93414-195">Physical Disk</span></span>|<span data-ttu-id="93414-196">_ 執行個體</span><span class="sxs-lookup"><span data-stu-id="93414-196">_Instance</span></span>|<span data-ttu-id="93414-197">Average Disk Queue Length</span><span class="sxs-lookup"><span data-stu-id="93414-197">Average Disk Queue Length</span></span>|<span data-ttu-id="93414-198">資源爭用</span><span class="sxs-lookup"><span data-stu-id="93414-198">Resource Contention</span></span>|  
  
### <a name="cpu-contention"></a><span data-ttu-id="93414-199">當 CPU 出現競爭</span><span class="sxs-lookup"><span data-stu-id="93414-199">CPU contention</span></span>  
 <span data-ttu-id="93414-200">如果處理器已飽和，您可以藉由分隔傳送和協調流程接收片段應用程式。</span><span class="sxs-lookup"><span data-stu-id="93414-200">If the processor is saturated, you can fragment the application by separating the receiving from the sending and orchestration.</span></span> <span data-ttu-id="93414-201">若要這樣做，建立個別的主控件，將對應特定功能 （接收/傳送/協調流程/追蹤） 的主機並加入這些個別的主控件專用的伺服器。</span><span class="sxs-lookup"><span data-stu-id="93414-201">To do this, create separate hosts, map the hosts to specific functionality (receive/send/orchestrations/tracking) and add dedicated servers to these separate hosts.</span></span> <span data-ttu-id="93414-202">協調流程功能通常是需要大量的 CPU。</span><span class="sxs-lookup"><span data-stu-id="93414-202">Orchestration functionality is often CPU-intensive.</span></span> <span data-ttu-id="93414-203">如果您設定系統，因此，不同的專用伺服器上執行的協調流程，這有助於改善整體系統輸送量。</span><span class="sxs-lookup"><span data-stu-id="93414-203">If you configure the system so the orchestrations execute on a separate dedicated server, this can help improve overall system throughput.</span></span>  
  
 <span data-ttu-id="93414-204">如果部署多個協調流程，您可以將它們登錄至不同的專用協調流程的主機。</span><span class="sxs-lookup"><span data-stu-id="93414-204">If multiple orchestrations are deployed, you can enlist them to different dedicated orchestration hosts.</span></span> <span data-ttu-id="93414-205">將不同的實體伺服器對應至專用的協調流程主控件，可確保不同的協調流程彼此隔離，不會爭用相同實體位址空間中或同一部伺服器上的共用資源。</span><span class="sxs-lookup"><span data-stu-id="93414-205">Mapping different physical servers to the dedicated orchestration hosts ensures that the different orchestrations are isolated and do not contend for shared resources either in the same physical address space or on the same server.</span></span>  
  
 <span data-ttu-id="93414-206">停止未使用的主控件執行個體。</span><span class="sxs-lookup"><span data-stu-id="93414-206">Stop unused host instances.</span></span> <span data-ttu-id="93414-207">未使用的主控件執行個體可以藉由定期檢查 MessageBox 進行處理的訊息競爭 CPU 和記憶體資源。</span><span class="sxs-lookup"><span data-stu-id="93414-207">Unused host instances can compete for CPU and memory resources by regularly checking the MessageBox for messages to process.</span></span> <span data-ttu-id="93414-208">此外，停止未使用接收位置、 傳送埠和協調流程。</span><span class="sxs-lookup"><span data-stu-id="93414-208">Additionally, stop unused receive locations, send ports, and orchestrations.</span></span>  
  
### <a name="spool-table-growth"></a><span data-ttu-id="93414-209">多工緩衝處理資料表成長</span><span class="sxs-lookup"><span data-stu-id="93414-209">Spool table growth</span></span>  
 <span data-ttu-id="93414-210">下游瓶頸及/或資源爭用的情況，可能會造成多工緩衝處理開始過度成長並降低整體效能。</span><span class="sxs-lookup"><span data-stu-id="93414-210">Downstream bottlenecks and/or resource contention can cause the spool to start growing excessively and reduce overall performance.</span></span> <span data-ttu-id="93414-211">如需詳細資訊，請參閱 「 資料表多工緩衝處理成長 」 中的[如何識別 MessageBox Database1 瓶頸](../technical-guides/how-to-identify-bottlenecks-in-the-messagebox-database1.md)。</span><span class="sxs-lookup"><span data-stu-id="93414-211">For more information, see “Spool Table Growth” in [How to Identify Bottlenecks in the MessageBox Database1](../technical-guides/how-to-identify-bottlenecks-in-the-messagebox-database1.md).</span></span>  
  
### <a name="memory-starvation"></a><span data-ttu-id="93414-212">記憶體耗盡</span><span class="sxs-lookup"><span data-stu-id="93414-212">Memory starvation</span></span>  
 <span data-ttu-id="93414-213">高輸送量實例可能增加對系統記體體的需求。</span><span class="sxs-lookup"><span data-stu-id="93414-213">High throughput scenarios can have increased demand on system memory.</span></span> <span data-ttu-id="93414-214">由於 32 位元處理序受限於它可以耗用的記憶體數量，建議您使用接收/程序/傳送功能分隔到不同的主控件執行個體，每個主機收到自己的 2GB 位址空間。</span><span class="sxs-lookup"><span data-stu-id="93414-214">Since a 32-bit process is limited by the amount of memory it can consume, it is recommended to separate the receive/process/send functionality into separate host instances such that each host receives its own 2GB address space.</span></span> <span data-ttu-id="93414-215">此外，如果多個主控件執行個體正在執行相同的實體伺服器上，您可以升級到 4/8GB 記憶體可避免磁碟交換資料，從實際的記憶體。</span><span class="sxs-lookup"><span data-stu-id="93414-215">In addition, if multiple host instances are running on the same physical server, you can upgrade to 4/8GB memory to avoid swapping data to disk from real memory.</span></span> <span data-ttu-id="93414-216">長時間執行的協調流程可以保存較長的配置記憶體。</span><span class="sxs-lookup"><span data-stu-id="93414-216">Long running orchestrations can hold onto allocated memory longer.</span></span> <span data-ttu-id="93414-217">這可能會導致記憶體膨脹，並啟動節流。</span><span class="sxs-lookup"><span data-stu-id="93414-217">This can cause memory bloat and throttling to start.</span></span> <span data-ttu-id="93414-218">大型訊息也可能會造成高記憶體耗用量。</span><span class="sxs-lookup"><span data-stu-id="93414-218">Large messages can also cause high memory consumption.</span></span>  
  
 <span data-ttu-id="93414-219">您也可以簡化藉由降低處理大型訊息時，就會發生記憶體膨脹問題**內部訊息佇列大小**和**每一 CPU 的內含式訊息**特定主控件的值。</span><span class="sxs-lookup"><span data-stu-id="93414-219">You can ease the memory bloat problem that occurs when large messages are processed by lowering the **Internal Message Queue Size** and **In-process Messages per CPU** values for the specific host.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="93414-220">如果延遲問題，變更為**內部訊息佇列大小**和**每一 CPU 的內含式訊息**應加注意這可能會增加系統的端對端延遲。</span><span class="sxs-lookup"><span data-stu-id="93414-220">If latency is a concern, changes to **Internal Message Queue Size** and **In-process Messages per CPU** should be made with caution as this may increase end-to-end latency of the system.</span></span>  
  
### <a name="disk-contention"></a><span data-ttu-id="93414-221">磁碟爭用</span><span class="sxs-lookup"><span data-stu-id="93414-221">Disk contention</span></span>  
 <span data-ttu-id="93414-222">如果磁碟已飽和 （例如，使用大量的檔案 /MSMQ 傳輸），請考慮升級為多磁針，並使用 RAID 10 磁碟條狀配置。</span><span class="sxs-lookup"><span data-stu-id="93414-222">If the disks are saturated (for example, with a large number of FILE/MSMQ transports), consider upgrading to multiple spindles and striping the disks with RAID 10.</span></span> <span data-ttu-id="93414-223">此外，每當使用檔案傳輸，務必確定接收和傳送資料夾不會變得大於 50000 的檔案。</span><span class="sxs-lookup"><span data-stu-id="93414-223">In addition, whenever using the FILE transport, it is important to ensure that the receive and send folders do not grow larger than 50,000 files.</span></span>  
  
 <span data-ttu-id="93414-224">接收資料夾可以擴展大型如果 BizTalk Server 會調整到系統的內送資料。</span><span class="sxs-lookup"><span data-stu-id="93414-224">The receive folder can grow large if BizTalk Server throttles incoming data into the system.</span></span> <span data-ttu-id="93414-225">請務必將資料從傳送資料夾移動，以便在這個資料夾中的成長不會影響 BizTalk Server 寫入其他資料的能力。</span><span class="sxs-lookup"><span data-stu-id="93414-225">It is important to move data from the send folder so that growth in this folder does not impact the ability of BizTalk Server to write additional data.</span></span> <span data-ttu-id="93414-226">對於非交易式 MSMQ 佇列，建議從遠端建立接收佇列，讓 BizTalk Server 將會減少磁碟爭用情況。</span><span class="sxs-lookup"><span data-stu-id="93414-226">For non-transactional MSMQ queues, it is recommended to remotely create the receive queues so that disk contention is reduced on the BizTalk Server.</span></span>  
  
 <span data-ttu-id="93414-227">遠端的非交易式佇列組態也提供高可用性，因為裝載佇列的遠端伺服器可以叢集化。</span><span class="sxs-lookup"><span data-stu-id="93414-227">The remote non-transactional queue configuration also provides high availability as the remote server hosting the queue can be clustered.</span></span>  
  
### <a name="other-system-resource-contention"></a><span data-ttu-id="93414-228">其他系統資源爭用</span><span class="sxs-lookup"><span data-stu-id="93414-228">Other system resource contention</span></span>  
 <span data-ttu-id="93414-229">根據傳輸類型，可能必須設定 IIS 的 HTTP （例如，MaxIOThreads、 MaxWorkerThreads） 之類的系統資源。</span><span class="sxs-lookup"><span data-stu-id="93414-229">Depending on the type of transport, it may be necessary to configure system resources like IIS for HTTP (for example, MaxIOThreads, MaxWorkerThreads).</span></span>  
  
 <span data-ttu-id="93414-230">ASP.NET 2.0 與 ASP.Net 4 \<processModel autoConfig ="true"\> machine.config 檔案中的設定會自動設定下列設定以獲得最佳效能：</span><span class="sxs-lookup"><span data-stu-id="93414-230">With ASP.NET 2.0 and ASP.Net 4, the \<processModel autoConfig="true"\> setting in the machine.config file will automatically configure the following settings for optimal performance:</span></span>  
  
-   <span data-ttu-id="93414-231">最大工作者執行緒</span><span class="sxs-lookup"><span data-stu-id="93414-231">Maximum Worker Threads</span></span>  
  
-   <span data-ttu-id="93414-232">最大 IO 執行緒</span><span class="sxs-lookup"><span data-stu-id="93414-232">Maximum IO Threads</span></span>  
  
-   <span data-ttu-id="93414-233">minFreeThreads httpRuntime 元素屬性</span><span class="sxs-lookup"><span data-stu-id="93414-233">minFreeThreads attribute of the httpRuntime element</span></span>  
  
-   <span data-ttu-id="93414-234">minLocalRequestFreeThreads httpRuntime 元素屬性</span><span class="sxs-lookup"><span data-stu-id="93414-234">minLocalRequestFreeThreads attribute of the httpRuntime element</span></span>  
  
-   <span data-ttu-id="93414-235">maxConnection 屬性\<connectionManagement\>項目 （網路設定） 項目</span><span class="sxs-lookup"><span data-stu-id="93414-235">maxConnection attribute of the \<connectionManagement\> Element (Network Settings) element</span></span>  
  
 <span data-ttu-id="93414-236">如需設定會影響配接器效能的參數的詳細資訊，請參閱[processModel 項目的 ASP.NET 組態設定](http://go.microsoft.com/fwlink/?LinkId=158080)(http://go.microsoft.com/fwlink/?LinkId=158080)。</span><span class="sxs-lookup"><span data-stu-id="93414-236">For more information about configuring parameters that affect adapter performance, see [ASP.NET Configuration Settings for the processModel Element](http://go.microsoft.com/fwlink/?LinkId=158080) (http://go.microsoft.com/fwlink/?LinkId=158080).</span></span>  
  
 <span data-ttu-id="93414-237">如需可能會影響 BizTalk Server 配接器的組態設定的詳細資訊，請參閱[組態參數會影響配接器效能](http://go.microsoft.com/fwlink/?LinkID=154200)(http://go.microsoft.com/fwlink/?LinkID=154200)。</span><span class="sxs-lookup"><span data-stu-id="93414-237">For more information about configuration settings that can affect BizTalk Server adapters, see [Configuration Parameters that Affect Adapter Performance](http://go.microsoft.com/fwlink/?LinkID=154200) (http://go.microsoft.com/fwlink/?LinkID=154200).</span></span>  
  
 <span data-ttu-id="93414-238">除了最佳化 BizTalk Server 應用程式，其他在相同伺服器上執行的 ASP.NET 應用程式可能會影響整體效能。</span><span class="sxs-lookup"><span data-stu-id="93414-238">In addition to optimizing your BizTalk Server applications, other ASP.NET applications running on the same server can have an affect on overall performance.</span></span> <span data-ttu-id="93414-239">請務必最佳化所有 ASP.NET 應用程式，以減少系統資源需求。</span><span class="sxs-lookup"><span data-stu-id="93414-239">It is important to optimize all of your ASP.NET applications to reduce demand on system resources.</span></span> <span data-ttu-id="93414-240">如需詳細資訊，請參閱[ASP.NET 效能](http://go.microsoft.com/fwlink/?LinkId=158081)(http://go.microsoft.com/fwlink/?LinkId=158081)。</span><span class="sxs-lookup"><span data-stu-id="93414-240">For more information, see [ASP.NET Performance](http://go.microsoft.com/fwlink/?LinkId=158081) (http://go.microsoft.com/fwlink/?LinkId=158081).</span></span>  
  
 <span data-ttu-id="93414-241">為達到最大效能設定時，請考慮最佳化其他外部系統，例如，傳訊引擎 （訊息佇列，MQSeries）、 應用程式、 資料庫、 Active Directory 等整體 BizTalk 方案的一部分。</span><span class="sxs-lookup"><span data-stu-id="93414-241">When configuring for maximum performance, consider optimizing other external systems such as messaging engines (Message Queuing, MQSeries), applications, databases, Active Directory, etc. that are part of your overall BizTalk solution.</span></span> <span data-ttu-id="93414-242">在任何這些外部系統的效能瓶頸可以有 BizTalk 方案的負面影響。</span><span class="sxs-lookup"><span data-stu-id="93414-242">Performance bottlenecks in any of these other external systems can have a negative effect on your BizTalk solution.</span></span>  
  
### <a name="downstream-bottlenecks"></a><span data-ttu-id="93414-243">下游瓶頸</span><span class="sxs-lookup"><span data-stu-id="93414-243">Downstream bottlenecks</span></span>  
 <span data-ttu-id="93414-244">如果下游系統無法從 BizTalk 接收資料的速度不夠快，此輸出資料會備份 BizTalk 資料庫中。</span><span class="sxs-lookup"><span data-stu-id="93414-244">If the downstream system is unable to receive data fast enough from BizTalk, this output data will back up in the BizTalk databases.</span></span> <span data-ttu-id="93414-245">這會導致膨脹、 導致開始節流、 壓縮接收管道，和會影響 BizTalk 系統的整體輸送量。</span><span class="sxs-lookup"><span data-stu-id="93414-245">This results in bloat, causes throttling to start, shrinks the receive pipe, and impacts the overall throughput of the BizTalk system.</span></span> <span data-ttu-id="93414-246">直接指示這是多工緩衝處理資料表成長。</span><span class="sxs-lookup"><span data-stu-id="93414-246">A direct indication of this is Spool table growth.</span></span> <span data-ttu-id="93414-247">如需瓶頸及多工緩衝處理資料表的詳細資訊，請參閱[如何識別 MessageBox Database1 瓶頸](../technical-guides/how-to-identify-bottlenecks-in-the-messagebox-database1.md)。</span><span class="sxs-lookup"><span data-stu-id="93414-247">For more information about bottlenecks and the Spool table, see [How to Identify Bottlenecks in the MessageBox Database1](../technical-guides/how-to-identify-bottlenecks-in-the-messagebox-database1.md).</span></span>  
  
### <a name="throttling-impact"></a><span data-ttu-id="93414-248">節流衝擊</span><span class="sxs-lookup"><span data-stu-id="93414-248">Throttling impact</span></span>  
 <span data-ttu-id="93414-249">節流最終會開始保護系統，使其無法到達不可復原的狀態。</span><span class="sxs-lookup"><span data-stu-id="93414-249">Throttling will eventually start to protect the system from reaching an unrecoverable state.</span></span> <span data-ttu-id="93414-250">因此，您可以使用節流來確認系統是否正常運作，並找出問題的來源。</span><span class="sxs-lookup"><span data-stu-id="93414-250">Thus, you can use throttling to verify whether the system is functioning normally and discover the source of the problem.</span></span> <span data-ttu-id="93414-251">識別從節流狀態瓶頸的原因之後，分析的其他效能計數器來判定問題的來源。</span><span class="sxs-lookup"><span data-stu-id="93414-251">After you identify the cause of the bottleneck from the throttling state, analyze the other performance counters to determine the source of the problem.</span></span> <span data-ttu-id="93414-252">例如，MessageBox 資料庫上的高爭用情況可能是因為 CPU 使用率過高，過度分頁到磁碟上的起因是記憶體不足所造成。</span><span class="sxs-lookup"><span data-stu-id="93414-252">For example, high contention on the MessageBox database could be due to high CPU use, caused by excessively paging to disk that is caused by low memory conditions.</span></span> <span data-ttu-id="93414-253">MessageBox 資料庫上的高爭用情況也可能被因高鎖定競爭，因為磁碟機飽和。</span><span class="sxs-lookup"><span data-stu-id="93414-253">High contention on the MessageBox database could also be caused by high lock contention due to saturated disk drives.</span></span> <span data-ttu-id="93414-254">雖然偶爾節流效能嚴重威脅，持續發生節流事件可能表示更重要的基礎問題。</span><span class="sxs-lookup"><span data-stu-id="93414-254">While occasional throttling is not a significant threat to performance, persistent throttling can indicate a more significant underlying problem.</span></span> <span data-ttu-id="93414-255">如需 BizTalk Server 會使用節流設定是這種情況的詳細資訊，請參閱[如何 BizTalk Server 實作主控件節流](http://go.microsoft.com/fwlink/?LinkID=155286)(http://go.microsoft.com/fwlink/?LinkID=155286)。</span><span class="sxs-lookup"><span data-stu-id="93414-255">For more information about those conditions where BizTalk Server will use throttling, see [How BizTalk Server Implements Host Throttling](http://go.microsoft.com/fwlink/?LinkID=155286) (http://go.microsoft.com/fwlink/?LinkID=155286).</span></span>  
  
 <span data-ttu-id="93414-256">如需有關如何節流 BizTalk Server 協助管理可用資源的使用和資源爭用的情況降到最低的詳細資訊，請參閱[最佳化資源使用量透過主控件節流](http://go.microsoft.com/fwlink/?LinkID=155770)(http://go.microsoft.com/fwlink/?LinkID=155770)。</span><span class="sxs-lookup"><span data-stu-id="93414-256">For more information about how BizTalk Server throttling can help manage the use of available resources and minimize resource contention, see [Optimizing Resource Usage Through Host Throttling](http://go.microsoft.com/fwlink/?LinkID=155770) (http://go.microsoft.com/fwlink/?LinkID=155770).</span></span>  
  
## <a name="biztalk-application-counters"></a><span data-ttu-id="93414-257">BizTalk 應用程式計數器</span><span class="sxs-lookup"><span data-stu-id="93414-257">BizTalk application counters</span></span>  
  
|<span data-ttu-id="93414-258">物件</span><span class="sxs-lookup"><span data-stu-id="93414-258">Object</span></span>|<span data-ttu-id="93414-259">執行個體</span><span class="sxs-lookup"><span data-stu-id="93414-259">Instance</span></span>|<span data-ttu-id="93414-260">計數器</span><span class="sxs-lookup"><span data-stu-id="93414-260">Counter</span></span>|<span data-ttu-id="93414-261">Description</span><span class="sxs-lookup"><span data-stu-id="93414-261">Description</span></span>|  
|------------|--------------|-------------|-----------------|  
|<span data-ttu-id="93414-262">BizTalk 傳訊</span><span class="sxs-lookup"><span data-stu-id="93414-262">BizTalk Messaging</span></span>|<span data-ttu-id="93414-263">RxHost</span><span class="sxs-lookup"><span data-stu-id="93414-263">RxHost</span></span>|<span data-ttu-id="93414-264">每秒接收文件數</span><span class="sxs-lookup"><span data-stu-id="93414-264">Documents Received/Sec</span></span>|<span data-ttu-id="93414-265">內送速率</span><span class="sxs-lookup"><span data-stu-id="93414-265">Incoming Rate</span></span>|  
|<span data-ttu-id="93414-266">BizTalk 傳訊</span><span class="sxs-lookup"><span data-stu-id="93414-266">BizTalk Messaging</span></span>|<span data-ttu-id="93414-267">TxHost</span><span class="sxs-lookup"><span data-stu-id="93414-267">TxHost</span></span>|<span data-ttu-id="93414-268">每秒處理文件數</span><span class="sxs-lookup"><span data-stu-id="93414-268">Documents Processed/Sec</span></span>|<span data-ttu-id="93414-269">外寄速率</span><span class="sxs-lookup"><span data-stu-id="93414-269">Outgoing Rate</span></span>|  
|<span data-ttu-id="93414-270">XLANG/s 協調流程</span><span class="sxs-lookup"><span data-stu-id="93414-270">XLANG/s Orchestrations</span></span>|<span data-ttu-id="93414-271">PxHost</span><span class="sxs-lookup"><span data-stu-id="93414-271">PxHost</span></span>|<span data-ttu-id="93414-272">每秒完成的協調流程數</span><span class="sxs-lookup"><span data-stu-id="93414-272">Orchestrations Completed/Sec.</span></span>|<span data-ttu-id="93414-273">處理速率</span><span class="sxs-lookup"><span data-stu-id="93414-273">Processing Rate</span></span>|  
|<span data-ttu-id="93414-274">BizTalk: MessageBox： 一般計數器</span><span class="sxs-lookup"><span data-stu-id="93414-274">BizTalk : MessageBox: General Counters</span></span>|<span data-ttu-id="93414-275">MsgBoxName</span><span class="sxs-lookup"><span data-stu-id="93414-275">MsgBoxName</span></span>|<span data-ttu-id="93414-276">多工緩衝處理大小</span><span class="sxs-lookup"><span data-stu-id="93414-276">Spool Size</span></span>|<span data-ttu-id="93414-277">所有主控件佇列總計大小</span><span class="sxs-lookup"><span data-stu-id="93414-277">Cumulative size of all Host Queues</span></span>|  
|<span data-ttu-id="93414-278">BizTalk: MessageBox： 一般計數器</span><span class="sxs-lookup"><span data-stu-id="93414-278">BizTalk : MessageBox: General Counters</span></span>|<span data-ttu-id="93414-279">MsgBoxName</span><span class="sxs-lookup"><span data-stu-id="93414-279">MsgBoxName</span></span>|<span data-ttu-id="93414-280">追蹤資料大小</span><span class="sxs-lookup"><span data-stu-id="93414-280">Tracking Data Size</span></span>|<span data-ttu-id="93414-281">MessageBox 上的 TrackingData 資料表大小</span><span class="sxs-lookup"><span data-stu-id="93414-281">Size of TrackingData table on the MessageBox</span></span>|  
|<span data-ttu-id="93414-282">BizTalk：MessageBox：主控件計數器</span><span class="sxs-lookup"><span data-stu-id="93414-282">BizTalk:MessageBox:Host Counters</span></span>|<span data-ttu-id="93414-283">PxHost:MsgBoxName</span><span class="sxs-lookup"><span data-stu-id="93414-283">PxHost:MsgBoxName</span></span>|<span data-ttu-id="93414-284">主控件佇列 - 長度</span><span class="sxs-lookup"><span data-stu-id="93414-284">Host Queue - Length</span></span>|<span data-ttu-id="93414-285">指定主控件佇列中的訊息數</span><span class="sxs-lookup"><span data-stu-id="93414-285">Number of messages in the specific Host Queue</span></span>|  
|<span data-ttu-id="93414-286">BizTalk：MessageBox：主控件計數器</span><span class="sxs-lookup"><span data-stu-id="93414-286">BizTalk:MessageBox:Host Counters</span></span>|<span data-ttu-id="93414-287">TxHost:MsgBoxName</span><span class="sxs-lookup"><span data-stu-id="93414-287">TxHost:MsgBoxName</span></span>|<span data-ttu-id="93414-288">主控件佇列 - 長度</span><span class="sxs-lookup"><span data-stu-id="93414-288">Host Queue - Length</span></span>|<span data-ttu-id="93414-289">指定主控件佇列中的訊息數</span><span class="sxs-lookup"><span data-stu-id="93414-289">Number of messages in the specific Host Queue</span></span>|  
|<span data-ttu-id="93414-290">BizTalk：訊息代理程式</span><span class="sxs-lookup"><span data-stu-id="93414-290">BizTalk:Message Agent</span></span>|<span data-ttu-id="93414-291">RxHost</span><span class="sxs-lookup"><span data-stu-id="93414-291">RxHost</span></span>|<span data-ttu-id="93414-292">資料庫大小</span><span class="sxs-lookup"><span data-stu-id="93414-292">Database Size</span></span>|<span data-ttu-id="93414-293">發佈 (PxHost) 佇列的大小</span><span class="sxs-lookup"><span data-stu-id="93414-293">Size of publishing (PxHost) Queue</span></span>|  
|<span data-ttu-id="93414-294">BizTalk：訊息代理程式</span><span class="sxs-lookup"><span data-stu-id="93414-294">BizTalk:Message Agent</span></span>|<span data-ttu-id="93414-295">PxHost</span><span class="sxs-lookup"><span data-stu-id="93414-295">PxHost</span></span>|<span data-ttu-id="93414-296">資料庫大小</span><span class="sxs-lookup"><span data-stu-id="93414-296">Database Size</span></span>|<span data-ttu-id="93414-297">發佈 (TxHost) 佇列的大小</span><span class="sxs-lookup"><span data-stu-id="93414-297">Size of publishing (TxHost) Queue</span></span>|  
|<span data-ttu-id="93414-298">BizTalk：訊息代理程式</span><span class="sxs-lookup"><span data-stu-id="93414-298">BizTalk:Message Agent</span></span>|<span data-ttu-id="93414-299">HostName</span><span class="sxs-lookup"><span data-stu-id="93414-299">HostName</span></span>|<span data-ttu-id="93414-300">訊息傳遞節流狀態</span><span class="sxs-lookup"><span data-stu-id="93414-300">Message Delivery Throttling State</span></span>|<span data-ttu-id="93414-301">影響 XLANG 和輸出傳輸</span><span class="sxs-lookup"><span data-stu-id="93414-301">Affects XLANG and Outbound transports</span></span>|  
|<span data-ttu-id="93414-302">BizTalk：訊息代理程式</span><span class="sxs-lookup"><span data-stu-id="93414-302">BizTalk:Message Agent</span></span>|<span data-ttu-id="93414-303">HostName</span><span class="sxs-lookup"><span data-stu-id="93414-303">HostName</span></span>|<span data-ttu-id="93414-304">訊息發佈節流狀態</span><span class="sxs-lookup"><span data-stu-id="93414-304">Message Publishing Throttling State</span></span>|<span data-ttu-id="93414-305">影響 XLANG 和輸入傳輸</span><span class="sxs-lookup"><span data-stu-id="93414-305">Affects XLANG and Inbound transports</span></span>|  
  
### <a name="where-do-i-start"></a><span data-ttu-id="93414-306">要從何處著手？</span><span class="sxs-lookup"><span data-stu-id="93414-306">Where do I start?</span></span>  
 <span data-ttu-id="93414-307">監視**訊息傳遞節流狀態**和**訊息發佈節流狀態**每個主控件執行個體是較好的位置開始。</span><span class="sxs-lookup"><span data-stu-id="93414-307">Monitoring the **Message Delivery Throttling State** and the **Message Publishing Throttling State** for each host instance is a good place to start.</span></span> <span data-ttu-id="93414-308">如果這些計數器的值不是零，這表示節流在 BizTalk 系統中，而且您可以進一步分析瓶頸的原因。</span><span class="sxs-lookup"><span data-stu-id="93414-308">If the value of these counters is not zero, this indicates throttling in the BizTalk system and you can further analyze the cause of the bottleneck.</span></span> <span data-ttu-id="93414-309">如需其他效能計數器的描述，請參閱[資料庫層中的瓶頸](../technical-guides/bottlenecks-in-the-database-tier.md)。</span><span class="sxs-lookup"><span data-stu-id="93414-309">For descriptions on the other performance counters, see [Bottlenecks in the Database Tier](../technical-guides/bottlenecks-in-the-database-tier.md).</span></span>  
  
## <a name="orchestration-engine-performance-counters"></a><span data-ttu-id="93414-310">協調流程引擎效能計數器</span><span class="sxs-lookup"><span data-stu-id="93414-310">Orchestration engine performance counters</span></span>  
 <span data-ttu-id="93414-311">我們強烈建議您微調協調流程執行階段設定，因為持續的協調流程 dehydration\rehydration 和持續性點可以對整體效能造成重大影響。</span><span class="sxs-lookup"><span data-stu-id="93414-311">We strongly recommend that you fine tune orchestration runtime settings because continuous orchestration dehydration\rehydration and persistence points can have a severe impact on overall performance.</span></span>  <span data-ttu-id="93414-312">測試可能包含多個持續點和交易式範圍的複雜協調流程時，您必須使用下列的計數器。</span><span class="sxs-lookup"><span data-stu-id="93414-312">You must use the following counters when testing complex orchestrations that may contain multiple persistence points and transactional scopes.</span></span>  
  
|<span data-ttu-id="93414-313">計數器</span><span class="sxs-lookup"><span data-stu-id="93414-313">Counter</span></span>|<span data-ttu-id="93414-314">註解</span><span class="sxs-lookup"><span data-stu-id="93414-314">Comments</span></span>|  
|-------------|--------------|  
|<span data-ttu-id="93414-315">凍結的協調流程數/秒</span><span class="sxs-lookup"><span data-stu-id="93414-315">Orchestrations dehydrated/sec</span></span>|<span data-ttu-id="93414-316">平均每秒凍結的數目。</span><span class="sxs-lookup"><span data-stu-id="93414-316">Average number dehydrated per second.</span></span>|  
|<span data-ttu-id="93414-317">解除凍結的協調流程數/秒</span><span class="sxs-lookup"><span data-stu-id="93414-317">Orchestrations rehydrated/sec</span></span>|<span data-ttu-id="93414-318">平均每秒解除凍結的數目。</span><span class="sxs-lookup"><span data-stu-id="93414-318">Average number rehydrated per second.</span></span>|  
|<span data-ttu-id="93414-319">持續點數/秒</span><span class="sxs-lookup"><span data-stu-id="93414-319">Persistence points/sec</span></span>|<span data-ttu-id="93414-320">平均每秒保存的協調流程執行個體數。</span><span class="sxs-lookup"><span data-stu-id="93414-320">Average number of orchestration instances persisted per second.</span></span>|  
|<span data-ttu-id="93414-321">記憶體中駐留的協調流程數</span><span class="sxs-lookup"><span data-stu-id="93414-321">Orchestrations resident in memory</span></span>|<span data-ttu-id="93414-322">目前由主控件執行個體裝載的協調流程執行個體數。</span><span class="sxs-lookup"><span data-stu-id="93414-322">Number of orchestration instances currently hosted by the host instance.</span></span>|  
|<span data-ttu-id="93414-323">完成的協調流程數/秒</span><span class="sxs-lookup"><span data-stu-id="93414-323">Orchestrations completed/sec</span></span>|<span data-ttu-id="93414-324">平均每秒完成的數目。</span><span class="sxs-lookup"><span data-stu-id="93414-324">Average number completed per second.</span></span>|  
|<span data-ttu-id="93414-325">擱置的協調流程數/秒</span><span class="sxs-lookup"><span data-stu-id="93414-325">Orchestrations suspended/sec</span></span>|<span data-ttu-id="93414-326">平均每秒擱置的數目。</span><span class="sxs-lookup"><span data-stu-id="93414-326">Average number suspended per second.</span></span>|  
|<span data-ttu-id="93414-327">認可的交易式範圍數/秒</span><span class="sxs-lookup"><span data-stu-id="93414-327">Transactional scopes committed/sec</span></span>|<span data-ttu-id="93414-328">平均每秒認可的數目。</span><span class="sxs-lookup"><span data-stu-id="93414-328">Average number committed per second.</span></span>|  
|<span data-ttu-id="93414-329">中止的交易式範圍數/秒</span><span class="sxs-lookup"><span data-stu-id="93414-329">Transactional scopes aborted/sec</span></span>|<span data-ttu-id="93414-330">平均每秒中止的數目。</span><span class="sxs-lookup"><span data-stu-id="93414-330">Average number aborted per second.</span></span>|  
|<span data-ttu-id="93414-331">補償的交易式範圍數/秒</span><span class="sxs-lookup"><span data-stu-id="93414-331">Transactional scopes compensated/sec</span></span>|<span data-ttu-id="93414-332">平均每秒補償的數目。</span><span class="sxs-lookup"><span data-stu-id="93414-332">Average number compensated per second.</span></span>|  
  
## <a name="backlog-buildup"></a><span data-ttu-id="93414-333">積存</span><span class="sxs-lookup"><span data-stu-id="93414-333">Backlog buildup</span></span>  
 <span data-ttu-id="93414-334">1-1 部署處理接收 1 個訊息結果 1 的訊息中的案例，而且系統中沒有待處理項目傳送時，如果外寄速率不等於內送速率。</span><span class="sxs-lookup"><span data-stu-id="93414-334">For a 1-1 deployment scenario where 1 message received results in 1 message processed and transmitted, if the outgoing rate does not equal the incoming rate, there is a backlog in the system.</span></span> <span data-ttu-id="93414-335">在此情況下，您可以監控多工緩衝處理大小。</span><span class="sxs-lookup"><span data-stu-id="93414-335">In this situation, you can monitor the Spool Size.</span></span> <span data-ttu-id="93414-336">在決定外寄速率中的瓶頸的原因時，一次執行單一的使用案例案例。</span><span class="sxs-lookup"><span data-stu-id="93414-336">When determining the cause of bottlenecks in outgoing rate, run a single use-case scenario at a time.</span></span> <span data-ttu-id="93414-337">隔離協調流程、 接收位置和傳送位置，以將主控件分開。</span><span class="sxs-lookup"><span data-stu-id="93414-337">Isolate orchestrations, receive locations, and send locations to separate hosts.</span></span>  
  
 <span data-ttu-id="93414-338">新增 biztalk: Message Box： 主控件計數器來監視主機效能監視器記錄檔。</span><span class="sxs-lookup"><span data-stu-id="93414-338">Add the BizTalk:Message Box:Host Counters to your Performance Monitor log to monitor a host.</span></span> <span data-ttu-id="93414-339">主控件佇列-長度： 計數器會追蹤特定主控件佇列中的訊息總數。</span><span class="sxs-lookup"><span data-stu-id="93414-339">The Host Queue - Length: counter tracks the total number of messages in a particular host queue.</span></span> <span data-ttu-id="93414-340">如果一或多個這些計數器會繼續成長經過一段時間，讓這些主機所執行的成品特別注意。</span><span class="sxs-lookup"><span data-stu-id="93414-340">If one or more of these counters continues grow over time, give particular attention to the artifacts executed by those hosts.</span></span>  
  
 <span data-ttu-id="93414-341">如果多工緩衝處理以線性成長，請將它判斷哪個應用程式佇列會負責多工緩衝處理成長。</span><span class="sxs-lookup"><span data-stu-id="93414-341">If the Spool is growing linearly, determine which Application Queue is responsible for the Spool growth.</span></span>  
  
 <span data-ttu-id="93414-342">如果沒有任何應用程式佇列逐漸在成長，多工緩衝處理持續成長，這可能表示清除工作會無法跟上。</span><span class="sxs-lookup"><span data-stu-id="93414-342">If none of the Application Queues are growing and the Spool continues to grow, it could mean that the purge jobs are unable to keep up.</span></span> <span data-ttu-id="93414-343">會發生這種情況是如果代理程式未執行，或有其他 SQL Server 上的系統資源爭用。</span><span class="sxs-lookup"><span data-stu-id="93414-343">This occurs if the agent is not running or there is other system resource contention on the SQL Server.</span></span>  
  
 <span data-ttu-id="93414-344">其中一個應用程式佇列成長，則診斷這股成長的原因。</span><span class="sxs-lookup"><span data-stu-id="93414-344">If one of the Application Queues is growing, diagnose the cause of this growth.</span></span> <span data-ttu-id="93414-345">監視無法清空特定應用程式佇列的系統上的系統資源 （例如，因為伺服器上的 CPU 耗盡而成長 Orchestration HOST-Q）。</span><span class="sxs-lookup"><span data-stu-id="93414-345">Monitor the system resources on the system that is unable to drain the specific Application Queue (for example, Orchestration Host-Q is growing due to CPU starvation on the server).</span></span> <span data-ttu-id="93414-346">此外，請確認節流計數器的特定主控件執行個體的值。</span><span class="sxs-lookup"><span data-stu-id="93414-346">In addition, verify the values of the throttling counter for the specific host instance.</span></span>  
  
 <span data-ttu-id="93414-347">如果 BizTalk:Messsage 代理訊息傳遞節流的狀態和訊息發佈節流狀態的效能計數器不是零，請檢查該值以確認節流的原因 （例如，記憶體超過閾值，執行中的訊息計數太高，依此類推）。</span><span class="sxs-lookup"><span data-stu-id="93414-347">If the BizTalk:Messsage Agent Message Delivery Throttling State and Message Publishing Throttling State performance counters are not zero, check the value to confirm the reason for throttling (for example, memory threshold exceeded, in-flight message count too high, and so on).</span></span>  
  
## <a name="stand-alone-profiler"></a><span data-ttu-id="93414-348">獨立的程式碼剖析工具</span><span class="sxs-lookup"><span data-stu-id="93414-348">Stand-Alone Profiler</span></span>  
 <span data-ttu-id="93414-349">您可以使用效能計數器，來偵測瓶頸在高層級的位置。</span><span class="sxs-lookup"><span data-stu-id="93414-349">You can use performance counters to detect the location of the bottleneck at a high level.</span></span> <span data-ttu-id="93414-350">不過，一旦縮小，您可能需要檢查多個程式碼緊密，以協助輕鬆問題。</span><span class="sxs-lookup"><span data-stu-id="93414-350">However, once narrowed down, you might need to examine the code more closely to help ease the problem.</span></span> <span data-ttu-id="93414-351">使用 Visual Studio 2010 隨附獨立分析工具可以是非常有用的工具，可協助您診斷程式碼花大部分的循環。</span><span class="sxs-lookup"><span data-stu-id="93414-351">The Stand-Alone Profiler that ships with Visual Studio 2010 can be a very helpful tool to help diagnose where the code is spending most of its cycles.</span></span> <span data-ttu-id="93414-352">如需詳細資訊，請參閱</span><span class="sxs-lookup"><span data-stu-id="93414-352">For more information, see</span></span>  
  
## <a name="l2l3-cache"></a><span data-ttu-id="93414-353">L2/L3 快取</span><span class="sxs-lookup"><span data-stu-id="93414-353">L2/L3 cache</span></span>  
 <span data-ttu-id="93414-354">從硬體觀點來看，您可以使用內建的 CPU 快取獲得最大的優點。</span><span class="sxs-lookup"><span data-stu-id="93414-354">From a hardware perspective, you can gain the biggest benefits by using the onboard CPU cache.</span></span> <span data-ttu-id="93414-355">較高的 CPU 快取有助於增加快取命中率，減少系統從記憶體對磁碟進行來回資料分頁的需求。</span><span class="sxs-lookup"><span data-stu-id="93414-355">Higher CPU cache helps increase cache hit rate reducing the need for the system to page data in and out of memory to disk.</span></span>  
  
## <a name="64-bit-performance-bottlenecks"></a><span data-ttu-id="93414-356">64 位元效能瓶頸</span><span class="sxs-lookup"><span data-stu-id="93414-356">64-Bit performance bottlenecks</span></span>  
 <span data-ttu-id="93414-357">64 位元系統上的效能可能看來會低於在 32 位元系統上所能達到的效能。</span><span class="sxs-lookup"><span data-stu-id="93414-357">Performance on 64-bit systems may appear lower than what can be achieved on 32-bit systems.</span></span> <span data-ttu-id="93414-358">這有幾個原因，最重要的是可能的記憶體。</span><span class="sxs-lookup"><span data-stu-id="93414-358">This is possible for a few reasons, the most important one being memory.</span></span>  
  
 <span data-ttu-id="93414-359">測量 2 GB 的記憶體的 32 位元系統上的效能，並比較結果類似 64 位元系統，使用 2 GB 的記憶體不比較相同的動作。</span><span class="sxs-lookup"><span data-stu-id="93414-359">Measuring performance on a 32-bit system with 2 GB of memory and comparing the results to a similar 64-bit system with 2 GB of memory is not comparing the same thing.</span></span> <span data-ttu-id="93414-360">64 位元系統將出現於磁碟 i/o 繫結 (低 %磁碟閒置時間 & 高磁碟佇列長度) 和 cpu （最大 CPU 和高內容切換）。</span><span class="sxs-lookup"><span data-stu-id="93414-360">The 64-bit system will appear to be disk-I/O bound (low % Disk Idle time & high Disk Queue Length) and CPU bound (max CPU and high context switching).</span></span> <span data-ttu-id="93414-361">不過，這是不是因為在 64 位元系統上執行檔案 I/O 是更耗費資源。</span><span class="sxs-lookup"><span data-stu-id="93414-361">However, this is not because performing file I/O on a 64-bit system is more expensive.</span></span>  
  
 <span data-ttu-id="93414-362">64 位元系統是更多的記憶體密集 （64 位元定位） 而導致耗用大部分的 2GB 可用記憶體的作業系統。</span><span class="sxs-lookup"><span data-stu-id="93414-362">The 64-bit system is more memory intensive (64-bit addressing) which results in the operating system consuming most of the 2 GB available memory.</span></span> <span data-ttu-id="93414-363">當發生這種情況時，大部分的其他作業會使分頁至磁碟的強調檔案子系統。</span><span class="sxs-lookup"><span data-stu-id="93414-363">When this happens, most other operations cause paging to disk which stresses the file subsystem.</span></span> <span data-ttu-id="93414-364">因此，系統在花費的 CPU 週期，這兩種資料的記憶體分頁輸入/輸出和程式碼，並會受到高磁碟延遲。</span><span class="sxs-lookup"><span data-stu-id="93414-364">Therefore, the system spends CPU cycles paging in/out of memory both data and code and is impacted by the high disk latency cost.</span></span> <span data-ttu-id="93414-365">這會造成系統呈現較高磁碟爭用和較高 CPU 耗用的情況。</span><span class="sxs-lookup"><span data-stu-id="93414-365">This manifests itself as both higher disk contention and higher CPU consumption.</span></span>  
  
 <span data-ttu-id="93414-366">若要減少此問題的方式是向上延展伺服器升級記憶體。</span><span class="sxs-lookup"><span data-stu-id="93414-366">The way to alleviate this problem is to scale-up the server by upgrading the memory.</span></span> <span data-ttu-id="93414-367">相應增加為 8 GB 的做法，不過，增加更多記憶體將會有幫助改善輸送量，除非問題的原因是因為記憶體不足的 CPU 資源用盡。</span><span class="sxs-lookup"><span data-stu-id="93414-367">Scaling-up to 8 GB is idea, however, adding more memory will not help improve throughput unless the source of the problem is CPU starvation due to low memory conditions.</span></span>  
  
## <a name="using-bam-to-identify-bottlenecks-and-high-latency-issues"></a><span data-ttu-id="93414-368">使用 BAM 識別瓶頸和高延遲問題</span><span class="sxs-lookup"><span data-stu-id="93414-368">Using BAM to identify bottlenecks and high-latency issues</span></span>  
 <span data-ttu-id="93414-369">低度延遲很重要，您可以使用 BAM 來測量系統完成 BizTalk Server 系統內的每個階段所花費的時間。</span><span class="sxs-lookup"><span data-stu-id="93414-369">When low-latency is important, you can use BAM to measure the time the system takes to complete each stage within the BizTalk Server system.</span></span> <span data-ttu-id="93414-370">雖然您可以使用 HAT 偵錯之訊息的狀態並診斷路由訊息中的問題的來源，您可以使用 BAM 來追蹤透過訊息流程的各個端點。</span><span class="sxs-lookup"><span data-stu-id="93414-370">Although you can use HAT to debug the state of messages and diagnose the source of problems in routing messages, you can use BAM to track various points through the message flow.</span></span> <span data-ttu-id="93414-371">藉由建立 BAM 追蹤設定檔定義具有接續活動，您可以測量系統，協助追蹤工作流程中成本最高的階段的不同部分之間的延遲。</span><span class="sxs-lookup"><span data-stu-id="93414-371">By creating a BAM tracking profile that defines an activity with continuations, you can measure latency between different parts of the system to help track the most expensive stages within the workflow process.</span></span>  
  
 <span data-ttu-id="93414-372">您可以使用 HAT 中協調流程偵錯工具，來查詢擱置的執行個體、 繼續偵錯模式中的執行個體，並加入適當的中斷點使用技術的詳細資料檢視。</span><span class="sxs-lookup"><span data-stu-id="93414-372">You can use Orchestration Debugger in HAT to query a suspended instance, resume the instance in debug mode, and add appropriate breakpoints using the Technical Details View.</span></span> <span data-ttu-id="93414-373">這會讓您追蹤活動並逐步偵錯訊息。</span><span class="sxs-lookup"><span data-stu-id="93414-373">This will enable you to trace the activities and debug messages step by step.</span></span>  
  
 <span data-ttu-id="93414-374">您可以設定中斷點追蹤下列事件：</span><span class="sxs-lookup"><span data-stu-id="93414-374">You can set breakpoints to track the following events:</span></span>  
  
-   <span data-ttu-id="93414-375">協調流程的開始和結束</span><span class="sxs-lookup"><span data-stu-id="93414-375">The start and finish of an orchestration</span></span>  
  
-   <span data-ttu-id="93414-376">圖形的開始和結束</span><span class="sxs-lookup"><span data-stu-id="93414-376">The start and finish of a shape</span></span>  
  
-   <span data-ttu-id="93414-377">訊息的傳送或接收</span><span class="sxs-lookup"><span data-stu-id="93414-377">The sending or receipt of a message</span></span>  
  
-   <span data-ttu-id="93414-378">例外狀況</span><span class="sxs-lookup"><span data-stu-id="93414-378">Exceptions</span></span>  
  
 <span data-ttu-id="93414-379">在每個中斷點，您可以檢查有關區域變數、訊息及其屬性、連接埠和角色連結的資訊。</span><span class="sxs-lookup"><span data-stu-id="93414-379">At each breakpoint, you can examine information about local variables, messages and their properties, ports, and role links.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="93414-380">請參閱</span><span class="sxs-lookup"><span data-stu-id="93414-380">See Also</span></span>  
 [<span data-ttu-id="93414-381">尋找並排除瓶頸</span><span class="sxs-lookup"><span data-stu-id="93414-381">Finding and Eliminating Bottlenecks</span></span>](../technical-guides/finding-and-eliminating-bottlenecks.md)