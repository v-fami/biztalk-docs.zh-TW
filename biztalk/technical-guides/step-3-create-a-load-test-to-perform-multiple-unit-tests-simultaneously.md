---
title: 步驟 3： 建立負載測試，以便同時執行多個單元測試 |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: b5dd7e31-7188-4edf-9513-ea2725950b47
caps.latest.revision: 19
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: d946c48c1bcaca420347771e73089e5535ab1229
ms.sourcegitcommit: 266308ec5c6a9d8d80ff298ee6051b4843c5d626
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 06/27/2018
ms.locfileid: "37002703"
---
# <a name="step-3-create-a-load-test-to-perform-multiple-unit-tests-simultaneously"></a>步驟 3： 建立負載測試，以便同時執行多個單元測試
負載測試執行多個執行個體的其中一個或多個單元測試，以便您可以測量您的應用程式效能和處理負載的能力。 Visual Studio 2010 負載測試的主要元件包括：  
  
- **案例**– 讓您設定測試的負載模式、 測試混合模型、 測試混合、 網路混合和 Web 瀏覽器混合負載測試的區段。 案例容納模擬複雜的真實世界工作負載設定檔的複雜度。 如需完整的清單，所有的負載測試情節屬性，請參閱[負載測試情節屬性](http://go.microsoft.com/fwlink/?LinkId=208327)(http://go.microsoft.com/fwlink/?LinkId=208327)。  
  
- **計數器集合**– 讓您建立的特定群組或 「 集 」 效能計數器的負載測試執行時，要收集的負載測試的區段。 預設會提供數個預先定義的計數器集合，而且可以加入自訂計數器集合。 例如若要評估的網路效能，您可以建立自訂的計數器設定、 新增相關的網路效能計數器，以及將它儲存到可用的計數器集合的清單。 如需建立及儲存的負載測試計數器集合的詳細資訊，請參閱[指定在負載測試中的 電腦的計數器集合](http://go.microsoft.com/fwlink/?LinkId=208328)(http://go.microsoft.com/fwlink/?LinkId=208328)。  
  
- **回合設定**– 回合設定定義多個面向的負載測試、 測試持續期間，在負載測試期間，會與不同的電腦相關聯的計數器集合包括各種測試驗證選項，並測試結果的儲存體選項。 您可以建立並儲存每個負載測試中，多個執行的設定，然後選取 執行測試時要使用特定的設定。 使用新增負載測試精靈建立負載測試時，會將初始回合設定加入至負載測試。 如需完整的所有負載測試回合設定屬性清單，請參閱[負載測試回合設定屬性](http://go.microsoft.com/fwlink/?LinkId=208329)(http://go.microsoft.com/fwlink/?LinkId=208329)。  
  
  建立使用新增負載測試精靈]，編輯使用負載測試編輯器中，並在 [負載測試分析器分析負載測試。 所有這些工具包含在 Microsoft Visual Studio Ultimate 版本中。 如需建立和編輯 Visual Studio 2010 Ultimate edition 中的負載測試的詳細資訊，請參閱[建立和編輯負載測試](http://go.microsoft.com/fwlink/?LinkId=208308)(http://go.microsoft.com/fwlink/?LinkId=208308)。  
  
  在測試專案中所述的步驟，在下列各節來新增負載測試的後續[步驟 1： 建立單元測試，以提交至 BizTalk Server 的文件](../technical-guides/step-1-create-a-unit-test-to-submit-documents-to-biztalk-server.md)。 這些步驟也會說明如何設定**案例**，**計數器集合**，並**回合設定**負載測試。  
  
##  <a name="BKMK_StepLoadTest"></a> 將負載測試加入負載測試情節、 計數器集合，並設定回合設定  
 本主題描述如何使用**新增負載測試精靈**新增負載測試專案的測試，以及如何設定負載測試以符合特定需求。  
  
### <a name="use-the-new-load-test-wizard-to-add-a-load-test-to-the-test-project"></a>使用新增負載測試精靈 將負載測試新增至測試專案  
 請遵循下列步驟來新增負載測試來使用新增負載測試精靈 的測試專案。  
  
1.  開啟**負載測試**如果它尚未開啟的 Visual Studio 2010 中的方案。  
  
2.  將資料夾加入 BTSLoad 專案;這個資料夾將包含此專案的過程中建立任何負載測試。 在 [方案總管] 中，以滑鼠右鍵按一下 BTSLoad 專案，指向**新增**，然後按一下**新資料夾**。 反白顯示文字的資料夾圖示**NewFolder1** BTSLoad 專案中，型別將會出現**LoadTests**變更醒目提示的文字，並按 Enter 鍵以完成建立資料夾 C:\Projects\LoadTest\BTSLoad\LoadTests。  
  
3.  在 [方案總管] 中，以滑鼠右鍵按一下**BTSLoad**專案，指向**新增**，然後按一下**負載測試**啟動**新增負載測試精靈**.  
  
4.  按 [下一步] 。  
  
5.  上**編輯負載測試情節的設定**下方的頁面上**輸入負載測試情節的名稱：** 類型**BTS_Messaging_Step**。 底下**考慮時間特性**選取**不使用考慮時間**，然後按一下 [**下一步]**。  
  
6.  在 [**編輯負載模式設定為負載測試情節**頁面上，選取**逐步執行負載**，輸入下列值，然後按一下**下一步]**。  
  
    -   **啟動使用者計數：** 30 位使用者  
  
    -   **逐步執行持續期間：** 60 秒  
  
    -   **逐步執行使用者計數：** 10 位使用者  
  
    -   **最大使用者計數**80 的使用者  
  
    > [!NOTE]  
    >  套用的步驟負載模式的設定時，您應該計算所需的所有步驟會增加完成的時間量。 比方說，使用上述的負載測試指定的負載模式設定將需要 5 分鐘才能完成所有的 60 秒遞增時跳緩慢增加從 30 80 的使用者。 新增負載測試精靈 選項來指定負載測試的長度會看到您的最後一頁，其中將會**負載測試的持續時間**。 如果您已經有針對計算所需的所有步驟完成簡單的工作，以輸入值 （在此情況下的 5 分鐘） 後，就遞增的時間**負載測試持續期間**。  
  
7.  在上**選取負載測試的測試混合模型**頁面上，選取**依據虛擬使用者數目**，然後按一下 [**下一步]**。  
  
8.  在 [**將測試加入至負載測試情節，並且編輯測試混合**頁面上，按一下**新增**] 按鈕。  
  
9. 底下**可用的測試**按兩下**BTSMessaging**並**BTSMessaging2**若要將這些單元測試新增到清單**選取的測試**。 按一下 [ **[確定]** ，然後按一下**下一步]**。  
  
10. 在上**將網路類型加入至負載測試情節，並且編輯網路混合**頁面上確認**網路類型**設定為**LAN**與**發佈**的**100%** ，然後按一下**下一步**。  
  
11. 在 [**指定在負載測試回合期間以計數器集合監視的電腦**頁面上，按一下**下一步]**。  
  
    > [!NOTE]  
    >  不要將電腦新增至目前的負載測試。 新增負載測試精靈只允許您將建立電腦關聯以預先定義的計數器集合，而且此負載測試需要預先定義的兩個使用並*自訂*計數器集合。 精靈完成為止，並儲存在負載測試之後，您就可以編輯負載測試，以便加入自訂計數器集合，並設定要監視使用這兩個預先定義的電腦的負載測試*和*自訂計數器集合。  
  
     在 **檢閱並編輯執行負載測試設定**頁面上，輸入下列值：  
  
    1.  選取 **負載測試持續期間**。  
  
    2.  **準備持續期間 （時分秒）** 30 秒  
  
    3.  **執行持續期間 （時分秒）** 5 分鐘  
  
        > [!NOTE]  
        >  配置的時間**回合持續期限**應該等於需要的所有步驟以完成上述，步驟 5 或 5 分鐘，此範例中所述的遞增的時間量。  
  
    4.  **取樣率**5 秒  
  
    5.  **描述**（選擇性），輸入負載測試的描述。  
  
    6.  **測試失敗時儲存記錄檔**，則為 True  
  
    7.  **驗證層級**低-叫用標記為 「 低的驗證規則  
  
12. 按一下 **完成**以關閉 新增負載測試精靈。  
  
13. 按一下 **檔案**功能表，然後選取**儲存\<負載測試名稱\>.loadtest 為**。  
  
    > [!NOTE]  
    >  在此範例中，<Load Test Name>將是由 Visual Studio 2010 中，通常 loadtestx.loadtest 指派至負載測試檔案的名稱，除非檔案的名稱已被手動變更。  
  
14. 將檔案儲存至稍早建立的 C:\Projects\LoadTest\BTSLoad\LoadTests 目錄。 它可能會很有用的案例中，所使用的名稱儲存檔案在此範例中的情節名稱會是 BTS_Messaging_Step，因此 loadtest 檔案會儲存為 C:\Projects\LoadTest\BTSLoad\LoadTests\BTS_Messaging_Step.loadtest。  
  
###  <a name="BKMK_BTSCounters"></a> 新增自訂計數器集合加入至量值的 BizTalk Server 關鍵效能指標 (KPI)  
 請遵循下列步驟來新增計數器，與量值來判斷最大持續輸送量 (MST) 的 BizTalk Server 應用程式所需的 BizTalk Server KPI 的效能計數器集合：  
  
1. 在方案總管 中按兩下在負載測試您在上一節，在負載測試編輯器中檢視負載測試中建立。  
  
2. 在負載測試編輯器 中，按一下以展開**計數器集合**。 請注意，沒有預先定義的計數器集合，以便讓 BizTalk Server，因此必須加入 「 BizTalk Server 」 計數器集合的計數器清單的自訂設定。  
  
3. 以滑鼠右鍵按一下**計數器集合**，然後選取**加入自訂計數器集合**。 根據預設，此動作會建立自訂計數器集合名稱**Custom1**。  
  
4. 以滑鼠右鍵按一下**Custom1**計數器設定，然後選取**屬性**若要將焦點設定為**屬性**Custom1 計數器集合 對話方塊。  
  
5. 按兩下名稱**Custom1**中**屬性**對話方塊中，輸入**BizTalk**然後按 ENTER 鍵來重新命名自訂計數器集合加入至**BizTalk**.  
  
6. 在 [負載測試編輯器] 中，以滑鼠右鍵按一下**BizTalk**計數器設定，然後選取**新增計數器**。  
  
7. 底下**電腦**，輸入 BizTalk Server 群組，以顯示包含 BizTalk Server 效能計數器的效能監視器類別中的其中一個 BizTalk Server 電腦的名稱。  
  
   > [!IMPORTANT]
   >  若要確保列出所有的 BizTalk Server 效能類別和效能計數器，您可能需要輸入完整的網域名稱 （或 IP 位址） 中的 BizTalk Server 群組中，您可能也需要啟動下列主控件執行個體上BizTalk Server 電腦。  
   > 
   > - 繫結至協調流程會在負載測試期間執行的 BizTalk 主控件執行個體。  
   >   -   設定為傳送或接收處理常式會在負載測試期間執行的配接器的 BizTalk 主控件執行個體。  
  
8. 步驟 24、 選取選項至預設主機中執行，選取主機類型的預設，然後在32 或 64 位元處理序中執行測試，選取的選項64 位元電腦上，在 64 位元處理序中執行測試。 針對步驟 25，選取**將個別測試標示為失敗，如果執行時間超過**並保留預設值為選取的 30 分鐘。  
  
   |27b 步驟中，選取核取方塊test 目錄中的組件使用載入內容，然後按一下另存新檔。|效能計數器|  
   |--------------------------|-------------------------|  
   |處理器|在另存新檔對話方塊方塊中，確認名稱BizTalkLoadTest旁輸入檔名，然後按一下儲存。|  
   |您現在已加入至方案的測試設定檔。|多工緩衝處理大小 *\<BizTalk MessageBox 資料庫名稱\>*:*\<SQL Server 執行個體名稱\>* 計數器執行個體。 **注意︰***\<BizTalk MessageBox 資料庫名稱\>* 並 *\<SQL Server 執行個體名稱\>* 只是預留位置BizTalk MessageBox 資料庫和裝載 BizTalk MessageBox 資料庫的 SQL Server 執行個體的實際名稱。 應與 BizTalk MessageBox 資料庫和相關聯的 SQL Server 執行個體的實際名稱取代這些預留位置。|  
   |BizTalk:傳訊|文件數/秒的接收主控件計數器執行個體。<br /><br /> 文件處理每秒傳輸主控件計數器執行個體。|  
   |BizTalk：訊息代理程式|文件的訊息傳遞內送速率接收主控件。|  
   |BizTalk：訊息代理程式|文件傳輸主控件的訊息發佈外寄速率。|  
   |XLANG/s 協調流程|協調流程每秒完成的協調流程處理主控件。|  
  
### <a name="modify-run-settings-to-map-counter-sets-to-appropriate-computers"></a>修改執行的設定，以將計數器集合對應至適當的電腦  
 請遵循下列步驟來將負載測試的適當的電腦與適當的計數器集合對應：  
  
1.  在 **負載測試編輯器**，以滑鼠右鍵按一下**回合設定**，然後選取**管理計數器集合**。  
  
2.  按一下 **新增電腦**將新電腦新增到清單。 反白顯示的文字與圖示**新的電腦**下方會出現**要監視的電腦和計數器集合**。 輸入您想要新增至清單的電腦名稱取代醒目提示的文字。  
  
3.  之後將電腦新增至清單中，按一下以展開 可用的計數器集合的清單，然後按一下以選取一或多個可用的計數器設定與電腦建立關聯的計數器集。  
  
4.  重複步驟 2 和 3，直到您有與您要收集效能資料的所有電腦相關聯計數器集合。  
  
###  <a name="BKMK_TestSettings"></a> 將測試設定檔新增至解決方案來執行測試並且從遠端收集資料  
 若要設定要使用您在中建立的測試控制器和測試代理程式電腦的負載測試[步驟 2： 設定負載測試控制器和代理程式電腦](../technical-guides/step-2-configure-load-test-controller-and-agent-computers.md)，請依照下列中的步驟[新增遠端執行的測試設定或您的方案的資料收集](http://go.microsoft.com/fwlink/?LinkId=209182)(http://go.microsoft.com/fwlink/?LinkId=209182)如下所示：  
  
1.  步驟 3 中，輸入名稱**BizTalkLoadTest**  
  
2.  略過步驟 6，因為您已在步驟 3 輸入的名稱。  
  
3.  步驟 7 中，輸入 「 這些遠端測試回合的預設測試設定 」 底下**描述**。  
  
4.  步驟 8 中，選取 預設命名配置。  
  
5.  針對步驟 9，底下**測試執行方法**選取**遠端執行**下方**控制器**選取測試控制器電腦，並保留其餘的屬性上**角色**頁面的預設設定。  
  
6.  步驟 24、 選取選項**至預設主機中執行**，選取**主機類型**的**預設**，然後在**32 或 64 位元處理序中執行測試**，選取的選項**64 位元電腦上，在 64 位元處理序中執行測試**。  
  
7.  針對步驟 25，選取**將個別測試標示為失敗，如果執行時間超過**並保留預設值為選取的 30 分鐘。  
  
8.  27b 步驟中，選取核取方塊**test 目錄中的組件使用載入內容**，然後按一下**另存新檔**。  
  
9. 在**另存新檔**對話方塊方塊中，確認名稱**BizTalkLoadTest**旁輸入**檔名**，然後按一下**儲存**。 您現在已加入至方案的測試設定檔。