---
title: "步驟 3： 建立負載測試，以便同時執行多個單元測試 |Microsoft 文件"
ms.custom: 
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: b5dd7e31-7188-4edf-9513-ea2725950b47
caps.latest.revision: "19"
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 76b3d26e9f1dd14463d153c89316b3cf3da0338d
ms.sourcegitcommit: 5abd0ed3f9e4858ffaaec5481bfa8878595e95f7
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 11/28/2017
---
# <a name="step-3-create-a-load-test-to-perform-multiple-unit-tests-simultaneously"></a>步驟 3： 建立負載測試，以便同時執行多個單元測試
負載測試執行多個執行個體的其中一個或多個單元測試，以便您可以測量您的應用程式效能和處理負載的能力。 Visual Studio 2010 負載測試的主要元件包括：  
  
-   **案例**– 您可在此設定測試的負載模式、 測試混合模型、 測試混合、 網路混合和 Web 瀏覽器混合負載測試的區段。 案例容納模擬複雜的實際工作負載設定檔的複雜性。 如需完整清單，所有的負載測試情節屬性，請參閱[負載測試情節屬性](http://go.microsoft.com/fwlink/?LinkId=208327)(http://go.microsoft.com/fwlink/?LinkId=208327)。  
  
-   **計數器集合**– 讓您建立特定群組或 「 集 」 效能計數器的負載測試執行時要收集負載測試的區段。 預設會提供數個預先定義的計數器集合，而且可以加入自訂計數器集合。 例如若要評估的網路效能，您可以建立自訂的計數器設定、 新增相關的網路效能計數器，以及將它儲存到可用的計數器集合的清單。 如需建立及儲存負載測試計數器集合詳細資訊，請參閱[指定在負載測試中的電腦的計數器集合](http://go.microsoft.com/fwlink/?LinkId=208328)(http://go.microsoft.com/fwlink/?LinkId=208328)。  
  
-   **回合設定**– 回合設定定義多方面的負載測試，測試持續期間，在負載測試中，會與不同的電腦相關聯的計數器集合包括各種測試驗證選項，並測試結果儲存體選項。 您可以建立並儲存每個負載測試中，多個回合的設定，然後選取 執行測試時要使用特定的設定。 當您使用新增負載測試精靈建立負載測試時，將初始回合設定會加入至負載測試。 如需所有負載測試回合設定屬性的完整清單，請參閱[載入測試回合設定屬性](http://go.microsoft.com/fwlink/?LinkId=208329)(http://go.microsoft.com/fwlink/?LinkId=208329)。  
  
 建立使用新增負載測試精靈，編輯與負載測試編輯器中，並在 負載測試分析器分析負載測試。 所有這些工具會包含在 Microsoft Visual Studio Ultimate edition。 如需有關建立和編輯負載測試，在 Visual Studio 2010 Ultimate 版本中的，請參閱[建立和編輯負載測試](http://go.microsoft.com/fwlink/?LinkId=208308)(http://go.microsoft.com/fwlink/?LinkId=208308)。  
  
 在測試專案中所述的步驟，在下列各節來新增負載測試的後續[步驟 1： 建立單元測試加入至 BizTalk Server 提交的文件](../technical-guides/step-1-create-a-unit-test-to-submit-documents-to-biztalk-server.md)。 這些步驟也會說明如何設定**案例**，**計數器集合**，和**回合設定**負載測試。  
  
##  <a name="BKMK_StepLoadTest"></a>加入負載測試的負載測試情節、 計數器集合，並設定執行設定  
 本主題描述如何使用**新增負載測試精靈**來新增負載測試專案的測試，以及如何設定負載測試以符合特定需求。  
  
### <a name="use-the-new-load-test-wizard-to-add-a-load-test-to-the-test-project"></a>使用新增負載測試精靈負載測試加入測試專案  
 請遵循下列步驟來新增負載測試加入測試專案，使用新增負載測試精靈。  
  
1.  開啟**負載測試**如果它尚未開啟的 Visual Studio 2010 中的方案。  
  
2.  將資料夾加入 BTSLoad 專案;這個資料夾將包含此專案中建立任何負載測試。 在 [方案總管] 中，以滑鼠右鍵按一下 BTSLoad 專案，指向**新增**，然後按一下**新資料夾**。 反白顯示文字的資料夾圖示**NewFolder1** BTSLoad 專案類型底下會出現**LoadTests**變更反白顯示的文字，並按 Enter 鍵，完成建立資料夾 C:\Projects\LoadTest\BTSLoad\LoadTests。  
  
3.  在 方案總管 中，以滑鼠右鍵按一下**BTSLoad**專案，指向**新增**，然後按一下 **負載測試**啟動**新增負載測試精靈**.  
  
4.  按一下 **[下一步]**。  
  
5.  在**編輯負載測試情節的設定**頁面**輸入負載測試情節的名稱：**類型**BTS_Messaging_Step**。 在下**考慮時間特性**選取**不使用考慮時間**，然後按一下 **下一步**。  
  
6.  在**編輯負載模式設定的負載測試情節**頁面上，選取**逐步執行負載**，輸入下列值，然後按一下**下一步**。  
  
    -   **啟動使用者計數：** 30 位使用者  
  
    -   **逐步執行持續期間：** 60 秒  
  
    -   **逐步執行使用者計數：** 10 個使用者  
  
    -   **最大使用者計數**80 的使用者  
  
    > [!NOTE]  
    >  套用的步驟負載模式的設定時您應該計算所需的所有步驟會累加完成的時間量。 比方說，使用負載測試使用上述指定的負載模式設定將會需要 5 分鐘才能完成所有 60 秒時，逐步遞增根本上 30 80 的使用者。 新增負載測試精靈會顯示與用來指定在負載測試的長度選項的最後一頁，其中將會是**負載測試的持續時間**。 如果您已經有計算所需的所有步驟完成，則輸入值 （在此情況下的 5 分鐘） 的簡單工作遞增的時間為**負載測試持續期間**。  
  
7.  在**選取負載測試的測試混合模型**頁面上，選取**根據虛擬使用者數目**，然後按一下 **下一步**。  
  
8.  在**將測試加入至負載測試情節並且測試混合**頁面上，按一下**新增** 按鈕。  
  
9. 在下**可用的測試**按兩下**BTSMessaging**和**BTSMessaging2**將這些單元測試加入至清單**選取的測試**。 按一下**確定**，然後按一下 **下一步**。  
  
10. 在**將網路類型加入至負載測試情節，並且編輯網路混合**頁面上確認**網路類型**設**LAN**與**發佈**的**100%** ，然後按一下 **下一步**。  
  
11. 在**指定負載測試回合期間以計數器集合監視的電腦**頁面上，按一下**下一步**。  
  
    > [!NOTE]  
    >  不要將電腦新增至目前的負載測試。 新增負載測試精靈只會允許您將電腦產生關聯以預先定義的計數器集合，而且此負載測試需要預先定義的使用和*自訂*計數器集合。 精靈完成為止，並儲存在負載測試之後，您就可以編輯要加入自訂計數器集合，並設定要監視電腦使用這兩個預先定義的負載測試的負載測試*和*自訂計數器集合。  
  
     在**檢閱和編輯執行負載測試設定**頁面上，輸入下列值：  
  
    1.  選取**負載測試持續期間**。  
  
    2.  **準備持續期間 （時分秒）** 30 秒  
  
    3.  **執行持續期間 （時分秒）** 5 分鐘  
  
        > [!NOTE]  
        >  時間配置給**回合持續期限**應該會等於所有步驟完成上述，步驟 5 或 5 分鐘，此範例中所述的增量所需的時間量。  
  
    4.  **取樣率**5 秒  
  
    5.  **描述**（選擇性） 輸入負載測試的描述。  
  
    6.  **測試失敗時儲存記錄檔**，則為 True  
  
    7.  **驗證層級**低-叫用標記為 「 低的驗證規則  
  
12. 按一下**完成**以關閉 新增負載測試精靈。  
  
13. 按一下**檔案**功能表，然後選取**儲存\<負載測試名稱\>為.loadtest**。  
  
    > [!NOTE]  
    >  在此範例中，<Load Test Name>會是由 Visual Studio 2010，通常 loadtestx.loadtest 指派給負載測試檔案的名稱，除非檔案的名稱已被手動變更。  
  
14. 將檔案儲存至稍早建立的 C:\Projects\LoadTest\BTSLoad\LoadTests 目錄。 可能很有用的案例; 所使用的名稱儲存檔案在此範例中的情節名稱會是 BTS_Messaging_Step，因此 loadtest 檔案會儲存為 C:\Projects\LoadTest\BTSLoad\LoadTests\BTS_Messaging_Step.loadtest。  
  
###  <a name="BKMK_BTSCounters"></a>加入自訂計數器集合加入至 BizTalk Server 關鍵效能指標 (KPI) 的量值  
 請遵循下列步驟來新增的計數器集合與效能計數器會測量來判斷最大持續輸送量 (MST) 的 BizTalk Server 應用程式所需的 BizTalk Server KPI:  
  
1.  在方案總管 中按兩下在負載測試您在上一節，在負載測試編輯器中檢視負載測試中建立。  
  
2.  在負載測試編輯器 中，按一下以展開**計數器集合**。 請注意，以便讓 BizTalk Server 沒有預先定義的計數器集合，因此必須加入 「 BizTalk Server 」 計數器集合的計數器清單的自訂設定。  
  
3.  以滑鼠右鍵按一下**計數器集合**選取**加入自訂計數器集合**。 根據預設，此動作會建立自訂計數器集合名稱**Custom1**。  
  
4.  以滑鼠右鍵按一下**Custom1**計數器設定，然後選取**屬性**焦點設定到**屬性**Custom1 計數器集合的對話方塊。  
  
5.  按兩下名稱**Custom1**中**屬性**對話方塊中，輸入**BizTalk** ，然後按 ENTER 鍵，若要重新命名自訂計數器集合加入至**BizTalk**.  
  
6.  在 [負載測試編輯器] 中，以滑鼠右鍵按一下**BizTalk**計數器設定，然後選取**新增計數器**。  
  
7.  在下**電腦**，輸入 BizTalk Server 群組，以顯示包含 BizTalk Server 效能計數器的效能監視器類別中的其中一個 BizTalk Server 電腦的名稱。  
  
    > [!IMPORTANT]  
    >  若要確定列出的所有 BizTalk Server 效能分類及效能計數器、 您可能需要輸入完整的網域名稱 （或 IP 位址） 中的 BizTalk Server 群組中以及您可能也需要上啟動下列主機的執行個體BizTalk Server 電腦。  
    >   
    >  -   繫結至協調流程將在負載測試期間執行的 BizTalk 主控件執行個體。  
    > -   設定為傳送或接收處理常式會在負載測試期間執行的配接器的 BizTalk 主控件執行個體。  
  
8.  BizTalk Server 提供了一組廣泛的效能計數器。 為了判斷最大持續性效能 (MST) 的 BizTalk Server 應用程式，您只需要加入下列 BizTalk Server 效能計數器至**BizTalk**自訂計數器集合：  
  
    |效能分類|效能計數器|  
    |--------------------------|-------------------------|  
    |處理器|%Processor Time _Total 計數器執行個體。|  
    |Biztalk: Messagebox： 一般計數器|多工緩衝處理大小 *\<BizTalk MessageBox 資料庫名稱\>*:*\<SQL Server 執行個體名稱\>*計數器執行個體。 **注意：***\<BizTalk MessageBox 資料庫名稱\>*和 *\<SQL Server 執行個體名稱\>*只是預留位置BizTalk MessageBox 資料庫和裝載 BizTalk MessageBox 資料庫的 SQL Server 執行個體的實際名稱。   應該使用的 BizTalk MessageBox 資料庫和相關聯的 SQL Server 執行個體的實際名稱取代這些預留位置。|  
    |BizTalk:傳訊|文件數/秒的接收主控件計數器執行個體。<br /><br /> 文件處理每秒傳輸主控件計數器執行個體。|  
    |BizTalk：訊息代理程式|文件的訊息傳遞內送速率接收主控件。|  
    |BizTalk：訊息代理程式|文件傳輸主控件的訊息發佈外寄速率。|  
    |XLANG/s 協調流程|協調流程完成每秒的協調流程處理主控件。|  
  
### <a name="modify-run-settings-to-map-counter-sets-to-appropriate-computers"></a>修改回合的設定來將計數器集合對應至適當的電腦  
 請遵循這些步驟，即可對應適當的計數器集合與負載測試的適當電腦：  
  
1.  在**負載測試編輯器**，以滑鼠右鍵按一下**回合設定**選取**管理計數器集合**。  
  
2.  按一下**新增電腦**將新電腦新增至清單。 反白顯示的文字與圖示**新電腦**會出現在**要監視的電腦和計數器集合**。 輸入您想要新增到清單的電腦名稱來取代反白顯示的文字。  
  
3.  之後將電腦加入至清單中，按一下以展開 可用的計數器集合的清單，然後按一下以選取一或多個可用的計數器設定與電腦建立關聯的計數器集。  
  
4.  重複步驟 2 和 3，直到您已經與您要收集效能資料的所有電腦關聯計數器集合。  
  
###  <a name="BKMK_TestSettings"></a>將測試設定檔加入至方案以執行測試，和從遠端收集資料  
 若要設定要使用您在中建立的測試控制器和測試代理程式電腦的負載測試[步驟 2： 設定負載測試控制器和代理程式電腦](../technical-guides/step-2-configure-load-test-controller-and-agent-computers.md)，依照[加入遠端執行的測試設定資料收集至您的方案或](http://go.microsoft.com/fwlink/?LinkId=209182)(http://go.microsoft.com/fwlink/?LinkId=209182) 如下所示：  
  
1.  步驟 3 輸入的名稱**BizTalkLoadTest**  
  
2.  略過步驟 6，因為您已在步驟 3 輸入的名稱。  
  
3.  步驟 7 中，輸入 「 這些是遠端測試回合的預設測試設定 」 下**描述**。  
  
4.  步驟 8 中，選取 預設的命名配置。  
  
5.  針對步驟 9，底下**測試執行方法**選取**遠端執行**下**控制器**選取測試控制器電腦並將其餘內容保留在**角色**頁面的預設設定。  
  
6.  步驟 24，選取選項**至預設主機中執行**，選取**主控類型**的**預設**，然後在**32 或 64 位元處理序中執行測試**，選取的選項**64 位元電腦上執行 64 位元處理序中的測試**。  
  
7.  針對步驟 25 選取**標記為失敗，如果超過執行時間的個別測試**並保留預設值為 30 分鐘選取。  
  
8.  27b 步驟中，選取核取方塊**測試目錄中的組件使用載入內容**，然後按一下 **存**。  
  
9. 在**另存新檔**對話方塊方塊中，確認名稱**BizTalkLoadTest**旁輸入**檔案名稱**，然後按一下**儲存**。 您現在已新增至您的方案的測試設定檔。