---
title: 調查瓶頸 |Microsoft 文件
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: 2ab8e485-ffe5-4f71-9ce2-f72c0c939e5d
caps.latest.revision: 6
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: e34d01bbfafd1a05f87fff5cda2b21764d43f42b
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 09/20/2017
ms.locfileid: "22298838"
---
# <a name="investigating-bottlenecks"></a>調查瓶頸
本主題說明建議的程序來調查瓶頸。  
  
## <a name="what-is-the-source-of-the-problem"></a>什麼是問題的來源？  
 瓶頸的來源可能是硬體或軟體相關。 當資源都未充分使用時，通常是造成瓶頸的指示。 透過硬體限制、 效率不佳的軟體設定，或是兩者，可能被造成瓶頸。  
  
 識別瓶頸是一項遞增程序，解決一個瓶頸，可能導致下一個瓶頸被發現。 識別和解決瓶頸的技術是本主題的目標。 系統在短時間內處於尖峰執行狀態，這種情形有可能發生。 不過，對持續性輸送量來說，系統最快只能用其最慢執行元件的速度處理。  
  
## <a name="using-an-iterative-approach-to-testing"></a>使用測試反覆處理方法  
 在端點 （進入/離開） 或中介 （協調流程/資料庫） 中的系統上可能是瓶頸。 瓶頸之後，使用結構化的方式來識別的來源。 會降低瓶頸之後，請務必再次測量效能，請確認新瓶頸未傳入其他地方系統中。  
  
 識別和解決瓶頸的程序應該是以反覆的方式。 改變一次只有一個參數，重複在每個測試回合，期間完全相同的步驟，然後測量效能，以確認單一修改的影響。 同時變動多個參數可能會掩蓋此變更的作用。  
  
 例如，變更參數 1，可以改善效能。 不過，變更參數 1 和變更參數 2 一起使用，可以造成不利的影響，否定變更參數 1 的優點。 這會導致淨效果為零，並會導致變更參數 1 的影響 (false negative) 和誤判的不同參數 2 的效果。  
  
## <a name="testing-consistency"></a>測試一致性  
 測量效能特性，變更設定之後應該要驗證變更的效果。  
  
-   **硬體-** 使用一致的硬體，因為變更硬體會造成不一致的行為，並且會產生誤導的結果。 例如，您會使用膝上型電腦測試 BizTalk 解決方案的效能。  
  
-   **測試回合持續時間-** 測量固定的最小週期，以確保結果會持續的效能。 執行較長時間測試也可確保系統經歷初始暖機/逐漸增加的所有快取會填入、 資料庫資料表已達到預期的計數，而節流有足夠的時間，可管制輸送量，一次指定預先定義的期間臨界值會叫用。 這種方法有助於探索最佳、持續性輸送量。  
  
-   **測試參數 –** 不會改變從測試執行的測試參數。 例如，變更對應的複雜性和 (或) 文件大小，可能會產生不同的輸送量和延遲結果。  
  
-   **清除狀態-** 完成測試之後，請確定測試環境的狀態是初始狀態，再執行下一個測試。 例如，歷程記錄資料可以建置執行階段輸送量會影響資料庫中。 回收服務執行個體有助於釋快取的資源，例如記憶體、 資料庫連接和執行緒。 在測試環境中，您可能想要建立和執行 bts_CleanupMsgbox 預存程序中所述[如何從測試環境中的 MessageBox 資料庫手動清除資料](http://go.microsoft.com/fwlink/?LinkId=158064)(http://go.microsoft.com/fwlink/?LinkId=158064)。 此指令碼是回到您 BizTalk Server 的測試環境與訊息方塊的全新狀態之間執行。 指令碼刪除所有的執行個體，包括狀態、 訊息和訂用帳戶，這些執行個體的所有資訊，但會保留所有啟用訂用帳戶，因此您不需要重新登錄您的協調流程或傳送埠。 請注意，此工具不支援在生產系統上。  
  
-   **效能測試和調整-** 這個測試類別的目標是將您的應用程式的效能和輸送量最大化，並尋找最大持續輸送量 (MST) 的系統。  如需規劃和測量最大持續性效能的詳細資訊請參閱[規劃維持效能](http://go.microsoft.com/fwlink/?LinkId=158065)(http://go.microsoft.com/fwlink/?LinkId=158065) 和[何謂持續性效能？](http://go.microsoft.com/fwlink/?LinkId=132304) (http://go.microsoft.com/fwlink/?LinkId=132304)。  
  
     MST 是在生產環境中的系統可無限處理的訊息流量的最高負載。 所有的 BizTalk 應用程式應該實際執行前先測試效能和輸送量。 最少，您應該執行一組代表性代表最常見的使用方式案例的測試案例。 我們建議您對預期負載進行測試，並在個別的環境符合實際執行環境的特性的尖峰負載。 此環境中應該有所有的公司標準服務安裝和執行，例如監視的代理程式和防毒軟體。  
  
-   我們也建議您在一起執行的其他 BizTalk 應用程式的生產環境中測試新的 BizTalk 應用程式的相同硬體上。 這些其他的 BizTalk 應用程式會放入 BizTalk Server、 SQL Server、 I/O、 網路和磁碟 I/O 的額外負載。 此外，一個 BizTalk 應用程式，可能會導致另一個則是節流 （多工緩衝處理深度變得很大，例如） 時。 所有的 BizTalk 應用程式應該是效能 / 壓力測試，才能移到實際執行環境。 此外，您應該決定從尖峰負載復原系統所需的時間。 系統會完全復原尖峰負載下一步的尖峰負載發生之前，如果您已經有問題。 系統會進一步和進一步的背後，將永遠無法完全復原。  
  
## <a name="expectations-throughput-vs-latency"></a>期望： 輸送量和延遲  
 您可以預期特定數量的輸送量和/或從已部署系統的延遲。 嘗試同時達到高輸送量和低度延遲置於系統逼近對方的要求。 您可以預期最佳輸送量和合理延遲。 當輸送量提高，壓力 （例如，較高的 CPU 耗用率較高的磁碟 i/o 競爭，記憶體不足的壓力和高鎖定爭） 在此系統會增加。 這種情況下可以對延遲造成負面影響。 若要探索系統的最佳容量，我們建議您找出並找出任何瓶頸降到最低。  
  
 資料庫中已完成的執行個體可能會造成瓶頸。 發生瓶頸時，可能會降低效能。 讓系統有足夠的時間來清空，可協助修正問題。 探索積存增加的原因，並協助修正問題很重要。  
  
 若要探索積存的原因，您可以分析歷程記錄資料和監視效能計數器 （以探索使用模式並診斷積存的來源）。 常見的是，晚批次方式處理大量資料時，可以發生待處理項目。 您可能會發現以探索系統，它能夠從積存復原的容量。 此資訊可協助您估計來處理過度負載的狀況和的緩衝區數量以配合處理輸送量中的非預期的尖峰系統內的硬體需求。  
  
 監視效能計數器，可協助表示在執行階段就會發生的潛在瓶頸。 不過，當我們懷疑 CPU 或記憶體瓶頸問題可能是其中一個自訂此解決方案的組成元件，我們強烈建議您程式碼剖析工具這類的 Visual Studio 分析工具或螞蟻效能分析工具在使用效能測試若要縮小範圍，以及表示確實會產生問題的類別。 很明顯地，應用程式程式碼剖析會妨礙效能。 因此，這些測試應該專注於 individuating 會導致記憶體耗用量、 CPU 使用率或延遲的元件，而且應該捨棄在這些測試期間收集的圖表。  
  
 微調系統以最佳的持續性輸送量，便需要深入了解部署的應用程式、 的優點和缺點系統和使用模式的特定案例。 探索瓶頸並可靠預測最佳、具持續性輸送量的唯一方法，是透過在最符合實際執行的拓撲上進行完整測試。 當針對特定使用案例中，執行負載和壓力測試，是縮小很重要的隔離到個別的主控件執行個體 （接收位置、 傳送埠、 協調流程） 的單一成品，並設定在 [效能監視器] 工具的右計數器造成瓶頸的原因。  
  
 本節中的其他主題會引導您完成定義該拓撲的程序，並提供有關如何降低，並避免瓶頸的指導方針。  
  
## <a name="scaling"></a>擴充  
 瓶頸可能會發生在已部署的拓撲的各個階段。 有些瓶頸可藉由向上擴充或向外延展環境。 向上擴充是升級現有的電腦的程序。 例如，您可以從四個處理器的電腦升級 BizTalk Server 電腦八個處理器的電腦，以及以取代現有的 Cpu 及新增更多的 RAM。 如此一來，您可以加速需要大量資源的工作，例如文件剖析和對應。 向外延展是將伺服器新增至您的部署程序。 延展增加或放大決策取決於瓶頸和所設定的應用程式的類型。 應用程式需要從頭設定建立成能夠利用相應增加或放大。下列指示說明如何變更硬體部署拓撲根據遇到的瓶頸。  
  
 **向上擴充**上執行的 BizTalk 方案的方式升級硬體 （如範例中，新增 CPU 和記憶體）。 您應該查看 1） 向外延展是過於昂貴或 2） 向外延展將協助您解決瓶頸時，向上擴充。 例如，您可以大幅減少所花費的時間轉換和處理大型訊息，如果您更快的電腦上執行工作。  
  
 **向外延展**將 BizTalk 節點加入至 BizTalk Server 群組，並使用它們來執行解決方案的一個或多個部分組成的應用程式平台。 您應該查看向外延展，1） 您需要隔離傳送、 接收、 處理、 追蹤主控件或 2） 當記憶體、 I/O 或網路 I/O 資源超量單一伺服器。 將負載分散到多部伺服器。不過，將新節點加入至 BizTalk Server 群組，可以增加 MessageBox 資料庫上的鎖定爭用。  
  
 因此您應該向上延展還是向外延展？ 向上延展您的平台可減少 BizTalk 解決方案的延遲，因為它會使單一工作 （例如，訊息對應） 的執行速度。 向外延展可以改善最大持續輸送量和 BizTalk 解決方案的延展性因為它可讓您的工作負載分散到多部電腦。  
  
## <a name="see-also"></a>另請參閱  
 [尋找並排除瓶頸](../technical-guides/finding-and-eliminating-bottlenecks.md)