---
title: "最佳化檔案群組的資料庫 |Microsoft 文件"
ms.custom: 
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: f7dbed4d-95d6-4a41-a69e-737a6f2f5a82
caps.latest.revision: "8"
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 6df4f1213ed35c06b14ae127cf0593abfdd8ff35
ms.sourcegitcommit: 3fc338e52d5dbca2c3ea1685a2faafc7582fe23a
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 12/01/2017
---
# <a name="optimizing-filegroups-for-the-databases"></a><span data-ttu-id="118ea-102">最佳化檔案群組的資料庫</span><span class="sxs-lookup"><span data-stu-id="118ea-102">Optimizing Filegroups for the Databases</span></span>
<span data-ttu-id="118ea-103">檔案輸入/輸出 (I/O) 競爭的情況通常是限制因素或在生產環境 BizTalk Server 環境中的瓶頸。</span><span class="sxs-lookup"><span data-stu-id="118ea-103">File input/output (I/O) contention is frequently a limiting factor, or bottleneck, in a production BizTalk Server environment.</span></span> <span data-ttu-id="118ea-104">BizTalk Server 資料庫非常密集的應用程式，而接著，BizTalk Server 所使用的 SQL Server 資料庫檔案最需要大量 I/O。</span><span class="sxs-lookup"><span data-stu-id="118ea-104">BizTalk Server is a very database intensive application and in turn, the SQL Server database used by BizTalk Server is very file I/O intensive.</span></span>  
  
 <span data-ttu-id="118ea-105">本主題描述如何最有效地利用檔案及檔案群組功能的 SQL Server 檔案 I/O 競爭次數降到最低，並改善 BizTalk Server 解決方案的整體效能。</span><span class="sxs-lookup"><span data-stu-id="118ea-105">This topic describes how to make optimal use of the files and filegroups feature of SQL Server to minimize the occurrence of file I/O contention and improve the overall performance of a BizTalk Server solution.</span></span>  
  
## <a name="overview"></a><span data-ttu-id="118ea-106">概觀</span><span class="sxs-lookup"><span data-stu-id="118ea-106">Overview</span></span>  
 <span data-ttu-id="118ea-107">每個 BizTalk Server 解決方案最終將會遇到檔案 I/O 競爭，提升輸送量。</span><span class="sxs-lookup"><span data-stu-id="118ea-107">Every BizTalk Server solution will eventually encounter file I/O contention as throughput is increased.</span></span> <span data-ttu-id="118ea-108">I/O 子系統或儲存引擎是任何關聯式資料庫的重要元件。</span><span class="sxs-lookup"><span data-stu-id="118ea-108">The I/O subsystem, or storage engine, is a key component of any relational database.</span></span> <span data-ttu-id="118ea-109">成功的資料庫實作通常需要在專案早期就進行周密的規劃。</span><span class="sxs-lookup"><span data-stu-id="118ea-109">A successful database implementation typically requires careful planning at the early stages of a project.</span></span> <span data-ttu-id="118ea-110">這項規劃應考量下列問題：</span><span class="sxs-lookup"><span data-stu-id="118ea-110">This planning should include consideration of the following issues:</span></span>  
  
-   <span data-ttu-id="118ea-111">應使用哪種磁碟硬體，如 RAID (磁碟陣列) 裝置。</span><span class="sxs-lookup"><span data-stu-id="118ea-111">What type of disk hardware to use, such as RAID (redundant array of independent disks) devices.</span></span> 
  
-   <span data-ttu-id="118ea-112">如何分配使用檔案和檔案群組的磁碟上的資料。</span><span class="sxs-lookup"><span data-stu-id="118ea-112">How to apportion data on the disks using files and filegroups.</span></span> <span data-ttu-id="118ea-113">如需有關如何使用 SQL Server 中的檔案和檔案群組的詳細資訊，請參閱[Database Files and Filegroups](https://docs.microsoft.com/sql/relational-databases/databases/database-files-and-filegroups)。</span><span class="sxs-lookup"><span data-stu-id="118ea-113">For more information about using files and filegroups in SQL Server, see [Database Files and Filegroups](https://docs.microsoft.com/sql/relational-databases/databases/database-files-and-filegroups).</span></span>
  
-   <span data-ttu-id="118ea-114">實作最佳的索引設計來存取資料時改善效能。</span><span class="sxs-lookup"><span data-stu-id="118ea-114">Implementing the optimal index design for improving performance when accessing data.</span></span> <span data-ttu-id="118ea-115">如需設計索引的詳細資訊，請參閱[設計索引](https://docs.microsoft.com/sql/relational-databases/sql-server-index-design-guide)。</span><span class="sxs-lookup"><span data-stu-id="118ea-115">For more information about designing indexes, see [Designing Indexes](https://docs.microsoft.com/sql/relational-databases/sql-server-index-design-guide).</span></span>
  
-   <span data-ttu-id="118ea-116">如何設定 SQL Server 組態參數，以獲得最佳效能。</span><span class="sxs-lookup"><span data-stu-id="118ea-116">How to set SQL Server configuration parameters for optimal performance.</span></span> <span data-ttu-id="118ea-117">適用於 SQL Server 設定最佳的設定參數的相關資訊，請參閱[伺服器組態選項](https://docs.microsoft.com/sql/database-engine/configure-windows/server-configuration-options-sql-server)。</span><span class="sxs-lookup"><span data-stu-id="118ea-117">For more information about setting optimal configuration parameters for SQL Server, see [Server Configuration Options](https://docs.microsoft.com/sql/database-engine/configure-windows/server-configuration-options-sql-server).</span></span> 
  
 <span data-ttu-id="118ea-118">BizTalk server 的主要設計目標之一是確保訊息是**從未**遺失。</span><span class="sxs-lookup"><span data-stu-id="118ea-118">One of the primary design goals of BizTalk Server is to ensure that a message is **never** lost.</span></span> <span data-ttu-id="118ea-119">若要降低訊息遺失的可能性，訊息會經常寫入至 MessageBox 資料庫在處理訊息。</span><span class="sxs-lookup"><span data-stu-id="118ea-119">In order to mitigate the possibility of message loss, messages are frequently written to the MessageBox database as the message is processed.</span></span> <span data-ttu-id="118ea-120">當協調流程處理訊息時，訊息會寫入協調流程中每個持續點的 MessageBox 資料庫中。</span><span class="sxs-lookup"><span data-stu-id="118ea-120">When messages are processed by an Orchestration, the message is written to the MessageBox database at every persistence point in the orchestration.</span></span> <span data-ttu-id="118ea-121">這些持續點會導致 MessageBox 實體磁碟寫入的訊息和相關的狀態。</span><span class="sxs-lookup"><span data-stu-id="118ea-121">These persistence points cause the MessageBox to write the message and related state to physical disk.</span></span> <span data-ttu-id="118ea-122">在更高的輸送量，此持續性會造成相當大的磁碟爭用情況，而可能成為瓶頸。</span><span class="sxs-lookup"><span data-stu-id="118ea-122">At higher throughputs, this persistence can result in considerable disk contention and can potentially become a bottleneck.</span></span>  
  
 <span data-ttu-id="118ea-123">進行最佳使用的檔案，並有效地解決檔案 IO 瓶頸，改善在 BizTalk Server 解決方案的整體效能可能會在 SQL Server 中的檔案群組功能。</span><span class="sxs-lookup"><span data-stu-id="118ea-123">Making optimal use of the files and filegroups feature in SQL Server has been shown to effectively address File IO bottlenecks and improve overall performance in BizTalk Server solutions.</span></span> <span data-ttu-id="118ea-124">此最佳化只應該由有經驗的 SQL Server 資料庫系統管理員和只有之後所有 BizTalk Server 資料庫已正確地備份。</span><span class="sxs-lookup"><span data-stu-id="118ea-124">This optimization should only be done by an experienced SQL Server database administrator and only after all BizTalk Server databases have been properly backed up.</span></span> <span data-ttu-id="118ea-125">應該在 BizTalk Server 環境中的所有 SQL Server 電腦上執行此最佳化。</span><span class="sxs-lookup"><span data-stu-id="118ea-125">This optimization should be performed on all SQL Server computers in the BizTalk Server environment.</span></span>  
  
 <span data-ttu-id="118ea-126">若要改善資料庫效能，因為這項功能可讓資料庫可建立跨多個磁碟、 多個磁碟控制卡或 RAID （獨立磁碟備援陣列） 系統可以利用 SQL Server 的檔案和檔案群組。</span><span class="sxs-lookup"><span data-stu-id="118ea-126">SQL Server files and filegroups can be utilized to improve database performance because this functionality allows a database be created across multiple disks, multiple disk controllers, or RAID (redundant array of independent disks) systems.</span></span> <span data-ttu-id="118ea-127">例如，若電腦有 4 個磁碟，您可以建立由 3 個資料檔和 1 個記錄檔組成的資料庫，每一個檔案各在一個磁碟上。</span><span class="sxs-lookup"><span data-stu-id="118ea-127">For example, if your computer has four disks, you can create a database that is made up of three data files and one log file, with one file on each disk.</span></span> <span data-ttu-id="118ea-128">存取資料時，四個讀寫頭可以同時存取平行的資料。</span><span class="sxs-lookup"><span data-stu-id="118ea-128">As data is accessed, four read/write heads can concurrently access the data in parallel.</span></span> <span data-ttu-id="118ea-129">大幅加快資料庫作業。</span><span class="sxs-lookup"><span data-stu-id="118ea-129">This speeds up database operations significantly.</span></span> <span data-ttu-id="118ea-130">如需有關實作 SQL Server 磁碟的硬體解決方案的詳細資訊，請參閱"資料庫的效能 「 SQL Server 線上叢書中[http://go.microsoft.com/fwlink/?LinkID=71419](http://go.microsoft.com/fwlink/?LinkID=71419)。</span><span class="sxs-lookup"><span data-stu-id="118ea-130">For more information about implementing hardware solutions for SQL Server disks, see “Database Performance” in the SQL Server Books online at [http://go.microsoft.com/fwlink/?LinkID=71419](http://go.microsoft.com/fwlink/?LinkID=71419).</span></span>  
  
 <span data-ttu-id="118ea-131">此外，檔案和檔案群組啟用資料位置選項，可以在特定的檔案群組中建立資料表。</span><span class="sxs-lookup"><span data-stu-id="118ea-131">Additionally, files and filegroups enable data placement, because tables can be created in specific filegroups.</span></span> <span data-ttu-id="118ea-132">這可改善效能，因為指定資料表的所有檔案 I/O 都可都導向特定的磁碟。</span><span class="sxs-lookup"><span data-stu-id="118ea-132">This improves performance, because all file I/O for a given table can be directed at a specific disk.</span></span> <span data-ttu-id="118ea-133">比方說，經常使用的資料表可以放在檔案群組，在某個磁碟，並在資料庫中其他較少存取的資料表可以位於不同的檔案放在第二個磁碟上的另一個檔案群組中。</span><span class="sxs-lookup"><span data-stu-id="118ea-133">For example, a heavily used table can be placed on a file in a filegroup, located on one disk, and the other less heavily accessed tables in the database can be located on different files in another filegroup, located on a second disk.</span></span>  
  
 <span data-ttu-id="118ea-134">檔案 IO 瓶頸相當詳細地討論[資料庫層中的瓶頸](../technical-guides/bottlenecks-in-the-database-tier.md)。</span><span class="sxs-lookup"><span data-stu-id="118ea-134">File IO bottlenecks are discussed in considerable detail in [Bottlenecks in the Database Tier](../technical-guides/bottlenecks-in-the-database-tier.md).</span></span> <span data-ttu-id="118ea-135">最常見檔案 I/O (磁碟 I/O) 是一個瓶頸的指標是 「 實體磁碟： 平均磁碟佇列長度 」 計數器的值。</span><span class="sxs-lookup"><span data-stu-id="118ea-135">The most common indicator that File I/O (Disk I/O) is a bottleneck is the value of the “Physical Disk:Average Disk Queue Length” counter.</span></span> <span data-ttu-id="118ea-136">「 實體磁碟： 平均磁碟佇列長度 」 計數器的值大於約 3 的任何 SQL 伺服器上任何指定的磁碟，然後檔案 I/O 時，可能是效能瓶頸。</span><span class="sxs-lookup"><span data-stu-id="118ea-136">When the value of the “Physical Disk:Average Disk Queue Length” counter is greater than about 3 for any given disk on any of the SQL Servers, then file I/O is likely a bottleneck.</span></span>  
  
 <span data-ttu-id="118ea-137">如果套用檔案群組的最佳化，不會解決檔案 I/O 瓶頸問題，然後它可能需要加入其他的實體或 SAN 磁碟機來增加磁碟子系統的輸送量。</span><span class="sxs-lookup"><span data-stu-id="118ea-137">If applying file or filegroup optimization doesn't resolve a file I/O bottleneck problem, then it may be necessary to increase the throughput of the disk subsystem by adding additional physical or SAN drives.</span></span>  
  
 <span data-ttu-id="118ea-138">本主題描述如何將手動套用 file 和 filegroup 最佳化，但也可撰寫這些最佳化。</span><span class="sxs-lookup"><span data-stu-id="118ea-138">This topic describes how to manually apply file and filegroup optimizations but these optimizations can also be scripted.</span></span> <span data-ttu-id="118ea-139">本主題的結尾會提供範例 SQL 指令碼。</span><span class="sxs-lookup"><span data-stu-id="118ea-139">A sample SQL script is provided at the end of this topic.</span></span> <span data-ttu-id="118ea-140">請務必注意，此指令碼會需要修改，以配合檔案、 檔案群組，以及針對任何給定的 BizTalk Server 解決方案使用 SQL Server 資料庫的磁碟組態。</span><span class="sxs-lookup"><span data-stu-id="118ea-140">It is important to note that this script would need to be modified to accommodate the file, filegroup, and disk configuration used by the SQL Server database(s) for any given BizTalk Server solution.</span></span>  
  
 
## <a name="databases-created-with-a-default-biztalk-server-configuration"></a><span data-ttu-id="118ea-141">使用預設的 BizTalk Server 組態建立的資料庫</span><span class="sxs-lookup"><span data-stu-id="118ea-141">Databases created with a default BizTalk Server configuration</span></span>  
 <span data-ttu-id="118ea-142">依據 13 不同資料庫中設定 BizTalk Server 中，可能會建立在 SQL Server 及所有的這些資料庫的預設檔案群組中建立時，會啟用功能。</span><span class="sxs-lookup"><span data-stu-id="118ea-142">Depending on which features are enabled when configuring BizTalk Server, up to 13 different databases may be created in SQL Server and all of these databases are created in the default file group.</span></span> <span data-ttu-id="118ea-143">SQL Server 的預設檔案群組是主要檔案群組，除非使用 ALTER DATABASE 命令來變更預設檔案群組。</span><span class="sxs-lookup"><span data-stu-id="118ea-143">The default filegroup for SQL Server is the PRIMARY filegroup unless the default filegroup is changed by using the ALTER DATABASE command.</span></span> <span data-ttu-id="118ea-144">下表列出的資料庫所建立的 SQL Server 中，如果設定 BizTalk Server 時，會啟用所有功能。</span><span class="sxs-lookup"><span data-stu-id="118ea-144">The table below lists the databases that are created in SQL Server if all features are enabled when configuring BizTalk Server.</span></span>  
  
### <a name="biztalk-server-databases"></a><span data-ttu-id="118ea-145">BizTalk Server 資料庫</span><span class="sxs-lookup"><span data-stu-id="118ea-145">BizTalk Server Databases</span></span>  
  
||||  
|-|-|-|  
|<span data-ttu-id="118ea-146">**資料庫**</span><span class="sxs-lookup"><span data-stu-id="118ea-146">**Database**</span></span>|<span data-ttu-id="118ea-147">**預設的資料庫名稱**</span><span class="sxs-lookup"><span data-stu-id="118ea-147">**Default Database Name**</span></span>|<span data-ttu-id="118ea-148">**說明**</span><span class="sxs-lookup"><span data-stu-id="118ea-148">**Description**</span></span>|  
|<span data-ttu-id="118ea-149">設定資料庫</span><span class="sxs-lookup"><span data-stu-id="118ea-149">Configuration database</span></span>|<span data-ttu-id="118ea-150">BizTalkMgmtDb</span><span class="sxs-lookup"><span data-stu-id="118ea-150">BizTalkMgmtDb</span></span>|<span data-ttu-id="118ea-151">中央中繼資訊存放區的所有 BizTalk Server 群組中的 BizTalk Server 執行個體。</span><span class="sxs-lookup"><span data-stu-id="118ea-151">The central meta-information store for all instances of BizTalk Server in the BizTalk Server group.</span></span>|  
|<span data-ttu-id="118ea-152">BizTalk MessageBox 資料庫</span><span class="sxs-lookup"><span data-stu-id="118ea-152">BizTalk MessageBox database</span></span>|<span data-ttu-id="118ea-153">BizTalkMsgBoxDb</span><span class="sxs-lookup"><span data-stu-id="118ea-153">BizTalkMsgBoxDb</span></span>|<span data-ttu-id="118ea-154">儲存訂閱述詞。</span><span class="sxs-lookup"><span data-stu-id="118ea-154">Stores subscriptions predicates.</span></span> <span data-ttu-id="118ea-155">它是主機平台，並會保留每個 BizTalk Server 主控件佇列和狀態資料表。</span><span class="sxs-lookup"><span data-stu-id="118ea-155">It is a host platform, and keeps queues and state tables for each BizTalk Server host.</span></span> <span data-ttu-id="118ea-156">MessageBox 資料庫也儲存訊息及訊息屬性。</span><span class="sxs-lookup"><span data-stu-id="118ea-156">The MessageBox database also stores the messages and message properties.</span></span>|  
|<span data-ttu-id="118ea-157">BizTalk 追蹤資料庫</span><span class="sxs-lookup"><span data-stu-id="118ea-157">BizTalk Tracking database</span></span>|<span data-ttu-id="118ea-158">BizTalkDTADb</span><span class="sxs-lookup"><span data-stu-id="118ea-158">BizTalkDTADb</span></span>|<span data-ttu-id="118ea-159">儲存商務和狀況監控 BizTalk Server 追蹤引擎所追蹤的資料。</span><span class="sxs-lookup"><span data-stu-id="118ea-159">Stores business and health monitoring data tracked by the BizTalk Server tracking engine.</span></span>|  
|<span data-ttu-id="118ea-160">BAM 分析資料庫</span><span class="sxs-lookup"><span data-stu-id="118ea-160">BAM Analysis database</span></span>|<span data-ttu-id="118ea-161">BAMAnalysis</span><span class="sxs-lookup"><span data-stu-id="118ea-161">BAMAnalysis</span></span>|<span data-ttu-id="118ea-162">SQL Server Analysis Services 資料庫的彙總的歷程記錄資料會保留商務活動。</span><span class="sxs-lookup"><span data-stu-id="118ea-162">SQL Server Analysis Services database that keeps the aggregated historical data for Business Activities.</span></span>|  
|<span data-ttu-id="118ea-163">BAM 星狀結構描述資料庫</span><span class="sxs-lookup"><span data-stu-id="118ea-163">BAM Star Schema database</span></span>|<span data-ttu-id="118ea-164">BAMStarSchema</span><span class="sxs-lookup"><span data-stu-id="118ea-164">BAMStarSchema</span></span>|<span data-ttu-id="118ea-165">轉換的 OLAP 處理從商務活動監控所收集的資料。</span><span class="sxs-lookup"><span data-stu-id="118ea-165">Transforms the data collected from Business Activity Monitoring for OLAP Processing.</span></span> <span data-ttu-id="118ea-166">使用 BAM 分析資料庫時，此資料庫是必要的。</span><span class="sxs-lookup"><span data-stu-id="118ea-166">This database is required when using the BAM Analysis database.</span></span>|  
|<span data-ttu-id="118ea-167">BAM 主要匯入資料庫</span><span class="sxs-lookup"><span data-stu-id="118ea-167">BAM Primary Import database</span></span>|<span data-ttu-id="118ea-168">BAMPrimaryImport</span><span class="sxs-lookup"><span data-stu-id="118ea-168">BAMPrimaryImport</span></span>|<span data-ttu-id="118ea-169">活動執行個體之後，會儲存商務活動，然後查詢的進度和資料的事件。</span><span class="sxs-lookup"><span data-stu-id="118ea-169">Stores the events from Business Activities and then queries for the progress and data after activity instances.</span></span> <span data-ttu-id="118ea-170">此資料庫也會執行即時彙總。</span><span class="sxs-lookup"><span data-stu-id="118ea-170">This database also performs real-time aggregations.</span></span>|  
|<span data-ttu-id="118ea-171">BAM 封存資料庫</span><span class="sxs-lookup"><span data-stu-id="118ea-171">BAM Archive database</span></span>|<span data-ttu-id="118ea-172">BAMArchive</span><span class="sxs-lookup"><span data-stu-id="118ea-172">BAMArchive</span></span>|<span data-ttu-id="118ea-173">儲存訂閱述詞。</span><span class="sxs-lookup"><span data-stu-id="118ea-173">Stores subscription predicates.</span></span> <span data-ttu-id="118ea-174">BAM 封存資料庫可將 BAM 主要匯入資料庫中的商務活動資料累積降到最低。</span><span class="sxs-lookup"><span data-stu-id="118ea-174">The BAM Archive database minimizes the accumulation of Business Activity data in the BAM Primary Import database.</span></span>|  
|<span data-ttu-id="118ea-175">SSO 資料庫</span><span class="sxs-lookup"><span data-stu-id="118ea-175">SSO database</span></span>|<span data-ttu-id="118ea-176">SSODB</span><span class="sxs-lookup"><span data-stu-id="118ea-176">SSODB</span></span>|<span data-ttu-id="118ea-177">安全地儲存組態資訊的接收位置。</span><span class="sxs-lookup"><span data-stu-id="118ea-177">Securely stores the configuration information for receive locations.</span></span> <span data-ttu-id="118ea-178">儲存資訊的 SSO 分支機構應用程式，以及所有分支機構應用程式已加密的使用者認證。</span><span class="sxs-lookup"><span data-stu-id="118ea-178">Stores information for SSO affiliate applications, as well as the encrypted user credentials to all the affiliate applications.</span></span>|  
|<span data-ttu-id="118ea-179">規則引擎資料庫</span><span class="sxs-lookup"><span data-stu-id="118ea-179">Rule Engine database</span></span>|<span data-ttu-id="118ea-180">BizTalkRuleEngineDb</span><span class="sxs-lookup"><span data-stu-id="118ea-180">BizTalkRuleEngineDb</span></span>|<span data-ttu-id="118ea-181">儲存機制：</span><span class="sxs-lookup"><span data-stu-id="118ea-181">Repository for:</span></span><br /><br /> <span data-ttu-id="118ea-182">-原則，也就是相關規則的集合。</span><span class="sxs-lookup"><span data-stu-id="118ea-182">-   Policies, which are sets of related rules.</span></span><br /><span data-ttu-id="118ea-183">-詞彙，規則中關於資料參考的使用者易記、 網域特定名稱的集合。</span><span class="sxs-lookup"><span data-stu-id="118ea-183">-   Vocabularies, which are collections of user-friendly, domain-specific names for data references in rules.</span></span>|  
|<span data-ttu-id="118ea-184">追蹤 Analysis Server 管理資料庫</span><span class="sxs-lookup"><span data-stu-id="118ea-184">Tracking Analysis Server Administration database</span></span>|<span data-ttu-id="118ea-185">BizTalkAnalysisDb</span><span class="sxs-lookup"><span data-stu-id="118ea-185">BizTalkAnalysisDb</span></span>|<span data-ttu-id="118ea-186">儲存商務和狀況監控 OLAP cube。</span><span class="sxs-lookup"><span data-stu-id="118ea-186">Stores both business and health monitoring OLAP cubes.</span></span>|  
  
## <a name="separation-of-data-files-and-log-files"></a><span data-ttu-id="118ea-187">分隔資料檔和記錄檔</span><span class="sxs-lookup"><span data-stu-id="118ea-187">Separation of data files and log files</span></span>  
 <span data-ttu-id="118ea-188">如先前所述，預設的 BizTalk Server 組態會將 MessageBox 資料庫置於單一檔案中的預設檔案群組。</span><span class="sxs-lookup"><span data-stu-id="118ea-188">As noted above, a default BizTalk Server configuration places the MessageBox Database into a single file in the default filegroup.</span></span> <span data-ttu-id="118ea-189">根據預設，MessageBox 資料庫的資料和交易記錄檔會放在相同的磁碟機和路徑。</span><span class="sxs-lookup"><span data-stu-id="118ea-189">By default, the data and transaction logs for the MessageBox database are placed on the same drive and path.</span></span> <span data-ttu-id="118ea-190">這是為了配合單一磁碟系統。</span><span class="sxs-lookup"><span data-stu-id="118ea-190">This is done to accommodate systems with a single disk.</span></span> <span data-ttu-id="118ea-191">單一檔案/檔案群組磁碟組態是**並非最佳**實際執行環境中。</span><span class="sxs-lookup"><span data-stu-id="118ea-191">A single file/filegroup/disk configuration is **not optimal** in a production environment.</span></span> <span data-ttu-id="118ea-192">為了達到最佳效能，資料檔案和記錄檔應放在不同磁碟上。</span><span class="sxs-lookup"><span data-stu-id="118ea-192">For optimal performance, the data files and log files should be placed on separate disks.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="118ea-193">記錄檔絕不能做為檔案群組的一部分。</span><span class="sxs-lookup"><span data-stu-id="118ea-193">Log files are never part of a filegroup.</span></span> <span data-ttu-id="118ea-194">記錄空間將與資料空間分別管理。</span><span class="sxs-lookup"><span data-stu-id="118ea-194">Log space is managed separately from data space.</span></span>  
  
## <a name="the-8020-rule-of-distributing-biztalk-server-databases"></a><span data-ttu-id="118ea-195">BizTalk Server 資料庫的散發的 80/20 規則</span><span class="sxs-lookup"><span data-stu-id="118ea-195">The 80/20 rule of distributing BizTalk Server databases</span></span>  
 <span data-ttu-id="118ea-196">在大部分的 BizTalk Server 解決方案，因為磁碟 I/O 競爭或資料庫競爭競爭的主要來源是 BizTalk Server MessageBox 資料庫。</span><span class="sxs-lookup"><span data-stu-id="118ea-196">The main source of contention in most BizTalk Server solutions, either because of disk I/O contention or database contention, is the BizTalk Server MessageBox database.</span></span> <span data-ttu-id="118ea-197">這是在單一和多重 MessageBox 的案例中，則為 true。</span><span class="sxs-lookup"><span data-stu-id="118ea-197">This is true in both single and multi-MessageBox scenarios.</span></span> <span data-ttu-id="118ea-198">它是值的合理假設在最多可達 80%的散發 BizTalk 資料庫會值的衍生自最佳化的 MessageBox 資料檔案和記錄檔。</span><span class="sxs-lookup"><span data-stu-id="118ea-198">It is reasonable to assume that as much as 80% of the value of distributing BizTalk databases will be derived from optimizing the MessageBox data files and log file.</span></span> <span data-ttu-id="118ea-199">下列所述的範例案例會著重於最佳化 MessageBox 資料庫的資料檔案。</span><span class="sxs-lookup"><span data-stu-id="118ea-199">The sample scenario detailed below is focused on optimizing the data files for a MessageBox database.</span></span> <span data-ttu-id="118ea-200">這些步驟然後可遵循的其他資料庫如有需要例如，如果方案需要大量的追蹤，則也可以最佳化追蹤資料庫。</span><span class="sxs-lookup"><span data-stu-id="118ea-200">These steps can then be followed for other databases as needed, for example, if the solution requires extensive tracking, then the Tracking database can also be optimized.</span></span>  
  
## <a name="manually-adding-files-to-the-messagebox-database-step-by-step"></a><span data-ttu-id="118ea-201">手動將檔案加入至 MessageBox 資料庫中，逐步</span><span class="sxs-lookup"><span data-stu-id="118ea-201">Manually adding files to the MessageBox database, step-by-step</span></span>  
 <span data-ttu-id="118ea-202">本節描述可供遵循以手動將檔案加入至 MessageBox 資料庫的步驟。</span><span class="sxs-lookup"><span data-stu-id="118ea-202">This section describes the steps that can be followed to manually add files to the MessageBox database.</span></span> <span data-ttu-id="118ea-203">在這個範例會加入三個檔案群組，然後將檔案加入至每個檔案群組，以便將檔案發佈的 MessageBox 中，跨多個磁碟。</span><span class="sxs-lookup"><span data-stu-id="118ea-203">In this example three filegroups are added and then a file is added to each filegroup to distribute the files for the MessageBox across multiple disks.</span></span>   
  
> [!NOTE]  
>  <span data-ttu-id="118ea-204">為了完成本指南中的效能測試，透過使用此指令碼會將發佈做為 BizTalk Server 效能最佳化指南的一部分最佳化檔案群組。</span><span class="sxs-lookup"><span data-stu-id="118ea-204">For purposes of the performance testing done for this guide, filegroups were optimized through the use of a script which will be published as part of the BizTalk Server Performance Optimizations Guide.</span></span> <span data-ttu-id="118ea-205">下列步驟提供僅供參考之用。</span><span class="sxs-lookup"><span data-stu-id="118ea-205">The steps below are provided for reference purposes only.</span></span>  
  
### <a name="manually-adding-files-to-the-messagebox-database-on-sql-server"></a><span data-ttu-id="118ea-206">手動將檔案加入至 SQL 伺服器上的 MessageBox 資料庫</span><span class="sxs-lookup"><span data-stu-id="118ea-206">Manually adding files to the MessageBox database on SQL Server</span></span>
  
1. <span data-ttu-id="118ea-207">開啟**SQL Server Management Studio**顯示**連接到伺服器** 對話方塊。</span><span class="sxs-lookup"><span data-stu-id="118ea-207">Open **SQL Server Management Studio** to display the **Connect to Server** dialog box.</span></span>  
  
     <span data-ttu-id="118ea-208">![SQL Server 管理登入畫面](../technical-guides/media/641a03f4-362c-4dde-8c9d-ac313d8881e3.gif "641a03f4-362c-4dde-8c9d-ac313d8881e3")</span><span class="sxs-lookup"><span data-stu-id="118ea-208">![SQL Server Administration login screen](../technical-guides/media/641a03f4-362c-4dde-8c9d-ac313d8881e3.gif "641a03f4-362c-4dde-8c9d-ac313d8881e3")</span></span>  
  
2.  <span data-ttu-id="118ea-209">在**伺服器名稱**欄位**連接到伺服器**對話方塊中，輸入裝載 BizTalk Server MessageBox 資料庫中，SQL Server 執行個體的名稱，然後按一下**連接**  按鈕以顯示**Microsoft SQL Server Management Studio**  對話方塊。</span><span class="sxs-lookup"><span data-stu-id="118ea-209">In the **Server name** field of the **Connect to Server** dialog box, enter the name of the SQL Server instance that houses the BizTalk Server MessageBox databases, and then click the **Connect** button to display the **Microsoft SQL Server Management Studio** dialog box.</span></span>  
  
     <span data-ttu-id="118ea-210">在**物件總管 中**窗格中的 SQL Server Management Studio，展開**資料庫**以檢視資料庫的 SQL Server 的這個執行個體。</span><span class="sxs-lookup"><span data-stu-id="118ea-210">In the **Object Explorer** pane of SQL Server Management Studio, expand **Databases** to view the databases for this instance of SQL Server.</span></span>  
  
     <span data-ttu-id="118ea-211">![SQL Server Management Studio，物件總管 中](../technical-guides/media/81f13912-fedc-48c3-9669-c18863e637b1.gif "81f13912-fedc-48c3-9669-c18863e637b1")</span><span class="sxs-lookup"><span data-stu-id="118ea-211">![SQL Server Management Studio, Object Explorer](../technical-guides/media/81f13912-fedc-48c3-9669-c18863e637b1.gif "81f13912-fedc-48c3-9669-c18863e637b1")</span></span>  
  
3.  <span data-ttu-id="118ea-212">以滑鼠右鍵按一下要新增檔案，然後再按資料庫**屬性**顯示**資料庫屬性**資料庫 對話方塊。</span><span class="sxs-lookup"><span data-stu-id="118ea-212">Right-click the database for which to add the files, and then click **Properties** to display the **Database Properties** dialog box for the database.</span></span>  
  
     <span data-ttu-id="118ea-213">![SQL Server 資料庫屬性 對話方塊](../technical-guides/media/82ae7c11-5b3a-4312-876c-70876abdd65c.gif "82ae7c11-5b3a-4312-876c-70876abdd65c")</span><span class="sxs-lookup"><span data-stu-id="118ea-213">![SQL Server Database Properties dialog box](../technical-guides/media/82ae7c11-5b3a-4312-876c-70876abdd65c.gif "82ae7c11-5b3a-4312-876c-70876abdd65c")</span></span>  
  
4.  <span data-ttu-id="118ea-214">在**資料庫屬性**對話方塊中，選取**檔案群組**頁面。</span><span class="sxs-lookup"><span data-stu-id="118ea-214">In the **Database Properties** dialog box, select the **Filegroups** page.</span></span> <span data-ttu-id="118ea-215">按一下**新增**按鈕以建立 BizTalkMsgBoxDb 資料庫的其他檔案群組。</span><span class="sxs-lookup"><span data-stu-id="118ea-215">Click the **Add** button to create additional filegroups for the BizTalkMsgBoxDb databases.</span></span> <span data-ttu-id="118ea-216">在下列範例中，會加入三個額外的檔案群組。</span><span class="sxs-lookup"><span data-stu-id="118ea-216">In the example below, three additional filegroups are added.</span></span>  
  
     <span data-ttu-id="118ea-217">![SQL Server，將檔案群組加入資料庫中](../technical-guides/media/6be47c0e-06c3-45d9-bce2-a42453da7d19.gif "6be47c0e-06c3-45d9-bce2-a42453da7d19")</span><span class="sxs-lookup"><span data-stu-id="118ea-217">![SQL Server, adding filegroups to a database](../technical-guides/media/6be47c0e-06c3-45d9-bce2-a42453da7d19.gif "6be47c0e-06c3-45d9-bce2-a42453da7d19")</span></span>  
  
5.  <span data-ttu-id="118ea-218">在 **[資料庫屬性]** 對話方塊中，選取 **[檔案]** 頁面。</span><span class="sxs-lookup"><span data-stu-id="118ea-218">In the **Database Properties** dialog box, select the **Files** page.</span></span>  
  
     <span data-ttu-id="118ea-219">按一下**新增**按鈕來建立其他檔案加入檔案群組，然後按一下 **確定**。</span><span class="sxs-lookup"><span data-stu-id="118ea-219">Click the **Add** button to create additional files to add to the filegroups, and then click **OK**.</span></span> <span data-ttu-id="118ea-220">MessageBox 資料庫現在都會分散到多個磁碟、 將提供顯著的效能優勢，透過單一磁碟組態中。</span><span class="sxs-lookup"><span data-stu-id="118ea-220">The MessageBox database is now distributed across multiple disks, which will provide a significant performance advantage over a single disk configuration.</span></span>  
  
     <span data-ttu-id="118ea-221">在下列範例中，針對每個稍早建立的檔案群組建立一個檔案，每個檔案放在不同磁碟上。</span><span class="sxs-lookup"><span data-stu-id="118ea-221">In the example below, a file is created for each of the filegroups that were created earlier and each file is placed on a separate disk.</span></span>  
  
     <span data-ttu-id="118ea-222">![SQL Server，檔案加入 filegroup](../technical-guides/media/d5d5c5df-d483-4f01-8128-f98228de51b9.gif "d5d5c5df-d483-4f01-8128-f98228de51b9")</span><span class="sxs-lookup"><span data-stu-id="118ea-222">![SQL Server, adding files to a filegroup](../technical-guides/media/d5d5c5df-d483-4f01-8128-f98228de51b9.gif "d5d5c5df-d483-4f01-8128-f98228de51b9")</span></span>  
  
## <a name="sample-sql-script-for-adding-filegroups-and-files-to-the-biztalk-messagebox-database"></a><span data-ttu-id="118ea-223">BizTalk MessageBox 資料庫中加入檔案群組和檔案的範例 SQL 指令碼</span><span class="sxs-lookup"><span data-stu-id="118ea-223">Sample SQL script for adding filegroups and files to the BizTalk MessageBox database</span></span>  
 <span data-ttu-id="118ea-224">下列範例 SQL 指令碼會執行相同的工作已在上一節以手動方式完成。</span><span class="sxs-lookup"><span data-stu-id="118ea-224">The sample SQL script below performs the same tasks that were completed manually in the previous section.</span></span>  
<span data-ttu-id="118ea-225">這個範例指令碼會假設不同的邏輯磁碟機 G 透過 J.存在指令碼會建立檔案群組和每個檔案群組的檔案，然後將 J 磁碟機上的記錄檔。</span><span class="sxs-lookup"><span data-stu-id="118ea-225">This sample script assumes the existence of distinct logical drives G through J. The script creates filegroups and files for each filegroup and places the log files on the J drive.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="118ea-226">SQL Server 循序寫入其記錄檔，因為沒有任何效能優勢，藉由建立多個 SQL Server 資料庫的記錄檔，才能實現。</span><span class="sxs-lookup"><span data-stu-id="118ea-226">Because SQL Server writes to its log files sequentially, there is no performance advantage realized by creating multiple log files for a SQL Server database.</span></span>  
  
```  
-- Filegroup changes are made using the master database  
USE [master]  
GO  
  
-- Script-wide declarations  
DECLARE @CommandBuffer nvarchar(2048)  
DECLARE @FG1_Path nvarchar(1024)  
DECLARE @FG2_Path nvarchar(1024)  
DECLARE @FG3_Path nvarchar(1024)  
DECLARE @Log_Path nvarchar(1024)  
  
-- Set the default path for all filegroups  
SET @FG1_Path = N'G:\BizTalkMsgBoxDATA\'  
SET @FG2_Path = N'H:\BizTalkMsgBoxDATA\'  
SET @FG3_Path = N'I:\BizTalkMsgBoxDATA\'  
SET @Log_Path = N'J:\BizTalkMsgBoxLog\'  
  
ALTER DATABASE [BizTalkMsgBoxDb] ADD FILEGROUP [BTS_MsgBox_FG1]  
SET @CommandBuffer = N'ALTER DATABASE [BizTalkMsgBoxDb] ADD FILE ( NAME = N''BizTalkMsgBoxDb_FG1'', FILENAME = N''' + @FG1_Path +   
N'BizTalkMsgBoxDb_FG1.ndf'' , SIZE = 102400KB , MAXSIZE = UNLIMITED, FILEGROWTH = 10240KB ) TO FILEGROUP [BTS_MsgBox_FG1]'  
EXECUTE (@CommandBuffer)  
  
ALTER DATABASE [BizTalkMsgBoxDb] ADD FILEGROUP [BTS_MsgBox_FG2]  
SET @CommandBuffer = N'ALTER DATABASE [BizTalkMsgBoxDb] ADD FILE ( NAME = N''BizTalkMsgBoxDb_FG1'', FILENAME = N''' + @FG2_Path +   
N'BizTalkMsgBoxDb_FG2.ndf'' , SIZE = 102400KB , MAXSIZE = UNLIMITED, FILEGROWTH = 10240KB ) TO FILEGROUP [BTS_MsgBox_FG2]'  
EXECUTE (@CommandBuffer)  
  
ALTER DATABASE [BizTalkMsgBoxDb] ADD FILEGROUP [BTS_MsgBox_FG3]  
SET @CommandBuffer = N'ALTER DATABASE [BizTalkMsgBoxDb] ADD FILE ( NAME = N''BizTalkMsgBoxDb_FG1'', FILENAME = N''' + @FG3_Path +   
N'BizTalkMsgBoxDb_FG3.ndf'' , SIZE = 102400KB , MAXSIZE = UNLIMITED, FILEGROWTH = 10240KB ) TO FILEGROUP [BTS_MsgBox_FG3]'  
EXECUTE (@CommandBuffer)  
  
ALTER DATABASE [BizTalkMsgBoxDb] MODIFY FILE ( NAME = N'BizTalkMsgBoxDb_log', SIZE = 10240KB , MAXSIZE = UNLIMITED, FILEGROWTH = 10240KB )  
  
GO -- Completes the previous batch, as necessary  
```  
  
 <span data-ttu-id="118ea-227">下列範例 SQL 指令碼可用於特定的檔案群組設定為預設檔案群組：</span><span class="sxs-lookup"><span data-stu-id="118ea-227">The sample SQL script below could be used to set a particular filegroup as the default filegroup:</span></span>  
  
```  
USE [BizTalkMsgBoxDb]  
GO  
declare @isdefault bit  
SELECT @isdefault=convert(bit, (status & 0x10)) FROM sysfilegroups WHERE groupname=N'BTS_MsgBox_FG1'  
if(@isdefault=0)  
ALTER DATABASE [BizTalkMsgBoxDb] MODIFY FILEGROUP [BTS_MsgBox_FG1] DEFAULT  
GO  
```  
  
 <span data-ttu-id="118ea-228">指令碼的優點是指令碼可以快速地執行多個工作，可以明確地說，重現和減少人為錯誤的可能性。</span><span class="sxs-lookup"><span data-stu-id="118ea-228">The advantage to scripting is that scripts can perform multiple tasks quickly, can be reproduced precisely, and reduce the possibility of human error.</span></span> <span data-ttu-id="118ea-229">指令碼的缺點是，撰寫不正確的指令碼的執行都可能會造成嚴重的問題，可能需要從頭重新設定 BizTalk Server 資料庫。</span><span class="sxs-lookup"><span data-stu-id="118ea-229">The disadvantage of scripting is that the execution of an incorrectly written script can potentially cause serious problems that could require the BizTalk Server databases to be re-configured from scratch.</span></span> <span data-ttu-id="118ea-230">因此，它是責 SQL 指令碼，例如本主題中列出的指令碼範例會徹底的測試，才能在生產環境中執行。</span><span class="sxs-lookup"><span data-stu-id="118ea-230">Therefore, it is of utmost importance that SQL scripts such as the sample script listed in this topic are thoroughly tested before being executed in a production environment.</span></span>