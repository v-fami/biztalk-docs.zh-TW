---
title: 最佳化資料庫檔案群組 |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: f7dbed4d-95d6-4a41-a69e-737a6f2f5a82
caps.latest.revision: 8
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: e48e475d3f8daf36cb6860393a4c4ff031a10e5a
ms.sourcegitcommit: 266308ec5c6a9d8d80ff298ee6051b4843c5d626
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 06/27/2018
ms.locfileid: "37003655"
---
# <a name="optimizing-filegroups-for-the-databases"></a><span data-ttu-id="4ab9a-102">最佳化檔案群組的資料庫</span><span class="sxs-lookup"><span data-stu-id="4ab9a-102">Optimizing Filegroups for the Databases</span></span>
<span data-ttu-id="4ab9a-103">檔案輸入/輸出 (I/O) 爭用通常是限制因素或在生產環境 BizTalk Server 環境中的瓶頸。</span><span class="sxs-lookup"><span data-stu-id="4ab9a-103">File input/output (I/O) contention is frequently a limiting factor, or bottleneck, in a production BizTalk Server environment.</span></span> <span data-ttu-id="4ab9a-104">BizTalk Server 是一個非常資料庫需要大量的應用程式和 BizTalk Server 所使用的 SQL Server 資料庫，是需要大量的非常檔案 I/O。</span><span class="sxs-lookup"><span data-stu-id="4ab9a-104">BizTalk Server is a very database intensive application and in turn, the SQL Server database used by BizTalk Server is very file I/O intensive.</span></span>  
  
 <span data-ttu-id="4ab9a-105">本主題描述如何更有效地使用的檔案和檔案群組的最小化的檔案 I/O 競爭的相符項目，並改善 BizTalk Server 解決方案的整體效能的 SQL Server 的功能。</span><span class="sxs-lookup"><span data-stu-id="4ab9a-105">This topic describes how to make optimal use of the files and filegroups feature of SQL Server to minimize the occurrence of file I/O contention and improve the overall performance of a BizTalk Server solution.</span></span>  
  
## <a name="overview"></a><span data-ttu-id="4ab9a-106">概觀</span><span class="sxs-lookup"><span data-stu-id="4ab9a-106">Overview</span></span>  
 <span data-ttu-id="4ab9a-107">每個 BizTalk Server 解決方案最後會發生檔案 I/O 競爭，因為會增加輸送量。</span><span class="sxs-lookup"><span data-stu-id="4ab9a-107">Every BizTalk Server solution will eventually encounter file I/O contention as throughput is increased.</span></span> <span data-ttu-id="4ab9a-108">I/O 子系統或儲存引擎，為任何關聯式資料庫的重要元件。</span><span class="sxs-lookup"><span data-stu-id="4ab9a-108">The I/O subsystem, or storage engine, is a key component of any relational database.</span></span> <span data-ttu-id="4ab9a-109">成功的資料庫實作通常需要在專案早期就進行周密的規劃。</span><span class="sxs-lookup"><span data-stu-id="4ab9a-109">A successful database implementation typically requires careful planning at the early stages of a project.</span></span> <span data-ttu-id="4ab9a-110">這項規劃應考量下列問題：</span><span class="sxs-lookup"><span data-stu-id="4ab9a-110">This planning should include consideration of the following issues:</span></span>  
  
- <span data-ttu-id="4ab9a-111">應使用哪種磁碟硬體，如 RAID (磁碟陣列) 裝置。</span><span class="sxs-lookup"><span data-stu-id="4ab9a-111">What type of disk hardware to use, such as RAID (redundant array of independent disks) devices.</span></span> 
  
- <span data-ttu-id="4ab9a-112">如何分配使用檔案和檔案群組在磁碟上的資料。</span><span class="sxs-lookup"><span data-stu-id="4ab9a-112">How to apportion data on the disks using files and filegroups.</span></span> <span data-ttu-id="4ab9a-113">如需使用 SQL Server 中的檔案與檔案群組的詳細資訊，請參閱[Database Files and Filegroups](https://docs.microsoft.com/sql/relational-databases/databases/database-files-and-filegroups)。</span><span class="sxs-lookup"><span data-stu-id="4ab9a-113">For more information about using files and filegroups in SQL Server, see [Database Files and Filegroups](https://docs.microsoft.com/sql/relational-databases/databases/database-files-and-filegroups).</span></span>
  
- <span data-ttu-id="4ab9a-114">實作存取資料時提升效能的最佳的索引設計。</span><span class="sxs-lookup"><span data-stu-id="4ab9a-114">Implementing the optimal index design for improving performance when accessing data.</span></span> <span data-ttu-id="4ab9a-115">如需更多關於設計索引的詳細資訊，請參閱[設計索引](https://docs.microsoft.com/sql/relational-databases/sql-server-index-design-guide)。</span><span class="sxs-lookup"><span data-stu-id="4ab9a-115">For more information about designing indexes, see [Designing Indexes](https://docs.microsoft.com/sql/relational-databases/sql-server-index-design-guide).</span></span>
  
- <span data-ttu-id="4ab9a-116">如何設定 SQL Server 組態參數，以獲得最佳效能。</span><span class="sxs-lookup"><span data-stu-id="4ab9a-116">How to set SQL Server configuration parameters for optimal performance.</span></span> <span data-ttu-id="4ab9a-117">適用於 SQL Server 設定最佳的組態參數的相關資訊，請參閱[伺服器組態選項](https://docs.microsoft.com/sql/database-engine/configure-windows/server-configuration-options-sql-server)。</span><span class="sxs-lookup"><span data-stu-id="4ab9a-117">For more information about setting optimal configuration parameters for SQL Server, see [Server Configuration Options](https://docs.microsoft.com/sql/database-engine/configure-windows/server-configuration-options-sql-server).</span></span> 
  
  <span data-ttu-id="4ab9a-118">其中一個 BizTalk Server 的主要設計目的是為了確保訊息**從未**遺失。</span><span class="sxs-lookup"><span data-stu-id="4ab9a-118">One of the primary design goals of BizTalk Server is to ensure that a message is **never** lost.</span></span> <span data-ttu-id="4ab9a-119">若要降低訊息遺失的可能性，訊息會經常寫入 MessageBox 資料庫在處理訊息。</span><span class="sxs-lookup"><span data-stu-id="4ab9a-119">In order to mitigate the possibility of message loss, messages are frequently written to the MessageBox database as the message is processed.</span></span> <span data-ttu-id="4ab9a-120">當協調流程處理訊息時，會將訊息寫入至 MessageBox 資料庫，在協調流程中每個持續點。</span><span class="sxs-lookup"><span data-stu-id="4ab9a-120">When messages are processed by an Orchestration, the message is written to the MessageBox database at every persistence point in the orchestration.</span></span> <span data-ttu-id="4ab9a-121">這些持續點會導致 MessageBox 的訊息和相關的狀態寫入實體磁碟。</span><span class="sxs-lookup"><span data-stu-id="4ab9a-121">These persistence points cause the MessageBox to write the message and related state to physical disk.</span></span> <span data-ttu-id="4ab9a-122">在更高的輸送量，此持續性可能會導致相當大的磁碟爭用情況，並可能成為瓶頸。</span><span class="sxs-lookup"><span data-stu-id="4ab9a-122">At higher throughputs, this persistence can result in considerable disk contention and can potentially become a bottleneck.</span></span>  
  
  <span data-ttu-id="4ab9a-123">進行最佳使用的檔案和 SQL Server 中的檔案群組功能可能會有效地處理檔案 IO 瓶頸，並改善在 BizTalk Server 解決方案的整體效能。</span><span class="sxs-lookup"><span data-stu-id="4ab9a-123">Making optimal use of the files and filegroups feature in SQL Server has been shown to effectively address File IO bottlenecks and improve overall performance in BizTalk Server solutions.</span></span> <span data-ttu-id="4ab9a-124">此最佳化只應該由有經驗的 SQL Server 資料庫系統管理員，並只在所有 BizTalk Server 資料庫已正確地備份使用。</span><span class="sxs-lookup"><span data-stu-id="4ab9a-124">This optimization should only be done by an experienced SQL Server database administrator and only after all BizTalk Server databases have been properly backed up.</span></span> <span data-ttu-id="4ab9a-125">應該在 BizTalk Server 環境中的所有 SQL Server 電腦上執行此最佳化。</span><span class="sxs-lookup"><span data-stu-id="4ab9a-125">This optimization should be performed on all SQL Server computers in the BizTalk Server environment.</span></span>  
  
  <span data-ttu-id="4ab9a-126">SQL Server 檔案和檔案群組可以用於改善資料庫效能，因為這項功能可讓資料庫可建立跨多個磁碟、 多個磁碟控制卡或 RAID （獨立磁碟備援陣列） 系統中執行。</span><span class="sxs-lookup"><span data-stu-id="4ab9a-126">SQL Server files and filegroups can be utilized to improve database performance because this functionality allows a database be created across multiple disks, multiple disk controllers, or RAID (redundant array of independent disks) systems.</span></span> <span data-ttu-id="4ab9a-127">例如，若電腦有 4 個磁碟，您可以建立由 3 個資料檔和 1 個記錄檔組成的資料庫，每一個檔案各在一個磁碟上。</span><span class="sxs-lookup"><span data-stu-id="4ab9a-127">For example, if your computer has four disks, you can create a database that is made up of three data files and one log file, with one file on each disk.</span></span> <span data-ttu-id="4ab9a-128">存取資料時，四個讀寫頭可以同時存取以平行方式的資料。</span><span class="sxs-lookup"><span data-stu-id="4ab9a-128">As data is accessed, four read/write heads can concurrently access the data in parallel.</span></span> <span data-ttu-id="4ab9a-129">大幅加快資料庫作業。</span><span class="sxs-lookup"><span data-stu-id="4ab9a-129">This speeds up database operations significantly.</span></span> <span data-ttu-id="4ab9a-130">實作 SQL Server 磁碟的硬體解決方案的詳細資訊，請參閱 < 資料庫效能 >，SQL Server 線上叢書中在[ http://go.microsoft.com/fwlink/?LinkID=71419 ](http://go.microsoft.com/fwlink/?LinkID=71419)。</span><span class="sxs-lookup"><span data-stu-id="4ab9a-130">For more information about implementing hardware solutions for SQL Server disks, see “Database Performance” in the SQL Server Books online at [http://go.microsoft.com/fwlink/?LinkID=71419](http://go.microsoft.com/fwlink/?LinkID=71419).</span></span>  
  
  <span data-ttu-id="4ab9a-131">此外，檔案和檔案群組啟用資料位置選項，可以在特定的檔案群組中建立資料表。</span><span class="sxs-lookup"><span data-stu-id="4ab9a-131">Additionally, files and filegroups enable data placement, because tables can be created in specific filegroups.</span></span> <span data-ttu-id="4ab9a-132">這可改善效能，因為指定的資料表的所有檔案 I/O 可都導向特定的磁碟。</span><span class="sxs-lookup"><span data-stu-id="4ab9a-132">This improves performance, because all file I/O for a given table can be directed at a specific disk.</span></span> <span data-ttu-id="4ab9a-133">比方說，使用量大的資料表可放置在檔案群組，在一個磁碟，並在資料庫中其他較少存取的資料表可以位於不同的檔案，放在第二個磁碟上的另一個檔案群組中。</span><span class="sxs-lookup"><span data-stu-id="4ab9a-133">For example, a heavily used table can be placed on a file in a filegroup, located on one disk, and the other less heavily accessed tables in the database can be located on different files in another filegroup, located on a second disk.</span></span>  
  
  <span data-ttu-id="4ab9a-134">檔案 IO 瓶頸會相當詳細討論[資料庫層中的瓶頸](../technical-guides/bottlenecks-in-the-database-tier.md)。</span><span class="sxs-lookup"><span data-stu-id="4ab9a-134">File IO bottlenecks are discussed in considerable detail in [Bottlenecks in the Database Tier](../technical-guides/bottlenecks-in-the-database-tier.md).</span></span> <span data-ttu-id="4ab9a-135">最常見檔案 I/O (磁碟 I/O) 是一個瓶頸的指標是 「 實體磁碟： Average Disk Queue Length"計數器的值。</span><span class="sxs-lookup"><span data-stu-id="4ab9a-135">The most common indicator that File I/O (Disk I/O) is a bottleneck is the value of the “Physical Disk:Average Disk Queue Length” counter.</span></span> <span data-ttu-id="4ab9a-136">當 「 實體磁碟： Average Disk Queue Length"計數器的值大於約 3 個任何指定的磁碟上的任何 SQL 伺服器時，然後檔案 I/O 可能是瓶頸。</span><span class="sxs-lookup"><span data-stu-id="4ab9a-136">When the value of the “Physical Disk:Average Disk Queue Length” counter is greater than about 3 for any given disk on any of the SQL Servers, then file I/O is likely a bottleneck.</span></span>  
  
  <span data-ttu-id="4ab9a-137">如果套用檔案群組的最佳化，無法解決檔案 I/O 瓶頸問題，則可能需要增加藉由新增額外的實體或 SAN 的磁碟機的磁碟子系統的輸送量。</span><span class="sxs-lookup"><span data-stu-id="4ab9a-137">If applying file or filegroup optimization doesn't resolve a file I/O bottleneck problem, then it may be necessary to increase the throughput of the disk subsystem by adding additional physical or SAN drives.</span></span>  
  
  <span data-ttu-id="4ab9a-138">本主題說明如何以手動方式套用檔案和檔案群組的最佳化，但這些最佳化可以也要編寫指令碼。</span><span class="sxs-lookup"><span data-stu-id="4ab9a-138">This topic describes how to manually apply file and filegroup optimizations but these optimizations can also be scripted.</span></span> <span data-ttu-id="4ab9a-139">本主題的結尾會提供範例 SQL 指令碼。</span><span class="sxs-lookup"><span data-stu-id="4ab9a-139">A sample SQL script is provided at the end of this topic.</span></span> <span data-ttu-id="4ab9a-140">請務必請注意，此指令碼會需要修改，以容納檔案、 檔案群組和任何指定的 BizTalk Server 解決方案使用的 SQL Server 資料庫的磁碟組態。</span><span class="sxs-lookup"><span data-stu-id="4ab9a-140">It is important to note that this script would need to be modified to accommodate the file, filegroup, and disk configuration used by the SQL Server database(s) for any given BizTalk Server solution.</span></span>  
  
 
## <a name="databases-created-with-a-default-biztalk-server-configuration"></a><span data-ttu-id="4ab9a-141">使用預設的 BizTalk Server 組態建立的資料庫</span><span class="sxs-lookup"><span data-stu-id="4ab9a-141">Databases created with a default BizTalk Server configuration</span></span>  
 <span data-ttu-id="4ab9a-142">依據設定 BizTalk Server 中，最多 13 個不同資料庫可能在 SQL Server 中建立，且所有這些資料庫會建立在預設檔案群組時，會啟用功能。</span><span class="sxs-lookup"><span data-stu-id="4ab9a-142">Depending on which features are enabled when configuring BizTalk Server, up to 13 different databases may be created in SQL Server and all of these databases are created in the default file group.</span></span> <span data-ttu-id="4ab9a-143">SQL Server 的預設檔案群組是主要檔案群組，除非使用 ALTER DATABASE 命令變更預設檔案群組。</span><span class="sxs-lookup"><span data-stu-id="4ab9a-143">The default filegroup for SQL Server is the PRIMARY filegroup unless the default filegroup is changed by using the ALTER DATABASE command.</span></span> <span data-ttu-id="4ab9a-144">下表列出如果設定 BizTalk Server 時，會啟用所有功能，SQL Server 中建立的資料庫。</span><span class="sxs-lookup"><span data-stu-id="4ab9a-144">The table below lists the databases that are created in SQL Server if all features are enabled when configuring BizTalk Server.</span></span>  
  
### <a name="biztalk-server-databases"></a><span data-ttu-id="4ab9a-145">BizTalk Server 資料庫</span><span class="sxs-lookup"><span data-stu-id="4ab9a-145">BizTalk Server Databases</span></span>  
  
||||  
|-|-|-|  
|<span data-ttu-id="4ab9a-146">**[資料庫備份]**</span><span class="sxs-lookup"><span data-stu-id="4ab9a-146">**Database**</span></span>|<span data-ttu-id="4ab9a-147">**預設的資料庫名稱**</span><span class="sxs-lookup"><span data-stu-id="4ab9a-147">**Default Database Name**</span></span>|<span data-ttu-id="4ab9a-148">**說明**</span><span class="sxs-lookup"><span data-stu-id="4ab9a-148">**Description**</span></span>|  
|<span data-ttu-id="4ab9a-149">設定資料庫</span><span class="sxs-lookup"><span data-stu-id="4ab9a-149">Configuration database</span></span>|<span data-ttu-id="4ab9a-150">BizTalkMgmtDb</span><span class="sxs-lookup"><span data-stu-id="4ab9a-150">BizTalkMgmtDb</span></span>|<span data-ttu-id="4ab9a-151">中央中繼資訊存放區的所有 BizTalk Server 群組中的 BizTalk Server 執行個體。</span><span class="sxs-lookup"><span data-stu-id="4ab9a-151">The central meta-information store for all instances of BizTalk Server in the BizTalk Server group.</span></span>|  
|<span data-ttu-id="4ab9a-152">BizTalk MessageBox 資料庫</span><span class="sxs-lookup"><span data-stu-id="4ab9a-152">BizTalk MessageBox database</span></span>|<span data-ttu-id="4ab9a-153">BizTalkMsgBoxDb</span><span class="sxs-lookup"><span data-stu-id="4ab9a-153">BizTalkMsgBoxDb</span></span>|<span data-ttu-id="4ab9a-154">儲存訂閱述詞。</span><span class="sxs-lookup"><span data-stu-id="4ab9a-154">Stores subscriptions predicates.</span></span> <span data-ttu-id="4ab9a-155">它是主應用程式平台，並保留每個 BizTalk Server 主控件佇列和狀態資料表。</span><span class="sxs-lookup"><span data-stu-id="4ab9a-155">It is a host platform, and keeps queues and state tables for each BizTalk Server host.</span></span> <span data-ttu-id="4ab9a-156">MessageBox 資料庫也儲存訊息及訊息屬性。</span><span class="sxs-lookup"><span data-stu-id="4ab9a-156">The MessageBox database also stores the messages and message properties.</span></span>|  
|<span data-ttu-id="4ab9a-157">BizTalk 追蹤資料庫</span><span class="sxs-lookup"><span data-stu-id="4ab9a-157">BizTalk Tracking database</span></span>|<span data-ttu-id="4ab9a-158">BizTalkDTADb</span><span class="sxs-lookup"><span data-stu-id="4ab9a-158">BizTalkDTADb</span></span>|<span data-ttu-id="4ab9a-159">儲存商務和狀況監控 BizTalk Server 追蹤引擎所追蹤的資料。</span><span class="sxs-lookup"><span data-stu-id="4ab9a-159">Stores business and health monitoring data tracked by the BizTalk Server tracking engine.</span></span>|  
|<span data-ttu-id="4ab9a-160">BAM 分析資料庫</span><span class="sxs-lookup"><span data-stu-id="4ab9a-160">BAM Analysis database</span></span>|<span data-ttu-id="4ab9a-161">BAMAnalysis</span><span class="sxs-lookup"><span data-stu-id="4ab9a-161">BAMAnalysis</span></span>|<span data-ttu-id="4ab9a-162">保留商務活動彙總的歷程記錄資料的 SQL Server Analysis Services 資料庫。</span><span class="sxs-lookup"><span data-stu-id="4ab9a-162">SQL Server Analysis Services database that keeps the aggregated historical data for Business Activities.</span></span>|  
|<span data-ttu-id="4ab9a-163">BAM 星狀結構描述資料庫</span><span class="sxs-lookup"><span data-stu-id="4ab9a-163">BAM Star Schema database</span></span>|<span data-ttu-id="4ab9a-164">BAMStarSchema</span><span class="sxs-lookup"><span data-stu-id="4ab9a-164">BAMStarSchema</span></span>|<span data-ttu-id="4ab9a-165">轉換用於 OLAP 處理從商務活動監控收集的資料。</span><span class="sxs-lookup"><span data-stu-id="4ab9a-165">Transforms the data collected from Business Activity Monitoring for OLAP Processing.</span></span> <span data-ttu-id="4ab9a-166">使用 BAM 分析資料庫時，需要此資料庫。</span><span class="sxs-lookup"><span data-stu-id="4ab9a-166">This database is required when using the BAM Analysis database.</span></span>|  
|<span data-ttu-id="4ab9a-167">BAM 主要匯入資料庫</span><span class="sxs-lookup"><span data-stu-id="4ab9a-167">BAM Primary Import database</span></span>|<span data-ttu-id="4ab9a-168">BAMPrimaryImport</span><span class="sxs-lookup"><span data-stu-id="4ab9a-168">BAMPrimaryImport</span></span>|<span data-ttu-id="4ab9a-169">在活動執行個體之後，會儲存商務活動，然後查詢的進度與資料的事件。</span><span class="sxs-lookup"><span data-stu-id="4ab9a-169">Stores the events from Business Activities and then queries for the progress and data after activity instances.</span></span> <span data-ttu-id="4ab9a-170">此資料庫也會執行即時彙總。</span><span class="sxs-lookup"><span data-stu-id="4ab9a-170">This database also performs real-time aggregations.</span></span>|  
|<span data-ttu-id="4ab9a-171">BAM 封存資料庫</span><span class="sxs-lookup"><span data-stu-id="4ab9a-171">BAM Archive database</span></span>|<span data-ttu-id="4ab9a-172">BAMArchive</span><span class="sxs-lookup"><span data-stu-id="4ab9a-172">BAMArchive</span></span>|<span data-ttu-id="4ab9a-173">儲存訂閱述詞。</span><span class="sxs-lookup"><span data-stu-id="4ab9a-173">Stores subscription predicates.</span></span> <span data-ttu-id="4ab9a-174">BAM 封存資料庫會將 BAM 主要匯入資料庫中的商務活動資料累積降到最低。</span><span class="sxs-lookup"><span data-stu-id="4ab9a-174">The BAM Archive database minimizes the accumulation of Business Activity data in the BAM Primary Import database.</span></span>|  
|<span data-ttu-id="4ab9a-175">SSO 資料庫</span><span class="sxs-lookup"><span data-stu-id="4ab9a-175">SSO database</span></span>|<span data-ttu-id="4ab9a-176">SSODB</span><span class="sxs-lookup"><span data-stu-id="4ab9a-176">SSODB</span></span>|<span data-ttu-id="4ab9a-177">安全地儲存組態資訊的接收位置。</span><span class="sxs-lookup"><span data-stu-id="4ab9a-177">Securely stores the configuration information for receive locations.</span></span> <span data-ttu-id="4ab9a-178">將資訊儲存為 SSO 分支機構應用程式，以及所有分支機構應用程式的加密的使用者認證。</span><span class="sxs-lookup"><span data-stu-id="4ab9a-178">Stores information for SSO affiliate applications, as well as the encrypted user credentials to all the affiliate applications.</span></span>|  
|<span data-ttu-id="4ab9a-179">規則引擎資料庫</span><span class="sxs-lookup"><span data-stu-id="4ab9a-179">Rule Engine database</span></span>|<span data-ttu-id="4ab9a-180">BizTalkRuleEngineDb</span><span class="sxs-lookup"><span data-stu-id="4ab9a-180">BizTalkRuleEngineDb</span></span>|<span data-ttu-id="4ab9a-181">存放庫：</span><span class="sxs-lookup"><span data-stu-id="4ab9a-181">Repository for:</span></span><br /><br /> <span data-ttu-id="4ab9a-182">-原則，也就是相關規則的集合。</span><span class="sxs-lookup"><span data-stu-id="4ab9a-182">-   Policies, which are sets of related rules.</span></span><br /><span data-ttu-id="4ab9a-183">-詞彙，規則中關於資料參考的使用者易記、 網域特定名稱的集合。</span><span class="sxs-lookup"><span data-stu-id="4ab9a-183">-   Vocabularies, which are collections of user-friendly, domain-specific names for data references in rules.</span></span>|  
|<span data-ttu-id="4ab9a-184">追蹤 Analysis Server 管理資料庫</span><span class="sxs-lookup"><span data-stu-id="4ab9a-184">Tracking Analysis Server Administration database</span></span>|<span data-ttu-id="4ab9a-185">BizTalkAnalysisDb</span><span class="sxs-lookup"><span data-stu-id="4ab9a-185">BizTalkAnalysisDb</span></span>|<span data-ttu-id="4ab9a-186">儲存商務和狀況監控 OLAP cube。</span><span class="sxs-lookup"><span data-stu-id="4ab9a-186">Stores both business and health monitoring OLAP cubes.</span></span>|  
  
## <a name="separation-of-data-files-and-log-files"></a><span data-ttu-id="4ab9a-187">分隔資料檔和記錄檔</span><span class="sxs-lookup"><span data-stu-id="4ab9a-187">Separation of data files and log files</span></span>  
 <span data-ttu-id="4ab9a-188">如先前所述，BizTalk Server 組態預設值會置於同一個檔案的預設檔案群組中的 MessageBox 資料庫。</span><span class="sxs-lookup"><span data-stu-id="4ab9a-188">As noted above, a default BizTalk Server configuration places the MessageBox Database into a single file in the default filegroup.</span></span> <span data-ttu-id="4ab9a-189">根據預設，MessageBox 資料庫的資料和交易記錄檔會放在相同的磁碟機和路徑。</span><span class="sxs-lookup"><span data-stu-id="4ab9a-189">By default, the data and transaction logs for the MessageBox database are placed on the same drive and path.</span></span> <span data-ttu-id="4ab9a-190">這是為了配合使用單一磁碟系統。</span><span class="sxs-lookup"><span data-stu-id="4ab9a-190">This is done to accommodate systems with a single disk.</span></span> <span data-ttu-id="4ab9a-191">單一檔案/檔案群組/磁碟組態**並非最佳**在生產環境中。</span><span class="sxs-lookup"><span data-stu-id="4ab9a-191">A single file/filegroup/disk configuration is **not optimal** in a production environment.</span></span> <span data-ttu-id="4ab9a-192">為了達到最佳效能，資料檔案和記錄檔應置於不同的磁碟。</span><span class="sxs-lookup"><span data-stu-id="4ab9a-192">For optimal performance, the data files and log files should be placed on separate disks.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="4ab9a-193">記錄檔絕不能做為檔案群組的一部分。</span><span class="sxs-lookup"><span data-stu-id="4ab9a-193">Log files are never part of a filegroup.</span></span> <span data-ttu-id="4ab9a-194">記錄空間將與資料空間分別管理。</span><span class="sxs-lookup"><span data-stu-id="4ab9a-194">Log space is managed separately from data space.</span></span>  
  
## <a name="the-8020-rule-of-distributing-biztalk-server-databases"></a><span data-ttu-id="4ab9a-195">BizTalk Server 資料庫的散發的 80/20 規則</span><span class="sxs-lookup"><span data-stu-id="4ab9a-195">The 80/20 rule of distributing BizTalk Server databases</span></span>  
 <span data-ttu-id="4ab9a-196">在大部分的 BizTalk Server 解決方案，因為磁碟 I/O 競爭或資料庫爭用，競爭的主要來源是 BizTalk Server MessageBox 資料庫。</span><span class="sxs-lookup"><span data-stu-id="4ab9a-196">The main source of contention in most BizTalk Server solutions, either because of disk I/O contention or database contention, is the BizTalk Server MessageBox database.</span></span> <span data-ttu-id="4ab9a-197">這是在單一和多個 MessageBox 的情況下，則為 true。</span><span class="sxs-lookup"><span data-stu-id="4ab9a-197">This is true in both single and multi-MessageBox scenarios.</span></span> <span data-ttu-id="4ab9a-198">它是值的合理假設最高達 80%的發佈 BizTalk 資料庫，將會衍生自最佳化的 MessageBox 資料檔案和記錄檔。</span><span class="sxs-lookup"><span data-stu-id="4ab9a-198">It is reasonable to assume that as much as 80% of the value of distributing BizTalk databases will be derived from optimizing the MessageBox data files and log file.</span></span> <span data-ttu-id="4ab9a-199">在下面詳細的範例案例著重於最佳化 MessageBox 資料庫之資料檔案。</span><span class="sxs-lookup"><span data-stu-id="4ab9a-199">The sample scenario detailed below is focused on optimizing the data files for a MessageBox database.</span></span> <span data-ttu-id="4ab9a-200">這些步驟可以再遵循其他資料庫如有需要比方說，如果解決方案需要大量追蹤，則也可以最佳化追蹤資料庫。</span><span class="sxs-lookup"><span data-stu-id="4ab9a-200">These steps can then be followed for other databases as needed, for example, if the solution requires extensive tracking, then the Tracking database can also be optimized.</span></span>  
  
## <a name="manually-adding-files-to-the-messagebox-database-step-by-step"></a><span data-ttu-id="4ab9a-201">手動將檔案加入至 MessageBox 資料庫中，逐步</span><span class="sxs-lookup"><span data-stu-id="4ab9a-201">Manually adding files to the MessageBox database, step-by-step</span></span>  
 <span data-ttu-id="4ab9a-202">本節描述可供遵循以手動方式將檔案新增至 MessageBox 資料庫的步驟。</span><span class="sxs-lookup"><span data-stu-id="4ab9a-202">This section describes the steps that can be followed to manually add files to the MessageBox database.</span></span> <span data-ttu-id="4ab9a-203">在此範例會新增三個檔案群組，然後檔案新增至每個檔案群組將檔案發佈的 MessageBox，跨多個磁碟。</span><span class="sxs-lookup"><span data-stu-id="4ab9a-203">In this example three filegroups are added and then a file is added to each filegroup to distribute the files for the MessageBox across multiple disks.</span></span>   
  
> [!NOTE]  
>  <span data-ttu-id="4ab9a-204">基於本指南中所進行的效能測試，已透過將 BizTalk Server 效能最佳化指南的一部分發行的指令碼使用進行最佳化檔案群組。</span><span class="sxs-lookup"><span data-stu-id="4ab9a-204">For purposes of the performance testing done for this guide, filegroups were optimized through the use of a script which will be published as part of the BizTalk Server Performance Optimizations Guide.</span></span> <span data-ttu-id="4ab9a-205">下列步驟會提供僅供參考。</span><span class="sxs-lookup"><span data-stu-id="4ab9a-205">The steps below are provided for reference purposes only.</span></span>  
  
### <a name="manually-adding-files-to-the-messagebox-database-on-sql-server"></a><span data-ttu-id="4ab9a-206">手動將檔案加入至 SQL Server 上的 MessageBox 資料庫</span><span class="sxs-lookup"><span data-stu-id="4ab9a-206">Manually adding files to the MessageBox database on SQL Server</span></span>
  
1. <span data-ttu-id="4ab9a-207">開啟**SQL Server Management Studio**顯示**連接到伺服器** 對話方塊。</span><span class="sxs-lookup"><span data-stu-id="4ab9a-207">Open **SQL Server Management Studio** to display the **Connect to Server** dialog box.</span></span>  
  
     <span data-ttu-id="4ab9a-208">![SQL Server 管理登入畫面](../technical-guides/media/641a03f4-362c-4dde-8c9d-ac313d8881e3.gif "641a03f4-362c-4dde-8c9d-ac313d8881e3")</span><span class="sxs-lookup"><span data-stu-id="4ab9a-208">![SQL Server Administration login screen](../technical-guides/media/641a03f4-362c-4dde-8c9d-ac313d8881e3.gif "641a03f4-362c-4dde-8c9d-ac313d8881e3")</span></span>  
  
2.  <span data-ttu-id="4ab9a-209">在 **伺服器名稱**欄位**連接到伺服器** 對話方塊中，輸入裝載 BizTalk Server MessageBox 資料庫中，SQL Server 執行個體的名稱，然後按一下**Connect**  按鈕以顯示**Microsoft SQL Server Management Studio**  對話方塊。</span><span class="sxs-lookup"><span data-stu-id="4ab9a-209">In the **Server name** field of the **Connect to Server** dialog box, enter the name of the SQL Server instance that houses the BizTalk Server MessageBox databases, and then click the **Connect** button to display the **Microsoft SQL Server Management Studio** dialog box.</span></span>  
  
     <span data-ttu-id="4ab9a-210">在**物件總管**窗格中的 SQL Server Management Studio 中，展開**資料庫**，來檢視此 SQL Server 執行個體的資料庫。</span><span class="sxs-lookup"><span data-stu-id="4ab9a-210">In the **Object Explorer** pane of SQL Server Management Studio, expand **Databases** to view the databases for this instance of SQL Server.</span></span>  
  
     <span data-ttu-id="4ab9a-211">![SQL Server Management Studio，物件總管](../technical-guides/media/81f13912-fedc-48c3-9669-c18863e637b1.gif "81f13912-fedc-48c3-9669-c18863e637b1")</span><span class="sxs-lookup"><span data-stu-id="4ab9a-211">![SQL Server Management Studio, Object Explorer](../technical-guides/media/81f13912-fedc-48c3-9669-c18863e637b1.gif "81f13912-fedc-48c3-9669-c18863e637b1")</span></span>  
  
3.  <span data-ttu-id="4ab9a-212">以滑鼠右鍵按一下要新增的檔案，然後按一下資料庫**屬性**顯示**資料庫屬性**資料庫 對話方塊。</span><span class="sxs-lookup"><span data-stu-id="4ab9a-212">Right-click the database for which to add the files, and then click **Properties** to display the **Database Properties** dialog box for the database.</span></span>  
  
     <span data-ttu-id="4ab9a-213">![SQL Server 資料庫屬性 對話方塊](../technical-guides/media/82ae7c11-5b3a-4312-876c-70876abdd65c.gif "82ae7c11-5b3a-4312-876c-70876abdd65c")</span><span class="sxs-lookup"><span data-stu-id="4ab9a-213">![SQL Server Database Properties dialog box](../technical-guides/media/82ae7c11-5b3a-4312-876c-70876abdd65c.gif "82ae7c11-5b3a-4312-876c-70876abdd65c")</span></span>  
  
4.  <span data-ttu-id="4ab9a-214">在 **資料庫屬性**對話方塊中，選取**檔案群組**頁面。</span><span class="sxs-lookup"><span data-stu-id="4ab9a-214">In the **Database Properties** dialog box, select the **Filegroups** page.</span></span> <span data-ttu-id="4ab9a-215">按一下 **新增**按鈕，以建立 BizTalkMsgBoxDb 資料庫的其他檔案群組。</span><span class="sxs-lookup"><span data-stu-id="4ab9a-215">Click the **Add** button to create additional filegroups for the BizTalkMsgBoxDb databases.</span></span> <span data-ttu-id="4ab9a-216">在下列範例中，會加入三個額外的檔案群組。</span><span class="sxs-lookup"><span data-stu-id="4ab9a-216">In the example below, three additional filegroups are added.</span></span>  
  
     <span data-ttu-id="4ab9a-217">![SQL Server，將檔案群組加入資料庫中](../technical-guides/media/6be47c0e-06c3-45d9-bce2-a42453da7d19.gif "6be47c0e-06c3-45d9-bce2-a42453da7d19")</span><span class="sxs-lookup"><span data-stu-id="4ab9a-217">![SQL Server, adding filegroups to a database](../technical-guides/media/6be47c0e-06c3-45d9-bce2-a42453da7d19.gif "6be47c0e-06c3-45d9-bce2-a42453da7d19")</span></span>  
  
5.  <span data-ttu-id="4ab9a-218">在 **[資料庫屬性]** 對話方塊中，選取 **[檔案]** 頁面。</span><span class="sxs-lookup"><span data-stu-id="4ab9a-218">In the **Database Properties** dialog box, select the **Files** page.</span></span>  
  
     <span data-ttu-id="4ab9a-219">按一下 **新增**按鈕來建立其他檔案加入檔案群組，然後按一下**確定**。</span><span class="sxs-lookup"><span data-stu-id="4ab9a-219">Click the **Add** button to create additional files to add to the filegroups, and then click **OK**.</span></span> <span data-ttu-id="4ab9a-220">MessageBox 資料庫現在會分散到多個磁碟，這將會提供顯著的優勢，透過單一磁碟組態中。</span><span class="sxs-lookup"><span data-stu-id="4ab9a-220">The MessageBox database is now distributed across multiple disks, which will provide a significant performance advantage over a single disk configuration.</span></span>  
  
     <span data-ttu-id="4ab9a-221">在下列範例中，稍早建立的檔案群組的每個建立檔案時，每個檔案會放在不同的磁碟。</span><span class="sxs-lookup"><span data-stu-id="4ab9a-221">In the example below, a file is created for each of the filegroups that were created earlier and each file is placed on a separate disk.</span></span>  
  
     <span data-ttu-id="4ab9a-222">![SQL Server，將檔案加入檔案群組](../technical-guides/media/d5d5c5df-d483-4f01-8128-f98228de51b9.gif "d5d5c5df-d483-4f01-8128-f98228de51b9")</span><span class="sxs-lookup"><span data-stu-id="4ab9a-222">![SQL Server, adding files to a filegroup](../technical-guides/media/d5d5c5df-d483-4f01-8128-f98228de51b9.gif "d5d5c5df-d483-4f01-8128-f98228de51b9")</span></span>  
  
## <a name="sample-sql-script-for-adding-filegroups-and-files-to-the-biztalk-messagebox-database"></a><span data-ttu-id="4ab9a-223">加入 BizTalk MessageBox 資料庫中的檔案群組和檔案的範例 SQL 指令碼</span><span class="sxs-lookup"><span data-stu-id="4ab9a-223">Sample SQL script for adding filegroups and files to the BizTalk MessageBox database</span></span>  
 <span data-ttu-id="4ab9a-224">下列範例 SQL 指令碼執行以手動方式完成上一節中的相同工作。</span><span class="sxs-lookup"><span data-stu-id="4ab9a-224">The sample SQL script below performs the same tasks that were completed manually in the previous section.</span></span>  
<span data-ttu-id="4ab9a-225">此範例指令碼會假設不同的邏輯磁碟機 G 透過 J.存在指令碼會建立檔案群組和每個檔案群組的檔案，並將放在 J 磁碟機上的記錄檔。</span><span class="sxs-lookup"><span data-stu-id="4ab9a-225">This sample script assumes the existence of distinct logical drives G through J. The script creates filegroups and files for each filegroup and places the log files on the J drive.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="4ab9a-226">SQL Server 循序寫入其記錄檔，因為沒有任何效能優勢，實現藉由建立多個 SQL Server 資料庫的記錄檔。</span><span class="sxs-lookup"><span data-stu-id="4ab9a-226">Because SQL Server writes to its log files sequentially, there is no performance advantage realized by creating multiple log files for a SQL Server database.</span></span>  
  
```  
-- Filegroup changes are made using the master database  
USE [master]  
GO  
  
-- Script-wide declarations  
DECLARE @CommandBuffer nvarchar(2048)  
DECLARE @FG1_Path nvarchar(1024)  
DECLARE @FG2_Path nvarchar(1024)  
DECLARE @FG3_Path nvarchar(1024)  
DECLARE @Log_Path nvarchar(1024)  
  
-- Set the default path for all filegroups  
SET @FG1_Path = N'G:\BizTalkMsgBoxDATA\'  
SET @FG2_Path = N'H:\BizTalkMsgBoxDATA\'  
SET @FG3_Path = N'I:\BizTalkMsgBoxDATA\'  
SET @Log_Path = N'J:\BizTalkMsgBoxLog\'  
  
ALTER DATABASE [BizTalkMsgBoxDb] ADD FILEGROUP [BTS_MsgBox_FG1]  
SET @CommandBuffer = N'ALTER DATABASE [BizTalkMsgBoxDb] ADD FILE ( NAME = N''BizTalkMsgBoxDb_FG1'', FILENAME = N''' + @FG1_Path +   
N'BizTalkMsgBoxDb_FG1.ndf'' , SIZE = 102400KB , MAXSIZE = UNLIMITED, FILEGROWTH = 10240KB ) TO FILEGROUP [BTS_MsgBox_FG1]'  
EXECUTE (@CommandBuffer)  
  
ALTER DATABASE [BizTalkMsgBoxDb] ADD FILEGROUP [BTS_MsgBox_FG2]  
SET @CommandBuffer = N'ALTER DATABASE [BizTalkMsgBoxDb] ADD FILE ( NAME = N''BizTalkMsgBoxDb_FG1'', FILENAME = N''' + @FG2_Path +   
N'BizTalkMsgBoxDb_FG2.ndf'' , SIZE = 102400KB , MAXSIZE = UNLIMITED, FILEGROWTH = 10240KB ) TO FILEGROUP [BTS_MsgBox_FG2]'  
EXECUTE (@CommandBuffer)  
  
ALTER DATABASE [BizTalkMsgBoxDb] ADD FILEGROUP [BTS_MsgBox_FG3]  
SET @CommandBuffer = N'ALTER DATABASE [BizTalkMsgBoxDb] ADD FILE ( NAME = N''BizTalkMsgBoxDb_FG1'', FILENAME = N''' + @FG3_Path +   
N'BizTalkMsgBoxDb_FG3.ndf'' , SIZE = 102400KB , MAXSIZE = UNLIMITED, FILEGROWTH = 10240KB ) TO FILEGROUP [BTS_MsgBox_FG3]'  
EXECUTE (@CommandBuffer)  
  
ALTER DATABASE [BizTalkMsgBoxDb] MODIFY FILE ( NAME = N'BizTalkMsgBoxDb_log', SIZE = 10240KB , MAXSIZE = UNLIMITED, FILEGROWTH = 10240KB )  
  
GO -- Completes the previous batch, as necessary  
```  
  
 <span data-ttu-id="4ab9a-227">下列範例 SQL 指令碼可用來將特定的檔案群組設定為預設檔案群組：</span><span class="sxs-lookup"><span data-stu-id="4ab9a-227">The sample SQL script below could be used to set a particular filegroup as the default filegroup:</span></span>  
  
```  
USE [BizTalkMsgBoxDb]  
GO  
declare @isdefault bit  
SELECT @isdefault=convert(bit, (status & 0x10)) FROM sysfilegroups WHERE groupname=N'BTS_MsgBox_FG1'  
if(@isdefault=0)  
ALTER DATABASE [BizTalkMsgBoxDb] MODIFY FILEGROUP [BTS_MsgBox_FG1] DEFAULT  
GO  
```  
  
 <span data-ttu-id="4ab9a-228">指令碼的優點是，指令碼可以快速地執行多個工作、 精確地說，即可重現和降低人為錯誤的可能性。</span><span class="sxs-lookup"><span data-stu-id="4ab9a-228">The advantage to scripting is that scripts can perform multiple tasks quickly, can be reproduced precisely, and reduce the possibility of human error.</span></span> <span data-ttu-id="4ab9a-229">指令碼的缺點是撰寫不正確的指令碼執行可能造成嚴重的問題，可能需要從頭重新設定 BizTalk Server 資料庫。</span><span class="sxs-lookup"><span data-stu-id="4ab9a-229">The disadvantage of scripting is that the execution of an incorrectly written script can potentially cause serious problems that could require the BizTalk Server databases to be re-configured from scratch.</span></span> <span data-ttu-id="4ab9a-230">因此，它的 SQL 指令碼，如本主題中列出的指令碼範例會徹底的首要之前，先測試在生產環境中執行。</span><span class="sxs-lookup"><span data-stu-id="4ab9a-230">Therefore, it is of utmost importance that SQL scripts such as the sample script listed in this topic are thoroughly tested before being executed in a production environment.</span></span>