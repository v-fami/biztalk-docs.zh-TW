---
title: "調整 BizTalk Server 資料庫的跨 |Microsoft 文件"
ms.custom: 
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 18853ceb-7975-4c30-878f-6b162005f795
caps.latest.revision: "2"
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: e3116b7aae087e74ade089c8020a7d35c883cd2e
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 09/20/2017
---
# <a name="scaling-out-the-biztalk-server-databases"></a><span data-ttu-id="a4c39-102">向外延展 BizTalk Server 資料庫</span><span class="sxs-lookup"><span data-stu-id="a4c39-102">Scaling Out the BizTalk Server Databases</span></span>
<span data-ttu-id="a4c39-103">若要提供高可用性[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]資料庫，設定兩部電腦執行[!INCLUDE[btsSQLServer2008](../includes/btssqlserver2008-md.md)]或[!INCLUDE[btsSQLServer2005](../includes/btssqlserver2005-md.md)]Windows 叢集中。</span><span class="sxs-lookup"><span data-stu-id="a4c39-103">To provide high availability for the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] databases, configure two computers that are running [!INCLUDE[btsSQLServer2008](../includes/btssqlserver2008-md.md)] or [!INCLUDE[btsSQLServer2005](../includes/btssqlserver2005-md.md)] in a Windows cluster.</span></span> <span data-ttu-id="a4c39-104">這些電腦可以主動/主動、 主動/被動或主動/主動/被動 （需要三部電腦） 中執行的備援性組態可以共用的磁碟機上儲存資料 (例如 RAID 1 + 0 SCSI 磁碟陣列) 或存放區域網路 (SAN)。</span><span class="sxs-lookup"><span data-stu-id="a4c39-104">These computers can run in an active/active, active/passive, or active/active/passive (requires three computers) configuration for redundancy and can store data on a shared drive (such as a RAID 1+0 SCSI disk array) or storage area network (SAN).</span></span>  
  
 <span data-ttu-id="a4c39-105">如果[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]服務變為無法使用，因為任何原因，資料庫叢集資源從作用中的電腦傳輸到被動電腦。</span><span class="sxs-lookup"><span data-stu-id="a4c39-105">If the [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] service becomes unavailable for any reason, the database cluster transfers resources from the active computer to the passive computer.</span></span> <span data-ttu-id="a4c39-106">在容錯移轉過程中，[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]服務執行個體發生資料庫連線失敗，並自動重新啟動以重新連接到資料庫。</span><span class="sxs-lookup"><span data-stu-id="a4c39-106">During this failover process, the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] service instances experience database connection failures and automatically restart to reconnect to the databases.</span></span> <span data-ttu-id="a4c39-107">正在運作的資料庫電腦 (先前為被動電腦) 會在容錯移轉期間獲得資源後，開始處理資料庫連接。</span><span class="sxs-lookup"><span data-stu-id="a4c39-107">The functioning database computer (previously the passive computer) begins processing the database connections after assuming the resources during failover.</span></span>  
  
 <span data-ttu-id="a4c39-108">叢集[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]資料庫述[叢集 BizTalk Server Databases2](../technical-guides/clustering-the-biztalk-server-databases2.md)。</span><span class="sxs-lookup"><span data-stu-id="a4c39-108">Clustering the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] databases is discussed in [Clustering the BizTalk Server Databases2](../technical-guides/clustering-the-biztalk-server-databases2.md).</span></span> <span data-ttu-id="a4c39-109">本節著重於向外延展[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]資料庫提供高可用性。</span><span class="sxs-lookup"><span data-stu-id="a4c39-109">This section focuses on scaling out the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] databases to provide high availability.</span></span>  
  
## <a name="providing-high-availability-for-the-biztalk-messagebox-database"></a><span data-ttu-id="a4c39-110">為 BizTalk MessageBox 資料庫提供高可用性</span><span class="sxs-lookup"><span data-stu-id="a4c39-110">Providing High Availability for the BizTalk MessageBox Database</span></span>  
 <span data-ttu-id="a4c39-111">本節提供如何設定 BizTalk MessageBox 資料庫的高可用性的資訊。</span><span class="sxs-lookup"><span data-stu-id="a4c39-111">This section provides information about to configure BizTalk MessageBox database for high availability.</span></span>  
  
### <a name="running-multiple-messagebox-databases"></a><span data-ttu-id="a4c39-112">執行多個 MessageBox 資料庫</span><span class="sxs-lookup"><span data-stu-id="a4c39-112">Running Multiple MessageBox Databases</span></span>  
 <span data-ttu-id="a4c39-113">若要增強的延展性[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]資料庫和 MessageBox 資料庫上位址高 CPU 使用率[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]電腦，您可以設定[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]跨多個 MessageBox 資料庫中儲存資料。</span><span class="sxs-lookup"><span data-stu-id="a4c39-113">To enhance the scalability of the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] databases and to address high CPU utilization on the MessageBox database [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] computer, you can configure [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] to store data across multiple MessageBox databases.</span></span> <span data-ttu-id="a4c39-114">當您執行「組態精靈」時，就會建立第一個 MessageBox 資料庫。</span><span class="sxs-lookup"><span data-stu-id="a4c39-114">You create the first MessageBox database when you run the Configuration Wizard.</span></span> <span data-ttu-id="a4c39-115">此 MessageBox 資料庫是主要 MessageBox 資料庫。</span><span class="sxs-lookup"><span data-stu-id="a4c39-115">This MessageBox database is the master MessageBox database.</span></span> <span data-ttu-id="a4c39-116">沒有單一的主要 MessageBox 資料庫中您[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]部署。</span><span class="sxs-lookup"><span data-stu-id="a4c39-116">There is a single master MessageBox database in your [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] deployment.</span></span> <span data-ttu-id="a4c39-117">主要 MessageBox 資料庫包含主要訂閱資訊，並將訊息路由至適當的 MessageBox 資料庫。</span><span class="sxs-lookup"><span data-stu-id="a4c39-117">The master MessageBox database contains the master subscription information and routes messages to the appropriate MessageBox database.</span></span> <span data-ttu-id="a4c39-118">一般而言，您會想要指派至僅供路由，主要 MessageBox 資料庫，並讓其他 MessageBox 資料庫執行處理。</span><span class="sxs-lookup"><span data-stu-id="a4c39-118">Typically, you want to dedicate the master MessageBox database to do routing only and let the other MessageBox databases do the processing.</span></span> <span data-ttu-id="a4c39-119">若要讓僅供路由至 MessageBox 資料庫時，選取**停用新訊息發佈**從 BizTalk 管理主控台中的 MessageBox 內容。</span><span class="sxs-lookup"><span data-stu-id="a4c39-119">To make a MessageBox database to do routing only, select **Disable new message publication** from the MessageBox properties in BizTalk Administration console.</span></span>  
  
 <span data-ttu-id="a4c39-120">MessageBox 資料庫的處理流程的範例如下所示：</span><span class="sxs-lookup"><span data-stu-id="a4c39-120">An example of MessageBox database processing flow is as follows:</span></span>  
  
1.  <span data-ttu-id="a4c39-121">當主要 MessageBox 資料庫收到新啟動訊息時 (商務程序的全新執行個體或訂閱訊息)，主要 MessageBox 資料庫會將啟動訊息分散至下一個可用的 MessageBox 資料庫。</span><span class="sxs-lookup"><span data-stu-id="a4c39-121">When the master MessageBox database receives a new activation message—a brand new instance of a business process or a subscription message—the master MessageBox database distributes the activation message to the next available MessageBox database.</span></span> <span data-ttu-id="a4c39-122">例如，若您有一個主要 MessageBox 資料庫以及兩個 MessageBox 資料庫，則主要 MessageBox 資料庫會將第一個啟動訊息路由至 MessageBox 資料庫 1，第二個啟動訊息路由至 MessageBox 資料庫 2，第三個啟動訊息路由至 MessageBox 資料庫 1，以此輪流模式循環。</span><span class="sxs-lookup"><span data-stu-id="a4c39-122">For example, if you have one master MessageBox database and two MessageBox databases, the master MessageBox database routes the first activation message to MessageBox database 1, the second activation message to MessageBox database 2, the third activation message to MessageBox database 1, and so on in a round-robin pattern.</span></span> <span data-ttu-id="a4c39-123">主要 MessageBox 資料庫使用內建邏輯來平衡負載，不需要其他負載平衡機制。</span><span class="sxs-lookup"><span data-stu-id="a4c39-123">The master MessageBox database uses built-in logic to load balance, and does not need additional load-balancing mechanisms.</span></span>  
  
2.  <span data-ttu-id="a4c39-124">在主要 MessageBox 資料庫路由啟動訊息至特定 MessageBox 資料庫 (例如，MessageBox 資料庫 1) 後，商務程序就會進入記憶體並執行。</span><span class="sxs-lookup"><span data-stu-id="a4c39-124">After the master MessageBox database routes the activation message to a particular MessageBox database (for example, MessageBox database 1), the business process goes into memory and runs.</span></span>  
  
3.  <span data-ttu-id="a4c39-125">如果商務程序必須等待訊息時，等候時間會超過幾秒鐘的時間，則會將商務程序保存回 MessageBox 資料庫 1。</span><span class="sxs-lookup"><span data-stu-id="a4c39-125">If the business process has to wait for a message, and the wait time is longer than several seconds, the business process is persisted back into MessageBox database 1.</span></span> <span data-ttu-id="a4c39-126">商務程序正在等待相互關聯訊息。</span><span class="sxs-lookup"><span data-stu-id="a4c39-126">The business process is waiting for a correlation message.</span></span>  
  
4.  <span data-ttu-id="a4c39-127">相互關聯訊息到達主要 MessageBox 資料庫時，訊息引擎會執行查閱作業資料庫中的 MessageBox 資料庫，其中包含相互關聯訊息 （在此範例中，MessageBox 1） 的狀態。</span><span class="sxs-lookup"><span data-stu-id="a4c39-127">When the correlation message arrives at the master MessageBox database, the Message Engine does a lookup operation in the database for the MessageBox database that contains the state for the correlation message (in this example, MessageBox 1).</span></span> <span data-ttu-id="a4c39-128">主要 MessageBox 資料庫會將訊息傳遞到 MessageBox 資料庫包含商務程序。</span><span class="sxs-lookup"><span data-stu-id="a4c39-128">The master MessageBox database delivers the message to the MessageBox database that contains the business process.</span></span>  
  
5.  <span data-ttu-id="a4c39-129">商務程序將返回到記憶體中繼續處理，直到完成為止，或直到它必須等待另一個相互關聯訊息。</span><span class="sxs-lookup"><span data-stu-id="a4c39-129">The business process is brought back into memory to continue processing until it finishes or until it has to wait for another correlation message.</span></span>  
  
 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]<span data-ttu-id="a4c39-130">儲存在 MessageBox 資料庫中的所有狀態和每個 MessageBox 資料庫包含不同商務程序的狀態資訊。</span><span class="sxs-lookup"><span data-stu-id="a4c39-130"> stores all the states in the MessageBox databases, and each MessageBox database contains state information for different business processes.</span></span> <span data-ttu-id="a4c39-131">為了獲得可靠性，您必須叢集所有 MessageBox 資料庫，包括主要和次要 MessageBox 資料庫。</span><span class="sxs-lookup"><span data-stu-id="a4c39-131">For reliability, you must cluster all the MessageBox databases, including the master and secondary MessageBox databases.</span></span>  
  
 <span data-ttu-id="a4c39-132">若要設定多個 MessageBox 資料庫，您使用[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]管理主控台來新增正在執行的電腦[!INCLUDE[btsSQLServer2008R2](../includes/btssqlserver2008r2-md.md)]或[!INCLUDE[btsSQLServer2008](../includes/btssqlserver2008-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="a4c39-132">To configure multiple MessageBox databases, you use the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] Administration console to add the computers that are running [!INCLUDE[btsSQLServer2008R2](../includes/btssqlserver2008r2-md.md)] or [!INCLUDE[btsSQLServer2008](../includes/btssqlserver2008-md.md)].</span></span> <span data-ttu-id="a4c39-133">從管理的觀點而言，您只需新增 MessageBox 資料庫。</span><span class="sxs-lookup"><span data-stu-id="a4c39-133">From an administration perspective, you only have to add new MessageBox databases.</span></span> [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]<span data-ttu-id="a4c39-134">自動處理啟動訊息的循環配置資源發佈，並將相互關聯訊息傳送至正確的 MessageBox 資料庫。</span><span class="sxs-lookup"><span data-stu-id="a4c39-134"> automatically handles the round-robin distribution of activation messages and sends correlation messages to the correct MessageBox databases.</span></span>  
  
 <span data-ttu-id="a4c39-135">如果您在環境中設定多個 MessageBox 資料庫，您就應該建立至少三個 MessageBox 資料庫，使您[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]群組，而且應該停用主要 MessageBox 資料庫上的訊息發佈。</span><span class="sxs-lookup"><span data-stu-id="a4c39-135">If you configure multiple MessageBox databases in your environment you should create a minimum of three MessageBox databases for your [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] group and you should disable message publication on the master MessageBox database.</span></span> <span data-ttu-id="a4c39-136">這項建議進行新增其他 MessageBox 資料庫將會造成額外負荷，因為主要 MessageBox 資料庫的 MessageBox 資料庫之間路由訊息。</span><span class="sxs-lookup"><span data-stu-id="a4c39-136">This recommendation is made because adding additional MessageBox databases incurs overhead by the master MessageBox database for routing messages between the MessageBox databases.</span></span> <span data-ttu-id="a4c39-137">如果您只設定兩個 MessageBox 資料庫的大部分其他 MessageBox 資料庫所獲得的效益偏移進行訊息路由，主要 MessageBox 資料庫所耗用的額外負擔。</span><span class="sxs-lookup"><span data-stu-id="a4c39-137">If you only configure two MessageBox databases then most of the benefit gained by the additional MessageBox database is offset by the overhead consumed by the master MessageBox database for message routing.</span></span>  
  
> [!IMPORTANT]  
>  [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]<span data-ttu-id="a4c39-138">儲存在 MessageBox 資料庫中的所有狀態和每個 MessageBox 資料庫包含不同商務程序的狀態資訊。</span><span class="sxs-lookup"><span data-stu-id="a4c39-138"> stores all the states in the MessageBox databases, and each MessageBox database contains state information for different business processes.</span></span> <span data-ttu-id="a4c39-139">為了獲得可靠性，您必須叢集所有 MessageBox 資料庫，包括主要和次要 MessageBox 資料庫。</span><span class="sxs-lookup"><span data-stu-id="a4c39-139">For reliability, you must cluster all the MessageBox databases, including the master and secondary MessageBox databases.</span></span>  
  
### <a name="providing-high-availability-for-multiple-messagebox-databases"></a><span data-ttu-id="a4c39-140">為多個 MessageBox 資料庫提供高可用性</span><span class="sxs-lookup"><span data-stu-id="a4c39-140">Providing High Availability for Multiple MessageBox Databases</span></span>  
 <span data-ttu-id="a4c39-141">加入至 MessageBox 資料庫時您[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]部署可改善延展性，它不提供高可用性，因為每個 MessageBox 資料庫是唯一且獨立的而且有可能的單一失敗點，所以您[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]環境。</span><span class="sxs-lookup"><span data-stu-id="a4c39-141">While adding MessageBox databases to your [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] deployment improves scalability, it does not provide high availability because each MessageBox database is unique and independent and is potentially a single point of failure for your [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] environment.</span></span> <span data-ttu-id="a4c39-142">新增備援包含為每個 MessageBox 資料庫設定伺服器叢集。</span><span class="sxs-lookup"><span data-stu-id="a4c39-142">To add redundancy involves configuring a server cluster for each MessageBox database.</span></span> [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]<span data-ttu-id="a4c39-143">因此資料庫不共用資料，或沒有伺服器叢集提供備援，請將資料分散到多個 MessageBox 資料庫中中。</span><span class="sxs-lookup"><span data-stu-id="a4c39-143"> distributes data across the multiple MessageBox databases, so the databases do not share data or otherwise provide redundancy without server clustering.</span></span>  
  
## <a name="providing-high-availability-for-the-biztalk-tracking-database"></a><span data-ttu-id="a4c39-144">為 BizTalk 追蹤資料庫提供高可用性</span><span class="sxs-lookup"><span data-stu-id="a4c39-144">Providing High Availability for the BizTalk Tracking Database</span></span>  
 <span data-ttu-id="a4c39-145">根據特定部署的需求，您可能想要藉由隔離到個別的 BizTalk 追蹤資料庫提升追蹤效能[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]電腦，而藉由建立不同的 BizTalk 主控件專用於主控件追蹤。</span><span class="sxs-lookup"><span data-stu-id="a4c39-145">Depending on the requirements of your particular deployment, you might want to enhance performance for tracking by isolating the BizTalk Tracking database onto a separate [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] computer and by creating a separate BizTalk Host dedicated to host tracking.</span></span> <span data-ttu-id="a4c39-146">下圖顯示兩個主控件執行個體與叢集的資料庫專用的追蹤主控件。</span><span class="sxs-lookup"><span data-stu-id="a4c39-146">The following figure shows a dedicated tracking host with two host instances and clustered databases.</span></span>  
  
 <span data-ttu-id="a4c39-147">![向外擴充追蹤資料庫](../technical-guides/media/4fc1d448-2a6c-4cea-ac17-96c1263dfb68.gif "4fc1d448-2a6c-4cea-ac17-96c1263dfb68")</span><span class="sxs-lookup"><span data-stu-id="a4c39-147">![Scaling out the tracking databases](../technical-guides/media/4fc1d448-2a6c-4cea-ac17-96c1263dfb68.gif "4fc1d448-2a6c-4cea-ac17-96c1263dfb68")</span></span>  
  
 <span data-ttu-id="a4c39-148">如果您的部署具有高輸送量且牽涉到追蹤許多資料，這些訊息，追蹤的額外負擔可能會耗用的資源執行的電腦上的許多[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="a4c39-148">If your deployment has high throughput and involves tracking lots of data for these messages, the tracking overhead could potentially consume lots of resources on the computer that is running [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)].</span></span> <span data-ttu-id="a4c39-149">如果發生這種情況，而且有高比率的內送訊息繼續，[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]達到的點，因為追蹤訊息所需的資源大於執行其他所需的資源無法處理新訊息[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]元件 （例如接收訊息，並將它們保存到 MessageBox 資料庫）。</span><span class="sxs-lookup"><span data-stu-id="a4c39-149">If this situation occurs and a high rate of incoming messages continues, [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] reaches a point where it cannot process new messages because the resources required to track messages are greater than the resources required to run the other [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] components (such as receiving messages and persisting them to the MessageBox database).</span></span>  
  
 <span data-ttu-id="a4c39-150">若要改善效能和安全性，建議您指派不包含任何其他項目 (例如，接收位置、協調流程或管線) 的主控件專供追蹤之用，並停用接收、處理和傳送主控件的追蹤。</span><span class="sxs-lookup"><span data-stu-id="a4c39-150">To improve performance and security, we recommend that you dedicate a host for tracking that does not contain any other items (such as receive locations, orchestrations, or pipelines) and that you disable tracking from the receiving, processing, and sending hosts.</span></span> <span data-ttu-id="a4c39-151">若要為追蹤主控件提供高可用性，請為追蹤主控件建立一個以上的主控件執行個體。</span><span class="sxs-lookup"><span data-stu-id="a4c39-151">To provide high availability for the tracking host, create more than one host instance of the tracking host.</span></span> <span data-ttu-id="a4c39-152">如需有關如何建立追蹤主控件的詳細資訊，請參閱[如何建立新的主控件](http://go.microsoft.com/fwlink/?LinkId=156825)(http://go.microsoft.com/fwlink/?LinkId=156825) 中[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]幫助。</span><span class="sxs-lookup"><span data-stu-id="a4c39-152">For more information about creating a tracking host, see [How to Create a New Host](http://go.microsoft.com/fwlink/?LinkId=156825) (http://go.microsoft.com/fwlink/?LinkId=156825) in [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] Help.</span></span>  
  
 <span data-ttu-id="a4c39-153">對於每個 MessageBox 資料庫，[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 僅使用一個追蹤主控件執行個體，將訊息從 MessageBox 資料庫移至 BizTalk 追蹤資料庫 (BizTalkDTADb)。</span><span class="sxs-lookup"><span data-stu-id="a4c39-153">For each MessageBox database, [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] uses only one tracking host instance to move messages from the MessageBox database to the BizTalk Tracking database (BizTalkDTADb).</span></span> <span data-ttu-id="a4c39-154">若其他電腦執行的追蹤主控件執行個體[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]出處理個別的追蹤主控件執行個體的每個 MessageBox 資料庫的自動調整。</span><span class="sxs-lookup"><span data-stu-id="a4c39-154">If additional computers run instances of the tracking host, [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] automatically scales out the handling of each MessageBox database to a separate instance of the tracking host.</span></span> <span data-ttu-id="a4c39-155">若 MessageBox 資料庫數目大於追蹤主控件執行個體數目，則一或多個追蹤主控件執行個體將服務一個以上的 MessageBox 資料庫。</span><span class="sxs-lookup"><span data-stu-id="a4c39-155">If the number of MessageBox databases is larger than the number of tracking host instances, one or more tracking host instances will service more than one MessageBox database.</span></span>  
  
 <span data-ttu-id="a4c39-156">若要提供 BizTalk 追蹤資料庫的高可用性，使用 Windows 叢集來設定兩部執行的資料庫電腦[!INCLUDE[btsSQLServer2008R2](../includes/btssqlserver2008r2-md.md)]或[!INCLUDE[btsSQLServer2008](../includes/btssqlserver2008-md.md)]主動/被動組態中。</span><span class="sxs-lookup"><span data-stu-id="a4c39-156">To provide high availability for the BizTalk Tracking database, use Windows Clustering to configure two database computers that are running [!INCLUDE[btsSQLServer2008R2](../includes/btssqlserver2008r2-md.md)] or [!INCLUDE[btsSQLServer2008](../includes/btssqlserver2008-md.md)] in an active/passive configuration.</span></span>  
  
## <a name="providing-high-availability-for-the-bam-databases"></a><span data-ttu-id="a4c39-157">為 BAM 資料庫提供高可用性</span><span class="sxs-lookup"><span data-stu-id="a4c39-157">Providing High Availability for the BAM Databases</span></span>  
 <span data-ttu-id="a4c39-158">*商務活動監控*(BAM) 提供獨立於 IT 實作或跨異質 IT 實作的商務程序可見性。</span><span class="sxs-lookup"><span data-stu-id="a4c39-158">*Business Activity Monitoring* (BAM) provides visibility into business processes independent of the IT implementation or across a heterogeneous IT implementation.</span></span> <span data-ttu-id="a4c39-159">BAM [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] （BAM 星狀結構描述資料庫、 BAM 主要匯入資料庫和 BAM 封存資料庫） 的資料庫和 BAM 分析資料庫儲存商務活動資料不同於操作監控資料。</span><span class="sxs-lookup"><span data-stu-id="a4c39-159">The BAM [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] databases (BAM Star Schema database, BAM Primary Import database, and BAM Archive database) and the BAM Analysis database store the business activity data that is different from the operational monitoring data.</span></span> <span data-ttu-id="a4c39-160">下圖顯示 BAM 資料庫基礎結構。</span><span class="sxs-lookup"><span data-stu-id="a4c39-160">The following diagram shows the BAM database infrastructure.</span></span>  
  
 <span data-ttu-id="a4c39-161">![BAM 資料庫基礎結構](../technical-guides/media/769c3b7c-fe16-4260-967e-6af003c4f08d.gif "769c3b7c-fe16-4260-967e-6af003c4f08d")</span><span class="sxs-lookup"><span data-stu-id="a4c39-161">![BAM database infrastructure](../technical-guides/media/769c3b7c-fe16-4260-967e-6af003c4f08d.gif "769c3b7c-fe16-4260-967e-6af003c4f08d")</span></span>  
  
 <span data-ttu-id="a4c39-162">若要確定 BAM 基礎結構為高度可用，請執行下列動作：</span><span class="sxs-lookup"><span data-stu-id="a4c39-162">To make sure your BAM infrastructure is highly available, do the following:</span></span>  
  
-   <span data-ttu-id="a4c39-163">**叢集 BAM 主要匯入資料庫和 BAM 分析資料庫。**</span><span class="sxs-lookup"><span data-stu-id="a4c39-163">**Cluster the BAM Primary Import database and the BAM Analysis database.**</span></span> <span data-ttu-id="a4c39-164">BAM 主要匯入資料庫是商務活動監控系統的中心。</span><span class="sxs-lookup"><span data-stu-id="a4c39-164">The BAM Primary Import database is the center of the Business Activity Monitoring system.</span></span> <span data-ttu-id="a4c39-165">因此，使用 Windows 叢集讓此資料庫高度可用，並依照接下來的兩個建議以避免此資料庫被填滿，就很重要。</span><span class="sxs-lookup"><span data-stu-id="a4c39-165">It is therefore important that you make this database highly available by using Windows Clustering and that you follow the next two recommendations to prevent this database from filling up.</span></span> <span data-ttu-id="a4c39-166">BAM 分析資料庫是一種 Analysis Services 資料庫，它儲存了商務分析師用以建立活動彙總和 OLAP Cube 的資料，因此，此資料庫的任何停機都會影響其產能。</span><span class="sxs-lookup"><span data-stu-id="a4c39-166">The BAM Analysis database is an Analysis Services database that stores the data that business analysts use to build activity aggregations and OLAP cubes, and therefore any downtime of this database affects their productivity.</span></span> <span data-ttu-id="a4c39-167">雖然您不必叢集 BAM 封存資料庫，我們建議您監視事件記錄檔的錯誤，請確定已成功，傳輸的資料，並監視資料庫的大小，SQL Server Integration Services (SSIS) 封裝執行時如此您可以取代它之前填滿上。</span><span class="sxs-lookup"><span data-stu-id="a4c39-167">While you do not have to cluster the BAM Archive database, we recommend that you monitor the event log for errors when the SQL Server Integration Services (SSIS) packages run to make sure the data has been transferred successfully, and to monitor the size of the database so that you can replace it before it fills up.</span></span>  
  
-   <span data-ttu-id="a4c39-168">**定義線上視窗。**</span><span class="sxs-lookup"><span data-stu-id="a4c39-168">**Define an online window.**</span></span> <span data-ttu-id="a4c39-169">若要讓更佳的效能並避免停機，BAM 資料分割的設定，BAM 主要匯入資料庫中的資料插入資料表時已完成活動，根據時間戳記。</span><span class="sxs-lookup"><span data-stu-id="a4c39-169">To allow for better performance and avoid downtime, BAM partitions the data in the BAM Primary Import database into tables based on the timestamp when the activity was completed.</span></span> <span data-ttu-id="a4c39-170">BAM 藉由定期將完成的資料表與另一個格式完全相同的空資料表交換來完成此項工作。</span><span class="sxs-lookup"><span data-stu-id="a4c39-170">BAM achieves this by regularly swapping the completed table with another empty table of identical format.</span></span> <span data-ttu-id="a4c39-171">BAM 在執行此動作後，其他完成的活動就會存放在新分割上 (資料表)，而 BAM 也會保留線上視窗所定義時間的舊分割。</span><span class="sxs-lookup"><span data-stu-id="a4c39-171">After BAM does this, the additional completed activities go into the new partition (table), while BAM keeps the old partitions for the time defined in the online window.</span></span> <span data-ttu-id="a4c39-172">您必須定義線上視窗以確保 BAM 主要匯入資料庫中的分割數目不會成長得太大。</span><span class="sxs-lookup"><span data-stu-id="a4c39-172">You must define an online window to make sure the number of partitions in the BAM Primary Import database does not grow too large.</span></span> <span data-ttu-id="a4c39-173">如需排程線上視窗的詳細資訊，請參閱[封存主要匯入資料庫資料](http://go.microsoft.com/fwlink/?LinkId=156826)(http://go.microsoft.com/fwlink/?LinkId=156826) 中[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]幫助。</span><span class="sxs-lookup"><span data-stu-id="a4c39-173">For more information about scheduling online windows, see [Archiving Primary Import Database Data](http://go.microsoft.com/fwlink/?LinkId=156826) (http://go.microsoft.com/fwlink/?LinkId=156826) in [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] Help.</span></span>  
  
-   <span data-ttu-id="a4c39-174">**排程定期執行 SSIS 封裝。**</span><span class="sxs-lookup"><span data-stu-id="a4c39-174">**Schedule SSIS packages to run periodically.**</span></span> <span data-ttu-id="a4c39-175">定義線上視窗可確保 BAM 主要匯入資料庫不會填滿舊活動的分割。</span><span class="sxs-lookup"><span data-stu-id="a4c39-175">Defining an online window makes sure your BAM Primary Import database does not fill up with old activity partitions.</span></span> <span data-ttu-id="a4c39-176">您也必須排程定期執行，若要建立新的資料分割，活動資料，並將資料從 BAM 主要匯入資料庫中的舊分割移到 BAM 封存資料庫的 SSIS 封裝。</span><span class="sxs-lookup"><span data-stu-id="a4c39-176">You must also schedule SSIS packages to run periodically to create a new partition for the activity data and to move the data from the old partitions in the BAM Primary Import database into the BAM Archive database.</span></span> <span data-ttu-id="a4c39-177">如需排程的 SSIS 封裝的詳細資訊，請參閱[排程 SQL Server Integration Services 封裝](http://go.microsoft.com/fwlink/?LinkId=156827)(http://go.microsoft.com/fwlink/?LinkId=156827) 中[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]幫助。</span><span class="sxs-lookup"><span data-stu-id="a4c39-177">For more information about scheduling SSIS packages, see [Scheduling SQL Server Integration Services Packages](http://go.microsoft.com/fwlink/?LinkId=156827) (http://go.microsoft.com/fwlink/?LinkId=156827) in [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] Help.</span></span>  
  
-   <span data-ttu-id="a4c39-178">**請仔細選擇少量的資料項目 （檢查點），並避免包含不必要資料的項目，定義活動時。**</span><span class="sxs-lookup"><span data-stu-id="a4c39-178">**Carefully choose small sets of data items (checkpoints), and avoid including unnecessary data items when defining an activity.**</span></span>  
  
-   <span data-ttu-id="a4c39-179">**了解排程和即時彙總設計彙總時之間的取捨。**</span><span class="sxs-lookup"><span data-stu-id="a4c39-179">**Understand the trade-offs between scheduled and real-time aggregations when you design your aggregations.**</span></span> <span data-ttu-id="a4c39-180">即時彙總自動維護的[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]觸發程序，且沒有延遲。</span><span class="sxs-lookup"><span data-stu-id="a4c39-180">Real-time aggregations are automatically maintained by [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] triggers and have zero latency.</span></span> <span data-ttu-id="a4c39-181">它們適用於某些關鍵任務的低延遲案例中，但是它們會造成效能成本，只要正在寫入事件至 BAM 主要匯入資料庫。</span><span class="sxs-lookup"><span data-stu-id="a4c39-181">They are ideal for some mission-critical low-latency scenarios, but they incur a performance cost whenever the events are being written to the BAM Primary Import database.</span></span> <span data-ttu-id="a4c39-182">排程彙總依賴排程 cube SSIS 封裝，以更新其彙總資料。</span><span class="sxs-lookup"><span data-stu-id="a4c39-182">Scheduled aggregations rely on scheduled cubing SSIS packages to update their aggregation data.</span></span> <span data-ttu-id="a4c39-183">其延遲是等於或大於 SSIS 排程間隔，但整體 BAM 主要匯入資料庫上具有較小的效能影響。</span><span class="sxs-lookup"><span data-stu-id="a4c39-183">Their latency is equal to or greater than the SSIS schedule interval, but overall they have a smaller performance impact on the BAM Primary Import database.</span></span>  
  
-   <span data-ttu-id="a4c39-184">**如果您選擇排程彙總，請確定您排程 cube SSIS 以封存 SSIS 比更頻繁地執行。**</span><span class="sxs-lookup"><span data-stu-id="a4c39-184">**If you choose scheduled aggregations, make sure you schedule the cubing SSIS to run more frequently than the archiving SSIS.**</span></span> <span data-ttu-id="a4c39-185">這是因為封存的 SSIS 不會移動已經為排程彙總到 BAM 封存資料庫處理的活動資料。</span><span class="sxs-lookup"><span data-stu-id="a4c39-185">This is because the archiving SSIS will not move the activity data that has been processed for scheduled aggregation to the BAM Archive database.</span></span>  
  
-   <span data-ttu-id="a4c39-186">**啟用 BAM 事件匯流排服務在多部電腦以取得容錯移轉功能。**</span><span class="sxs-lookup"><span data-stu-id="a4c39-186">**Enable the BAM Event Bus service in multiple computers to obtain failover functionality.**</span></span>  
  
## <a name="providing-high-availability-for-the-other-biztalk-server-databases"></a><span data-ttu-id="a4c39-187">為其他 BizTalk 伺服器資料庫提供高可用性</span><span class="sxs-lookup"><span data-stu-id="a4c39-187">Providing High Availability for the Other BizTalk Server Databases</span></span>  
 <span data-ttu-id="a4c39-188">若要提供高可用性的其他[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]資料庫，設定兩部電腦執行[!INCLUDE[btsSQLServer2008R2](../includes/btssqlserver2008r2-md.md)]或[!INCLUDE[btsSQLServer2008](../includes/btssqlserver2008-md.md)]Windows 叢集中。</span><span class="sxs-lookup"><span data-stu-id="a4c39-188">To provide high availability for the other [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] databases, configure two computers that are running [!INCLUDE[btsSQLServer2008R2](../includes/btssqlserver2008r2-md.md)] or [!INCLUDE[btsSQLServer2008](../includes/btssqlserver2008-md.md)] in a Windows cluster.</span></span> <span data-ttu-id="a4c39-189">這些電腦可以在備援的主動/主動或主動/被動組態執行，而且可以將資料儲存在共用磁碟機 (例如 RAID 1 + 0 SCSI 磁碟陣列) 或存放區域網路 (SAN)。</span><span class="sxs-lookup"><span data-stu-id="a4c39-189">These computers can run in an active/active or active/passive configuration for redundancy and can store data on a shared drive (such as a RAID 1+0 SCSI disk array) or storage area network (SAN).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="a4c39-190">另請參閱</span><span class="sxs-lookup"><span data-stu-id="a4c39-190">See Also</span></span>  
 [<span data-ttu-id="a4c39-191">叢集 BizTalk Server Databases2</span><span class="sxs-lookup"><span data-stu-id="a4c39-191">Clustering the BizTalk Server Databases2</span></span>](../technical-guides/clustering-the-biztalk-server-databases2.md)