---
title: 檢查清單： 測量 HYPER-V 上的效能 |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: f32c95f4-a4eb-412b-9fa7-140e80b85e5a
caps.latest.revision: 13
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 111ca6bfa37fdfc6af6f484ebc1568cbaca2c8f6
ms.sourcegitcommit: 266308ec5c6a9d8d80ff298ee6051b4843c5d626
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 06/27/2018
ms.locfileid: "37007111"
---
# <a name="checklist-measuring-performance-on-hyper-v"></a>檢查清單： 測量 HYPER-V 上的效能
雖然大部分的原則分析安裝在 HYPER-V 虛擬機器效能上的客體作業系統的效能分析的效能，在實體機器上安裝作業系統的相同，許多集合的方法是不同。 評估您在 HYPER-V 虛擬機器上安裝客體作業系統上執行的 BizTalk Server 解決方案的效能時，應該使用下列各節，快速參考。  

## <a name="measuring-disk-io-performance"></a>測量磁碟 I/O 效能  
 您可以使用下列效能監視器計數器來測量在 HYPER-V 虛擬機器上安裝客體作業系統上的磁碟 I/O 效能：  


|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 步驟                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                參考                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **測量 HYPER-V 主機作業系統上的磁碟延遲**-在 HYPER-V 主機的作業系統上的磁碟效能的最佳初始指標使用取得的 「 \Logical 磁碟 (*) \Avg。Disk sec/Read"和"\Logical 磁碟 (\*) \Avg。Disk sec/Write"效能監視器計數器。這些效能監視器計數器來測量讀取和寫入作業的時間來回應作業系統的時間的量。一般的經驗法則，平均回應時間大於 15ms年會被視為不佳。一般的經驗法則，平均回應時間大於 15ms年會被視為不佳。這根據一般的搜尋單一 7200 RPM 磁碟機，而不需要快取的時間。建議的實體磁碟效能監視器計數器與邏輯磁碟使用，因為 Windows 應用程式和服務使用以呈現給作業系統的實體磁碟 (LUN) 可以是其中的磁碟機代號的邏輯磁碟機組成磁碟陣列中的多個實體磁碟機。使用下列規則的經驗法則，測量 HYPER-V 主機作業系統使用 \Logical 磁碟上的磁碟延遲時 (\*) \Avg。磁碟 sec/Read] 或 [\Logical 磁碟 (\*) \Avg。磁碟 sec/Write 效能監視器計數器：<br /> <br />這根據一般的搜尋單一 7200 RPM 磁碟機，而不需要快取的時間。建議的實體磁碟效能監視器計數器與邏輯磁碟使用，因為 Windows 應用程式和服務使用以呈現給作業系統的實體磁碟 (LUN) 可以是其中的磁碟機代號的邏輯磁碟機組成磁碟陣列中的多個實體磁碟機。使用下列規則的經驗法則，測量 HYPER-V 主機作業系統使用 \Logical 磁碟上的磁碟延遲時 (\*) \Avg。磁碟 sec/Read] 或 [\Logical 磁碟 (\*) \Avg。磁碟 sec/Write 效能監視器計數器：<br /> <br /> -1 毫秒到 15ms年 = 狀況良好<br />-15ms年 25 毫秒 = 警告或監視<br />-26ms年以上 = 嚴重，效能會受到負面影響\* \*附註：* \*安裝在非虛擬化環境中的實體磁碟提供更佳的效能比經由 HYPER-V 主機作業系統的磁碟。 如果磁碟效能十分重要的應用程式的整體效能，請考慮裝載在實際的硬體上的磁碟。 **注意：** 時評估的磁碟 I/O 效能，請確定您要排除的任何磁碟分割進行評估掃描的防毒軟體設定。 防毒軟體掃描導入了對造成負面影響效能和扭曲測試結果的額外負荷。 <br /><br /> **測量在客體作業系統上的磁碟延遲**– 可以測量回應時間的客體作業系統所使用的磁碟，使用同一個效能監視器計數器來測量回應時間的 HYPER-V 主機作業系統所使用的磁碟系統。 | 如需有關磁碟效能分析的詳細資訊，請參閱下列資源：<br /><br /> -在 「 執行 SQL Server 2008 in a HYPER-V 環境 – 最佳 Practices and Performance Considerations 「 白皮書 」 在 HYPER-V 中執行 SQL Server 中的效能負荷 」 一節[ http://go.microsoft.com/fwlink/?LinkId=144622 ](http://go.microsoft.com/fwlink/?LinkId=144622)。<br />-條件在繫結磁碟問題[ http://go.microsoft.com/fwlink/?LinkId=120947 ](http://go.microsoft.com/fwlink/?LinkId=120947)。<br />SQL Server 前置部署 I/O 最佳實務範例[ http://go.microsoft.com/fwlink/?LinkId=120948 ](http://go.microsoft.com/fwlink/?LinkId=120948)。<br />-「 I/O 瓶頸 」 一節的 「 疑難排解效能問題，在 SQL Server 2008 > 白皮書，網址[ http://go.microsoft.com/fwlink/?LinkID=202135 ](http://go.microsoft.com/fwlink/?LinkID=202135)。<br />-如何找出使用 Microsoft Server 效能 Advisor (SPA) 工具，在磁碟效能瓶頸[ http://go.microsoft.com/fwlink/?LinkID=98096 ](http://go.microsoft.com/fwlink/?LinkID=98096)。 |

## <a name="measuring-memory-performance"></a>測量記憶體效能  
 您可以使用下列效能監視器計數器來測量可用的記憶體，HYPER-V 虛擬機器上安裝客體作業系統效能的影響：  

|步驟|參考|  
|----------|---------------|  
|**測量 HYPER-V 主機作業系統上的可用記憶體**– 用於 HYPER-V 主機作業系統的實體記憶體數量由上監視的 「 \Memory\Available MBytes 「 效能監視器計數器實體電腦。 此計數器會報告可用主機作業系統可用實體記憶體數量。 評估可用主機作業系統可用實體記憶體時，請使用下列規則的經驗法則：<br /><br /> <ul><li>**\Memory\Available Mbytes** – Available mbytes 量值的電腦上安裝的實體記憶體百分比的電腦上，執行的處理序可用的實體記憶體數量。 測量這個效能監視器計數器的值時，就會套用下列準則：<br /><br /> <ul><li>可用的記憶體的 50%或更 = 狀況良好</li><li>25%的可用的記憶體 = 監視</li><li>10%的可用的記憶體 = 警告</li><li>可用的記憶體低於 5%= 嚴重，效能會受到負面影響</li></ul></li><li>**\Memory\Pages/sec** – 這個效能監視器計數器會測量在讀取或寫入磁碟以解決硬體分頁錯誤頁面的速率。 若要解決硬體分頁錯誤，作業系統必須交換記憶體內容的磁碟，而效能受到負面影響。 每秒實體可用的記憶體不足的相互關聯的頁面數目可能表示實體記憶體不足。 測量這個效能監視器計數器的值時，就會套用下列準則：<br /><br /> <ul><li>少於 500 個 = 狀況良好</li><li>500-1000年 = 監視或警告</li><li>大於 1000年 = 嚴重，效能會受到負面影響</li></ul></li></ul><br /> **測量在客體作業系統上的可用記憶體**– 客體作業系統可用的記憶體可以測量的相同效能監控計數器來測量 HYPER-V 主機作業系統可用的記憶體。|詳細資訊的相關影響可用的實體記憶體的應用程式伺服器效能，請參閱 Exchange Server 2003 說明主題 < 統治出記憶體繫結的問題 >，網址[ http://go.microsoft.com/fwlink/?LinkId=121056 ](http://go.microsoft.com/fwlink/?LinkId=121056)。|  

## <a name="measuring-network-performance"></a>測量網路效能  
 HYPER-V 可讓客體電腦共用相同的實體網路介面卡。 雖然這有助於整併硬體，請小心不要 saturate 實體介面卡。 您可以使用下列方法來確保 HYPER-V 虛擬機器所使用的網路健康狀態：  


|                                 步驟                                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               參考                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|----------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|                       **測試網路延遲**                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 Ping 每個虛擬機器，以確保有適當的網路延遲。 在 區域網路，應該會收到小於 1 毫秒回應時間。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|                       **測試封包遺失**                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          您可以使用 pathping.exe 公用程式來測試虛擬機器之間的封包遺失。 Pathping.exe 測量網路上的封包遺失，並且只適用於所有版本的[!INCLUDE[btsWinNoVersion](../includes/btswinnoversion-md.md)]因為[!INCLUDE[btsWin2kSvr](../includes/btswin2ksvr-md.md)]。 Pathping.exe 送出至網路中的每個節點的 100 個 ping 要求的高載，並計算會傳回多少 ping。 在 區域網路上應該不會遺失從 pathping.exe 公用程式 ping 要求。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|                   **測試網路檔案傳輸**                    |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          複製虛擬機器之間 100 MB 的檔案，並測量完成複製所需的時間長度。 在 狀況良好的 100Mbit 100 MB (mb) 的檔案應該複製 (mb) 網路，以 10 到 20 秒為單位。 狀況良好的 1Gbit 網路 100 MB 的檔案應該複製在 3 到 5 秒內。 在這些參數範圍外的複製時間較長的網路問題。 當網路介面卡具有 「 自動偵測到 」 時，就會發生不佳的網路傳輸的一個常見原因要充分利用可用的頻寬時，防止網路介面卡的 10MB 半雙工網路。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| **量值為 HYPER-V 主機作業系統上的網路使用率** | 您可以使用下列效能監視器計數器來測量 HYPER-V 主機作業系統上的網路使用率：<br /><br /> **\Network 介面 (\*) \Bytes Total/sec** – 網路使用率百分比會計算位元組總數/秒乘以 8，將它轉換成位元，請將結果乘以 100 上，然後除以網路介面卡的目前頻寬。 您可以使用下列的臨界值來評估網路頻寬使用率：<br /><br /> -低於 40%的耗用的介面 = 狀況良好<br />-耗用的介面 41%-64%= 監視或警告<br />-耗用的介面 65 100%= 嚴重，效能會受到負面影響<br /><br /> **\Network 介面 (\*) \Output 佇列長度**– 輸出佇列長度量值的網路介面卡上等候的執行緒數目。 如果有 2 個以上的執行緒等待網路介面卡上，網路可能是瓶頸。 常見的原因，這是不佳的網路延遲及/或網路上的高衝突率。 您可以使用下列的臨界值來評估輸出佇列長度：<br /><br /> -0 = 狀況良好<br />-1-2 = 監視或警告<br />-Greater than 2 = 嚴重，效能會受到負面影響。<br /><br /> 確定方案中的所有電腦 （實體和虛擬） 的網路介面卡已設定的最大傳輸單位 (MTU) 使用相同的值。 設定 MTU 值的詳細資訊，請參閱 < 附錄 a: TCP/IP 組態參數 >，網址[ http://go.microsoft.com/fwlink/?LinkId=113716 ](http://go.microsoft.com/fwlink/?LinkId=113716)。<br /><br /> 如果以 2 或多個輸出佇列長度，請考慮將一個或多個實體網路介面卡新增至裝載的虛擬機器的實體電腦，並繫結客體作業系統，這些實體網路介面卡所使用的網路介面卡。 |
|    **量值在客體作業系統上的網路使用率**    |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       如果 HYPER-V 根磁碟分割上的網路介面卡處於忙碌狀態，如先前所述的效能監視器計數器所指出的請考慮使用 「 \Hyper-V 虛擬網路介面卡 (\*) \Bytes/sec"以找出哪些效能監視器計數器虛擬網路介面卡會耗用大部分的網路使用率。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |

 網路效能分析的詳細資訊，請參閱 < 章 15-測量.NET 應用程式效能 >，網址[ http://go.microsoft.com/fwlink/?LinkId=121073 ](http://go.microsoft.com/fwlink/?LinkId=121073)。  

## <a name="measuring-processor-performance"></a>測量處理器效能  
 您可以使用下列方法來評估在 HYPER-V 虛擬機器上安裝客體作業系統上的處理器效能：  

- **測量客體作業系統的處理器使用率-** 傳統上，處理器效能可以用來評估 」 \Processor(*)\\處理器時間百分比 」 效能監視器計數器。 這不是精確的計數器，但評估為客體作業系統的處理器使用率，因為 HYPER-V 測量並報告此值相對於配置給虛擬機器的處理器數目。 每個客體作業系統 」 的更多的處理器配置給虛擬機器超過實際存在的實體電腦上執行，如果傳回的值"\Processor (\*)\\處理器時間百分比 」 效能監視器計數器很少，即使事實上處理器使用率是瓶頸。 這是因為利用實體處理器循環配置資源方式，虛擬處理器。 每個虛擬處理器會試著配置本身的共用的整體系統資源，因此在 4 個實體處理器的系統中，每個虛擬處理器會依預設會嘗試使用 25%的系統資源。 8 個虛擬處理器，以便共同建立這表示如果虛擬處理器會嘗試利用 200%的 CPU 容量的伺服器。 在此情況下，每個虛擬處理器會回報所測量的低使用率 」 \Processor (\*)\\%Processor Time"（相對於它所需要的層級） 的效能監視器計數器和內容切換過多虛擬處理器會導致每個虛擬機器的效能不佳。 在此案例中，請考慮減少配置給主機作業系統上的 HYPER-V 虛擬機器的虛擬處理器數目。HYPER-V 提供 hypervisor 來監視效能的邏輯與虛擬處理器的效能物件。 邏輯處理器與直接相互關聯的處理器或實體電腦已安裝的核心數目。 比方說，8 個邏輯處理器會相互關聯的實體電腦上安裝的 2 個四核心處理器。 虛擬處理器虛擬機器實際使用的項目，而且會以虛擬處理器根和子資料分割中的所有執行。  

   HYPER-V 提供 hypervisor 來監視效能的邏輯與虛擬處理器的效能物件。 邏輯處理器與直接相互關聯的處理器或實體電腦已安裝的核心數目。 比方說，8 個邏輯處理器會相互關聯的實體電腦上安裝的 2 個四核心處理器。 虛擬處理器虛擬機器實際使用的項目，而且會以虛擬處理器根和子資料分割中的所有執行。  

   若要精確地測量客體作業系統的處理器使用量，請使用 「 HYPER-V Hypervisor 邏輯 processor （_total） %total 執行階段 」 HYPER-V 主機作業系統上的效能監視器計數器。 使用下列的臨界值，以評估客體作業系統系統處理器使用率使用 「 HYPER-V Hypervisor 邏輯 processor （_total） %total 執行階段 「 效能監視器計數器：  

  - 消耗低於 60%= 狀況良好  

  - 60%-89%使用 = 監視或警告  

  - 90%-100%使用 = 重大，效能會受到負面影響  

    若要疑難排解 HYPER-V 環境上的客體作業系統的處理器效能，最好儘量主機作業系統所報告的值之間的平衡"\Hyper-V Hypervisor 邏輯 processor （_total)\\%執行總計時間 」 (LPTR) 和 「 \Hyper-V Hypervisor 虛擬 processor （_total)\\%的總執行時間 」 (VPTR)。 如果 LPTR 很高，而且 VPTR 不足再確認不會有更多的處理器配置給虛擬機器，超過實際可用的實體電腦上。 使用 「 \Hyper-V Hypervisor 虛擬 Processor(*)\\客體執行時間百分比 」 計數器，可用來判斷哪一個虛擬處理器所耗用的 CPU，並取消配置虛擬處理器，從虛擬機器，視需要設定的一對一對應虛擬處理器與邏輯處理器。 如需有關如何設定虛擬處理器與邏輯處理器的一對一對應的詳細資訊，請參閱中的 < 最佳化處理器效能 > 一節[檢查清單： 在 HYPER-V 上的 最佳化效能](~/technical-guides/checklist-optimizing-performance-on-hyper-v.md)。 如果 VPTR 很高，而且 LPTR 不足則考慮配置額外的虛擬機器的處理器，如果有可用的邏輯處理器，以及額外的處理器支援客體作業系統。 萬一其中 VPTR 很高，LPTR 偏低，有可用的邏輯處理器，若要配置，但額外的處理器不支援客體作業系統，請考慮藉由將實體電腦上的其他虛擬機器向外延展和配置給這些虛擬機器可用的處理器。 在其中 VPTR 和 LPTR 是高的情況下，組態會推送的實體電腦的限制，並應該考慮將另一部實體電腦和其他 HYPER-V 虛擬機器加入至環境相應放大。 下列流程圖說明在 HYPER-V 環境中的處理器效能的疑難排解時，應使用的程序。  

    如果 VPTR 很高，而且 LPTR 偏低，則考慮配置額外的虛擬機器的處理器，如果有可用的邏輯處理器，以及額外的處理器支援客體作業系統。 萬一其中 VPTR 很高，LPTR 偏低，有可用的邏輯處理器，若要配置，但額外的處理器不支援客體作業系統，請考慮藉由將實體電腦上的其他虛擬機器向外延展和配置給這些虛擬機器可用的處理器。 在其中 VPTR 和 LPTR 是高的情況下，組態會推送的實體電腦的限制，並應該考慮將另一部實體電腦和其他 HYPER-V 虛擬機器加入至環境相應放大。 下列流程圖說明在 HYPER-V 環境中的處理器效能的疑難排解時，應使用的程序。  

    ![疑難排解 Hyper-v 上的 CPU 效能&#45;V](../technical-guides/media/623fdcd6-e80b-4ba9-bf46-5d9b92b6612b.gif "623fdcd6-e80b-4ba9-bf46-5d9b92b6612b")  
    在 HYPER-V 環境中的 CPU 效能疑難排解  

  > [!NOTE]  
  >  **客體作業系統的處理器不需要實體的處理器核心組同質性**– hypervisor 會決定如何實體資源使用。 在處理器使用率的情況下 hypervisor 會排程的執行緒形式的實體處理器的來賓處理器時間。 這表示虛擬機器的處理器負載會分散於實體電腦的處理器。 此外，虛擬機器不能超過設定的數個邏輯處理器，例如，如果單一虛擬機器設定為具有 8 個處理器/核心，在實體電腦上執行 2 個邏輯處理器的處理器使用量則虛擬機器不能超過設定的邏輯處理器 （在此情況下 2 個處理器） 數目的處理器容量。  

- **測量整體處理器使用率的 HYPER-V 環境中，使用 HYPER-V 效能監視計數器-** 基於測量處理器使用率，主機作業系統邏輯上視為只是另一個客體作業系統. 因此，「 \Processor(*)\\%Processor Time"監視的計數器會測量主控件僅限作業系統的處理器使用量。 若要測量的主機作業系統和所有的客體作業系統的實體處理器總使用率，使用"\Hyper-V Hypervisor 邏輯 processor （_total)\\%total 執行階段 「 效能監視器計數器。 此計數器會測量處理器執行這兩個主機作業系統所花費的時間百分比總計，所有客體作業系統。  

   使用下列的臨界值評估的 HYPER-V 環境使用的整體處理器使用率 」 \Hyper-V Hypervisor 邏輯 processor （_total)\\%total 執行階段 「 效能監視器計數器：  

  - 消耗低於 60%= 狀況良好  

  - 60%-89%使用 = 監視或警告  

  - 90%-100%使用 = 重大，效能會受到負面影響  

    如需有關處理器使用率，請檢閱下列資源：  

  - "How To： 識別導致高的使用者模式 CPU 瓶頸的伺服器應用程式在生產環境中的函式 」 在[ http://go.microsoft.com/fwlink/?LinkID=107047 ](http://go.microsoft.com/fwlink/?LinkID=107047)。  

  - 在的"章 15-測量的.NET 應用程式效能 」 [ http://go.microsoft.com/fwlink/?LinkId=121073 ](http://go.microsoft.com/fwlink/?LinkId=121073)。
