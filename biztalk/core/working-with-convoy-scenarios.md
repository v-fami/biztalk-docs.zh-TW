---
title: 使用群組實例 |Microsoft 文件
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: 1028ab37-7ead-41a6-a186-53e5344d1a28
caps.latest.revision: 19
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 42f1c9931fe91b284c53a05c7868554c622306fb
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 09/20/2017
ms.locfileid: "22290494"
---
# <a name="working-with-convoy-scenarios"></a><span data-ttu-id="4bd38-102">使用群組實例</span><span class="sxs-lookup"><span data-stu-id="4bd38-102">Working with Convoy Scenarios</span></span>
<span data-ttu-id="4bd38-103">A*群組*存在多個單一訊息必須與達到所需的結果相關的任何時間。</span><span class="sxs-lookup"><span data-stu-id="4bd38-103">A *convoy* exists any time that multiple single messages must be related to achieve the required result.</span></span> <span data-ttu-id="4bd38-104">有兩種類型的群組： 循序和平行。</span><span class="sxs-lookup"><span data-stu-id="4bd38-104">There are two main types of convoys: sequential and parallel.</span></span>  
  
 <span data-ttu-id="4bd38-105">在特定情況下，協調流程執行個體會同時接收一組相互關聯的訊息。</span><span class="sxs-lookup"><span data-stu-id="4bd38-105">Under certain conditions, an orchestration instance might receive a group of correlated messages all at the same time.</span></span> <span data-ttu-id="4bd38-106">此時，便可能發生競爭情形，因此群組的其中一個訊息必須初始化協調流程執行個體中的相互關聯集，才能讓其他訊息與該協調流程執行個體相互關聯。</span><span class="sxs-lookup"><span data-stu-id="4bd38-106">In this situation, a race condition might occur, in which one of the messages in the group must initialize a correlation set in the orchestration instance before the other messages can be correlated to that orchestration instance.</span></span>  
  
 <span data-ttu-id="4bd38-107">為確保所有的相互關聯訊息都是由相同的協調流程執行個體所接收，BizTalk Server 會偵測這種可能存在的競爭情形，並將這些訊息視為一個群組。</span><span class="sxs-lookup"><span data-stu-id="4bd38-107">To ensure that all of the correlated messages are received by the same orchestration instance, BizTalk Server detects the potential for such a race condition and treats these messages as a convoy.</span></span> <span data-ttu-id="4bd38-108">在登錄過程中，執行階段會建立一般訂閱，並將其認定為群組的一部分。</span><span class="sxs-lookup"><span data-stu-id="4bd38-108">At enlistment, the runtime creates a general subscription and identifies it as part of a convoy.</span></span> <span data-ttu-id="4bd38-109">填寫該訂閱後，傳訊引擎便根據預先定義的相互關聯屬性值建立暫時訂閱。</span><span class="sxs-lookup"><span data-stu-id="4bd38-109">After filling this subscription, the messaging engine creates a temporary subscription based on the values in the predefined correlation properties.</span></span> <span data-ttu-id="4bd38-110">這個暫時訂閱就叫做*隊組*。</span><span class="sxs-lookup"><span data-stu-id="4bd38-110">This temporary subscription is called a *convoy set*.</span></span> <span data-ttu-id="4bd38-111">群組集是在群組中使用的一組相互關聯集。</span><span class="sxs-lookup"><span data-stu-id="4bd38-111">A convoy set is a group of correlation sets that are used in a convoy.</span></span> <span data-ttu-id="4bd38-112">所有符合一般訂閱的後續訊息都是對照群組集評估而得，那些符合的訊息會路由傳送至現有的連接埠。</span><span class="sxs-lookup"><span data-stu-id="4bd38-112">All subsequent messages that match the general subscription are evaluated against the convoy set, and those that match are routed to an existing port.</span></span>  
  
## <a name="using-convoys-with-business-processes"></a><span data-ttu-id="4bd38-113">搭配商務程序使用群組</span><span class="sxs-lookup"><span data-stu-id="4bd38-113">Using Convoys with Business Processes</span></span>  
 <span data-ttu-id="4bd38-114">搭配商務程序使用群組處理時，請考慮下列事項：</span><span class="sxs-lookup"><span data-stu-id="4bd38-114">Consider the following when using convoy processing with a business process:</span></span>  
  
-   <span data-ttu-id="4bd38-115">A*相互關聯集*是一份您使用將訊息路由至特定商務程序的特定值的屬性。</span><span class="sxs-lookup"><span data-stu-id="4bd38-115">A *correlation set* is a list of properties with specific values that you use to route messages to a specific business process.</span></span> <span data-ttu-id="4bd38-116">相互關聯集上使用**接收**圖形不能包含三個以上用於相互關聯的屬性。</span><span class="sxs-lookup"><span data-stu-id="4bd38-116">The correlation set used on a **Receive** shape cannot contain more than three properties used for correlation.</span></span> <span data-ttu-id="4bd38-117">原因是這些值是在資料庫層級上識別和儲存的，而此層級最多只支援三個參數。</span><span class="sxs-lookup"><span data-stu-id="4bd38-117">This is because these values are identified and stored at the database level, which supports a maximum of three parameters.</span></span>  
  
-   <span data-ttu-id="4bd38-118">平行和循序群組可以並存於相同的商務程序，但無法彼此共用任何相互關聯集。</span><span class="sxs-lookup"><span data-stu-id="4bd38-118">Parallel and sequential convoys can coexist in the same business process, but they cannot share any correlation sets with each other.</span></span> <span data-ttu-id="4bd38-119">這是因為每一個相互關聯集只能屬於一個群組。</span><span class="sxs-lookup"><span data-stu-id="4bd38-119">This is because each correlation set can belong to only one convoy.</span></span>  
  
-   <span data-ttu-id="4bd38-120">BizTalk Server 不支援群組處理，當您使用**啟動協調流程**圖形以便將傳遞已經初始化的相互關聯到新的協調流程設定。</span><span class="sxs-lookup"><span data-stu-id="4bd38-120">BizTalk Server does not support convoy processing when you use the **Start Orchestration** shape to pass an already-initialized correlation set into a new orchestration.</span></span> <span data-ttu-id="4bd38-121">這是因為群組集已在資料庫層級經過處理，與已經在執行中的協調流程執行個體無關。</span><span class="sxs-lookup"><span data-stu-id="4bd38-121">This is because convoy sets are handled at the database level, independent of already-running orchestration instances.</span></span>  
  
-   <span data-ttu-id="4bd38-122">您無法使用單一**接收**圖形來初始化兩個或多個將用於不同群組中的相互關聯集。</span><span class="sxs-lookup"><span data-stu-id="4bd38-122">You cannot use a single **Receive** shape to initialize two or more correlation sets that will be used in separate convoys.</span></span> <span data-ttu-id="4bd38-123">例如，假設「接收 r1」初始化第一個群組的相互關聯集 c1 和 c2，「接收 r2」沿用 c1 後成為第二個群組，然後「接收 r3」沿用 c2 後成為第三個群組。</span><span class="sxs-lookup"><span data-stu-id="4bd38-123">For example, suppose that receive r1 initializes correlation sets c1 and c2 for the first convoy, receive r2 follows c1 for the second convoy, and receive r3 follows c2 for the third convoy.</span></span> <span data-ttu-id="4bd38-124">第二個群組的預定群組集是 c1、r2，而第三個群組的預定群組集是 c2、r3，都是由 r1 初始化的。</span><span class="sxs-lookup"><span data-stu-id="4bd38-124">The intended convoy sets for the second convoy are c1, r2 and the intended convoy sets for the third convoy are c2, r3, which are all initialized by r1.</span></span> <span data-ttu-id="4bd38-125">在這種情況下，協調流程引擎不會將這些訊息視為群組。</span><span class="sxs-lookup"><span data-stu-id="4bd38-125">In this case, the orchestration engine will not treat these as convoys.</span></span> <span data-ttu-id="4bd38-126">如果 r2 和 r3 兩者，都沿用 c1 和 c2 (c1、r2、r3 和 c2、r2、r3)；都只沿用 c1 (c1、r2、r3)；或者都只沿用 c2 (c2、r2、r3)，則此範例即為有效的群組實例。</span><span class="sxs-lookup"><span data-stu-id="4bd38-126">The example is a valid convoy scenario if both r2 and r3 follow both c1 and c2 (c1, r2, r3 and c2, r2, r3), both follow c1 only (c1, r2, r3), or both follow c2 only (c2, r2, r3).</span></span>  
  
## <a name="zombies"></a><span data-ttu-id="4bd38-127">Zombie</span><span class="sxs-lookup"><span data-stu-id="4bd38-127">Zombies</span></span>  
 <span data-ttu-id="4bd38-128">使用群組可能產生所謂 Zombie 的「遺失」訊息。</span><span class="sxs-lookup"><span data-stu-id="4bd38-128">The use of convoys can result in "lost" messages called zombies.</span></span> <span data-ttu-id="4bd38-129">當執行中協調流程內之非啟動中的接收訂閱符合 MessageBox 資料庫中的訊息時，MessageBox 便會將該訊息傳送到協調流程。</span><span class="sxs-lookup"><span data-stu-id="4bd38-129">When a non-activating receive subscription in a running orchestration matches a message in the MessageBox database, then the MessageBox delivers the message to the orchestration.</span></span> <span data-ttu-id="4bd38-130">因為 MessageBox 並不瞭解協調流程內部的商務邏輯，它只是一律將所有符合訂閱範圍的訊息傳送給協調流程。</span><span class="sxs-lookup"><span data-stu-id="4bd38-130">Because the MessageBox does not know the business logic inside the orchestration, it simply delivers to the orchestration all the messages that match the subscription.</span></span> <span data-ttu-id="4bd38-131">如果這些訊息中有任何訊息錯過協調流程執行流程中、可以取用訊息的接收訂閱期間，那麼這個訊息就會成為 Zombie。</span><span class="sxs-lookup"><span data-stu-id="4bd38-131">If any of these messages are delivered when the orchestration execution flow has passed the receive subscriptions that can consume the messages, then such messages become zombies.</span></span>  
  
 <span data-ttu-id="4bd38-132">這裡試舉一個產生 Zombie 的狀況當做範例：在反覆 17 次的迴圈內有一個接收，但在迴圈反覆期間傳送了 18 個符合接收訂閱的訊息</span><span class="sxs-lookup"><span data-stu-id="4bd38-132">An example of a situation that creates zombies is a receive inside a loop that iterates 17 times, but 18 messages are delivered that match the receive subscription in the loop.</span></span> <span data-ttu-id="4bd38-133">(MessageBox 不知道協調流程的邏輯只處理 17 個訊息)。協調流程沒有取用傳送的第 18 個訊息，因為執行流程已經結束迴圈。</span><span class="sxs-lookup"><span data-stu-id="4bd38-133">(The MessageBox does not know that the orchestration logic only handles 17 messages.) The 18th message delivered is not consumed by the orchestration because execution flow has already exited the loop.</span></span> <span data-ttu-id="4bd38-134">協調流程已完成，但有捨棄的訊息 (Zombie)，而這些訊息是不可繼續處理的，因為協調流程執行個體已經完成。</span><span class="sxs-lookup"><span data-stu-id="4bd38-134">The orchestration is completed with discarded messages (zombies), which are not resumable because the orchestration instance has already completed.</span></span>  
  
 <span data-ttu-id="4bd38-135">您可以管理 Zombie，方法是使用 Windows Management Instrumentation (WMI) 指令碼，查詢狀態為「擱置 (不可繼續)」的執行個體。</span><span class="sxs-lookup"><span data-stu-id="4bd38-135">You can manage zombies by using a Windows Management Instrumentation (WMI) script to query the instances with the "Suspended-NonResumable" state.</span></span> <span data-ttu-id="4bd38-136">傳訊引擎也會另外將錯誤訊息「完成並有捨棄的訊息」寫入事件日誌。</span><span class="sxs-lookup"><span data-stu-id="4bd38-136">In addition, the messaging engine writes an error message, "Completed with discarded messages", to the event log.</span></span>  
  
 <span data-ttu-id="4bd38-137">此外，如果您的循序群組中有長時間執行的交易式範圍，而該範圍還有逾時設定，則某些協調流程執行個體可能會以「擱置 (不可繼續)」狀態結束。</span><span class="sxs-lookup"><span data-stu-id="4bd38-137">Moreover, if you have a sequential convoy with a long-running transactional scope, and the scope has a time-out setting, some orchestration instances may end up in the "Suspended-NonResumable" state.</span></span> <span data-ttu-id="4bd38-138">您可能也會發現，輸出訊息數加上「擱置 (不可繼續)」執行個體數，小於輸入訊息數。</span><span class="sxs-lookup"><span data-stu-id="4bd38-138">You may also notice that the number of output messages plus the number of "Suspended-NonResumable" instances is less than the number of input messages.</span></span> <span data-ttu-id="4bd38-139">這是依據設計的行為。</span><span class="sxs-lookup"><span data-stu-id="4bd38-139">This behavior is by design.</span></span> <span data-ttu-id="4bd38-140">當逾時例外狀況發生時，程式碼執行流程會進入例外狀況處理常式。</span><span class="sxs-lookup"><span data-stu-id="4bd38-140">When a time-out exception happens, the code goes into the exception handler.</span></span> <span data-ttu-id="4bd38-141">BizTalk Server 會呼叫例外狀況處理常式，交由它來處理例外狀況，包括處理 Zombie。</span><span class="sxs-lookup"><span data-stu-id="4bd38-141">BizTalk Server calls the exception handler to let it handle the exception, including handling the zombies.</span></span> <span data-ttu-id="4bd38-142">您可以在例外狀況處理常式中使用傳送埠，將 Zombie 傳送至某個目的地，進一步加以檢視和處理。</span><span class="sxs-lookup"><span data-stu-id="4bd38-142">You can use a send port in the exception handler to send the zombies to a destination for further review and processing.</span></span>  
  
 <span data-ttu-id="4bd38-143">群組以外的實例也可能產生 Zombie。</span><span class="sxs-lookup"><span data-stu-id="4bd38-143">Scenarios other than convoys can also generate zombies.</span></span> <span data-ttu-id="4bd38-144">例如，假設協調流程執行個體預期商務程序會送來一個回應訊息，但不知何故，卻收到兩個符合訂閱的回應訊息。</span><span class="sxs-lookup"><span data-stu-id="4bd38-144">For example, suppose that an orchestration instance is expecting one response message from a business process, and for some reason, it receives two matching subscription response messages.</span></span> <span data-ttu-id="4bd38-145">在這種情況下，第二個回應訊息便會成為 Zombie。</span><span class="sxs-lookup"><span data-stu-id="4bd38-145">In this case, the second response message becomes a zombie.</span></span> <span data-ttu-id="4bd38-146">另一個範例是當您有**接聽**圖形**接收**圖形在一個分支和**延遲**圖形在其他分支。</span><span class="sxs-lookup"><span data-stu-id="4bd38-146">Another example is when you have a **Listen** shape with a **Receive** shape at one branch and a **Delay** shape at the other branch.</span></span> <span data-ttu-id="4bd38-147">如果訊息在逾時狀況發生當時抵達，則此訊息會變成 Zombie。</span><span class="sxs-lookup"><span data-stu-id="4bd38-147">If a message arrives at the same time that the time-out occurs, the message becomes a zombie.</span></span>  
  
 <span data-ttu-id="4bd38-148">如需如何管理 zombie 的詳細資訊，請參閱**移除已擱置服務執行個體** [!INCLUDE[ui-guidance-developers-reference](../includes/ui-guidance-developers-reference.md)]。</span><span class="sxs-lookup"><span data-stu-id="4bd38-148">For more information about how to manage zombies, see **Removing Suspended Service Instances** [!INCLUDE[ui-guidance-developers-reference](../includes/ui-guidance-developers-reference.md)].</span></span>
  
## <a name="next-steps"></a><span data-ttu-id="4bd38-149">後續的步驟</span><span class="sxs-lookup"><span data-stu-id="4bd38-149">Next steps</span></span>
 [<span data-ttu-id="4bd38-150">循序群組</span><span class="sxs-lookup"><span data-stu-id="4bd38-150">Sequential Convoys</span></span>](../core/sequential-convoys.md)  
  
 [<span data-ttu-id="4bd38-151">平行群組</span><span class="sxs-lookup"><span data-stu-id="4bd38-151">Parallel Convoys</span></span>](../core/parallel-convoys.md)  
  
## <a name="see-also"></a><span data-ttu-id="4bd38-152">另請參閱</span><span class="sxs-lookup"><span data-stu-id="4bd38-152">See Also</span></span>  
 [<span data-ttu-id="4bd38-153">協調流程中使用的相互關聯</span><span class="sxs-lookup"><span data-stu-id="4bd38-153">Using Correlations in Orchestrations</span></span>](../core/using-correlations-in-orchestrations.md)