---
title: WCF 配接器 FAQ： 使用 WCF 服務 |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: befa2268-8a65-465f-8086-70a66808845e
caps.latest.revision: 5
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: f3dc7ae44fa6ef6722c0887f2c70a83f43d1bf5c
ms.sourcegitcommit: 266308ec5c6a9d8d80ff298ee6051b4843c5d626
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 06/27/2018
ms.locfileid: "36970047"
---
# <a name="wcf-adapter-faq-using-wcf-services"></a><span data-ttu-id="4e533-102">WCF 配接器 FAQ：使用 WCF 服務</span><span class="sxs-lookup"><span data-stu-id="4e533-102">WCF Adapter FAQ: Using WCF Services</span></span>
## <a name="how-does-biztalk-server-use-its-wcf-adapters-to-access-wcf-services"></a><span data-ttu-id="4e533-103">BizTalk Server 如何使用其 WCF 配接器存取 WCF 服務</span><span class="sxs-lookup"><span data-stu-id="4e533-103">How does BizTalk Server use its WCF adapters to access WCF services?</span></span>  
 <span data-ttu-id="4e533-104">在 BizTalk Server 中，BizTalk WCF 配接器是透過 WCF 接收位置或傳送埠設定。</span><span class="sxs-lookup"><span data-stu-id="4e533-104">BizTalk WCF adapters are configured in BizTalk Server through either a WCF receive location or a send port.</span></span> <span data-ttu-id="4e533-105">啟用使用 WCF 配接器的接收位置時，會針對每個接受位置產生並初始化單一 ServiceHost 執行個體。</span><span class="sxs-lookup"><span data-stu-id="4e533-105">When a receive location using a WCF adapter is enabled, a single ServiceHost instance is instantiated and initialized for each receive location.</span></span> <span data-ttu-id="4e533-106">ServiceHost 執行一般的服務，可接受內送 WCF 訊息，並將它們轉換成 BizTalk 訊息中，再將它們發佈至 BizTalk MessageBox 資料庫。</span><span class="sxs-lookup"><span data-stu-id="4e533-106">The ServiceHost runs a generic service that accepts incoming WCF messages, and converts them to BizTalk messages before publishing them to the BizTalk MessageBox database.</span></span> <span data-ttu-id="4e533-107">一般的 ServiceHost 服務是內部 WCF BizTalk 接收配接器實作並公開無類型合約。</span><span class="sxs-lookup"><span data-stu-id="4e533-107">The generic ServiceHost service is internal to the WCF BizTalk receive adapter implementation and exposes a typeless contract.</span></span> <span data-ttu-id="4e533-108">在 WCF 中，無類型合約所組成，採用單一參數的型別 WCF System.ServiceModel.Channel.Message 作業簽章。</span><span class="sxs-lookup"><span data-stu-id="4e533-108">In WCF, a typeless contract consists of operation signatures that take a single parameter of type WCF System.ServiceModel.Channel.Message.</span></span>  
  
 <span data-ttu-id="4e533-109">WCF 服務的作業應該標示為 IsOneWay = false，若要存取 BizTalk 傳送埠，即使沒有任何要傳回的資料。</span><span class="sxs-lookup"><span data-stu-id="4e533-109">The operation  of a WCF service should be marked as IsOneWay=false if they are to be accessed by a BizTalk send port even if there is no data to return.</span></span> <span data-ttu-id="4e533-110">用戶端合約上的作業應該要標註為 IsOneWay = false 和 ReplyAction ="\*"。</span><span class="sxs-lookup"><span data-stu-id="4e533-110">The operations on the client-side contract should be annotated with IsOneWay=false and ReplyAction=”\*”.</span></span>  <span data-ttu-id="4e533-111">此外應該標示為 IsOneWay 在從用戶端的所有呼叫 ="false"。</span><span class="sxs-lookup"><span data-stu-id="4e533-111">Additionally all calls from the client should be marked at IsOneWay=”false”.</span></span> <span data-ttu-id="4e533-112">雙向服務作業可能會傳回型別訊息的值。</span><span class="sxs-lookup"><span data-stu-id="4e533-112">A two-way service operation may return a value of type Message.</span></span> <span data-ttu-id="4e533-113">這個例外狀況使用 Wcf-netmsmq 配接器，因為它會執行將訊息張貼到 MSMQ 佇列的單向作業。</span><span class="sxs-lookup"><span data-stu-id="4e533-113">The exception to this is using the WCF-NetMsmq adapter since it executes a one-way operation that posts a message into an MSMQ queue.</span></span> <span data-ttu-id="4e533-114">在此情況下，傳送埠可以是單向和任何服務作業標示為 IsOneWay = true。</span><span class="sxs-lookup"><span data-stu-id="4e533-114">In this case the send port can be one-way and any service operation marked as IsOneWay=true.</span></span>  
  
 <span data-ttu-id="4e533-115">可能會造成一些混淆，您也可在 WCF 中定義的 isOneWay = false 的 OperationContract，實際上會傳回 void 的方法上。</span><span class="sxs-lookup"><span data-stu-id="4e533-115">It may be a little confusing that it is also possible in WCF to define an isOneWay=false OperationContract on a method that actually returns void.</span></span> <span data-ttu-id="4e533-116">在這種情況會實際將為您建立 WCF 執行階段在網路上傳回的訊息。</span><span class="sxs-lookup"><span data-stu-id="4e533-116">In such a situation there is actually a message returned on the wire created by the WCF runtime for you.</span></span>  
  
 <span data-ttu-id="4e533-117">BizTalk WCF 配接器進行這項功能使用。</span><span class="sxs-lookup"><span data-stu-id="4e533-117">The BizTalk WCF adapters make use of this feature.</span></span> <span data-ttu-id="4e533-118">當您指定單向 BizTalk 連接埠，實際取得 void 的方法為 isOneWay = false 內 WCF 配接器的實作。</span><span class="sxs-lookup"><span data-stu-id="4e533-118">When you specify a one-way BizTalk port you actually get a void method with isOneWay=false within the implementation of the WCF adapter.</span></span> <span data-ttu-id="4e533-119">重點是，BizTalk 單向連接埠，使用 HTTP 或 net.tcp，例如直接通道時將會實際對應到 isOneWay = false 的 OperationContract。</span><span class="sxs-lookup"><span data-stu-id="4e533-119">The point is that a BizTalk one-way port, when using a direct channel such as HTTP or net.tcp, will actually correspond to an isOneWay=false OperationContract.</span></span> <span data-ttu-id="4e533-120">已排入佇列的通道，例如 net.msmq 會不同，因為單向的 BizTalk 連接埠連線真的中斷了對談 isOneWay = true 的 OperationContract。</span><span class="sxs-lookup"><span data-stu-id="4e533-120">Queued channels such as net.msmq are different in that a one-way BizTalk port does happen to talk to an isOneWay=true OperationContract.</span></span> <span data-ttu-id="4e533-121">這種情況是不同的因為 WCF 發送器會使用通道一筆交易。</span><span class="sxs-lookup"><span data-stu-id="4e533-121">The situation is different because the WCF dispatcher is using a transaction against the channel.</span></span>  
  
## <a name="how-do-you-create-and-use-a-custom-binding-with-a-wcf-custom-adapter"></a><span data-ttu-id="4e533-122">您該如何建立及使用 WCF 自訂配接器的自訂繫結嗎？</span><span class="sxs-lookup"><span data-stu-id="4e533-122">How do you create and use a custom binding with a WCF custom adapter?</span></span>  
 <span data-ttu-id="4e533-123">WCF CustomBinding BindingElements 集合所組成。</span><span class="sxs-lookup"><span data-stu-id="4e533-123">A WCF CustomBinding consists of a collection of BindingElements.</span></span> <span data-ttu-id="4e533-124">CustomBinding 可以藉由一起提取預先存在的 BindingElements （例如，結合既有的傳輸與從其他來源的預先存在的編碼器） 建立。</span><span class="sxs-lookup"><span data-stu-id="4e533-124">A CustomBinding can be created by pulling together pre-existing BindingElements (for example, combining a pre-existing Transport with a pre-existing Encoder from another source).</span></span> <span data-ttu-id="4e533-125">或者，可以藉由組合預先存在的 BindingElement 與新寫入的自訂 BindingElement 建立。</span><span class="sxs-lookup"><span data-stu-id="4e533-125">Or it can be created by combining a pre-existing BindingElement with a newly written custom BindingElement.</span></span> <span data-ttu-id="4e533-126">在程式碼中 CustomBinding 可以建立從這些元件 BindingElements 以程式設計方式加入它們。</span><span class="sxs-lookup"><span data-stu-id="4e533-126">In code a CustomBinding can be built from these component BindingElements by adding them programmatically.</span></span> <span data-ttu-id="4e533-127">此外，WCF 也可讓透過.NET 組態 （組態檔） 的這個建構。</span><span class="sxs-lookup"><span data-stu-id="4e533-127">WCF also allows this construction through .NET Configuration (config files).</span></span> <span data-ttu-id="4e533-128">使用 BizTalk Server 可以透過 BizTalk WCF 自訂配接器建立此 CustomBinding。</span><span class="sxs-lookup"><span data-stu-id="4e533-128">By using BizTalk Server this CustomBinding can be created through the BizTalk WCF Custom adapter.</span></span>  
  
 <span data-ttu-id="4e533-129">BizTalk WCF 自訂配接器不僅可讓您從 BindingElements 建置新的繫結，也可讓您設定的新繫結直接。</span><span class="sxs-lookup"><span data-stu-id="4e533-129">The BizTalk WCF Custom adapter not only allows you to build a new binding from BindingElements but also lets you configure a new binding directly.</span></span> <span data-ttu-id="4e533-130">它也可讓您設定標準繫結上的行為。</span><span class="sxs-lookup"><span data-stu-id="4e533-130">It also allows you to configure behaviors on standard bindings.</span></span> <span data-ttu-id="4e533-131">這是特別有用，因為比起撰寫新的 BindingElements 物件更容易撰寫自訂行為。</span><span class="sxs-lookup"><span data-stu-id="4e533-131">This is particularly useful because writing custom behaviors is much easier than writing new BindingElements objects.</span></span>  
  
 <span data-ttu-id="4e533-132">建立 BindingElement 是所涉及的開發活動，而其參考的最佳資源來源是超連結的 WCF 範例 」<http://go.microsoft.com/fwlink/?LinkId=142449>"\t"_blank" http://go.microsoft.com/fwlink/?LinkId=142449。</span><span class="sxs-lookup"><span data-stu-id="4e533-132">Building a BindingElement is an involved development exercise and the best source of reference for it is the WCF samples at  HYPERLINK "<http://go.microsoft.com/fwlink/?LinkId=142449>" \t "_blank" http://go.microsoft.com/fwlink/?LinkId=142449.</span></span> <span data-ttu-id="4e533-133">若要建立自訂 BindingElement，您會建立衍生自 BindingElement 類別。</span><span class="sxs-lookup"><span data-stu-id="4e533-133">To create a custom BindingElement you create a class that derives from BindingElement.</span></span> <span data-ttu-id="4e533-134">新的 BindingElement 將必須在新的組件中。</span><span class="sxs-lookup"><span data-stu-id="4e533-134">A new BindingElement will have to be in a new assembly.</span></span> <span data-ttu-id="4e533-135">這個組件必須安裝到全域組件快取 (GAC) 所在之 BizTalk 主控件中，傳送埠和接收位置的管理電腦的設定。</span><span class="sxs-lookup"><span data-stu-id="4e533-135">This assembly must be installed into the Global Assembly Cache (GAC) of the administration computer where the BizTalk Host, send port, and receive location are configured.</span></span> <span data-ttu-id="4e533-136">若要自訂繫結相關聯的特定傳送埠或接收位置，您必須先將它新增至\<bindingElementExtensions\>的同一部電腦上的 machine.config 檔案的區段。</span><span class="sxs-lookup"><span data-stu-id="4e533-136">To associate a custom binding with a specific send port or receive location, you first need to add it to the \<bindingElementExtensions\> section of the machine.config file on the same computer.</span></span>  
  
 <span data-ttu-id="4e533-137">之後您再啟動該變更**傳輸內容設定**設定的繫結 對話方塊。</span><span class="sxs-lookup"><span data-stu-id="4e533-137">After making that change you can then bring up the **Transport Properties Configuration** dialog box to configure the binding.</span></span>  
  
1. <span data-ttu-id="4e533-138">在 **繫結**索引標籤的 繫結類型，選取**customBinding**。</span><span class="sxs-lookup"><span data-stu-id="4e533-138">On the **Binding** tab, for Binding type, select **customBinding**.</span></span>  
  
2. <span data-ttu-id="4e533-139">在**繫結**窗格中，以滑鼠右鍵按一下**CustomBindingElement**，然後選取**加入延伸模組**。</span><span class="sxs-lookup"><span data-stu-id="4e533-139">In the **Binding** pane, right-click **CustomBindingElement**, and select **Add Extension**.</span></span>  
  
3. <span data-ttu-id="4e533-140">選取您在 machine.config 檔案中指定的繫結項目，並視需要設定繫結。</span><span class="sxs-lookup"><span data-stu-id="4e533-140">Select the binding element you specified in the machine.config file and configure the binding as required.</span></span> <span data-ttu-id="4e533-141">您現可供使用的訊息傳輸或接收。</span><span class="sxs-lookup"><span data-stu-id="4e533-141">It is now ready to use for message transmission or receipt.</span></span>  
  
   <span data-ttu-id="4e533-142">以這種方式新增時，BizTalk 就會執行非常有限的驗證，自訂繫結。</span><span class="sxs-lookup"><span data-stu-id="4e533-142">BizTalk does very limited validation for a custom binding when it has been added in this manner.</span></span> <span data-ttu-id="4e533-143">因此，務必確認繫結項目會列在正確的順序。</span><span class="sxs-lookup"><span data-stu-id="4e533-143">Therefore, it is important to ensure the binding elements are listed in the correct order.</span></span> <span data-ttu-id="4e533-144">您想在執行階段的第一次叫用的繫結元素必須位於底部的 CustomBindingElement 繫結樹狀目錄中，在對話方塊中。</span><span class="sxs-lookup"><span data-stu-id="4e533-144">The binding element you want invoked first at runtime must be on the bottom of the CustomBindingElement binding tree in the dialog box.</span></span> <span data-ttu-id="4e533-145">BindingElements 的清單必須包含傳輸和該傳輸必須位於清單底部。</span><span class="sxs-lookup"><span data-stu-id="4e533-145">The list of BindingElements must contain a Transport and that Transport must be at the bottom of the list.</span></span> <span data-ttu-id="4e533-146">BindingElements 集合也可能包含編碼器。</span><span class="sxs-lookup"><span data-stu-id="4e533-146">The set of BindingElements may also contain an Encoder.</span></span> <span data-ttu-id="4e533-147">如需詳細資訊，請參閱 WCF 文件上繫結項目在[ http://go.microsoft.com/fwlink/?LinkId=142449 ](http://go.microsoft.com/fwlink/?LinkId=142449)。</span><span class="sxs-lookup"><span data-stu-id="4e533-147">For more information, see the WCF documentation on binding elements at [http://go.microsoft.com/fwlink/?LinkId=142449](http://go.microsoft.com/fwlink/?LinkId=142449).</span></span>  
  
## <a name="what-is-a-wcf-custom-behavior-and-how-do-i-use-one-with-biztalk-server"></a><span data-ttu-id="4e533-148">什麼是 WCF 自訂行為，以及如何使用一個 BizTalk Server？</span><span class="sxs-lookup"><span data-stu-id="4e533-148">What is a WCF custom behavior and how do I use one with BizTalk Server?</span></span>  
 <span data-ttu-id="4e533-149">使用 WCF 做為訊息的通訊機制的優點之一是使用自訂程式碼來擴充其服務的功能的機會。</span><span class="sxs-lookup"><span data-stu-id="4e533-149">One of the advantages of using WCF as a message communication mechanism is the opportunity to extend the functionality of its services by using custom code.</span></span> <span data-ttu-id="4e533-150">自訂行為延伸模組是其中一個 WCF 區別市場中其他 Web 服務技術的功能。</span><span class="sxs-lookup"><span data-stu-id="4e533-150">Custom behavior extensions are one of the features that differentiate WCF from other Web services technologies in the market.</span></span>  
  
 <span data-ttu-id="4e533-151">有不同的點，來攔截和執行自訂處理的訊息抵達其最終目的地之前 WCF 訊息的流程中。</span><span class="sxs-lookup"><span data-stu-id="4e533-151">There are different points within the flow of a WCF message to intercept and execute custom processing before a message reaches its final destination.</span></span> <span data-ttu-id="4e533-152">WCF 自訂行為延伸模組是一種這類類型的攔截機制，而且可用來擴充 WCF 服務或用戶端功能，在不同的層級的資料粒度。</span><span class="sxs-lookup"><span data-stu-id="4e533-152">WCF custom behavior extensions are one such type of interception mechanism and can be used to extend WCF service or client functionality at different levels of granularity.</span></span> <span data-ttu-id="4e533-153">自訂行為延伸模組可存在於這兩個 WCF 服務和用戶端層級。</span><span class="sxs-lookup"><span data-stu-id="4e533-153">Custom behavior extensions can exist at both the WCF service and client levels.</span></span> <span data-ttu-id="4e533-154">設定 WCF 服務的呼叫堆疊上的行為並不會影響用來進行呼叫的通訊繫結上。</span><span class="sxs-lookup"><span data-stu-id="4e533-154">Configuring a behavior on the call stack to a WCF service has no influence on the communication binding used to make the call.</span></span> <span data-ttu-id="4e533-155">事實上，行為是用戶端通常不會看到它，因為它們不會顯示在服務發行中繼資料。</span><span class="sxs-lookup"><span data-stu-id="4e533-155">In fact, behaviors are typically invisible to the client because they are not displayed in the metadata a service publishes.</span></span> <span data-ttu-id="4e533-156">用戶端通常會有 WCF 作業呼叫期間執行的行為不知道。</span><span class="sxs-lookup"><span data-stu-id="4e533-156">The client typically has no idea that the behaviors are executing during a call to a WCF operation.</span></span>  
  
 <span data-ttu-id="4e533-157">輕鬆實作自訂中呼叫 WCF 服務的處理能力是通訊的 WCF 為何這類的豐富程式設計典範相較於其他的 Web 應用程式之間方法的主要原因之一。</span><span class="sxs-lookup"><span data-stu-id="4e533-157">The ability to easily implement custom processing in a call to a WCF service is one of the main reasons why WCF is such a rich programming paradigm compared to other ways of communication between Web applications.</span></span> <span data-ttu-id="4e533-158">這個自訂的處理可能需要幾乎所有形式，即會依照在 Web 應用程式的擴充性需求。</span><span class="sxs-lookup"><span data-stu-id="4e533-158">This custom processing can take almost any form as dictated by extensibility requirements within a Web application.</span></span> <span data-ttu-id="4e533-159">開發人員可以建立自訂的延伸模組，檢查及驗證服務組態或修改在 WCF 用戶端和服務應用程式的執行階段行為。</span><span class="sxs-lookup"><span data-stu-id="4e533-159">Developers can create custom extensions that inspect and validate service configuration or modify runtime behavior in WCF client and service applications.</span></span> <span data-ttu-id="4e533-160">行為可以補充一般的訊息處理、 在處理期間修改訊息、 繁複特定設定的準則和採取適當的動作、 驗證呼叫端的身分識別和是否成功等傳遞訊息。因為它真的是自訂的處理機制實作任何擴充性應用程式需要。</span><span class="sxs-lookup"><span data-stu-id="4e533-160">Behaviors can supplement normal message processing, modify the message during processing, scrutinize certain configuration criteria and take appropriate action, validate identities of the caller and pass the message on if it is successful, etc. Because it is truly a custom processing mechanism you implement whatever extensibility your application needs.</span></span>  
  
 <span data-ttu-id="4e533-161">若要使用 BizTalk Server 中的 WCF 自訂行為您會設定使用它**行為**Wcf-custom 或 Wcf-customisolated 配接器的接收位置或傳送埠 索引標籤。</span><span class="sxs-lookup"><span data-stu-id="4e533-161">To use a WCF custom behavior in BizTalk Server you will configure it by using the **Behavior** tab for the WCF-Custom or WCF-CustomIsolated adapter for a receive location or a send port.</span></span>