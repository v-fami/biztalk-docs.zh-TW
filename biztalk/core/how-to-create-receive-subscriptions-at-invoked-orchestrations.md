---
title: 如何建立接收端叫用的協調流程訂閱 |Microsoft 文件
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: 3423309a-cb5a-40a5-9582-6ee3ac82b538
caps.latest.revision: 9
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: c419101aa16c23f5fd8a644c0fe33f269d06d6ba
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 09/20/2017
ms.locfileid: "22250142"
---
# <a name="how-to-create-receive-subscriptions-at-invoked-orchestrations"></a><span data-ttu-id="be104-102">如何在叫用的協調流程建立接收訂閱</span><span class="sxs-lookup"><span data-stu-id="be104-102">How to Create Receive Subscriptions at Invoked Orchestrations</span></span>
<span data-ttu-id="be104-103">雖然您可以將訊息傳遞做為參數透過**啟動協調流程**當您啟動協調流程，在某些情況下，您可能想要從呼叫端協調流程傳送訊息至之後叫用的協調流程圖形引動過程。</span><span class="sxs-lookup"><span data-stu-id="be104-103">Although you can pass messages as parameters through the **Start Orchestration** shape when you start an orchestration, in some scenarios you may want to send messages from the caller orchestration to the invoked orchestration after the invocation.</span></span> <span data-ttu-id="be104-104">例如，您可能不知道會在叫用時傳遞何種訊息，或者其他協調流程可能需要動態地將訊息傳送到叫用的協調流程。</span><span class="sxs-lookup"><span data-stu-id="be104-104">For example, you may not know what messages you want to pass at the time of invocation, or other orchestrations may need to send messages to the invoked orchestration dynamically.</span></span>  
  
 <span data-ttu-id="be104-105">將訊息傳送到叫用之協調流程的方式，就是以相互關聯進行傳遞，讓叫用的協調流程可以建立由相互關聯協助定義的訂閱，然後再使用該訂閱來接收訊息。</span><span class="sxs-lookup"><span data-stu-id="be104-105">The way to send a message to an invoked orchestration is to pass in a correlation so that the invoked orchestration can create the subscription that the correlation helps define and then receive the message by using that subscription.</span></span> <span data-ttu-id="be104-106">然而，您不能只傳入相互關聯便期待叫用的協調流程會根據相互關聯建立訂閱，並可接收訂閱的訊息。</span><span class="sxs-lookup"><span data-stu-id="be104-106">However, you cannot simply pass in a correlation and expect the invoked orchestration to create the subscription based on the correlation and receive a message on the subscription.</span></span> <span data-ttu-id="be104-107">如果您使用該方法，您從呼叫端協調流程傳送到叫用之協調流程的訊息便會造成「無法路由已發佈的訊息，因為找不到訂閱者」錯誤。</span><span class="sxs-lookup"><span data-stu-id="be104-107">If you use that approach, the messages you send from the caller orchestration to the invoked orchestration will result in the error, "The published message could not be routed because no subscribers were found."</span></span> <span data-ttu-id="be104-108">這是因為下列各項：</span><span class="sxs-lookup"><span data-stu-id="be104-108">This is because of the following:</span></span>  
  
-   <span data-ttu-id="be104-109">在叫用的協調流程中出現競爭條件。</span><span class="sxs-lookup"><span data-stu-id="be104-109">There is a race condition in the invoked orchestration.</span></span>  
  
-   <span data-ttu-id="be104-110">叫用的協調流程沒有認可點將訂閱傳送到 MessageBox 資料庫以進行路由，因此無法接收訊息。</span><span class="sxs-lookup"><span data-stu-id="be104-110">There is no commit point for the invoked orchestration to send the subscription to the MessageBox database for routing so that it can receive the messages.</span></span>  
  
 <span data-ttu-id="be104-111">解決此問題的方式之一是執行下列步驟：</span><span class="sxs-lookup"><span data-stu-id="be104-111">A way to resolve this problem is to perform the following steps:</span></span>  
  
1.  <span data-ttu-id="be104-112">在呼叫端協調流程中，擁有啟動接收以接收訊息。</span><span class="sxs-lookup"><span data-stu-id="be104-112">In the caller orchestration, you have an activate receive to receive the message.</span></span> <span data-ttu-id="be104-113">您會在呼叫端協調流程收到訊息，初始化相互關聯集，然後將傳遞相互關聯集及自我相互關聯的接收直接繫結連接埠通過之後**啟動協調流程**圖形。</span><span class="sxs-lookup"><span data-stu-id="be104-113">After you receive the message in the caller orchestration, initialize the correlation set, and then pass the correlation set and a self-correlating receive direct-bound port through the **Start Orchestration** shape.</span></span> <span data-ttu-id="be104-114">您所傳入的連接埠會成為叫用之協調流程中的傳送埠，而且您將使用該傳送埠傳回訊息，以便與呼叫端協調流程同步。</span><span class="sxs-lookup"><span data-stu-id="be104-114">The port that you pass in becomes a send port in the invoked orchestration, and you will use it to send the message back to synchronize with the caller orchestration.</span></span>  
  
2.  <span data-ttu-id="be104-115">在叫用的協調流程中，透過自我相互關聯的連接埠，將訊息傳回到呼叫端協調流程。</span><span class="sxs-lookup"><span data-stu-id="be104-115">In the invoked orchestration, send a message back to the caller orchestration through the self-correlating port.</span></span> <span data-ttu-id="be104-116">與呼叫端協調流程達成的同步可避免競爭條件，並能在叫用的協調流程中建立要進行路由之 MessageBox 的接收訂閱時提供認可點。</span><span class="sxs-lookup"><span data-stu-id="be104-116">This synchronizes with the caller orchestration to prevent race conditions and to provide a commit point while creating the receive subscription to the MessageBox for routing in the invoked orchestration.</span></span>  
  
3.  <span data-ttu-id="be104-117">呼叫端協調流程會透過自我相互關聯的連接埠接收訊息，並與叫用的協調流程同步。</span><span class="sxs-lookup"><span data-stu-id="be104-117">The caller orchestration receives the message through the self-correlating port and synchronizes with the invoked orchestration.</span></span> <span data-ttu-id="be104-118">請注意，自我相互關聯的連接埠接收並不需要相互關聯實行項目。</span><span class="sxs-lookup"><span data-stu-id="be104-118">Note that self-correlating port receives do not need correlation followers.</span></span> <span data-ttu-id="be104-119">現在，您可以從呼叫端協調流程將訊息安全地傳送到叫用的協調流程，而且叫用的協調流程會根據相互關聯接收訊息。</span><span class="sxs-lookup"><span data-stu-id="be104-119">You can now safely send messages from the caller orchestration to the invoked orchestration, and the invoked orchestration will receive the messages based upon the correlation.</span></span>  
  
 <span data-ttu-id="be104-120">儘管先前的方法可以達成目標，更好的方法卻是傳入訊息以初始化您要在其上接收的相互關聯。</span><span class="sxs-lookup"><span data-stu-id="be104-120">Although the preceding approach can achieve the goal, a better approach is to pass in the message that initializes the correlation on which you want to receive upon.</span></span> <span data-ttu-id="be104-121">當您透過自我相互關聯的連接埠，使呼叫端協調流程與叫用的協調流程同步時，我們建議您永遠傳入初始化相化關聯所需要的訊息。</span><span class="sxs-lookup"><span data-stu-id="be104-121">When you are synchronizing a caller orchestration with an invoked orchestration through a self-correlating port, we recommend that you always pass in the message that you need for initializing the correlations.</span></span> <span data-ttu-id="be104-122">下列步驟提供最可靠與最高效能的方法：</span><span class="sxs-lookup"><span data-stu-id="be104-122">The following steps provide the most reliable and highest-performance approach:</span></span>  
  
1.  <span data-ttu-id="be104-123">在呼叫端協調流程中，擁有啟動接收以接收訊息。</span><span class="sxs-lookup"><span data-stu-id="be104-123">In the caller orchestration, you have an activate receive to receive the message.</span></span> <span data-ttu-id="be104-124">您會收到訊息之後，傳遞訊息和自我相互關聯的接收直接繫結連接埠通過**啟動協調流程**圖形。</span><span class="sxs-lookup"><span data-stu-id="be104-124">After you receive the message, pass a message and a self-correlating receive direct-bound port through the **Start Orchestration** shape.</span></span> <span data-ttu-id="be104-125">您所傳入的訊息會在叫用的協調流程中用來初始化相互關聯。</span><span class="sxs-lookup"><span data-stu-id="be104-125">The message you pass in will be used to initialize the correlation in the invoked orchestration.</span></span> <span data-ttu-id="be104-126">您所傳入的連接埠會成為叫用之協調流程中的傳送埠，而且您將使用該傳送埠傳回訊息，以便與呼叫端協調流程同步。</span><span class="sxs-lookup"><span data-stu-id="be104-126">The port that you pass in becomes a send port in the invoked orchestration, and you will use it to send the message back to synchronize with the caller orchestration.</span></span>  
  
2.  <span data-ttu-id="be104-127">在叫用的協調流程中，初始化相互關聯，並將訊息傳回到呼叫端協調流程。</span><span class="sxs-lookup"><span data-stu-id="be104-127">In the invoked orchestration, initialize the correlation and send a message back to the caller orchestration.</span></span> <span data-ttu-id="be104-128">與呼叫端協調流程達成的同步可避免競爭條件，並能在叫用的協調流程中建立要進行路由之 MessageBox 的接收訂閱時提供認可點。</span><span class="sxs-lookup"><span data-stu-id="be104-128">This synchronizes with the caller orchestration to prevent race conditions and to provide a commit point while creating the receive subscription to the MessageBox for routing in the invoked orchestration.</span></span>  
  
3.  <span data-ttu-id="be104-129">呼叫端協調流程會透過自我相互關聯的連接埠接收訊息，並與叫用的協調流程同步。</span><span class="sxs-lookup"><span data-stu-id="be104-129">The caller orchestration receives the message through the self-correlating port and synchronizes with the invoked orchestration.</span></span> <span data-ttu-id="be104-130">請注意，自我相互關聯的連接埠接收並不需要相互關聯實行項目。</span><span class="sxs-lookup"><span data-stu-id="be104-130">Note that the self-correlating port receives do not need correlation followers.</span></span> <span data-ttu-id="be104-131">現在，您可以從呼叫端協調流程將訊息安全地傳送到叫用的協調流程，而且叫用的協調流程會根據相互關聯接收訊息。</span><span class="sxs-lookup"><span data-stu-id="be104-131">You can now safely send messages from the caller orchestration to the invoked orchestration, and the invoked orchestration will receive the messages based upon the correlation.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="be104-132">另請參閱</span><span class="sxs-lookup"><span data-stu-id="be104-132">See Also</span></span>  
 <span data-ttu-id="be104-133">[協調流程中使用的相互關聯](../core/using-correlations-in-orchestrations.md) </span><span class="sxs-lookup"><span data-stu-id="be104-133">[Using Correlations in Orchestrations](../core/using-correlations-in-orchestrations.md) </span></span>  
 [<span data-ttu-id="be104-134">如何使用自我相互關聯直接繫結連接埠</span><span class="sxs-lookup"><span data-stu-id="be104-134">How to Use Self-Correlating Direct Bound Ports</span></span>](../core/how-to-use-self-correlating-direct-bound-ports.md)