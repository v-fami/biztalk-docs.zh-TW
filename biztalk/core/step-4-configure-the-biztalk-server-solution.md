---
title: 步驟 4： 設定 BizTalk Server 解決方案 |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: d60e6a82-51af-41e5-a755-5f337492ba2f
caps.latest.revision: 4
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 4e65c3cf64045378b0f69b6980b98cdec88f175d
ms.sourcegitcommit: 266308ec5c6a9d8d80ff298ee6051b4843c5d626
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 06/27/2018
ms.locfileid: "37013879"
---
# <a name="step-4-configure-the-biztalk-server-solution"></a><span data-ttu-id="07e1d-102">步驟 4： 設定 BizTalk Server 解決方案</span><span class="sxs-lookup"><span data-stu-id="07e1d-102">Step 4: Configure the BizTalk Server Solution</span></span>
<span data-ttu-id="07e1d-103">在上一個步驟中，您需要建立並部署[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]應用程式以接收到的 Salesforce 通知[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]並插入內部部署 SQL Server 資料庫的詳細資料。</span><span class="sxs-lookup"><span data-stu-id="07e1d-103">In the previous step, you created and deployed a [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] application to receive Salesforce notification into [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] and insert the details into an on-premise SQL Server database.</span></span> <span data-ttu-id="07e1d-104">在此步驟中，我們將設定中的應用程式[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]管理主控台。</span><span class="sxs-lookup"><span data-stu-id="07e1d-104">In this step, we’ll configure the application in [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] Administration console.</span></span> <span data-ttu-id="07e1d-105">主要設定應用程式，牽涉到建立實體連接埠對應至我們在協調流程中建立的邏輯連接埠。</span><span class="sxs-lookup"><span data-stu-id="07e1d-105">Configuring the application primarily involves creating physical ports corresponding to the logical ports we created in the orchestration.</span></span> <span data-ttu-id="07e1d-106">它還包含繫結至邏輯連接埠的實體連接埠。</span><span class="sxs-lookup"><span data-stu-id="07e1d-106">It also involves binding the physical port to the logical ports.</span></span> <span data-ttu-id="07e1d-107">我們會執行下列步驟來設定[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]應用程式：</span><span class="sxs-lookup"><span data-stu-id="07e1d-107">We’ll perform the following steps to configure the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] application:</span></span>  
  
- <span data-ttu-id="07e1d-108">設定要求-回應 Wcf-basichttprelay 接收位置，以接收來自 Salesforce 商機通知。</span><span class="sxs-lookup"><span data-stu-id="07e1d-108">Configure a request-response WCF-BasicHttpRelay receive location to receive opportunity notifications from Salesforce.</span></span>  
  
- <span data-ttu-id="07e1d-109">設定要求-回應 Wcf-webhttp 傳送埠以傳送至 Salesforce 的查詢，擷取已接收的商機通知相關的產品詳細資料。</span><span class="sxs-lookup"><span data-stu-id="07e1d-109">Configure a request-response WCF-WebHttp send port to send query to Salesforce for retrieving product details related to the received opportunity notification.</span></span> <span data-ttu-id="07e1d-110">此傳送埠也會收到來自 Salesforce 的查詢回應。</span><span class="sxs-lookup"><span data-stu-id="07e1d-110">This send port also receives the query response from Salesforce.</span></span>  
  
- <span data-ttu-id="07e1d-111">設定要從 Salesforce 的查詢回應插入內部部署 SQL Server 資料庫的單向 WCF SQL 傳送埠。</span><span class="sxs-lookup"><span data-stu-id="07e1d-111">Configure a one-way WCF-SQL send port to insert the query response from Salesforce into an on-premise SQL Server database.</span></span>  
  
- <span data-ttu-id="07e1d-112">設定[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]應用程式的關聯中所建立的實體連接埠至協調流程中的邏輯連接埠[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]管理主控台。</span><span class="sxs-lookup"><span data-stu-id="07e1d-112">Configure the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] application by associating the logical port in the orchestration with the physical ports created in the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] Administration console.</span></span>  
  
### <a name="to-configure-the-wcf-basichttprelay-receive-location"></a><span data-ttu-id="07e1d-113">若要設定 Wcf-basichttprelay 接收位置</span><span class="sxs-lookup"><span data-stu-id="07e1d-113">To configure the WCF-BasicHttpRelay receive location</span></span>  
  
1. <span data-ttu-id="07e1d-114">開啟[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]管理主控台。</span><span class="sxs-lookup"><span data-stu-id="07e1d-114">Open the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] Administration console.</span></span> <span data-ttu-id="07e1d-115">展開 [應用程式] 節點，並尋找**SalesforceIntegration**應用程式。</span><span class="sxs-lookup"><span data-stu-id="07e1d-115">Expand the Applications node and look for the **SalesforceIntegration** application.</span></span> <span data-ttu-id="07e1d-116">您在部署時，會建立此應用程式[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]從 Visual Studio 的專案。</span><span class="sxs-lookup"><span data-stu-id="07e1d-116">This application is created when you deployed the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] project from Visual Studio.</span></span>  
  
2. <span data-ttu-id="07e1d-117">依序展開**SalesforceIntegration**應用程式，以滑鼠右鍵按一下**接收埠**，指向**新增**，然後按一下 **要求-回應接收埠**.</span><span class="sxs-lookup"><span data-stu-id="07e1d-117">Expand the **SalesforceIntegration** application, right-click **Receive Ports**, point to **New**, and then click **Request-Response Receive Port**.</span></span> <span data-ttu-id="07e1d-118">將連接埠名稱指定為`ReceiveOppNotification`，然後從左窗格中，按一下**接收位置**。</span><span class="sxs-lookup"><span data-stu-id="07e1d-118">Specify the port name as `ReceiveOppNotification` and from the left-pane, click **Receive Locations**.</span></span>  
  
3. <span data-ttu-id="07e1d-119">在 [接收位置屬性] 對話方塊中，指定下列值：</span><span class="sxs-lookup"><span data-stu-id="07e1d-119">In the Receive Location Properties dialog box, specify the following values:</span></span>  
  
   |||  
   |-|-|  
   |<span data-ttu-id="07e1d-120">[屬性]</span><span class="sxs-lookup"><span data-stu-id="07e1d-120">Name</span></span>|<span data-ttu-id="07e1d-121">輸入`ReceiveOppNotification`。</span><span class="sxs-lookup"><span data-stu-id="07e1d-121">Enter `ReceiveOppNotification`.</span></span>|  
   |<span data-ttu-id="07e1d-122">類型</span><span class="sxs-lookup"><span data-stu-id="07e1d-122">Type</span></span>|<span data-ttu-id="07e1d-123">選取**Wcf-basichttprelay**</span><span class="sxs-lookup"><span data-stu-id="07e1d-123">Select **WCF-BasicHttpRelay**</span></span>|  
   |<span data-ttu-id="07e1d-124">接收處理常式</span><span class="sxs-lookup"><span data-stu-id="07e1d-124">Receive Handler</span></span>|<span data-ttu-id="07e1d-125">選取**BizTalkServerApplication**</span><span class="sxs-lookup"><span data-stu-id="07e1d-125">Select **BizTalkServerApplication**</span></span>|  
   |<span data-ttu-id="07e1d-126">接收管線</span><span class="sxs-lookup"><span data-stu-id="07e1d-126">Receive Pipeline</span></span>|<span data-ttu-id="07e1d-127">選取**XMLReceive**</span><span class="sxs-lookup"><span data-stu-id="07e1d-127">Select **XMLReceive**</span></span>|  
   |<span data-ttu-id="07e1d-128">傳送管線</span><span class="sxs-lookup"><span data-stu-id="07e1d-128">Send Pipeline</span></span>|<span data-ttu-id="07e1d-129">選取**PassThruTransmit**</span><span class="sxs-lookup"><span data-stu-id="07e1d-129">Select **PassThruTransmit**</span></span>|  
  
    <span data-ttu-id="07e1d-130">按一下 **設定**針對連接埠類型。</span><span class="sxs-lookup"><span data-stu-id="07e1d-130">Click **Configure** against the port type.</span></span>  
  
4. <span data-ttu-id="07e1d-131">在 [Wcf-basichttprelay 傳輸屬性] 對話方塊中，指定下列值：</span><span class="sxs-lookup"><span data-stu-id="07e1d-131">In the WCF-BasicHttpRelay Transport Properties dialog box, specify the following values:</span></span>  
  
   1. <span data-ttu-id="07e1d-132">在 **一般**索引標籤上，如**位址 (URI)**，輸入`https://btssalesforce.servicebus.windows.net/notifications/opportunity`。</span><span class="sxs-lookup"><span data-stu-id="07e1d-132">On the **General** tab, for **Address (URI)**, enter `https://btssalesforce.servicebus.windows.net/notifications/opportunity`.</span></span> <span data-ttu-id="07e1d-133">在這裡， **btssalesforce**是您在中建立的命名空間[步驟 1： 建立服務匯流排命名空間](../core/step-1-create-a-service-bus-namespace.md)。</span><span class="sxs-lookup"><span data-stu-id="07e1d-133">Here, **btssalesforce** is namespace you created in [Step 1: Create a Service Bus Namespace](../core/step-1-create-a-service-bus-namespace.md).</span></span> <span data-ttu-id="07e1d-134">您可以指定以下是在 Salesforce 中建立工作流程時指定的相同 URL 的 URL[步驟 2： 設定 Salesforce 系統](../core/step-2-set-up-the-salesforce-system.md)。</span><span class="sxs-lookup"><span data-stu-id="07e1d-134">The URL you specify here is the same URL you specified while creating a workflow in Salesforce in [Step 2: Set up the Salesforce System](../core/step-2-set-up-the-salesforce-system.md).</span></span> <span data-ttu-id="07e1d-135">您設定工作流程中每次有機會的階段設為 Closed Won，Salesforce 會傳送通知至 URL *<https://btssalesforce.servicebus.windows.net/notifications/opportunity>*。</span><span class="sxs-lookup"><span data-stu-id="07e1d-135">You set up a workflow in which every time the stage of an opportunity is set to Closed Won, Salesforce sends a notification to the URL *<https://btssalesforce.servicebus.windows.net/notifications/opportunity>*.</span></span> <span data-ttu-id="07e1d-136">我們會指定相同的 URL 為屬於這個接收位置組態。</span><span class="sxs-lookup"><span data-stu-id="07e1d-136">We specify the same URL here as part of this receive location configuration.</span></span> <span data-ttu-id="07e1d-137">啟用接收位置時，會在 URL 所指定的轉送端點[!INCLUDE[winazure](../includes/winazure-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="07e1d-137">When the receive location is enabled, the relay endpoint specified by the URL is created in [!INCLUDE[winazure](../includes/winazure-md.md)].</span></span>  
  
   2. <span data-ttu-id="07e1d-138">在 **安全性**索引標籤上，指定下列項目：</span><span class="sxs-lookup"><span data-stu-id="07e1d-138">On the **Security** tab, specify the following:</span></span>  
  
      -   <span data-ttu-id="07e1d-139">針對**安全性模式**，選取**傳輸**至於**轉送用戶端驗證類型**，選取**無**。</span><span class="sxs-lookup"><span data-stu-id="07e1d-139">For **Security mode**, select **Transport** and for **Relay client authentication type**, select **None**.</span></span>  
  
      -   <span data-ttu-id="07e1d-140">選取 **啟用服務探索**核取方塊，以發佈中的服務行為[服務登錄](http://msdn.microsoft.com/library/windowsazure/dd582704.aspx)。</span><span class="sxs-lookup"><span data-stu-id="07e1d-140">Select the **Enable service discovery** check box to publish the service behavior in the [Service Registry](http://msdn.microsoft.com/library/windowsazure/dd582704.aspx).</span></span> <span data-ttu-id="07e1d-141">指定**顯示名稱**表示與服務發行至登錄的名稱。</span><span class="sxs-lookup"><span data-stu-id="07e1d-141">Specify the **Display name** which denotes the name with which the service is published to the registry.</span></span> <span data-ttu-id="07e1d-142">您可以設定**探索模式**至公用或私人。</span><span class="sxs-lookup"><span data-stu-id="07e1d-142">You can set the **Discovery mode** to public or private.</span></span> <span data-ttu-id="07e1d-143">本教學課程中，將**顯示名稱**來`SF Outbound Notification`並**探索模式**來**公用**。</span><span class="sxs-lookup"><span data-stu-id="07e1d-143">For this tutorial, set **Display name** to `SF Outbound Notification` and **Discovery mode** to **Public**.</span></span>  
  
      -   <span data-ttu-id="07e1d-144">在存取控制服務方塊中，按一下**編輯**。</span><span class="sxs-lookup"><span data-stu-id="07e1d-144">Under Access control service box, click **Edit**.</span></span> <span data-ttu-id="07e1d-145">針對**存取控制服務 STS Uri**，輸入`https://btssalesforce-sb.accesscontrol.windows.net/`。</span><span class="sxs-lookup"><span data-stu-id="07e1d-145">For **Access Control Service STS Uri**, enter `https://btssalesforce-sb.accesscontrol.windows.net/`.</span></span> <span data-ttu-id="07e1d-146">針對**簽發者名稱**並**簽發者金鑰**，輸入您在中儲存的值[步驟 1： 建立服務匯流排命名空間](../core/step-1-create-a-service-bus-namespace.md)如**預設使用者**和**預設金鑰**欄位。</span><span class="sxs-lookup"><span data-stu-id="07e1d-146">For **Issuer Name** and **Issuer Key**, enter the values that you saved in [Step 1: Create a Service Bus Namespace](../core/step-1-create-a-service-bus-namespace.md) for **Default User** and **Default Key** fields.</span></span>  
  
   3. <span data-ttu-id="07e1d-147">按一下 **確定**直到結束所有開啟的對話方塊。</span><span class="sxs-lookup"><span data-stu-id="07e1d-147">Click **OK** until you exit all open dialog boxes.</span></span>  
  
### <a name="to-configure-the-wcf-webhttp-send-port"></a><span data-ttu-id="07e1d-148">若要設定 Wcf-webhttp 傳送埠</span><span class="sxs-lookup"><span data-stu-id="07e1d-148">To configure the WCF-WebHttp send port</span></span>  
  
1. <span data-ttu-id="07e1d-149">依序展開**SalesforceIntegration**應用程式，以滑鼠右鍵按一下**傳送連接埠**，指向**新增**，然後按一下 **靜態請求-回應傳送埠**.</span><span class="sxs-lookup"><span data-stu-id="07e1d-149">Expand the **SalesforceIntegration** application, right-click **Send Ports**, point to **New**, and then click **Static Solicit-Response Send Port**.</span></span>  
  
2. <span data-ttu-id="07e1d-150">在傳送埠屬性 對話方塊中，指定下列值：</span><span class="sxs-lookup"><span data-stu-id="07e1d-150">In the Send Port Properties dialog box, specify the following values:</span></span>  
  
   |||  
   |-|-|  
   |<span data-ttu-id="07e1d-151">[屬性]</span><span class="sxs-lookup"><span data-stu-id="07e1d-151">Name</span></span>|<span data-ttu-id="07e1d-152">輸入`SalesforceREST`。</span><span class="sxs-lookup"><span data-stu-id="07e1d-152">Enter `SalesforceREST`.</span></span>|  
   |<span data-ttu-id="07e1d-153">類型</span><span class="sxs-lookup"><span data-stu-id="07e1d-153">Type</span></span>|<span data-ttu-id="07e1d-154">選取**Wcf-webhttp**</span><span class="sxs-lookup"><span data-stu-id="07e1d-154">Select **WCF-WebHttp**</span></span>|  
   |<span data-ttu-id="07e1d-155">傳送處理常式</span><span class="sxs-lookup"><span data-stu-id="07e1d-155">Send Handler</span></span>|<span data-ttu-id="07e1d-156">選取**BizTalkServerApplication**</span><span class="sxs-lookup"><span data-stu-id="07e1d-156">Select **BizTalkServerApplication**</span></span>|  
   |<span data-ttu-id="07e1d-157">傳送管線</span><span class="sxs-lookup"><span data-stu-id="07e1d-157">Send Pipeline</span></span>|<span data-ttu-id="07e1d-158">選取**PassThruTransmit**</span><span class="sxs-lookup"><span data-stu-id="07e1d-158">Select **PassThruTransmit**</span></span>|  
   |<span data-ttu-id="07e1d-159">接收管線</span><span class="sxs-lookup"><span data-stu-id="07e1d-159">Receive Pipeline</span></span>|<span data-ttu-id="07e1d-160">選取  **AddNamespace** ，然後按一下省略符號按鈕，針對來設定管線的管線。</span><span class="sxs-lookup"><span data-stu-id="07e1d-160">Select **AddNamespace** and click the ellipsis button against the pipeline to configure the pipeline.</span></span><br /><br /> <span data-ttu-id="07e1d-161">-底下**第 1 階段： 解碼**，如**NamespaceBase**，輸入`http://BtsSalesforceIntegration.QueryResult`。</span><span class="sxs-lookup"><span data-stu-id="07e1d-161">-   Under **Stage 1: Decode**, for **NamespaceBase**, enter `http://BtsSalesforceIntegration.QueryResult`.</span></span> <span data-ttu-id="07e1d-162">這是您在建立 QueryResult.xsd 結構描述的命名空間[步驟 3b： 使用 Wcf-webhttp 配接器從 Salesforce 擷取機會詳細資料](../core/step-3b-retrieve-opportunities-from-salesforce-using-the-wcf-webhttp-adapter.md)。</span><span class="sxs-lookup"><span data-stu-id="07e1d-162">This is the namespace of the QueryResult.xsd schema that you created in [Step 3b: Retrieve Opportunity Details from Salesforce using the WCF-WebHttp Adapter](../core/step-3b-retrieve-opportunities-from-salesforce-using-the-wcf-webhttp-adapter.md).</span></span> <span data-ttu-id="07e1d-163">當**AddNamespace**接收管線從 Salesforce 收到回應時，它將此命名空間加入至回應訊息。</span><span class="sxs-lookup"><span data-stu-id="07e1d-163">When the **AddNamespace** receive pipeline receives the response from Salesforce, it adds this namespace to the response message.</span></span> <span data-ttu-id="07e1d-164">根據預設，來自 Salesforce 的回應訊息不包含任何命名空間。</span><span class="sxs-lookup"><span data-stu-id="07e1d-164">By default, the response message from Salesforce does not include any namespace.</span></span><br />     <span data-ttu-id="07e1d-165">針對**NamespacePrefix**，輸入`sf`。</span><span class="sxs-lookup"><span data-stu-id="07e1d-165">For **NamespacePrefix**, enter `sf`.</span></span><br /><span data-ttu-id="07e1d-166">-底下**階段 2： 解譯**，接受預設值，然後按一下**確定**。</span><span class="sxs-lookup"><span data-stu-id="07e1d-166">-   Under **Stage 2: Disassemble**, accept the default values and then click **OK**.</span></span>|  
  
    <span data-ttu-id="07e1d-167">在 傳送埠屬性 對話方塊中，按一下 **設定**針對連接埠類型。</span><span class="sxs-lookup"><span data-stu-id="07e1d-167">On the Send Port Properties dialog box, click **Configure** against the port type.</span></span>  
  
3. <span data-ttu-id="07e1d-168">在 [Wcf-webhttp 傳輸屬性] 對話方塊中，指定下列值：</span><span class="sxs-lookup"><span data-stu-id="07e1d-168">In the WCF-WebHttp Transport Properties dialog box, specify the following values:</span></span>  
  
   1. <span data-ttu-id="07e1d-169">在 [一般] 索引標籤上，執行下列動作：</span><span class="sxs-lookup"><span data-stu-id="07e1d-169">On the **General** tab, do the following:</span></span>  
  
      - <span data-ttu-id="07e1d-170">針對**位址 (URI)**，輸入`https://<Salesforce_instance_name>.salesforce.com/services/data/v24.0`。</span><span class="sxs-lookup"><span data-stu-id="07e1d-170">for **Address (URI)**, enter `https://<Salesforce_instance_name>.salesforce.com/services/data/v24.0`.</span></span> <span data-ttu-id="07e1d-171">您可以藉由複製的文字會與 https:// Salesforce.com 上有開啟的 Salesforce.com 入口網站的網址列中擷取的 Salesforce 執行個體名稱。</span><span class="sxs-lookup"><span data-stu-id="07e1d-171">You can retrieve the Salesforce instance name by copying the text between https:// and Salesforce.com in the address bar where you have the Salesforce.com portal open.</span></span> <span data-ttu-id="07e1d-172">例如，如果在 Salesforce 入口網站的 URL 是否*https://*<em>na15</em>*.salesforce.com/home/home.jsp*，Salesforce 執行個體名稱是**na15**.</span><span class="sxs-lookup"><span data-stu-id="07e1d-172">For example, if the URL in the Salesforce portal is *https://*<em>na15</em>*.salesforce.com/home/home.jsp*, the Salesforce instance name is **na15**.</span></span>  
  
      - <span data-ttu-id="07e1d-173">底下**HTTP 方法和 URL 對應**方塊中，指定下列項目：</span><span class="sxs-lookup"><span data-stu-id="07e1d-173">Under **HTTP Method and URL Mapping** box, specify the following:</span></span>  
  
        ```  
        <BtsHttpUrlMapping>  
        <Operation Method="GET" Url="/query?q={VAR}" />  
        </BtsHttpUrlMapping>  
        ```  
  
         <span data-ttu-id="07e1d-174">以下是如何使用這項設定 — 若要查詢 Salesforce 擷取機會通知的詳細資訊，我們必須執行 「 取得 」 作業在 Salesforce REST 端點上的 (在指定**位址**欄位) 和附加若要擷取機會詳細資料的查詢。</span><span class="sxs-lookup"><span data-stu-id="07e1d-174">Here’s how this setting is used— To query Salesforce for retrieving more information about the opportunity notification, we must perform a GET operation on the Salesforce REST endpoint (specified in the **Address** field) and append the query to retrieve the opportunity details.</span></span> <span data-ttu-id="07e1d-175">因此，URL 看起來應該類似：</span><span class="sxs-lookup"><span data-stu-id="07e1d-175">So, the URL should look like:</span></span>  
  
        ```  
        https://na15.salesforce.com/services/data/v24.0/query?q=<query_string>  
        ```  
  
         <span data-ttu-id="07e1d-176">我們已經有 Salesforce REST 端點的一部分**位址 (URI)** 欄位。</span><span class="sxs-lookup"><span data-stu-id="07e1d-176">We already have the Salesforce REST endpoint as part of the **Address (URI)** field.</span></span> <span data-ttu-id="07e1d-177">因此，部分**HTTP 方法和 URL 對應** 屬性中，我們會指定使用 GET 方法，並附加 **{VAR}** 做為變數。</span><span class="sxs-lookup"><span data-stu-id="07e1d-177">So, as part of **HTTP Method and URL Mapping** property, we specify using the GET method and appending the **{VAR}** as a variable.</span></span>  
  
      - <span data-ttu-id="07e1d-178">在 **變數對應**方塊中，按一下**編輯**。</span><span class="sxs-lookup"><span data-stu-id="07e1d-178">In the **Variable Mapping** box, click **Edit**.</span></span> <span data-ttu-id="07e1d-179">在此方塊中指定方式的值 **{VAR}** 變數在執行階段推算。</span><span class="sxs-lookup"><span data-stu-id="07e1d-179">In this box you specify how the value for the **{VAR}** variable is deduced at runtime.</span></span>  
  
         <span data-ttu-id="07e1d-180">在 [步驟 3b： 使用 Wcf-webhttp 配接器從 Salesforce 擷取機會詳細資料](../core/step-3b-retrieve-opportunities-from-salesforce-using-the-wcf-webhttp-adapter.md)，我們已升級查詢屬性，這會導致建立**PropertySchema.xsd**。</span><span class="sxs-lookup"><span data-stu-id="07e1d-180">In [Step 3b: Retrieve Opportunity Details from Salesforce using the WCF-WebHttp Adapter](../core/step-3b-retrieve-opportunities-from-salesforce-using-the-wcf-webhttp-adapter.md), we had promoted the Query property, which resulted in creating a **PropertySchema.xsd**.</span></span> <span data-ttu-id="07e1d-181">我們將使用**查詢**該結構描述將由該元素對應至在 URL 中的 {VAR} 變數的查詢字串中的項目。</span><span class="sxs-lookup"><span data-stu-id="07e1d-181">We’ll use the **Query** element in that schema to pass the query string by mapping that element to the {VAR} variable in the URL.</span></span>  
  
         <span data-ttu-id="07e1d-182">在 [變數對應] 對話方塊中，**變數**欄會列出您稍早指定，例如，變數的名稱**VAR**。</span><span class="sxs-lookup"><span data-stu-id="07e1d-182">In the Variable Mapping dialog box, the **Variable** column lists the name of the variable you specified earlier, for example, **VAR**.</span></span> <span data-ttu-id="07e1d-183">在 [**屬性名稱**] 欄中，指定要傳給變數的查詢字串之升級屬性的名稱。</span><span class="sxs-lookup"><span data-stu-id="07e1d-183">In the **Property Name** column, specify the name of the promoted property that has the query string to be passed to the variable.</span></span> <span data-ttu-id="07e1d-184">在本教學課程中，該屬性名稱就**查詢**。</span><span class="sxs-lookup"><span data-stu-id="07e1d-184">In this tutorial, that property name is **Query**.</span></span> <span data-ttu-id="07e1d-185">最後，針對**屬性的命名空間**，指定的命名空間**PropertySchema.xsd**，這是`https://BtsSalesforceIntegration.PropertySchema`。</span><span class="sxs-lookup"><span data-stu-id="07e1d-185">Finally, for **Property Namespace**, specify the namespace for the **PropertySchema.xsd**, which is `https://BtsSalesforceIntegration.PropertySchema`.</span></span> <span data-ttu-id="07e1d-186">按一下 [確定] 。</span><span class="sxs-lookup"><span data-stu-id="07e1d-186">Click **OK**.</span></span>  
  
         <span data-ttu-id="07e1d-187">![WCF 的一般 索引標籤&#45;WebHttp 配接器](../core/media/bts-sf-webhttp-general.jpg "BTS_SF_WebHttp_General")</span><span class="sxs-lookup"><span data-stu-id="07e1d-187">![General tab of WCF&#45;WebHttp Adapter](../core/media/bts-sf-webhttp-general.jpg "BTS_SF_WebHttp_General")</span></span>  
  
   2. <span data-ttu-id="07e1d-188">在上**安全性**索引標籤上，如**安全性模式**，選取**傳輸**。</span><span class="sxs-lookup"><span data-stu-id="07e1d-188">On the **Security** tab, for **Security mode**, select **Transport**.</span></span>  
  
   3. <span data-ttu-id="07e1d-189">在上**行為**索引標籤上，使用您在中建立的自訂行為[步驟 3d： 讓 BizTalk Server 傳送和接收的訊息，從 Salesforce](../core/step-3d-enabling-biztalk-server-to-send-and-receive-messages-from-salesforce.md)向 Salesforce。</span><span class="sxs-lookup"><span data-stu-id="07e1d-189">On the **Behavior** tab, use the custom behavior that you created in [Step 3d: Enabling BizTalk Server to Send and Receive Messages from Salesforce](../core/step-3d-enabling-biztalk-server-to-send-and-receive-messages-from-salesforce.md) to authenticate with Salesforce.</span></span> <span data-ttu-id="07e1d-190">若要使用的行為，請執行下列作業：</span><span class="sxs-lookup"><span data-stu-id="07e1d-190">To use the behavior, do the following:</span></span>  
  
      -   <span data-ttu-id="07e1d-191">以滑鼠右鍵按一下**Servicebehavior** ，然後選取**新增擴充功能**。</span><span class="sxs-lookup"><span data-stu-id="07e1d-191">Right-click **EndpointBehavior** and then select **Add extension**.</span></span>  
  
      -   <span data-ttu-id="07e1d-192">在 [**選取行為延伸模組**] 對話方塊中，選取**Microsoft.BizTalk.Adapter.Behaviors.Demo.Salesforce**。</span><span class="sxs-lookup"><span data-stu-id="07e1d-192">In the **Select Behavior Extension** dialog box, select **Microsoft.BizTalk.Adapter.Behaviors.Demo.Salesforce**.</span></span> <span data-ttu-id="07e1d-193">我們將行為加入至 machine.config 時使用此行為的名稱。</span><span class="sxs-lookup"><span data-stu-id="07e1d-193">We had used this behavior name while adding the behavior to the machine.config.</span></span>  
  
      -   <span data-ttu-id="07e1d-194">選取新加入的行為，然後指定下列值：</span><span class="sxs-lookup"><span data-stu-id="07e1d-194">Select the newly added behavior and then specify the following values:</span></span>  
  
          |||  
          |-|-|  
          |<span data-ttu-id="07e1d-195">consumerKey （必要）</span><span class="sxs-lookup"><span data-stu-id="07e1d-195">consumerKey (Required)</span></span>|<span data-ttu-id="07e1d-196">指定您的 Salesforce 帳戶的取用者索引鍵。</span><span class="sxs-lookup"><span data-stu-id="07e1d-196">Specify the consumer key for your Salesforce account.</span></span> <span data-ttu-id="07e1d-197">您可以移至您在建立連線的 Salesforce 應用程式，以擷取取用者索引鍵[步驟 2： 設定 Salesforce 系統](../core/step-2-set-up-the-salesforce-system.md)。</span><span class="sxs-lookup"><span data-stu-id="07e1d-197">You can retrieve the consumer key by going to the Salesforce connected application you created in [Step 2: Set up the Salesforce System](../core/step-2-set-up-the-salesforce-system.md).</span></span>|  
          |<span data-ttu-id="07e1d-198">consumerSecret （必要）</span><span class="sxs-lookup"><span data-stu-id="07e1d-198">consumerSecret (Required)</span></span>|<span data-ttu-id="07e1d-199">取用者祕密從 Salesforce 連線應用程式中建立的擷取[步驟 2： 設定 Salesforce 系統](../core/step-2-set-up-the-salesforce-system.md)。</span><span class="sxs-lookup"><span data-stu-id="07e1d-199">Retrieve the consumer secret from the Salesforce connected application you created in [Step 2: Set up the Salesforce System](../core/step-2-set-up-the-salesforce-system.md).</span></span>|  
          |<span data-ttu-id="07e1d-200">密碼 （必要）</span><span class="sxs-lookup"><span data-stu-id="07e1d-200">Password (Required)</span></span>|<span data-ttu-id="07e1d-201">指定的 Salesforce 帳戶的密碼。</span><span class="sxs-lookup"><span data-stu-id="07e1d-201">Specify the password for the Salesforce account.</span></span> <span data-ttu-id="07e1d-202">若要從協力廠商應用程式連接到 Salesforce，您必須指定密碼格式密碼後面的安全性權杖中。</span><span class="sxs-lookup"><span data-stu-id="07e1d-202">To connect to Salesforce from a third party application, you must specify the password in the format password followed by the security token.</span></span> <span data-ttu-id="07e1d-203">比方說，如果密碼**密碼**語彙基元，而且**XXXXXX**，您必須輸入`passwordXXXXXX`。</span><span class="sxs-lookup"><span data-stu-id="07e1d-203">For example, if the password is **password** and the token is **XXXXXX**, you must enter `passwordXXXXXX`.</span></span>|  
          |<span data-ttu-id="07e1d-204">sessionTimeout</span><span class="sxs-lookup"><span data-stu-id="07e1d-204">sessionTimeout</span></span>|<span data-ttu-id="07e1d-205">這有預設值為 300。</span><span class="sxs-lookup"><span data-stu-id="07e1d-205">This has a default value of 300.</span></span>|  
          |<span data-ttu-id="07e1d-206">使用者名稱 （必要）</span><span class="sxs-lookup"><span data-stu-id="07e1d-206">Username (Required)</span></span>|<span data-ttu-id="07e1d-207">指定 Salesforce 開發人員登入帳戶。</span><span class="sxs-lookup"><span data-stu-id="07e1d-207">Specify the Salesforce developer login account.</span></span>|  
  
           <span data-ttu-id="07e1d-208">![WCF 的 [行為] 索引標籤&#45;WebHttp 配接器](../core/media/bts-sf-webhttp-behavior.jpg "BTS_SF_WebHttp_Behavior")</span><span class="sxs-lookup"><span data-stu-id="07e1d-208">![Behavior tab for WCF&#45;WebHttp adapter](../core/media/bts-sf-webhttp-behavior.jpg "BTS_SF_WebHttp_Behavior")</span></span>  
  
   4. <span data-ttu-id="07e1d-209">上**訊息**索引標籤之下**輸出訊息** 方塊中，如**動詞的隱藏主體**，輸入`GET`。</span><span class="sxs-lookup"><span data-stu-id="07e1d-209">On the **Messages** tab, under **Outbound Message** box, for **Suppress Body for Verbs**, enter `GET`.</span></span> <span data-ttu-id="07e1d-210">GET 方法，這可確保沒有任何訊息內容中的要求傳送至 Salesforce。</span><span class="sxs-lookup"><span data-stu-id="07e1d-210">This ensures for the GET method, there is no message payload in the request being sent to Salesforce.</span></span>  
  
   5. <span data-ttu-id="07e1d-211">按一下 **確定**直到結束所有開啟的對話方塊。</span><span class="sxs-lookup"><span data-stu-id="07e1d-211">Click **OK** until you exit all open dialog boxes.</span></span>  
  
### <a name="to-configure-the-wcf-sql-send-port"></a><span data-ttu-id="07e1d-212">若要設定 WCF SQL 傳送埠</span><span class="sxs-lookup"><span data-stu-id="07e1d-212">To configure the WCF-SQL send port</span></span>  
  
1.  <span data-ttu-id="07e1d-213">依序展開**SalesforceIntegration**應用程式，以滑鼠右鍵按一下**傳送連接埠**，指向**新增**，然後按一下 **靜態的單向傳送埠**.</span><span class="sxs-lookup"><span data-stu-id="07e1d-213">Expand the **SalesforceIntegration** application, right-click **Send Ports**, point to **New**, and then click **Static One-way Send Port**.</span></span>  
  
2.  <span data-ttu-id="07e1d-214">在傳送埠屬性 對話方塊中，指定下列值：</span><span class="sxs-lookup"><span data-stu-id="07e1d-214">In the Send Port Properties dialog box, specify the following values:</span></span>  
  
    |||  
    |-|-|  
    |<span data-ttu-id="07e1d-215">[屬性]</span><span class="sxs-lookup"><span data-stu-id="07e1d-215">Name</span></span>|<span data-ttu-id="07e1d-216">輸入`SendToSQL`。</span><span class="sxs-lookup"><span data-stu-id="07e1d-216">Enter `SendToSQL`.</span></span>|  
    |<span data-ttu-id="07e1d-217">類型</span><span class="sxs-lookup"><span data-stu-id="07e1d-217">Type</span></span>|<span data-ttu-id="07e1d-218">選取**WCF-SQL**</span><span class="sxs-lookup"><span data-stu-id="07e1d-218">Select **WCF-SQL**</span></span>|  
    |<span data-ttu-id="07e1d-219">傳送處理常式</span><span class="sxs-lookup"><span data-stu-id="07e1d-219">Send Handler</span></span>|<span data-ttu-id="07e1d-220">選取**BizTalkServerApplication**</span><span class="sxs-lookup"><span data-stu-id="07e1d-220">Select **BizTalkServerApplication**</span></span>|  
    |<span data-ttu-id="07e1d-221">傳送管線</span><span class="sxs-lookup"><span data-stu-id="07e1d-221">Send Pipeline</span></span>|<span data-ttu-id="07e1d-222">選取**XMLTransmit**</span><span class="sxs-lookup"><span data-stu-id="07e1d-222">Select **XMLTransmit**</span></span>|  
  
     <span data-ttu-id="07e1d-223">在 傳送埠屬性 對話方塊中，按一下 **設定**針對連接埠類型。</span><span class="sxs-lookup"><span data-stu-id="07e1d-223">On the Send Port Properties dialog box, click **Configure** against the port type.</span></span>  
  
3.  <span data-ttu-id="07e1d-224">在 [WCF-SQL 傳輸屬性] 對話方塊中，指定下列值：</span><span class="sxs-lookup"><span data-stu-id="07e1d-224">In the WCF-SQL Transport Properties dialog box, specify the following values:</span></span>  
  
    1.  <span data-ttu-id="07e1d-225">在 [一般] 索引標籤上，執行下列動作：</span><span class="sxs-lookup"><span data-stu-id="07e1d-225">On the **General** tab, do the following:</span></span>  
  
        -   <span data-ttu-id="07e1d-226">底下`Endpoint Address`，按一下**設定**。</span><span class="sxs-lookup"><span data-stu-id="07e1d-226">Under `Endpoint Address`, click **Configure**.</span></span> <span data-ttu-id="07e1d-227">針對**InitialCatalog**屬性，指定包含必須在其中輸入將資料從 Salesforce 回應之資料表的資料庫名稱。</span><span class="sxs-lookup"><span data-stu-id="07e1d-227">For the **InitialCatalog** property, specify the database name that contains the table where the data from Salesforce response must be entered.</span></span> <span data-ttu-id="07e1d-228">在本教學課程中，輸入此值作為`Orders`。</span><span class="sxs-lookup"><span data-stu-id="07e1d-228">For this tutorial enter this value as `Orders`.</span></span> <span data-ttu-id="07e1d-229">針對**Server**屬性中，輸入安裝 SQL Server 資料庫的伺服器名稱。</span><span class="sxs-lookup"><span data-stu-id="07e1d-229">For **Server** property, enter the server name where SQL Server database is installed.</span></span>  
  
        -   <span data-ttu-id="07e1d-230">底下**SOAP 動作標頭**，指定要用於插入動作**OrderDetails**資料表。</span><span class="sxs-lookup"><span data-stu-id="07e1d-230">Under **SOAP Action header**, specify the action to be used for inserting into the **OrderDetails** table.</span></span> <span data-ttu-id="07e1d-231">您必須輸入`TableOp/Insert/dbo/OrderDetails`。</span><span class="sxs-lookup"><span data-stu-id="07e1d-231">You must enter `TableOp/Insert/dbo/OrderDetails`.</span></span>  
  
    2.  <span data-ttu-id="07e1d-232">在 [認證] 索引標籤中，如果所有項目空白配接器使用 Windows 驗證來連接到 SQL Server 資料庫。</span><span class="sxs-lookup"><span data-stu-id="07e1d-232">On the Credentials tab, if you leave everything blank the adapter uses Windows Authentication to connect to the SQL Server database.</span></span> <span data-ttu-id="07e1d-233">如果您想要使用任何其他形式的驗證，您可以指定相關的值。</span><span class="sxs-lookup"><span data-stu-id="07e1d-233">If you want to use any other form of authentication, you can specify the relevant values.</span></span>  
  
    3.  <span data-ttu-id="07e1d-234">按一下 **確定**直到結束所有開啟的對話方塊。</span><span class="sxs-lookup"><span data-stu-id="07e1d-234">Click **OK** until you exit all open dialog boxes.</span></span>  
  
### <a name="to-configure-the-biztalk-server-application"></a><span data-ttu-id="07e1d-235">若要設定 BizTalk Server 應用程式</span><span class="sxs-lookup"><span data-stu-id="07e1d-235">To configure the BizTalk Server application</span></span>  
  
1. <span data-ttu-id="07e1d-236">在 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]管理主控台中，以滑鼠右鍵按一下**SalesforceIntegration**應用程式，，然後按一下**設定**。</span><span class="sxs-lookup"><span data-stu-id="07e1d-236">In the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] Administration console, right-click the **SalesforceIntegration** application, and then click **Configure**.</span></span>  
  
2. <span data-ttu-id="07e1d-237">在 [設定應用程式] 對話方塊中，選取**NotificationServiceClient**協調流程，以及從右窗格中，執行下列動作：</span><span class="sxs-lookup"><span data-stu-id="07e1d-237">In the Configure Application dialog box, select the **NotificationServiceClient** orchestration, and from the right pane do the following:</span></span>  
  
   1. <span data-ttu-id="07e1d-238">針對主機上，選取**BizTalkServerApplication**。</span><span class="sxs-lookup"><span data-stu-id="07e1d-238">For Host, select **BizTalkServerApplication**.</span></span>  
  
   2. <span data-ttu-id="07e1d-239">對應的邏輯接收埠**SalesforceNotificationPort**實體接收埠， **ReceiveOppNotification**。</span><span class="sxs-lookup"><span data-stu-id="07e1d-239">Map the logical receive port **SalesforceNotificationPort** to the physical receive port, **ReceiveOppNotification**.</span></span>  
  
   3. <span data-ttu-id="07e1d-240">邏輯傳送連接埠對應**SalesforceRESTInterface**至實體傳送埠， **SalesforceREST**。</span><span class="sxs-lookup"><span data-stu-id="07e1d-240">Map the logical send port **SalesforceRESTInterface** to the physical send port, **SalesforceREST**.</span></span>  
  
   4. <span data-ttu-id="07e1d-241">邏輯傳送連接埠對應**SendToSQL**至實體傳送埠， **SendToSQL**。</span><span class="sxs-lookup"><span data-stu-id="07e1d-241">Map the logical send port **SendToSQL** to the physical send port, **SendToSQL**.</span></span>  
  
      <span data-ttu-id="07e1d-242">按一下 [確定] 。</span><span class="sxs-lookup"><span data-stu-id="07e1d-242">Click **OK**.</span></span>  
  
3. <span data-ttu-id="07e1d-243">以滑鼠右鍵按一下**SalesforceIntegration**應用程式，然後按一下**開始**。</span><span class="sxs-lookup"><span data-stu-id="07e1d-243">Right-click the **SalesforceIntegration** application and then click **Start**.</span></span> <span data-ttu-id="07e1d-244">這會啟動**NotificationServiceClient**協調流程中，啟用接收位置，並啟動傳送埠。</span><span class="sxs-lookup"><span data-stu-id="07e1d-244">This starts the **NotificationServiceClient** orchestration, enables the receive location, and starts the send port.</span></span>  
  
   <span data-ttu-id="07e1d-245">本主題中，我們完成設定中的解決方案[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]管理主控台中，關聯的實體連接埠至協調流程中的邏輯連接埠。</span><span class="sxs-lookup"><span data-stu-id="07e1d-245">In this topic, we finished configuring the solution in [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] Administration console by associating the logical ports in the orchestration with the physical ports.</span></span>