---
title: 設定透過 AS2 接收訊息的連接埠 |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: 01d4d897-d12b-4de4-a86b-e6d2718470c2
caps.latest.revision: 18
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 85499228eb7bb9622f07be353d8bc0705d25adc8
ms.sourcegitcommit: 266308ec5c6a9d8d80ff298ee6051b4843c5d626
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 06/27/2018
ms.locfileid: "36983943"
---
# <a name="configuring-a-receive-port-for-messages-over-as2"></a><span data-ttu-id="8698e-102">設定透過 AS2 接收訊息的接收埠</span><span class="sxs-lookup"><span data-stu-id="8698e-102">Configuring a Receive Port for Messages over AS2</span></span>
<span data-ttu-id="8698e-103">若要接收含有 EDI 或非 EDI 內容的 AS2 訊息，請建立 HTTP 接收埠，以便接收此訊息並將回應傳回給合作對象。</span><span class="sxs-lookup"><span data-stu-id="8698e-103">To receive an AS2 message with an EDI or non-EDI payload, create an HTTP receive port to receive the message and return a response back to the party.</span></span>  

 <span data-ttu-id="8698e-104">如果此 MDN 將以同步方式傳回，接收埠就必須是雙向要求-回應接收埠。</span><span class="sxs-lookup"><span data-stu-id="8698e-104">If the MDN will be returned synchronously, the receive port must be a two-way request-response receive port.</span></span> <span data-ttu-id="8698e-105">接收埠中的接收位置將會接收 AS2 訊息，而與雙向接收埠相關聯的傳送埠則會傳送同步 MDN。</span><span class="sxs-lookup"><span data-stu-id="8698e-105">A receive location in the receive port will receive the AS2 message, while the send port associated with the two-way receive port will send the synschronous MDN.</span></span>  

 <span data-ttu-id="8698e-106">如果此 MDN 將以非同步方式傳回，接收埠就可以是單向接收埠，因為此 MDN 必須透過個別的動態傳送埠傳回。</span><span class="sxs-lookup"><span data-stu-id="8698e-106">If the MDN will be returned asynchronously, the receive port can be a one-way receive port, because the MDN must be returned over a separate dynamic send port.</span></span> <span data-ttu-id="8698e-107">接收埠將會傳回 HTTP 回應，不論它是單向或雙向連接埠都一樣。</span><span class="sxs-lookup"><span data-stu-id="8698e-107">An HTTP response will be returned by the receive port, whether it is a one-way or two-way port.</span></span> <span data-ttu-id="8698e-108">如果您設定了雙向接收埠來接收 AS2 訊息，而傳回非同步 MDN，HTTP 回應將透過雙向接收位置的傳送埠傳回。</span><span class="sxs-lookup"><span data-stu-id="8698e-108">If you set up a two-way receive port to receive an AS2 message, while returning an asynchronoius MDN, the HTTP response will be returned over the send port of the two-way receive location.</span></span>  

> [!NOTE]
>  <span data-ttu-id="8698e-109">用來接收 AS2 訊息的雙向接收埠不應該用來接收 MDN 訊息。</span><span class="sxs-lookup"><span data-stu-id="8698e-109">The two-way receive port used to receive AS2 messages should not be used to receive MDN messages.</span></span> <span data-ttu-id="8698e-110">MDN 訊息應該透過靜態單向接收埠接收。</span><span class="sxs-lookup"><span data-stu-id="8698e-110">MDN messages should be received on a static one-way receive port.</span></span> <span data-ttu-id="8698e-111">針對 MDN 使用要求/回應接收埠會讓 200OK 訊息無法在回應內送 MDN 時傳回，因而導致系統不必要地重試 MDN 傳輸作業。</span><span class="sxs-lookup"><span data-stu-id="8698e-111">Using a request/response receive port for an MDN would prevent a 200OK message from being returned in response to the incoming MDN, thereby causing unnecessary retries of the MDN transmission.</span></span>  

 <span data-ttu-id="8698e-112">請使用下列組態來建立接收埠：</span><span class="sxs-lookup"><span data-stu-id="8698e-112">Create the receive port with the following configuration:</span></span>  


|                 <span data-ttu-id="8698e-113">位置</span><span class="sxs-lookup"><span data-stu-id="8698e-113">Location</span></span>                 |                <span data-ttu-id="8698e-114">屬性</span><span class="sxs-lookup"><span data-stu-id="8698e-114">Property</span></span>                |                                                                                                                                                                                                                                                                                           <span data-ttu-id="8698e-115">設定</span><span class="sxs-lookup"><span data-stu-id="8698e-115">Setting</span></span>                                                                                                                                                                                                                                                                                           |
|------------------------------------------|----------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|   <span data-ttu-id="8698e-116">**接收埠屬性： 一般**</span><span class="sxs-lookup"><span data-stu-id="8698e-116">**Receive Port Properties: General**</span></span>   |               <span data-ttu-id="8698e-117">連接埠類型</span><span class="sxs-lookup"><span data-stu-id="8698e-117">Port type</span></span>                |                                                                                                                                                                                                                                                                                      <span data-ttu-id="8698e-118">要求-回應</span><span class="sxs-lookup"><span data-stu-id="8698e-118">Request-Response</span></span>                                                                                                                                                                                                                                                                                       |
| <span data-ttu-id="8698e-119">**接收位置屬性： 一般**</span><span class="sxs-lookup"><span data-stu-id="8698e-119">**Receive Location Properties: General**</span></span> |             <span data-ttu-id="8698e-120">傳輸類型</span><span class="sxs-lookup"><span data-stu-id="8698e-120">Transport Type</span></span>             |                                                                                                                                                                                                          <span data-ttu-id="8698e-121">HTTP**附註：** 只有 HTTP 配接器可以用於傳輸 EDIINT/AS2/AS2 編碼訊息。</span><span class="sxs-lookup"><span data-stu-id="8698e-121">HTTP **Note:**  Only the HTTP adapter can be used for transporting EDIINT/AS2-encoded messages.</span></span> <span data-ttu-id="8698e-122">這種傳輸無法搭配 HTTP 配接器以外的配接器運作。</span><span class="sxs-lookup"><span data-stu-id="8698e-122">This transport will not work with an adapter other than the HTTP adapter.</span></span>                                                                                                                                                                                                          |
| <span data-ttu-id="8698e-123">**接收位置屬性： 一般**</span><span class="sxs-lookup"><span data-stu-id="8698e-123">**Receive Location Properties: General**</span></span> |            <span data-ttu-id="8698e-124">接收處理常式</span><span class="sxs-lookup"><span data-stu-id="8698e-124">Receive handler</span></span>             |                                                                                                                                                                                                                                                                                  <span data-ttu-id="8698e-125">BizTalkServerIsolatedHost</span><span class="sxs-lookup"><span data-stu-id="8698e-125">BizTalkServerIsolatedHost</span></span>                                                                                                                                                                                                                                                                                  |
| <span data-ttu-id="8698e-126">**接收位置屬性： 一般**</span><span class="sxs-lookup"><span data-stu-id="8698e-126">**Receive Location Properties: General**</span></span> |            <span data-ttu-id="8698e-127">接收管線</span><span class="sxs-lookup"><span data-stu-id="8698e-127">Receive pipeline</span></span>            | <span data-ttu-id="8698e-128">-AS2EdiReceive (如果內容是 EDI 編碼)</span><span class="sxs-lookup"><span data-stu-id="8698e-128">-   AS2EdiReceive (if the payload is EDI-encoded)</span></span><br /><span data-ttu-id="8698e-129">-AS2Receive （如果內容不是 EDI 編碼）**附註：** 時使用 AS2EdiReceive 管線，您必須新增至 BizTalk 應用程式使用者群組執行 BizTalk 外掛式主控件執行個體處理序的使用者帳戶。</span><span class="sxs-lookup"><span data-stu-id="8698e-129">-   AS2Receive (if the payload is not EDI-encoded) **Note:**  When using the AS2EdiReceive pipeline, you must add the user account that the BizTalk Isolated Host Instance process is running under to the BizTalk Application Users group.</span></span> <span data-ttu-id="8698e-130">AS2EdiReceive 管線會在 BizTalk 外掛式主控件執行個體處理序中執行。</span><span class="sxs-lookup"><span data-stu-id="8698e-130">The AS2EdiReceive pipeline executes in the BizTalk Isolated Host Instance process.</span></span> <span data-ttu-id="8698e-131">AS2EdiReceive 管線會存取 SSO 存放區，而此存放區會要求使用者必須是「[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 應用程式使用者」群組中的成員。</span><span class="sxs-lookup"><span data-stu-id="8698e-131">The AS2EdiReceive pipeline accesses the SSO store, which requires that the user is in the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] Application Users group.</span></span> |
| <span data-ttu-id="8698e-132">**接收位置屬性： 一般**</span><span class="sxs-lookup"><span data-stu-id="8698e-132">**Receive Location Properties: General**</span></span> |             <span data-ttu-id="8698e-133">傳送管線</span><span class="sxs-lookup"><span data-stu-id="8698e-133">Send pipeline</span></span>              |                                                                                                                                                                                                                                                                                           <span data-ttu-id="8698e-134">AS2Send</span><span class="sxs-lookup"><span data-stu-id="8698e-134">AS2Send</span></span>                                                                                                                                                                                                                                                                                           |
|      <span data-ttu-id="8698e-135">**HTTP 傳輸屬性**</span><span class="sxs-lookup"><span data-stu-id="8698e-135">**HTTP Transport Properties**</span></span>       | <span data-ttu-id="8698e-136">虛擬目錄加 ISAPI 延伸模組</span><span class="sxs-lookup"><span data-stu-id="8698e-136">Virtual directory plus ISAPI extension</span></span> |                                                                                                                                                                                                                                                                      <span data-ttu-id="8698e-137">/\<虛擬目錄名稱\>/BTSHTTPReceive.dll</span><span class="sxs-lookup"><span data-stu-id="8698e-137">/\<name of virtual directory\>/BTSHTTPReceive.dll</span></span>                                                                                                                                                                                                                                                                      |
|      <span data-ttu-id="8698e-138">**HTTP 傳輸屬性**</span><span class="sxs-lookup"><span data-stu-id="8698e-138">**HTTP Transport Properties**</span></span>       |  <span data-ttu-id="8698e-139">要求-回應傳回內容類型</span><span class="sxs-lookup"><span data-stu-id="8698e-139">Request-Response Return content type</span></span>  |                                                                                                                                                                                                                                                                                          <span data-ttu-id="8698e-140">text/xml</span><span class="sxs-lookup"><span data-stu-id="8698e-140">text/xml</span></span>                                                                                                                                                                                                                                                                                           |

## <a name="functionality-of-the-receive-location-in-synchronous-and-asynchronous-modes"></a><span data-ttu-id="8698e-141">接收位置在同步與非同步模式中的功能</span><span class="sxs-lookup"><span data-stu-id="8698e-141">Functionality of the Receive Location in Synchronous and Asynchronous Modes</span></span>  
 <span data-ttu-id="8698e-142">雙向接收埠會進行下列作業來接收並處理 EDI/AS2 訊息，以及傳回回應：</span><span class="sxs-lookup"><span data-stu-id="8698e-142">The two-way receive port does the following to receive and process an EDI/AS2 message and return a response:</span></span>  

-   <span data-ttu-id="8698e-143">透過 HTTP 接收 AS2 訊息。</span><span class="sxs-lookup"><span data-stu-id="8698e-143">Receive the AS2 message over HTTP.</span></span>  

-   <span data-ttu-id="8698e-144">使用 AS2EDIReceive 接收管線 (針對 EDI 編碼訊息) 或 AS2Receive 接收管線 (針對不是以 EDI 編碼的訊息) 來處理 AS2 訊息。</span><span class="sxs-lookup"><span data-stu-id="8698e-144">Process the AS2 message using the AS2EDIReceive receive pipeline (for EDI-encoded messages) or the AS2Receive receive pipeline (for messages that are not encoded in EDI).</span></span> <span data-ttu-id="8698e-145">如需有關此程序的詳細資訊，請參閱 <<c0> [ 處理內送 AS2 訊息](../core/processing-an-incoming-as2-message.md)。</span><span class="sxs-lookup"><span data-stu-id="8698e-145">For more information on this process, see [Processing an Incoming AS2 Message](../core/processing-an-incoming-as2-message.md).</span></span>  

-   <span data-ttu-id="8698e-146">針對接收的訊息設定下列內容屬性：</span><span class="sxs-lookup"><span data-stu-id="8698e-146">Set the following context properties on the received message:</span></span>  

    -   <span data-ttu-id="8698e-147">`IsAS2PayloadMessage == True` (因為它是內容訊息)</span><span class="sxs-lookup"><span data-stu-id="8698e-147">`IsAS2PayloadMessage == True` (because it is a payload message)</span></span>  

    -   <span data-ttu-id="8698e-148">`IsEmptyMDNResponse == False` (因為它不是空的 MDN)</span><span class="sxs-lookup"><span data-stu-id="8698e-148">`IsEmptyMDNResponse == False` (because it is not an empty MDN)</span></span>  

-   <span data-ttu-id="8698e-149">如果此訊息是 EDI 編碼，請解譯 EDI 檔案、產生 XML 檔案，然後將它們放置在 MessageBox 中。</span><span class="sxs-lookup"><span data-stu-id="8698e-149">If the message is EDI-encoded, disassemble the EDI file, generate XML files, and drop them into the MessageBox.</span></span> <span data-ttu-id="8698e-150">針對每個 XML 檔案，將 `BTS.MessageType` 的內容屬性設定為含有命名空間的結構描述名稱。</span><span class="sxs-lookup"><span data-stu-id="8698e-150">Set the context property of `BTS.MessageType` for each XML file to the schema name with namespace.</span></span>  

-   <span data-ttu-id="8698e-151">如果此訊息不是 EDI 編碼，請以原生格式將訊息放置在 MessageBox 中。</span><span class="sxs-lookup"><span data-stu-id="8698e-151">If the message is not EDI-encoded, drop the message in its native format into the MessageBox.</span></span>  

-   <span data-ttu-id="8698e-152">使用 AS2EdiReceive 接收管線來產生 MDN 檔案 (如果啟用的話)。</span><span class="sxs-lookup"><span data-stu-id="8698e-152">Generate the MDN file, if enabled, using the AS2EdiReceive receive pipeline.</span></span> <span data-ttu-id="8698e-153">如需有關此程序的詳細資訊，請參閱 <<c0> [ 產生外寄 MDN](../core/generating-an-outgoing-mdn.md)。</span><span class="sxs-lookup"><span data-stu-id="8698e-153">For more information on this process, see [Generating an Outgoing MDN](../core/generating-an-outgoing-mdn.md).</span></span> <span data-ttu-id="8698e-154">針對此訊息設定下列內容屬性：</span><span class="sxs-lookup"><span data-stu-id="8698e-154">Set the following context properties on the message:</span></span>  

    -   <span data-ttu-id="8698e-155">`EdiIntAS.IsAS2AsynchronousMdn == False` (如果處於同步模式下)</span><span class="sxs-lookup"><span data-stu-id="8698e-155">`EdiIntAS.IsAS2AsynchronousMdn == False` (if in synchronous mode)</span></span>  

    -   <span data-ttu-id="8698e-156">`EdiIntAS.IsAS2AsynchronousMdn== True` (如果處於非同步模式下)</span><span class="sxs-lookup"><span data-stu-id="8698e-156">`EdiIntAS.IsAS2AsynchronousMdn== True` (if in asynchronous mode)</span></span>  

-   <span data-ttu-id="8698e-157">如果處於同步模式下，請使用 AS2Send 傳送管線來傳送 MDN 檔案 (如果啟用的話)。</span><span class="sxs-lookup"><span data-stu-id="8698e-157">If in synchronous mode, send the MDN file, if enabled, using the AS2Send send pipeline.</span></span> <span data-ttu-id="8698e-158">如需有關此程序的詳細資訊，請參閱 <<c0> [ 傳送外寄 MDN](../core/sending-an-outgoing-mdn.md)。</span><span class="sxs-lookup"><span data-stu-id="8698e-158">For more information on this process, see [Sending an Outgoing MDN](../core/sending-an-outgoing-mdn.md).</span></span>  

-   <span data-ttu-id="8698e-159">如果處於非同步模式下，請將 MDN 檔案 (如果啟用的話) 路由傳送至 MessageBox (讓個別的動態傳送埠挑選它並傳送它)。</span><span class="sxs-lookup"><span data-stu-id="8698e-159">If in asynchronous mode, route the MDN file, if enabled, to the MessageBox (for a separate dynamic send port to pick it up and send it).</span></span>  

-   <span data-ttu-id="8698e-160">如果處於非同步模式下，除了以非同步方式傳回的完整 MDN 以外，請產生空的 MDN。</span><span class="sxs-lookup"><span data-stu-id="8698e-160">If in asynchronous mode, generate an empty MDN in addition to the complete MDN that it returns asynchronously.</span></span> <span data-ttu-id="8698e-161">針對此訊息設定下列內容屬性：</span><span class="sxs-lookup"><span data-stu-id="8698e-161">Set the following context properties on the message:</span></span>  

    -   `IsAS2PayloadMessage == False`  

    -   `IsEmptyMDNResponse == True`  

-   <span data-ttu-id="8698e-162">如果處於非同步模式下，請透過接收埠與傳送合作對象之間的 HTTP 連線，將 HTTP 回應傳回給原始傳送者，以便關閉該連線。</span><span class="sxs-lookup"><span data-stu-id="8698e-162">If in asynchronous mode, return the HTTP response to the original sender over the HTTP connection between the receive port and the sending party, which closes that connection.</span></span> <span data-ttu-id="8698e-163">因為完整 MDN 不會關閉同步連線，所以這是必要條件。</span><span class="sxs-lookup"><span data-stu-id="8698e-163">This is necessary because the synchronous connection is not closed by the complete MDN.</span></span>  

-   <span data-ttu-id="8698e-164">產生通知訊息 (如果啟用的話)，然後將它放置在 MessageBox 中。</span><span class="sxs-lookup"><span data-stu-id="8698e-164">Generate an acknowledgment message, if enabled, and drop it into the MessageBox.</span></span> <span data-ttu-id="8698e-165">將 `BTS.MessageType` 的內容屬性設定為通知控制結構描述。</span><span class="sxs-lookup"><span data-stu-id="8698e-165">Set the context property of `BTS.MessageType` to the acknowledgment control schema.</span></span>  

## <a name="see-also"></a><span data-ttu-id="8698e-166">另請參閱</span><span class="sxs-lookup"><span data-stu-id="8698e-166">See Also</span></span>  
 <span data-ttu-id="8698e-167">[設定 AS2 解決方案的連接埠](../core/configuring-ports-for-an-as2-solution.md) </span><span class="sxs-lookup"><span data-stu-id="8698e-167">[Configuring Ports for an AS2 Solution](../core/configuring-ports-for-an-as2-solution.md) </span></span>  
 <span data-ttu-id="8698e-168">[處理內送 AS2 訊息](../core/processing-an-incoming-as2-message.md) </span><span class="sxs-lookup"><span data-stu-id="8698e-168">[Processing an Incoming AS2 Message](../core/processing-an-incoming-as2-message.md) </span></span>  
 <span data-ttu-id="8698e-169">[產生外寄 MDN](../core/generating-an-outgoing-mdn.md) </span><span class="sxs-lookup"><span data-stu-id="8698e-169">[Generating an Outgoing MDN](../core/generating-an-outgoing-mdn.md) </span></span>  
 [<span data-ttu-id="8698e-170">傳送外寄 MDN</span><span class="sxs-lookup"><span data-stu-id="8698e-170">Sending an Outgoing MDN</span></span>](../core/sending-an-outgoing-mdn.md)