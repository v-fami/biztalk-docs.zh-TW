---
title: "MDN 訊息 |Microsoft 文件"
ms.custom: 
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 16ac6253-0be5-4636-b102-bf5af8956261
caps.latest.revision: "20"
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 5a6600237961b59e440a460263a8f4315b2c4773
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 09/20/2017
---
# <a name="mdn-messages"></a><span data-ttu-id="e6c56-102">MDN 訊息</span><span class="sxs-lookup"><span data-stu-id="e6c56-102">MDN Messages</span></span>
<span data-ttu-id="e6c56-103">「訊息處理通知」(MDN) 是為了回應 AS2 訊息而傳送的通知。</span><span class="sxs-lookup"><span data-stu-id="e6c56-103">The Message Disposition Notification (MDN) is the acknowledgment sent in response to an AS2 message.</span></span> <span data-ttu-id="e6c56-104">如果已啟用 MDN，則必須等到接收及驗證 MDN 之後，AS2 傳輸才算完成。</span><span class="sxs-lookup"><span data-stu-id="e6c56-104">If an MDN is enabled, the AS2 transmission is not complete until the MDN has been received and verified.</span></span> [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]<span data-ttu-id="e6c56-105">將一律嘗試傳回 MDN 以指出訊息處理的狀態，即使處理 AS2 訊息時發生錯誤。</span><span class="sxs-lookup"><span data-stu-id="e6c56-105"> will always attempt to return an MDN to indicate the status of message processing, even if an error occurred in processing the AS2 message.</span></span>  
  
 <span data-ttu-id="e6c56-106">MDN 提供下列驗證：</span><span class="sxs-lookup"><span data-stu-id="e6c56-106">The MDN provides verification of the following:</span></span>  
  
-   <span data-ttu-id="e6c56-107">**原始訊息已成功接收的合作對象所收到**。</span><span class="sxs-lookup"><span data-stu-id="e6c56-107">**That the original message was successfully received by the receiving party**.</span></span> <span data-ttu-id="e6c56-108">原始訊息的傳送者會比較原始傳送訊息的 MessageID 與接收者包含在 MDN 中的原始訊息識別碼欄位，以驗證這一點。</span><span class="sxs-lookup"><span data-stu-id="e6c56-108">The sender of the original message verifies this by comparing the MessageID of the original sent message with the original-message-id field that the receiver included in the MDN.</span></span>  
  
-   <span data-ttu-id="e6c56-109">**接收端夥伴已確認交換資料的完整性**。</span><span class="sxs-lookup"><span data-stu-id="e6c56-109">**That the integrity of the data exchanged was verified by the receiving partner**.</span></span> <span data-ttu-id="e6c56-110">原始訊息的傳送者會比較從原始傳送訊息內容計算得出的 MIC，以及接收者在所接收訊息內容上計算所得並包含在 MDN 之 Received-content-MIC 欄位 (若已簽署) 的 MIC，以驗證這一點。</span><span class="sxs-lookup"><span data-stu-id="e6c56-110">The sender of the original message verifies this by comparing the MIC that was calculated from the original sent message payload, with the MIC that the receiver calculated on the received message payload and included in the Received-content-MIC field of the MDN (if signed).</span></span>  
  
-   <span data-ttu-id="e6c56-111">**是不可否認性回條**。</span><span class="sxs-lookup"><span data-stu-id="e6c56-111">**That there is a non-repudiation of receipt**.</span></span> <span data-ttu-id="e6c56-112">傳送者採用的方式是使用接收端夥伴的公用金鑰驗證簽署的 MDN，並確認 MDN 中傳回的 MIC 值與儲存在不可否認性資料庫中的原始訊息內容 MIC 相同。</span><span class="sxs-lookup"><span data-stu-id="e6c56-112">The sender does this by verifying the signed MDN with the receiving partner's public key, and by verifying that the returned MIC value in the MDN is the same as the MIC for the original message payload stored in the non-repudiation database.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="e6c56-113">同步的 MDN 可做為 HTTP 回應，例如 200 OK。</span><span class="sxs-lookup"><span data-stu-id="e6c56-113">A synchronous MDN serves as an HTTP Response, e.g., 200 OK.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="e6c56-114">Mdn 的接收端處理的相關資訊，請參閱[處理內送 MDN](../core/processing-an-incoming-mdn.md)。</span><span class="sxs-lookup"><span data-stu-id="e6c56-114">For more information about receive-side processing of MDNs, see [Processing an Incoming MDN](../core/processing-an-incoming-mdn.md).</span></span> <span data-ttu-id="e6c56-115">Mdn 的傳送端處理的相關資訊，請參閱[傳送外寄 MDN](../core/sending-an-outgoing-mdn.md)。</span><span class="sxs-lookup"><span data-stu-id="e6c56-115">For more information about send-side processing of MDNs, see [Sending an Outgoing MDN](../core/sending-an-outgoing-mdn.md).</span></span>  
  
## <a name="properties-used-to-generate-the-mdn"></a><span data-ttu-id="e6c56-116">用來產生 MDN 的屬性</span><span class="sxs-lookup"><span data-stu-id="e6c56-116">Properties Used to Generate the MDN</span></span>  
 <span data-ttu-id="e6c56-117">AS2Receive 接收管線會產生 MDN 使用合作對象的 AS2 協議屬性，如果**對驗證與 MDN 使用協議設定，而非訊息標頭**單向協議索引標籤上選取屬性**協議屬性** 對話方塊。</span><span class="sxs-lookup"><span data-stu-id="e6c56-117">The AS2Receive receive pipeline will generate an MDN using a party's AS2 agreement properties if the **Use agreement settings for validation and MDN instead of message header** property is selected on the one-way agreement tab in the **Agreement Properties** dialog box.</span></span> <span data-ttu-id="e6c56-118">在這種情況下，接收管線將會使用訊息標頭中的 AS2-Form 屬性來產生 MDN，但是其他屬性則取自合作對象的 AS2 協議設定。</span><span class="sxs-lookup"><span data-stu-id="e6c56-118">In this instance, the AS2-From property in the message header will be used in generating the MDN, but other properties will be taken from the party's AS2 agreement settings.</span></span>  
  
 <span data-ttu-id="e6c56-119">如果沒有選取覆寫 AS2 屬性的選項，或者無法使用合作對象 AS2 協議，接收管線將會使用內送訊息中的 AS2 標頭標記來產生 MDN。</span><span class="sxs-lookup"><span data-stu-id="e6c56-119">If the option to override AS2 property is not selected, or the party’s AS2 agreement is available, the receive pipeline will generate the MDN using the AS2 header tags in the incoming message.</span></span>  
  
 <span data-ttu-id="e6c56-120">MDN 可以簽署，但是無法加密或壓縮。</span><span class="sxs-lookup"><span data-stu-id="e6c56-120">An MDN can be signed, but it cannot be encrypted or compressed.</span></span>  
  
## <a name="mdn-context-properties"></a><span data-ttu-id="e6c56-121">MDN 內容屬性</span><span class="sxs-lookup"><span data-stu-id="e6c56-121">MDN Context Properties</span></span>  
 <span data-ttu-id="e6c56-122">處理 MDN 訊息時使用的內容屬性包括可以升級的屬性，以及雖然不公開但是可以在擱置和追蹤訊息中檢視的屬性。</span><span class="sxs-lookup"><span data-stu-id="e6c56-122">Context properties used in processing MDN messages include properties that can be promoted as well as properties that are not publicly exposed, but can be viewed in suspended and tracked messages.</span></span> <span data-ttu-id="e6c56-123">如需這些內容屬性的清單，請參閱[AS2 內容屬性](../core/as2-context-properties.md)。</span><span class="sxs-lookup"><span data-stu-id="e6c56-123">For a list of these context properties, see [AS2 Context Properties](../core/as2-context-properties.md).</span></span>  
  
 <span data-ttu-id="e6c56-124">DispositionMode 和 DispositionType 兩個內容屬性必須同時升級，才能產生 MDN。</span><span class="sxs-lookup"><span data-stu-id="e6c56-124">Both the DispositionMode and DispositionType context properties must be promoted in order for an MDN to be generated.</span></span> <span data-ttu-id="e6c56-125">如果 AS2 或 EDI 內容出現錯誤，DispositionType 屬性將會指出該項錯誤。</span><span class="sxs-lookup"><span data-stu-id="e6c56-125">If an error occurs in the AS2 or EDI payload, the DispositionType property will indicate the error.</span></span> <span data-ttu-id="e6c56-126">您可以看到這個屬性中的**訊息詳細資料**（透過 [服務詳細資料] 對話方塊中） 從擱置服務執行個體，在顯示的對話方塊**群組中樞**頁面[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]管理主控台。</span><span class="sxs-lookup"><span data-stu-id="e6c56-126">You can see this property in the **Message Details** dialog box that is displayed (via the Service Details dialog box) from the Suspended service instances in the **Group Hub** page of the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] Administration Console.</span></span> <span data-ttu-id="e6c56-127">如果標頭發生錯誤，[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 會在 DispositionType 屬性中指出這項錯誤，而且會嘗試傳送 MDN，但是也可能因為錯誤的不同，而無法這樣做。</span><span class="sxs-lookup"><span data-stu-id="e6c56-127">If an error occurs in the header, [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] will indicate the error in the DispositionType property, and will attempt to send the MDN, but depending on the error, may not be able to do so.</span></span>  
  
## <a name="mdn-headers"></a><span data-ttu-id="e6c56-128">MDN 標頭</span><span class="sxs-lookup"><span data-stu-id="e6c56-128">MDN Headers</span></span>  
 <span data-ttu-id="e6c56-129">MDN 包含下列標頭：</span><span class="sxs-lookup"><span data-stu-id="e6c56-129">The MDN contains the following headers:</span></span>  
  
-   <span data-ttu-id="e6c56-130">**HTTP/AS2 標頭**。</span><span class="sxs-lookup"><span data-stu-id="e6c56-130">**HTTP/AS2 headers**.</span></span> <span data-ttu-id="e6c56-131">如需詳細資訊，請參閱[AS2 訊息](../core/as2-messages.md)。</span><span class="sxs-lookup"><span data-stu-id="e6c56-131">For more information, see [AS2 Messages](../core/as2-messages.md).</span></span>  
  
-   <span data-ttu-id="e6c56-132">**傳輸層**。</span><span class="sxs-lookup"><span data-stu-id="e6c56-132">**Transfer Layer**.</span></span> <span data-ttu-id="e6c56-133">這包括 Content-Type 標頭 (內含已簽署的多部分訊息)、MIC 的演算法、簽章格式通訊協定，以及最外層多部分界限子標頭。</span><span class="sxs-lookup"><span data-stu-id="e6c56-133">This includes the Content-Type header that includes the signed multipart message, the algorithm for the MIC, the signature formatting protocol, and the outermost multipart boundary sub-headers.</span></span>  
  
-   <span data-ttu-id="e6c56-134">**第一個部分**。</span><span class="sxs-lookup"><span data-stu-id="e6c56-134">**First Part**.</span></span> <span data-ttu-id="e6c56-135">多部分簽署訊息的第一個部分是內嵌的 MDN。</span><span class="sxs-lookup"><span data-stu-id="e6c56-135">The first part of the multipart signed message is the embedded MDN.</span></span> <span data-ttu-id="e6c56-136">這個部分可由人工判讀。</span><span class="sxs-lookup"><span data-stu-id="e6c56-136">It is human readable.</span></span>  
  
-   <span data-ttu-id="e6c56-137">**第二個部分**。</span><span class="sxs-lookup"><span data-stu-id="e6c56-137">**Second Part**.</span></span> <span data-ttu-id="e6c56-138">多部分簽署訊息的第二個部分包含數位簽章、原始訊息的參考、配置類型和狀態，以及 MIC 值。</span><span class="sxs-lookup"><span data-stu-id="e6c56-138">The second part of the multipart signed message contains the digital signature, a reference to the original message, the disposition type and status, and the MIC value.</span></span> <span data-ttu-id="e6c56-139">這個部分可由電腦判讀。</span><span class="sxs-lookup"><span data-stu-id="e6c56-139">It is machine readable.</span></span>  
  
 <span data-ttu-id="e6c56-140">AS2-From 標頭、AS2-To 標頭和 MessageID 內容屬性可用來讓 MDN 與其回應的 AS2 訊息產生關聯。</span><span class="sxs-lookup"><span data-stu-id="e6c56-140">The AS2-From header, AS2-To header, and MessageID context property are used to correlate an MDN to the AS2 message that it is responding to.</span></span> <span data-ttu-id="e6c56-141">MDN 中的 Original-Message-ID 標頭則來自 MDN 回應之 AS2 的 Message-ID 標頭。</span><span class="sxs-lookup"><span data-stu-id="e6c56-141">The Original-Message-ID header in an MDN comes from the Message-ID header of the AS2 message that the MDN is responding to.</span></span>  
  
## <a name="mic"></a><span data-ttu-id="e6c56-142">MIC</span><span class="sxs-lookup"><span data-stu-id="e6c56-142">MIC</span></span>  
 <span data-ttu-id="e6c56-143">訊息完整性檢查 (MIC) 是用來確認 MDN 有和原始傳送的訊息內容相互關聯。</span><span class="sxs-lookup"><span data-stu-id="e6c56-143">The Message Integrity Check (MIC) is used to verify that an MDN correlates to the original sent message payload.</span></span> <span data-ttu-id="e6c56-144">MIC 摘要包含在多部分簽署 MDN 訊息第二個部分的 Received-Content-MIC 延伸模組欄位中。</span><span class="sxs-lookup"><span data-stu-id="e6c56-144">The MIC digest is included in the Received-Content-MIC extension field in the second part of the multipart signed MDN message.</span></span>  
  
 <span data-ttu-id="e6c56-145">如果已啟用 MDN，在 AS2 傳送管線處理輸出訊息時，它會根據訊息內容計算 MICHashValue。</span><span class="sxs-lookup"><span data-stu-id="e6c56-145">If an MDN is enabled, when the AS2 send pipeline processes an outbound message, it computes a MICHashValue from the message payload.</span></span> <span data-ttu-id="e6c56-146">傳送管線會將雜湊值儲存在 BizTalkMsgBoxDb 資料庫的 EdiInt_Mic 資料表中。</span><span class="sxs-lookup"><span data-stu-id="e6c56-146">The send pipeline saves the hash value in the EdiInt_Mic table of the BizTalkMsgBoxDb database.</span></span> <span data-ttu-id="e6c56-147">AS2 訊息是在這個資料表中加以追蹤，以 AS2From、AS2To 和 MessageID 等值，連同伴隨的 MICHashValue 資料行，做為其唯一識別。</span><span class="sxs-lookup"><span data-stu-id="e6c56-147">AS2 messages are tracked in this table, identified uniquely by the AS2From, AS2To, and MessageID values, with an accompanying MICHashValue column.</span></span> <span data-ttu-id="e6c56-148">訊息接收者會在處理訊息內容時計算 MIC 雜湊值，並將雜湊值包含在其所傳回的 MDN 中。</span><span class="sxs-lookup"><span data-stu-id="e6c56-148">The receiver of the message calculates the MIC hash value when it processes the message payload, and includes the hash value in the MDN that it returns.</span></span> <span data-ttu-id="e6c56-149">原始訊息的傳送者將會比較其接收之 MDN，以及其所儲存的雜湊值。</span><span class="sxs-lookup"><span data-stu-id="e6c56-149">The sender of the original message will compare the MIC hash value in the MDN that it receives with the hash value that it saved.</span></span> <span data-ttu-id="e6c56-150">如果兩者相符，它就會處置 MDN，並刪除 EdiInt_Mic 資料表中的項目，以完成傳輸作業。</span><span class="sxs-lookup"><span data-stu-id="e6c56-150">If they match, it disposes of the MDN, deletes the entry in the EdiInt_Mic table, and the transmission is complete.</span></span>  
  
 <span data-ttu-id="e6c56-151">MIC 使用 Base64 編碼。</span><span class="sxs-lookup"><span data-stu-id="e6c56-151">The MIC is base64 encoded.</span></span> <span data-ttu-id="e6c56-152">套用至 MIC 的演算法可以是 SHA1 或 MD5。</span><span class="sxs-lookup"><span data-stu-id="e6c56-152">The algorithm to be applied for the MIC can be SHA1 or MD5.</span></span> <span data-ttu-id="e6c56-153">取決於**簽署演算法**下拉式清單 (如果已啟用**要求簽署的 MDN**會檢查屬性) 在**傳送者 MDN 設定**頁面的單向協議索引標籤中**協議屬性** 對話方塊。</span><span class="sxs-lookup"><span data-stu-id="e6c56-153">It is determined from the **Signing Algorithm** drop-down (enabled if **Request Signed MDN** property is checked) in the **Sender MDN Settings** page of the one-way agreement tab in the **Agreement Properties** dialog box.</span></span> <span data-ttu-id="e6c56-154">它也會根據原始訊息的 Signed-Receipt-MICalg AS2 標頭來決定。</span><span class="sxs-lookup"><span data-stu-id="e6c56-154">It is also determined from the Signed-Receipt-MICalg AS2 header of the original message.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="e6c56-155">另請參閱</span><span class="sxs-lookup"><span data-stu-id="e6c56-155">See Also</span></span>  
 <span data-ttu-id="e6c56-156">[AS2 訊息](../core/as2-messages.md) </span><span class="sxs-lookup"><span data-stu-id="e6c56-156">[AS2 Messages](../core/as2-messages.md) </span></span>  
 <span data-ttu-id="e6c56-157">[處理內送 MDN](../core/processing-an-incoming-mdn.md) </span><span class="sxs-lookup"><span data-stu-id="e6c56-157">[Processing an Incoming MDN](../core/processing-an-incoming-mdn.md) </span></span>  
 [<span data-ttu-id="e6c56-158">傳送外寄 MDN</span><span class="sxs-lookup"><span data-stu-id="e6c56-158">Sending an Outgoing MDN</span></span>](../core/sending-an-outgoing-mdn.md)