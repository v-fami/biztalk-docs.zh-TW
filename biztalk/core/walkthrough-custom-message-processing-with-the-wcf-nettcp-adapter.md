---
title: "逐步解說： 使用 Wcf-nettcp 配接器處理的自訂訊息 |Microsoft 文件"
ms.custom: 
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: b56b7492-2ea0-4c63-8f1b-430eb277517d
caps.latest.revision: "32"
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 9a7123d908f25e6575eaaba4f9a92608f17c88be
ms.sourcegitcommit: 3fd1c85d9dc2ce7b77da75a5c2087cc48cfcbe50
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/17/2018
---
# <a name="walkthrough-custom-message-processing-with-the-wcf-nettcp-adapter"></a><span data-ttu-id="2cffb-102">逐步解說： 使用 Wcf-nettcp 配接器處理的自訂訊息</span><span class="sxs-lookup"><span data-stu-id="2cffb-102">Walkthrough: Custom Message Processing with the WCF-NetTcp Adapter</span></span>
<span data-ttu-id="2cffb-103">在本逐步解說[!INCLUDE[firstref_btsWinCommFoundation](../includes/firstref-btswincommfoundation-md.md)]用戶端提交[!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)]訊息，其中包含內嵌二進位 JPEG 影像資料的 BizTalk 接收位置使用 Wcf-nettcp 配接器。</span><span class="sxs-lookup"><span data-stu-id="2cffb-103">In this walkthrough a [!INCLUDE[firstref_btsWinCommFoundation](../includes/firstref-btswincommfoundation-md.md)] client submits a [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] message containing embedded binary JPEG image data to a BizTalk receive location using the WCF-NetTcp adapter.</span></span> <span data-ttu-id="2cffb-104">透過使用 XPath 陳述式 （具有節點 Base64 編碼） 擷取二進位編碼的 JPEG 影像，取得 **輸入訊息內文** 配接器的組態中的設定。</span><span class="sxs-lookup"><span data-stu-id="2cffb-104">The binary encoded JPEG image gets extracted by using an XPath statement (with Base64 Node encoding) through the **Inbound Message Body** settings in the adapter’s configuration.</span></span> <span data-ttu-id="2cffb-105">XPath 處理不同於預設方法，[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]用來處理內送訊息。</span><span class="sxs-lookup"><span data-stu-id="2cffb-105">XPath processing differs from the default method that [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] uses to handle incoming messages.</span></span> <span data-ttu-id="2cffb-106">在預設方法中，配接器取得的整個內容**主體**元素[!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)]訊息、，然後將它提交到 BizTalk MessageBox 資料庫。</span><span class="sxs-lookup"><span data-stu-id="2cffb-106">In the default method, the adapter obtains the entire contents of the **Body** element of the [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] message, and then submits it to the BizTalk MessageBox database.</span></span> <span data-ttu-id="2cffb-107">XPath 訊息處理會擷取特定的傳入部分[!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)]訊息以建立自訂的 BizTalk 訊息。</span><span class="sxs-lookup"><span data-stu-id="2cffb-107">XPath message processing extracts specific parts of an incoming [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] message to create a custom BizTalk message.</span></span> <span data-ttu-id="2cffb-108">在此範例中 XPath 處理尋找名為 XML 項目**SendPicture**傳入[!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)]訊息 （這是以 XML 格式）。</span><span class="sxs-lookup"><span data-stu-id="2cffb-108">In this sample XPath processing locates an XML element named **SendPicture** in the incoming [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] message (which is in XML format).</span></span> <span data-ttu-id="2cffb-109">在發現該元素，XPath 擷取的項目值做為二進位 Base64 編碼物件，並將該二進位值放入 BizTalk 訊息。</span><span class="sxs-lookup"><span data-stu-id="2cffb-109">After finding that element, XPath extracts the element's value as a binary Base64 encoded object, and places that binary value into a BizTalk message.</span></span> <span data-ttu-id="2cffb-110">訊息會發佈到 MessageBox 資料庫，然後輸出至檔案傳送埠的傳送埠篩選訂閱幫助。</span><span class="sxs-lookup"><span data-stu-id="2cffb-110">The message is published to the MessageBox database, then output to a FILE send port with the help of a send port filter subscription.</span></span> <span data-ttu-id="2cffb-111">在此範例中，使用沒有協調流程和所有處理都都透過 BizTalk 傳訊，其使用 XPath。</span><span class="sxs-lookup"><span data-stu-id="2cffb-111">No orchestrations are used in this sample, and all the processing is done through BizTalk messaging using XPath.</span></span>  
  
 <span data-ttu-id="2cffb-112">A[!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)]配接器用來與通訊[!INCLUDE[firstref_btsWinCommFoundation](../includes/firstref-btswincommfoundation-md.md)]用戶端和[!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)]遠端服務從[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="2cffb-112">A [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] adapter is used to communicate with [!INCLUDE[firstref_btsWinCommFoundation](../includes/firstref-btswincommfoundation-md.md)] clients and [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] remote services from [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)].</span></span>  <span data-ttu-id="2cffb-113">它可讓協調流程和結構描述發行成[!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)]服務、 以及也可讓您使用外部 WCF 服務協調流程。</span><span class="sxs-lookup"><span data-stu-id="2cffb-113">It allows orchestrations and schemas to be published as [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] services, and also provides the ability for an orchestration to consume external WCF services.</span></span> <span data-ttu-id="2cffb-114">Wcf-nettcp 配接器會使用 **NetTcpBinding** 繫結，這表示 TCP 傳輸使用最佳化的二進位訊息編碼方式。</span><span class="sxs-lookup"><span data-stu-id="2cffb-114">The WCF-NetTcp adapter uses the **NetTcpBinding** binding, which means the TCP transport using an optimized binary message encoding.</span></span> <span data-ttu-id="2cffb-115">Wcf-nettcp 配接器是由傳送配接器和接收配接器所組成。</span><span class="sxs-lookup"><span data-stu-id="2cffb-115">The WCF-NetTcp adapter consists of both a send adapter and a receive adapter.</span></span> <span data-ttu-id="2cffb-116">該配接器可完整存取 SOAP 安全性、可靠性和交易功能。</span><span class="sxs-lookup"><span data-stu-id="2cffb-116">It provides full access to SOAP security, reliability, and transaction features.</span></span>  
  
 <span data-ttu-id="2cffb-117">完成此逐步解說之後，您將會瞭解如何執行下列工作：</span><span class="sxs-lookup"><span data-stu-id="2cffb-117">After completing this walkthrough, you will understand how to perform the following tasks:</span></span>  
  
-   <span data-ttu-id="2cffb-118">使用 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 管理主控台匯入 MSI 檔案，以建立傳送埠、接受埠和接收位置。</span><span class="sxs-lookup"><span data-stu-id="2cffb-118">By using the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] Administration console, import an MSI file to create a send port, a receive port, and a receive location.</span></span>  
  
-   <span data-ttu-id="2cffb-119">使用[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]系統管理主控台中，設定[!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)]接收位置，才能執行 XPath 陳述式要從中擷取資料**SendPicture**元素[!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)]訊息。</span><span class="sxs-lookup"><span data-stu-id="2cffb-119">By using the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] Administration console, configure a [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] receive location to run an XPath statement to extract data from the **SendPicture** element of the [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] message.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="2cffb-120">**Hosttrusted** 項目會指定與接收處理常式關聯的主控件是否受到信任。</span><span class="sxs-lookup"><span data-stu-id="2cffb-120">The **hosttrusted** element specifies whether the host associated with the receive handler is trusted.</span></span> <span data-ttu-id="2cffb-121">在 bindings.xml 檔案中，它設定為其預設值為`false`因為在此範例中我們不在意[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]企業單一登入服務 (SSO)。</span><span class="sxs-lookup"><span data-stu-id="2cffb-121">In the bindings.xml file, it is set to its default setting of `false` because in this sample we don't care about the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] Enterprise Single Sign-On service (SSO).</span></span> <span data-ttu-id="2cffb-122">SSO 可讓使用者認證，透過傳遞[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]整合協力廠商應用程式與[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="2cffb-122">SSO allows the passing of user credentials through [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] to integrate third-party applications with [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)].</span></span> <span data-ttu-id="2cffb-123">A `false` 設定可防止 BizTalk 訊息通過 BizTalk 服務，為 SSO 處理程序中。</span><span class="sxs-lookup"><span data-stu-id="2cffb-123">A `false` setting prevents a BizTalk message from passing through the BizTalk service as part of the SSO processing.</span></span>  
  
## <a name="prerequisites"></a><span data-ttu-id="2cffb-124">必要條件</span><span class="sxs-lookup"><span data-stu-id="2cffb-124">Prerequisites</span></span>  
 <span data-ttu-id="2cffb-125">執行此範例中的步驟可以確保您的環境會安裝下列必要條件。</span><span class="sxs-lookup"><span data-stu-id="2cffb-125">To perform the steps in this sample ensure that your environment installs the following prerequisites;</span></span>  
  
-   <span data-ttu-id="2cffb-126">建置組件，並執行部署程序的電腦和執行範例的電腦需要 Microsoft [!INCLUDE[btsWinSvr2k8](../includes/btswinsvr2k8-md.md)]，Microsoft [!INCLUDE[netfx40_short](../includes/netfx40-short-md.md)]，與 Microsoft BizTalk Server。</span><span class="sxs-lookup"><span data-stu-id="2cffb-126">Both the computer that builds the assemblies and runs the deployment process, and the computer that runs the sample, require Microsoft [!INCLUDE[btsWinSvr2k8](../includes/btswinsvr2k8-md.md)], Microsoft [!INCLUDE[netfx40_short](../includes/netfx40-short-md.md)], and Microsoft BizTalk Server.</span></span>  
  
-   <span data-ttu-id="2cffb-127">用來建置組件並執行部署程序的電腦需要 Microsoft Visual Studio。</span><span class="sxs-lookup"><span data-stu-id="2cffb-127">The computer used to build the assemblies and run the deployment process requires Microsoft Visual Studio.</span></span>  
  
-   <span data-ttu-id="2cffb-128">執行此範例的電腦需要[!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)]配接器和[!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)]系統管理工具。</span><span class="sxs-lookup"><span data-stu-id="2cffb-128">The computer that runs the sample requires the [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] Adapters and the [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] Administration Tools.</span></span> <span data-ttu-id="2cffb-129">這些是 Microsoft BizTalk Server 安裝期間安裝的選項。</span><span class="sxs-lookup"><span data-stu-id="2cffb-129">These are options to install during setup of Microsoft BizTalk Server.</span></span>  
  
-   <span data-ttu-id="2cffb-130">在電腦上您用來執行管理工作，您必須以成員的使用者帳戶執行[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]Administrators 群組，才能設定[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]內的應用程式設定[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]管理主控台。</span><span class="sxs-lookup"><span data-stu-id="2cffb-130">On the computers that you use to perform administrative tasks, you must run as a user account that is a member of the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] Administrators group to configure the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] application settings within the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] Administration console.</span></span> <span data-ttu-id="2cffb-131">此使用者帳戶也必須管理主控件執行個體，並可能需要其他工作的應用程式部署的本機 Administrators 群組成員。</span><span class="sxs-lookup"><span data-stu-id="2cffb-131">This user account must also be a member of the local Administrators group for application deployment, managing host instances, and other tasks that may be required.</span></span>  
  
-   <span data-ttu-id="2cffb-132">需要的任何電腦上[!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)]功能，完成的單次安裝程序[!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)]範例[http://go.microsoft.com/fwlink/?LinkId=135510](http://go.microsoft.com/fwlink/?LinkId=135510)。</span><span class="sxs-lookup"><span data-stu-id="2cffb-132">On any computer that requires [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] capability, complete the one-time setup procedure for the [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] samples at [http://go.microsoft.com/fwlink/?LinkId=135510](http://go.microsoft.com/fwlink/?LinkId=135510).</span></span>  
  
-   <span data-ttu-id="2cffb-133">執行範例，並匯入到.msi 檔案的電腦上[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]，請確定主機不受信任的主機，或匯入將會失敗。</span><span class="sxs-lookup"><span data-stu-id="2cffb-133">On the computer that runs the sample and imports an .msi file into [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)], ensure the host is not a trusted host or the import will fail.</span></span>  
  
-   <span data-ttu-id="2cffb-134">您必須下載逐步解說程式碼，並將它解壓縮到您的電腦。</span><span class="sxs-lookup"><span data-stu-id="2cffb-134">You must download the walkthrough code and extract it to your computer.</span></span>  <span data-ttu-id="2cffb-135">這個逐步解說是整個屬於[!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)]配接器逐步解說 」 套件。</span><span class="sxs-lookup"><span data-stu-id="2cffb-135">This walkthrough is a part of the entire [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] Adapter Walkthrough package.</span></span> <span data-ttu-id="2cffb-136">您可以下載檔案**WCFAdapterWalkthroughs.exe**從[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]Developer Center [http://go.microsoft.com/fwlink/?LinkId=194140](http://go.microsoft.com/fwlink/?LinkId=194140)。</span><span class="sxs-lookup"><span data-stu-id="2cffb-136">You can download the file **WCFAdapterWalkthroughs.exe** from the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] Developer Center at [http://go.microsoft.com/fwlink/?LinkId=194140](http://go.microsoft.com/fwlink/?LinkId=194140).</span></span>  
  
### <a name="configure-the-wcfcustommessageprocessing-application-and-artifacts"></a><span data-ttu-id="2cffb-137">設定 WCFCustomMessageProcessing 應用程式和成品</span><span class="sxs-lookup"><span data-stu-id="2cffb-137">Configure the WCFCustomMessageProcessing application and artifacts</span></span>  
  
1.  <span data-ttu-id="2cffb-138">在[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]管理主控台中，以滑鼠右鍵按一下**應用程式**，選取**匯入**，然後選取**MSI 檔案**。</span><span class="sxs-lookup"><span data-stu-id="2cffb-138">In the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] Administration console, right-click **Applications**, select **Import**, and then select **MSI file**.</span></span> <span data-ttu-id="2cffb-139">移至 **C:\WCFCustomMessageProcessing\WCFCustomMessageProcessing.msi** 檔案，然後再按一下 **開啟**。</span><span class="sxs-lookup"><span data-stu-id="2cffb-139">Go to the **C:\WCFCustomMessageProcessing\WCFCustomMessageProcessing.msi** file, and then click **Open**.</span></span> <span data-ttu-id="2cffb-140">這會建立此應用程式的下列成品︰</span><span class="sxs-lookup"><span data-stu-id="2cffb-140">This creates the following artifacts for this application:</span></span>  
  
    -   <span data-ttu-id="2cffb-141">**FileSP**傳送埠： 上的本機檔案系統位置**C:\WCFCustomMessageProcessing\Out**的 JPEG 影像資料所傳送[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]作為最終輸出的範例處理。</span><span class="sxs-lookup"><span data-stu-id="2cffb-141">**FileSP** send port: The location on the local file system of **C:\WCFCustomMessageProcessing\Out** where the JPEG image data is sent by [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] as the final output of the sample processing.</span></span> <span data-ttu-id="2cffb-142">您可以檢視傳送埠篩選條件的 **BTS。RecievePortName = NetTcpRP** 中設定 **FileSP 屬性** 對話方塊下的 **篩選**。</span><span class="sxs-lookup"><span data-stu-id="2cffb-142">You can view the send port filter of **BTS.RecievePortName = NetTcpRP** configured in the **FileSP Properties** dialog box under **Filters**.</span></span> <span data-ttu-id="2cffb-143">相關聯的篩選器，是使用 NetTcp 接收埠。</span><span class="sxs-lookup"><span data-stu-id="2cffb-143">The filter is associated with the NetTcp receive port.</span></span> <span data-ttu-id="2cffb-144">接收埠將會傳送至 FileSP NetTcpRP 上接受任何訊息傳送連接埠的輸出位置 **C:\WCFCustomMessageProcessing\Out** 接收位置執行 XPath 處理訊息之後。</span><span class="sxs-lookup"><span data-stu-id="2cffb-144">Any messages accepted on the NetTcpRP receive port will be sent to the FileSP send port output location of **C:\WCFCustomMessageProcessing\Out** after the receive location executes the XPath processing on the message.</span></span>  
  
    -   <span data-ttu-id="2cffb-145">**NetTcpRP** 接收埠︰ 在邏輯上包含的連接埠 **NetTcpRL** 接收位置。</span><span class="sxs-lookup"><span data-stu-id="2cffb-145">**NetTcpRP** receive port: The port that logically contains the **NetTcpRL** receive location.</span></span>  
  
    -   <span data-ttu-id="2cffb-146">**NetTcpRL**接收位置： 這會使用預設**PassThroughTransmit**管線和 Wcf-nettcp 配接器執行 XPath 陳述式提取 JPEG 影像的內送的資料[!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)]訊息。</span><span class="sxs-lookup"><span data-stu-id="2cffb-146">**NetTcpRL** receive location: This uses the default **PassThroughTransmit** pipeline and the WCF-NetTcp adapter to run an XPath statement to pull the JPEG image data out of the incoming [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] message.</span></span>  
  
### <a name="alternative-steps-to-configure-the-wcfcustommessageprocessing-application"></a><span data-ttu-id="2cffb-147">若要設定 WCFCustomMessageProcessing 應用程式的替代步驟</span><span class="sxs-lookup"><span data-stu-id="2cffb-147">Alternative steps to configure the WCFCustomMessageProcessing application</span></span>  
  
-   <span data-ttu-id="2cffb-148">或者，以下是手動步驟，設定應用程式，而不使用 **C:\WCFCustomMessageProcessing\bindings.xml** 檔案。</span><span class="sxs-lookup"><span data-stu-id="2cffb-148">Alternatively, here are the manual steps to configure the application without using the **C:\WCFCustomMessageProcessing\bindings.xml** file.</span></span> <span data-ttu-id="2cffb-149">您不需要執行這項操作，如果先前的繫結檔案匯入程序能正常運作。</span><span class="sxs-lookup"><span data-stu-id="2cffb-149">You do not need to do this if the previous binding file import process works correctly.</span></span>  <span data-ttu-id="2cffb-150">但是，在閱讀本文後，可能會增加您不知情的情形與 MSI 檔案。</span><span class="sxs-lookup"><span data-stu-id="2cffb-150">But, reading it may increase your knowledge of what is going on with the MSI file.</span></span>  
  
-   <span data-ttu-id="2cffb-151">建立單向接收埠 (**NetTcpRP**) 和接收位置 (**NetTcpRL**)。</span><span class="sxs-lookup"><span data-stu-id="2cffb-151">Create a one-way receive port (**NetTcpRP**) and a receive location (**NetTcpRL**).</span></span>  
  
    1.  <span data-ttu-id="2cffb-152">展開 **WCFCustomMessageProcessing** 應用程式，以滑鼠右鍵按一下 **接收埠**, ，請選取 **新增**, ，然後選取 **單向接收埠**。</span><span class="sxs-lookup"><span data-stu-id="2cffb-152">Expand the **WCFCustomMessageProcessing** application, right-click **Receive Ports**, select **New**, and select **One-way Receive Port**.</span></span> <span data-ttu-id="2cffb-153">在 **接收埠屬性** 對話方塊方塊中，輸入 `NetTcpRP` 的 **名稱**, ，然後按一下 **確定**。</span><span class="sxs-lookup"><span data-stu-id="2cffb-153">In the **Receive Port Properties** dialog box, enter `NetTcpRP` for **Name**, and click **OK**.</span></span>  
  
    2.  <span data-ttu-id="2cffb-154">以滑鼠右鍵按一下 **NetTcpRP** 接收埠，請選取 **新增**, ，然後選取 **接收位置**。</span><span class="sxs-lookup"><span data-stu-id="2cffb-154">Right-click the **NetTcpRP** receive port, select **New**, and select **Receive Location**.</span></span> <span data-ttu-id="2cffb-155">在 **接收位置屬性**  對話方塊中，輸入 `NetTcRL` 的 **名稱**。</span><span class="sxs-lookup"><span data-stu-id="2cffb-155">In the **Receive Location Properties** dialog box, enter `NetTcRL` for **Name**.</span></span> <span data-ttu-id="2cffb-156">在 **傳輸** 區段中，按一下 **類型** 下拉式清單方塊中，選取 **Wcf-nettcp** 從下拉式清單，然後按一下  **設定**。</span><span class="sxs-lookup"><span data-stu-id="2cffb-156">In the **Transport** section, click the **Type** drop-down list box, select **WCF-NetTcp** from the drop-down list, and then click **Configure**.</span></span>  
  
    3.  <span data-ttu-id="2cffb-157">在 **一般** 索引標籤上，輸入 **net.tcp://localhost/NetTcpRL/Image** 中 **Address(URI)** 欄位。</span><span class="sxs-lookup"><span data-stu-id="2cffb-157">On the **General** tab, enter **net.tcp://localhost/NetTcpRL/Image** in the **Address(URI)** field.</span></span>  
  
    4.  <span data-ttu-id="2cffb-158">在 **安全性** 索引標籤上，設定 **安全性模式** 至 **None。**</span><span class="sxs-lookup"><span data-stu-id="2cffb-158">On the **Security** tab, set the **Security mode** to **None.**</span></span>  
  
    5.  <span data-ttu-id="2cffb-159">在 **訊息** 索引標籤上，選取 **路徑** 選項 **輸入 BizTalk 訊息內文**, ，並輸入 `/*[local-name()="SendPicture" and namespace-uri()='http://tempuri.org/']/*[local-name()="stream"]` 的內文路徑運算式。</span><span class="sxs-lookup"><span data-stu-id="2cffb-159">On the **Message** tab, select the **Path** option for the **Inbound BizTalk message body**, and enter `/*[local-name()="SendPicture" and namespace-uri()='http://tempuri.org/']/*[local-name()="stream"]` for the body path expression.</span></span> <span data-ttu-id="2cffb-160">選取 **Base64** 為 **節點編碼**。</span><span class="sxs-lookup"><span data-stu-id="2cffb-160">Select **Base64** as the **Node Encoding**.</span></span> <span data-ttu-id="2cffb-161">**路徑**選項會設定為值，因為主體[!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)]訊息[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]接收是以下列格式：  **\<SendPicture xmlns ="http://tempuri.org/"\>\<資料流\>*實際 base 64 編碼的二進位影像資料*\</資料流\>\</SendPicture\>**</span><span class="sxs-lookup"><span data-stu-id="2cffb-161">The **Path** option is set to value because the body of the [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] message that [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] receives is in the following format: **\<SendPicture xmlns="http://tempuri.org/"\>\<stream\>*actual base 64 encoded binary image data*\</stream\>\</SendPicture\>**</span></span>  
  
    6.  <span data-ttu-id="2cffb-162">在 **接收位置屬性** 對話方塊中，按一下  **確定**。</span><span class="sxs-lookup"><span data-stu-id="2cffb-162">In the **Receive Location Properties** dialog box, click **OK**.</span></span>  
  
-   <span data-ttu-id="2cffb-163">建立單向 file 傳送埠 (FileSP) NetTcpRP 訂閱接收埠。</span><span class="sxs-lookup"><span data-stu-id="2cffb-163">Create a one-way file send port (FileSP) subscribed to the NetTcpRP receive port.</span></span>  
  
    1.  <span data-ttu-id="2cffb-164">以滑鼠右鍵按一下 **傳送埠**, ，請選取 **新增**, ，然後選取 **單向接收埠**。</span><span class="sxs-lookup"><span data-stu-id="2cffb-164">Right-click **Send Ports**, select **New**, and select **One-way Receive Port**.</span></span> <span data-ttu-id="2cffb-165">選取 **靜態單向連接埠**。</span><span class="sxs-lookup"><span data-stu-id="2cffb-165">Select **Static One-way Port**.</span></span> <span data-ttu-id="2cffb-166">輸入 `FileSP` 的 **名稱**。</span><span class="sxs-lookup"><span data-stu-id="2cffb-166">Enter `FileSP` for **Name**.</span></span>  
  
    2.  <span data-ttu-id="2cffb-167">在 **傳輸** 區段中，按一下 **類型** 下拉式清單方塊中，選取 **檔案** 從下拉式清單，然後按一下  **設定**。</span><span class="sxs-lookup"><span data-stu-id="2cffb-167">In the **Transport** section, click the **Type** drop-down list box, select **FILE** from the drop-down list, and then click **Configure**.</span></span>  
  
    3.  <span data-ttu-id="2cffb-168">在 **目的地資料夾** 輸入 `C:\WCFCustomMessageProcessing\Out`, ，然後按一下 **確定**。</span><span class="sxs-lookup"><span data-stu-id="2cffb-168">Under **Destination Folder** enter `C:\WCFCustomMessageProcessing\Out`, and click **OK**.</span></span>  
  
    4.  <span data-ttu-id="2cffb-169">按一下  **篩選**, ，請選取 `BTS.ReceivePortName == NetTcpRP`, ，然後按一下  **確定。**</span><span class="sxs-lookup"><span data-stu-id="2cffb-169">Click **Filters**, select `BTS.ReceivePortName == NetTcpRP`, and then click **OK.**</span></span>  
  
### <a name="configure-the-send-port-and-run-the-application"></a><span data-ttu-id="2cffb-170">設定傳送埠和執行應用程式</span><span class="sxs-lookup"><span data-stu-id="2cffb-170">Configure the send port and run the application</span></span>  
  
1.  <span data-ttu-id="2cffb-171">以滑鼠右鍵按一下 **WCFCustomMessageProcessing** 應用程式，並選取 **啟動**。</span><span class="sxs-lookup"><span data-stu-id="2cffb-171">Right-click the **WCFCustomMessageProcessing** application and select **Start**.</span></span> <span data-ttu-id="2cffb-172">會登記 NetTcpRL 接收位置，然後啟動 FileSP 傳送埠。</span><span class="sxs-lookup"><span data-stu-id="2cffb-172">That will enlist the NetTcpRL receive location and start the FileSP send port.</span></span>  
  
2.  <span data-ttu-id="2cffb-173">在[!INCLUDE[btsVStudioNoVersion](../includes/btsvstudionoversion-md.md)]，接著請開啟`Client.sln`檔案從**C:WCFCustomMessageProcessing\Client**資料夾。</span><span class="sxs-lookup"><span data-stu-id="2cffb-173">In [!INCLUDE[btsVStudioNoVersion](../includes/btsvstudionoversion-md.md)], open up the `Client.sln` file from the **C:WCFCustomMessageProcessing\Client** folder.</span></span> <span data-ttu-id="2cffb-174">在 [方案總管] 中，以滑鼠右鍵按一下 **用戶端** 專案，然後選取 **建置**。</span><span class="sxs-lookup"><span data-stu-id="2cffb-174">In Solution Explorer, right-click the **Client** project and select **Build**.</span></span>  
  
3.  <span data-ttu-id="2cffb-175">在[!INCLUDE[btsVStudioNoVersion](../includes/btsvstudionoversion-md.md)]，選取**偵錯**，然後選取**啟動但不偵錯**執行 Client.exe 應用程式。</span><span class="sxs-lookup"><span data-stu-id="2cffb-175">In [!INCLUDE[btsVStudioNoVersion](../includes/btsvstudionoversion-md.md)], select **Debug**, and then select **Start Without Debugging** to run the Client.exe application.</span></span> <span data-ttu-id="2cffb-176">命令提示字元會顯示指出映像已提交給[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="2cffb-176">A command prompt will appear saying the image was submitted to [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)].</span></span>  
  
4.  <span data-ttu-id="2cffb-177">觀察成功 {GUID}.jpg 檔案輸出，以傳送連接埠檔案資料夾的 **C:\WCFCustomMessageProcessing\Out**。這會顯示應用程式處理解壓縮 JPEG 檔案，並寫入它的檔案傳送埠已順利完成。</span><span class="sxs-lookup"><span data-stu-id="2cffb-177">Observe the successful {GUID}.jpg file output to the send port file folder of **C:\WCFCustomMessageProcessing\Out**. This shows that the application processing to extract the JPEG file and write it out to a FILE send port completed successfully.</span></span>