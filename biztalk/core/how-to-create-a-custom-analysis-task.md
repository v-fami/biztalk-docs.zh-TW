---
title: 如何建立自訂分析工作 |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
helpviewer_keywords:
- BAM, DTS tasks
- DTS tasks
- DTS packages, tasks
- BAM, processing
ms.assetid: 6046c113-fb58-4e72-8f48-5470e52be9a8
caps.latest.revision: 7
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: f8683e95373bbfa806cc9ac9ae27e90a661d006e
ms.sourcegitcommit: 266308ec5c6a9d8d80ff298ee6051b4843c5d626
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 06/27/2018
ms.locfileid: "36977583"
---
# <a name="how-to-create-a-custom-analysis-task"></a><span data-ttu-id="01d53-102">如何建立自訂分析工作</span><span class="sxs-lookup"><span data-stu-id="01d53-102">How to Create a Custom Analysis Task</span></span>
<span data-ttu-id="01d53-103">建立自訂 DTS 工作處理 BAM 資料最簡單的方式，就是從 BAM 自動產生的封裝開始，取代所有實際的資料處理。</span><span class="sxs-lookup"><span data-stu-id="01d53-103">The easiest way to create a custom DTS task for processing BAM data is to start from the package that is auto-generated by BAM and replace all the actual data processing.</span></span>  
  
### <a name="to-create-a-custom-dts-task"></a><span data-ttu-id="01d53-104">建立自訂 DTS 工作</span><span class="sxs-lookup"><span data-stu-id="01d53-104">To create a custom DTS task</span></span>  
  
1. <span data-ttu-id="01d53-105">建立需要 OLAP Cube 的 BAM 定義。</span><span class="sxs-lookup"><span data-stu-id="01d53-105">Create a BAM Definition that requires an OLAP cube.</span></span> <span data-ttu-id="01d53-106">例如，請使用 Excel 精靈，將一份 PivotTable® 報告保留為非 RTA 檢視。</span><span class="sxs-lookup"><span data-stu-id="01d53-106">For example use the Excel wizards, and leave one PivotTable® report as non-RTA view.</span></span>  
  
2. <span data-ttu-id="01d53-107">開啟 BAM 所建立的 DTS 封裝，進行 Cube 處理。</span><span class="sxs-lookup"><span data-stu-id="01d53-107">Open the DTS package for cube processing that BAM creates.</span></span> <span data-ttu-id="01d53-108">BAM 會建立一個這類套件針對每個檢視，稱為 BAM_AN_\<*檢視表名稱*\>。</span><span class="sxs-lookup"><span data-stu-id="01d53-108">BAM creates one such package for each view, known as BAM_AN_\<*View Name*\>.</span></span>  
  
3. <span data-ttu-id="01d53-109">在 DTS 設計師中開啟這個封裝，然後將前兩個和最後一個步驟之外的所有步驟全部移除。</span><span class="sxs-lookup"><span data-stu-id="01d53-109">Open the Package in the DTS Designer and remove all steps except the first two steps and the last step.</span></span> <span data-ttu-id="01d53-110">此外，您需要保持與主要匯入資料庫的連接。</span><span class="sxs-lookup"><span data-stu-id="01d53-110">You may also want to keep the connection to the Primary Import database.</span></span>  
  
4. <span data-ttu-id="01d53-111">編輯第一個 ActiveX® 工作的屬性。</span><span class="sxs-lookup"><span data-stu-id="01d53-111">Edit the properties of the first ActiveX® task.</span></span> <span data-ttu-id="01d53-112">移除包含 DTSGlobalVariables.Parent.Steps 的所有指令碼行，因為它們參考到已刪除的步驟。</span><span class="sxs-lookup"><span data-stu-id="01d53-112">Remove all lines that contain DTSGlobalVariables.Parent.Steps, because they refer to the deleted steps.</span></span> <span data-ttu-id="01d53-113">指令碼的開頭如下：</span><span class="sxs-lookup"><span data-stu-id="01d53-113">The script begins with:</span></span>  
  
   ```  
   serverName = "<your server here>"   
   databaseName = "<your analysis database here>"  
   cubeName = "<your cube name here>"  
   ```  
  
   > [!NOTE]
   >  <span data-ttu-id="01d53-114">「開始資料分析」工作 (封裝中的第二個工作) 非常重要，因為它為您的封裝提供：</span><span class="sxs-lookup"><span data-stu-id="01d53-114">The task "Begin Data Analysis" (the second task in the package) is very important because it gives your package:</span></span>  
   > 
   > - <span data-ttu-id="01d53-115">移動的視窗，可進行已完成活動的累加處理 (名稱為 bam_(BamView)_View(Activity)_CompletedInstancesWindow 的動態 SQL 檢視)。</span><span class="sxs-lookup"><span data-stu-id="01d53-115">A moving window for incremental processing of the completed Activities (the dynamic SQL view named  bam_(BamView)_View(Activity)_CompletedInstancesWindow</span></span>  
   >   -   <span data-ttu-id="01d53-116">進度-名為 bam 的資料表中之活動的快照集\_(BamView) _View (Activity) _ActiveInstancesSnapshot。</span><span class="sxs-lookup"><span data-stu-id="01d53-116">A Snapshot of the Activities that are in progress - a table named  bam\_(BamView)_View(Activity)_ActiveInstancesSnapshot.</span></span>  
  
5. <span data-ttu-id="01d53-117">在簡短的交易中取得檢視和資料表，在這段交易期間您不會插入任何資料，所以這份資料就代表主要匯入資料庫的即時快照集。</span><span class="sxs-lookup"><span data-stu-id="01d53-117">Obtain the view and table in a short transaction, during which you insert no data, so that the data represents a real instantaneous snapshot of the Primary Import database.</span></span> <span data-ttu-id="01d53-118">請根據檢視和資料表做為輸入資料，執行一或多個步驟來完成實際的資料轉換。</span><span class="sxs-lookup"><span data-stu-id="01d53-118">Implement one or more steps to do the actual data transformations based on the view and table as input data.</span></span> <span data-ttu-id="01d53-119">如果您分析工作的目的不是要填滿 OLAP Cube，請記得保存最後一次執行工作的時間戳記，並以將此時間戳記指派給 "CompletedCubeLastProcessTime" 全域變數的程式碼取代第一個 ActiveX 工作。</span><span class="sxs-lookup"><span data-stu-id="01d53-119">If the purpose of your analysis task is something other than filling an OLAP cube, remember to keep a timestamp of when your job committed for the last time and replace the first ActiveX task with code that assigns this timestamp to the global variable "CompletedCubeLastProcessTime".</span></span> <span data-ttu-id="01d53-120">第二個工作就會使用此變數確保不會遺失任何資料，以及在 DTS 封裝損毀和重新啟動時，不會有任何資料處理兩次的情形。</span><span class="sxs-lookup"><span data-stu-id="01d53-120">The second task uses this variable to make sure that there is no missed data and that no data processes twice in case of a crash and restart of the DTS package.</span></span>  
  
6. <span data-ttu-id="01d53-121">最後，您必須呼叫最後一個工作，也就是「結束資料分析」。</span><span class="sxs-lookup"><span data-stu-id="01d53-121">Finally, you must call the last task, which is "end data analysis".</span></span> <span data-ttu-id="01d53-122">這個工作會釋放處理過的已完成活動，當它們一離開線上視窗時就會予以封存並從主要匯入中移除。</span><span class="sxs-lookup"><span data-stu-id="01d53-122">This task releases the completed activities that were processed, so that they can be archived and removed from the primary import once they are outside of the online window.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="01d53-123">另請參閱</span><span class="sxs-lookup"><span data-stu-id="01d53-123">See Also</span></span>  
 [<span data-ttu-id="01d53-124">使用商務活動監控</span><span class="sxs-lookup"><span data-stu-id="01d53-124">Using Business Activity Monitoring</span></span>](../core/using-business-activity-monitoring.md)