---
title: "如何在協調流程中建立角色連結 |Microsoft 文件"
ms.custom: 
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: cc386ac2-a851-4342-9ceb-0b6faddf4ece
caps.latest.revision: "13"
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: e40a77392af9e97791cd9afbacc8f0b533f60288
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 09/20/2017
---
# <a name="how-to-create-role-links-in-orchestrations"></a><span data-ttu-id="831a7-102">如何在協調流程中建立角色連結</span><span class="sxs-lookup"><span data-stu-id="831a7-102">How to Create Role Links in Orchestrations</span></span>
<span data-ttu-id="831a7-103">以下是您要在協調流程中使用角色連結時所需完成的基本工作：</span><span class="sxs-lookup"><span data-stu-id="831a7-103">The following are the basic tasks you will need to complete to use role links in your orchestration:</span></span>  
  
-   <span data-ttu-id="831a7-104">建立合作對象與傳送埠，並將它們彼此關聯。</span><span class="sxs-lookup"><span data-stu-id="831a7-104">Create parties and send ports and associate them with each other.</span></span>  
  
-   <span data-ttu-id="831a7-105">請使用下列程序來建立角色連結類型及新增連接埠類型。</span><span class="sxs-lookup"><span data-stu-id="831a7-105">Use the following procedure to create role link types and add the port types.</span></span>  
  
    |<span data-ttu-id="831a7-106">建立角色連結類型</span><span class="sxs-lookup"><span data-stu-id="831a7-106">To create a role link type</span></span>|  
    |--------------------------------|  
    |<span data-ttu-id="831a7-107">1.在 協調流程檢視 視窗中，依序展開**類型**，以滑鼠右鍵按一下**角色連結類型**，然後按一下 **新角色連結類型**。</span><span class="sxs-lookup"><span data-stu-id="831a7-107">1.  In the Orchestration View window, expand **Types**, right-click **Role Link Types**, and then click **New Role Link Type**.</span></span><br /><span data-ttu-id="831a7-108">2.按一下您剛建立的角色連結類型。</span><span class="sxs-lookup"><span data-stu-id="831a7-108">2.  Click the role link type you just created.</span></span> <span data-ttu-id="831a7-109">在 [屬性] 視窗中**識別碼**欄位中，輸入`Provider_Consumer_RoleLinkType`。</span><span class="sxs-lookup"><span data-stu-id="831a7-109">In the Properties window, in the **Identifier** field, type `Provider_Consumer_RoleLinkType`.</span></span><br /><span data-ttu-id="831a7-110">3.展開**provider_consumer_rolelinktype**，然後按一下  **role_1**。</span><span class="sxs-lookup"><span data-stu-id="831a7-110">3.  Expand **Provider_Consumer_RoleLinkType**, and then click **Role_1**.</span></span> <span data-ttu-id="831a7-111">在 [屬性] 視窗中**識別碼**欄位中，輸入`ConsumerRole`。</span><span class="sxs-lookup"><span data-stu-id="831a7-111">In the Properties window, in the **Identifier** field, type `ConsumerRole`.</span></span><br /><span data-ttu-id="831a7-112">4.以滑鼠右鍵按一下**ConsumerRole**，然後按一下 **新增連接埠類型**。</span><span class="sxs-lookup"><span data-stu-id="831a7-112">4.  Right-click **ConsumerRole**, and then click **Add Port Type**.</span></span> <span data-ttu-id="831a7-113">如此便可啟動「連接埠類型精靈」。</span><span class="sxs-lookup"><span data-stu-id="831a7-113">This starts the Port Type Wizard.</span></span><br /><span data-ttu-id="831a7-114">5.在**歡迎使用連接埠類型精靈**頁面上，按一下**下一步**。</span><span class="sxs-lookup"><span data-stu-id="831a7-114">5.  On the **Welcome to the Port Type Wizard** page, click **Next**.</span></span><br /><span data-ttu-id="831a7-115">6.在**選取連接埠類型或建立新的連接埠類型**頁面上，選取**建立新的連接埠類型**，然後**連接埠類型名稱**，型別`ConsumerPortType`。</span><span class="sxs-lookup"><span data-stu-id="831a7-115">6.  On the **Select a Port Type or create a new Port Type** page, select **Create a new Port Type**, and then for **Port Type Name**, type `ConsumerPortType`.</span></span><br /><span data-ttu-id="831a7-116">7.如**通訊模式**，選取**單向**，以及**存取限制**，選取**公用-沒有限制**。</span><span class="sxs-lookup"><span data-stu-id="831a7-116">7.  For **Communication Pattern**, select **One-Way**, and for **Access Restrictions**, select **Public - no limit**.</span></span> <span data-ttu-id="831a7-117">按一下 **[下一步]**。</span><span class="sxs-lookup"><span data-stu-id="831a7-117">Click **Next**.</span></span><br /><span data-ttu-id="831a7-118">8.在**完成連接埠精靈**頁面上，按一下**完成**。</span><span class="sxs-lookup"><span data-stu-id="831a7-118">8.  On the **Completing the Port Wizard** page, click **Finish**.</span></span><br /><span data-ttu-id="831a7-119">9.以滑鼠右鍵按一下**provider_consumer_rolelinktype**，然後按一下 **新角色**。</span><span class="sxs-lookup"><span data-stu-id="831a7-119">9. Right-click **Provider_Consumer_RoleLinkType**, and then click **New Role**.</span></span><br /><span data-ttu-id="831a7-120">10.按一下**[role_1]**，然後在 [屬性] 視窗中**識別碼**欄位中，輸入`ProviderRole`。</span><span class="sxs-lookup"><span data-stu-id="831a7-120">10. Click **Role_1**, and then in the Properties window, in the **Identifier** field, type `ProviderRole`.</span></span><br /><span data-ttu-id="831a7-121">11.以滑鼠右鍵按一下**ProviderRole**，然後按一下 **新增連接埠類型**。</span><span class="sxs-lookup"><span data-stu-id="831a7-121">11. Right-click **ProviderRole**, and then click **Add Port Type**.</span></span> <span data-ttu-id="831a7-122">如此便可啟動「連接埠類型精靈」。</span><span class="sxs-lookup"><span data-stu-id="831a7-122">This starts the Port Type Wizard.</span></span><br /><span data-ttu-id="831a7-123">12.在**歡迎使用連接埠類型精靈**頁面上，按一下**下一步**。</span><span class="sxs-lookup"><span data-stu-id="831a7-123">12. On the **Welcome to the Port Type Wizard** page, click **Next**.</span></span><br /><span data-ttu-id="831a7-124">13.在**選取連接埠類型或建立新的連接埠類型**頁面上，選取**建立新的連接埠類型**，然後**連接埠類型名稱**，型別`ProviderPortType`。</span><span class="sxs-lookup"><span data-stu-id="831a7-124">13. On the **Select a Port Type or create a new Port Type** page, select **Create a new Port Type**, and then for **Port Type Name**, type `ProviderPortType`.</span></span><br /><span data-ttu-id="831a7-125">14.如**通訊模式**，選取**單向**，以及**存取限制**，選取**公用-沒有限制**。</span><span class="sxs-lookup"><span data-stu-id="831a7-125">14. For **Communication Pattern**, select **One-Way**, and for **Access Restrictions**, select **Public - no limit**.</span></span> <span data-ttu-id="831a7-126">按一下 **[下一步]**。</span><span class="sxs-lookup"><span data-stu-id="831a7-126">Click **Next**.</span></span><br /><span data-ttu-id="831a7-127">15.在**完成連接埠精靈**頁面上，按一下**完成**。</span><span class="sxs-lookup"><span data-stu-id="831a7-127">15. On the **Completing the Port Wizard** page, click **Finish**.</span></span> <span data-ttu-id="831a7-128">**注意：**放置在角色連結的已設定連接埠不會保留其相關聯的繫結資訊。</span><span class="sxs-lookup"><span data-stu-id="831a7-128">**Note:**      Configured ports placed inside of role links do not retain their associated binding information.</span></span>|  
  
     <span data-ttu-id="831a7-129">在前面的程序中，您建立了包含兩個角色的角色連結類型，分別是會接收及處理取用者傳來之訊息的 ProviderRole，以及您的協調流程將使用隨角色提供之傳送埠來傳送訊息給取用者的 ConsumerRole。</span><span class="sxs-lookup"><span data-stu-id="831a7-129">In the preceding procedure, you create a role link type that contains two roles—a ProviderRole that will receive and process messages from the consumer and a ConsumerRole that your orchestration will use the send port provided with the role to send messages to the consumer.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="831a7-130">角色連結類型可以包含提供者角色和取用者角色，而且可以包含任一個角色，或兩種角色各一個 (視您的商務程序需求而定)。</span><span class="sxs-lookup"><span data-stu-id="831a7-130">The role link type can contain a provider role and a consumer role, and it can include one of either or one of each, depending on your business process needs.</span></span>  
  
-   <span data-ttu-id="831a7-131">使用下列程序，將角色連結新增至您的協調流程。</span><span class="sxs-lookup"><span data-stu-id="831a7-131">Use the following procedure to add role links to your orchestration.</span></span>  
  
    |<span data-ttu-id="831a7-132">若要使用角色連結精靈建立角色連結</span><span class="sxs-lookup"><span data-stu-id="831a7-132">To create a role link by using the Role Link Wizard</span></span>|  
    |---------------------------------------------------------|  
    |<span data-ttu-id="831a7-133">1.在協調流程 [工具箱] 中，拖曳**角色連結**圖形至設計介面。</span><span class="sxs-lookup"><span data-stu-id="831a7-133">1.  In the orchestration Toolbox, drag the **Role Link** shape to the design surface.</span></span> <span data-ttu-id="831a7-134">如此便可啟動「角色連結精靈」。</span><span class="sxs-lookup"><span data-stu-id="831a7-134">This starts the Role Link Wizard.</span></span><br /><span data-ttu-id="831a7-135">2.在**歡迎使用角色連結精靈**頁面上，按一下**下一步**。</span><span class="sxs-lookup"><span data-stu-id="831a7-135">2.  On the **Welcome to the Role Link Wizard** page, click **Next**.</span></span><br /><span data-ttu-id="831a7-136">3.在**角色連結名稱**頁面上，於**名稱**欄位中，輸入`Provider_Consumer`。</span><span class="sxs-lookup"><span data-stu-id="831a7-136">3.  On the **Role Link Name** page, in the **Name** field, type `Provider_Consumer`.</span></span> <span data-ttu-id="831a7-137">按一下 **[下一步]**。</span><span class="sxs-lookup"><span data-stu-id="831a7-137">Click **Next**.</span></span><br /><span data-ttu-id="831a7-138">4.在**角色連結類型**頁面上，選取**使用現有的角色連結類型**。</span><span class="sxs-lookup"><span data-stu-id="831a7-138">4.  On the **Role Link Type** page, select **Use an existing Role Link Type**.</span></span> <span data-ttu-id="831a7-139">在**角色連結類型名稱**下拉式清單中，選取**[provider_consumer_rolelinktype]**。</span><span class="sxs-lookup"><span data-stu-id="831a7-139">In the **Role Link Type Name** drop-down list, select **Provider_Consumer_RoleLinkType**.</span></span> <span data-ttu-id="831a7-140">按一下 **[下一步]**。</span><span class="sxs-lookup"><span data-stu-id="831a7-140">Click **Next**.</span></span><br /><span data-ttu-id="831a7-141">5.在**角色識別**頁面上，選取**ProviderRole**從**此協調流程將實作哪一個角色來接收和處理來自夥伴的訊息？**下拉式清單。</span><span class="sxs-lookup"><span data-stu-id="831a7-141">5.  On the **Role Identification** page, select **ProviderRole** from the **Which role will this orchestration implement to receive and process messages from partners?** drop-down list.</span></span> <span data-ttu-id="831a7-142">精靈會自動選取**ConsumerRole**如**此協調流程會將訊息傳送至夥伴角色內的連接埠上使用下列角色**。</span><span class="sxs-lookup"><span data-stu-id="831a7-142">The wizard automatically selects **ConsumerRole** for **This orchestration will use the role below to send messages to partners on ports inside the role**.</span></span> <span data-ttu-id="831a7-143">按一下 **[下一步]**。</span><span class="sxs-lookup"><span data-stu-id="831a7-143">Click **Next**.</span></span><br /><span data-ttu-id="831a7-144">6.在**角色連結使用方式**頁面上，選取**我將會傳送第一個訊息給我夥伴的角色**。</span><span class="sxs-lookup"><span data-stu-id="831a7-144">6.  On the **Role Link Usage** page, select **I will be sending the first message to my partner's role**.</span></span> <span data-ttu-id="831a7-145">按一下 **[完成]**。</span><span class="sxs-lookup"><span data-stu-id="831a7-145">Click **Finish**.</span></span>|  
  
     <span data-ttu-id="831a7-146">在前面的程序中，您已進一步將 ConsumerRole 定義為初始角色。 .</span><span class="sxs-lookup"><span data-stu-id="831a7-146">In the preceding procedure, you further define the ConsumerRole as the initiating role.</span></span> <span data-ttu-id="831a7-147">這表示您的協調流程會透過 ConsumerRole 所提供的連接埠將第一個訊息傳送給取用者，然後 ProviderRole 會接收從取用者所傳回的訊息，以做進一步的處理。</span><span class="sxs-lookup"><span data-stu-id="831a7-147">This means that your orchestration will send the first message to the consumer through the port provided by the ConsumerRole and then the ProviderRole will receive the message sent back from the consumer for further processing.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="831a7-148">如果角色連結類型中只有一個角色，您需要您的角色定義商務程序中，選取**提供者角色： 我將會接收第一個訊息**或**取用者角色： 我將會傳送第一個訊息**而不是執行步驟 5 中前述程序。</span><span class="sxs-lookup"><span data-stu-id="831a7-148">If there is only one role in the role link type, you need to define your role in the business process by selecting either **Provider Role: I will be receiving the first message** or **Consumer Role: I will be sending the first message** instead of performing step 5 in the preceding procedure.</span></span>  
  
-   <span data-ttu-id="831a7-149">設計您的商務程序。</span><span class="sxs-lookup"><span data-stu-id="831a7-149">Design your business process.</span></span> <span data-ttu-id="831a7-150">您可以利用相互關聯集合來確保內送訊息與適當的協調流程執行個體是相符的。</span><span class="sxs-lookup"><span data-stu-id="831a7-150">You can leverage correlation sets to ensure that an incoming message matches the appropriate instance of an orchestration.</span></span>  
  
-   <span data-ttu-id="831a7-151">關聯連接埠與**傳送**和**接收**圖形。</span><span class="sxs-lookup"><span data-stu-id="831a7-151">Associate the ports with **Send** and **Receive** shapes.</span></span> <span data-ttu-id="831a7-152">此外，請執行下列動作：</span><span class="sxs-lookup"><span data-stu-id="831a7-152">In addition, do the following:</span></span>  
  
    -   <span data-ttu-id="831a7-153">如果初始角色是傳送訊息的取用者，明確地設定**DestinationParty**協調流程中的屬性 （一次，一次）。</span><span class="sxs-lookup"><span data-stu-id="831a7-153">If the initiating role is a consumer for sending messages, explicitly set the **DestinationParty** property (once and only once) in your orchestration.</span></span> <span data-ttu-id="831a7-154">若要這樣做，請將設定的值**DestinationParty**中**運算式**圖形，如下列範例，其中 ConfirmOrder 是角色連結名稱，而 PartnerName 和 organizationname 則是參數合作對象：</span><span class="sxs-lookup"><span data-stu-id="831a7-154">To do so, set the value of the **DestinationParty** in the **Expression** shape, as in the following example, where ConfirmOrder is the name of a role link, and PartnerName and OrganizationName are parameters of a party:</span></span>  
  
        ```  
        ConfirmOrder(Microsoft.XLANGs.BaseTypes.DestinationParty) = new Microsoft.XLANGs.BaseTypes.Party("PartnerName", "OrganizationName");  
        ```  
  
    -   <span data-ttu-id="831a7-155">如果初始角色是提供者接收訊息， **DestinationParty**屬性會自動初始化收件者。</span><span class="sxs-lookup"><span data-stu-id="831a7-155">If the initiating role is a provider for receiving messages, the **DestinationParty** property is initialized automatically by the receiver.</span></span> <span data-ttu-id="831a7-156">**DestinationParty**設為提供者本身。</span><span class="sxs-lookup"><span data-stu-id="831a7-156">The **DestinationParty** is set to the provider itself.</span></span> <span data-ttu-id="831a7-157">**SourceParty**屬性是唯讀的而且提供透過受信任的管線元件來解析合作對象名稱為基礎的安全性識別碼 (SID) 寄件者或合作對象相關聯的憑證。</span><span class="sxs-lookup"><span data-stu-id="831a7-157">The **SourceParty** property is read-only, and is supplied through a trusted pipeline component to resolve the party name based on the security identifier (SID) of the sender or on a certificate associated with the party.</span></span> <span data-ttu-id="831a7-158">執行管線元件的主控件必須標示為**信任的驗證**。</span><span class="sxs-lookup"><span data-stu-id="831a7-158">The host running the pipeline component must be marked as **Authentication Trusted**.</span></span> <span data-ttu-id="831a7-159">您可以取得的值**SourceParty**中**運算式**圖形，方法是使用下列範例程式碼：</span><span class="sxs-lookup"><span data-stu-id="831a7-159">You can get the value of the **SourceParty** in the **Expression** shape by using the following sample code:</span></span>  
  
        ```  
        PartyName = Buyer_Supplier(Microsoft.XLANGs.BaseTypes.SourceParty);  
        ```  
  
## <a name="examples-of-using-role-links"></a><span data-ttu-id="831a7-160">使用角色連結的範例</span><span class="sxs-lookup"><span data-stu-id="831a7-160">Examples of Using Role Links</span></span>  
  
-   [<span data-ttu-id="831a7-161">PartyResolution （BizTalk Server 範例）</span><span class="sxs-lookup"><span data-stu-id="831a7-161">PartyResolution (BizTalk Server Sample)</span></span>](../core/partyresolution-biztalk-server-sample.md)  
  
-   <span data-ttu-id="831a7-162">從 BizTalk Server 程式碼範例，可從下載 SDK 範例 「 使用角色連結 」 [http://go.microsoft.com/fwlink/?LinkId=73703](http://go.microsoft.com/fwlink/?LinkId=73703)。</span><span class="sxs-lookup"><span data-stu-id="831a7-162">Download the SDK sample "Using Role Links" from the BizTalk Server code samples available at [http://go.microsoft.com/fwlink/?LinkId=73703](http://go.microsoft.com/fwlink/?LinkId=73703).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="831a7-163">另請參閱</span><span class="sxs-lookup"><span data-stu-id="831a7-163">See Also</span></span>  
 <span data-ttu-id="831a7-164">[協調流程中使用角色連結](../core/using-role-links-in-orchestrations.md) </span><span class="sxs-lookup"><span data-stu-id="831a7-164">[Using Role Links in Orchestrations](../core/using-role-links-in-orchestrations.md) </span></span>  
 <span data-ttu-id="831a7-165">[如何使用角色連結圖形](../core/how-to-use-the-role-link-shape.md) </span><span class="sxs-lookup"><span data-stu-id="831a7-165">[How to Use the Role Link Shape](../core/how-to-use-the-role-link-shape.md) </span></span>  
 [<span data-ttu-id="831a7-166">如何使用角色連結精靈</span><span class="sxs-lookup"><span data-stu-id="831a7-166">How to Use the Role Link Wizard</span></span>](../core/how-to-use-the-role-link-wizard.md)