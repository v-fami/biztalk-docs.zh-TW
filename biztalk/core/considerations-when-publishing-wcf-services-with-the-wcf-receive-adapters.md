---
title: 接收配接器發佈 WCF 服務使用 WCF 時的考量 |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
helpviewer_keywords:
- publishing, WCF services
- WCF adapters, best practices
- WCF adapters, receive adapters
- WCF services, publishing
- best practices, WCF adapters
ms.assetid: 797b7ffd-534c-4f09-9738-fb17b208bc96
caps.latest.revision: 34
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: f9c232f085647d3f69f576232ec9d9adb3b01a2b
ms.sourcegitcommit: 266308ec5c6a9d8d80ff298ee6051b4843c5d626
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 06/27/2018
ms.locfileid: "37004079"
---
# <a name="considerations-when-publishing-wcf-services-with-the-wcf-receive-adapters"></a><span data-ttu-id="4d39a-102">利用 WCF 接收配接器發佈 WCF 服務的考量</span><span class="sxs-lookup"><span data-stu-id="4d39a-102">Considerations When Publishing WCF Services with the WCF Receive Adapters</span></span>
<span data-ttu-id="4d39a-103">本主題將提供您利用 WCF 接收配接器來發佈 WCF 服務時應該納入考量的相關資訊。</span><span class="sxs-lookup"><span data-stu-id="4d39a-103">This topic provides information that you should take into consideration when publishing WCF services with the WCF receive adapters.</span></span>  <span data-ttu-id="4d39a-104">使用 WCF 配接器發佈服務後，WCF 用戶端將能夠把該服務當成一般 WCF 服務來呼叫。</span><span class="sxs-lookup"><span data-stu-id="4d39a-104">Publishing a service using a WCF adapter allows it to be called by a WCF client as if it were a typical WCF service.</span></span>  
  
## <a name="in-process-hosting"></a><span data-ttu-id="4d39a-105">內含式裝載</span><span class="sxs-lookup"><span data-stu-id="4d39a-105">In-Process Hosting</span></span>  
 <span data-ttu-id="4d39a-106">裝載接收位置內[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]處理序空間，btsntsvc.exe，允許簡化的開發和部署的優點。</span><span class="sxs-lookup"><span data-stu-id="4d39a-106">Hosting the receive location within the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] process space, btsntsvc.exe, allows the benefits of simplified development and deployment.</span></span> <span data-ttu-id="4d39a-107">此外，它會建立比在利用高可用性和負載平衡功能的 IIS 中裝載的多個主控件執行個體[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="4d39a-107">Additionally, it creates more host instances than hosting in IIS to take advantage of the high-availability and load balancing capabilities of  [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)].</span></span>  <span data-ttu-id="4d39a-108">在裝載外部資訊[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]在 IIS 中的程序是指[外掛式 WCF 接收配接器設定的 IIS](../core/configuring-iis-for-the-isolated-wcf-receive-adapters.md)。</span><span class="sxs-lookup"><span data-stu-id="4d39a-108">For information in hosting outside of the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] process in IIS refer to [Configuring IIS for the Isolated WCF Receive Adapters](../core/configuring-iis-for-the-isolated-wcf-receive-adapters.md).</span></span>  
  
## <a name="set-the-isoneway-property-of-wcf-services-published-with-the-wcf-adapters-except-for-the-wcf-netmsmq-receive-adapter-to-false"></a><span data-ttu-id="4d39a-109">發佈的 WCF 配接器 （除了 Wcf-netmsmq 接收配接器） 為 false 的 WCF 服務的 IsOneWay 屬性設定</span><span class="sxs-lookup"><span data-stu-id="4d39a-109">Set the IsOneWay property of WCF services published with the WCF adapters (except for the WCF-NetMsmq receive adapter) to false</span></span>  
 <span data-ttu-id="4d39a-110">**System.ServiceModel.OperationContractAttribute.IsOneWay** WCF 配接器發佈的 WCF 服務的屬性，除了服務發行使用 Wcf-netmsmq 接收配接器設定為 **，則為 true** -設為**false**甚至是單向接收位置。</span><span class="sxs-lookup"><span data-stu-id="4d39a-110">The **System.ServiceModel.OperationContractAttribute.IsOneWay** property of WCF services published with the WCF adapters—except for services published with the WCF-NetMsmq receive adapter where it is set to **true** —is set to **false** even for the one-way receive locations.</span></span> <span data-ttu-id="4d39a-111">如果**IsOneWay**屬性設定為**false**，甚至方法會傳回**void**產生回覆訊息。</span><span class="sxs-lookup"><span data-stu-id="4d39a-111">If the **IsOneWay** property is set to **false**, even methods that return a **void** result in a reply message.</span></span> <span data-ttu-id="4d39a-112">在這種情況下，基礎結構會建立並傳送空白訊息，向呼叫者指示該方法已經傳回。</span><span class="sxs-lookup"><span data-stu-id="4d39a-112">In this case, the infrastructure creates and sends an empty message to indicate to the caller that the method has returned.</span></span> <span data-ttu-id="4d39a-113">使用這種方法時，基礎結構就會將服務作業擲出的例外狀況傳回給用戶端。</span><span class="sxs-lookup"><span data-stu-id="4d39a-113">Using this approach enables the infrastructure to send exceptions thrown by the service operation back to the client.</span></span>  
  
 <span data-ttu-id="4d39a-114">若要使用 WCF 配接器 （除了 Wcf-netmsmq 接收配接器） 發佈的 WCF 服務所在**IsOneWay**是**false**，則**IsOneWay**屬性用戶端必須設定為**false** ，如下所示：</span><span class="sxs-lookup"><span data-stu-id="4d39a-114">To consume WCF services published with the WCF adapters (except for the WCF-NetMsmq receive adapter) in which **IsOneWay** is **false**, the **IsOneWay** property on the client side must be set to **false** as follows:</span></span>  
  
```  
[ServiceContract(Namespace="Microsoft.WCF.Documentation")]  
  public interface ISampleService{  
    [OperationContract(IsOneWay=false, ReplyAction="*",Action="…"]  
    string SampleMethod(string msg);  
}  
```  
  
> [!NOTE]
>  <span data-ttu-id="4d39a-115">因為預設值**IsOneWay**屬性是**false**，您不必在程式碼中指定的屬性。</span><span class="sxs-lookup"><span data-stu-id="4d39a-115">Because the default value of the **IsOneWay** property is **false**, you do not have to specify the property in the code.</span></span>  
  
## <a name="the-replyaction-property-of-the-operationcontractattribute-on-the-client-side-should-be-set-to--an-asterisk-when-consuming-wcf-services-published-with-one-way-receive-locations"></a><span data-ttu-id="4d39a-116">若是在使用透過單向接收位置發佈的 WCF 服務，用戶端上 OperationContractAttribute 的 ReplyAction 屬性應該要設為 "\*" (星號)。</span><span class="sxs-lookup"><span data-stu-id="4d39a-116">The ReplyAction property of the OperationContractAttribute on the client side should be set to "\*" (an asterisk) when consuming WCF services published with one-way receive locations</span></span>  
 <span data-ttu-id="4d39a-117">**System.servicemodel.operationcontractattribute**屬性**System.servicemodel.operationcontractattribute.replyaction**可用於用戶端上指定的值從 WCF 服務的回應訊息的 SOAP 動作。</span><span class="sxs-lookup"><span data-stu-id="4d39a-117">The **System.ServiceModel.OperationContractAttribute.ReplyAction** property of the **System.ServiceModel.OperationContractAttribute** can be used on the client side to specify the value of the SOAP action for the response messages from WCF services.</span></span>  
  
 <span data-ttu-id="4d39a-118">除了指定回覆訊息的動作標頭的特定值 (若要通知用戶端，這是回覆及所要採取的動作)，您也可以指定字串"\*"（星號）。</span><span class="sxs-lookup"><span data-stu-id="4d39a-118">In addition to specifying a particular value for the action header of the reply message (to notify the client this is a reply and what action to be taken), you can also specify the string "\*" (an asterisk).</span></span> <span data-ttu-id="4d39a-119">在用戶端應用程式中指定星號，就會指示該用戶端不要驗證該服務所傳送回應訊息中的回覆動作。</span><span class="sxs-lookup"><span data-stu-id="4d39a-119">Specifying an asterisk in a client application instructs the client not to validate the reply action in response messages that the service sends.</span></span>  
  
 <span data-ttu-id="4d39a-120">若要取用 WCF 服務發佈的單向接收位置，proxy 方法的 WCF 服務必須傳回**void**，在此情況下的 proxy 方法需要 WCF 服務會傳送空白訊息，以便向呼叫者，該方法已經傳回。</span><span class="sxs-lookup"><span data-stu-id="4d39a-120">To consume a WCF service published by a one-way receive location, the proxy method for the WCF service must return **void**, in which case the proxy method expects that the WCF service will send an empty message to indicate to the caller that the method has returned.</span></span> <span data-ttu-id="4d39a-121">Proxy 方法，以接收此空白訊息，如**ReplyAction**屬性**OperationContractAttribute**應該設定為"\*"（星號），如下所示：</span><span class="sxs-lookup"><span data-stu-id="4d39a-121">For the proxy method to receive this empty message, the **ReplyAction** property of the **OperationContractAttribute** should be set to "\*" (an asterisk) as follows:</span></span>  
  
```  
[ServiceContract(Namespace="Microsoft.WCF.Documentation")]  
  public interface ISampleService{  
    [OperationContract(IsOneWay=false, ReplyAction="*",Action="…"]  
    string SampleMethod(string msg);  
}  
```  
  
> [!NOTE]
>  <span data-ttu-id="4d39a-122">您沒有設定**ReplyAction**屬性為"\*"（星號） Wcf-netmsmq 配接器，因為 Wcf-netmsmq 配接器需要 WCF 用戶端設定**IsOneWay**屬性 **，則為 true**。</span><span class="sxs-lookup"><span data-stu-id="4d39a-122">You do not have to set the **ReplyAction** property to "\*" (an asterisk) for the WCF-NetMsmq adapter, because the WCF-NetMsmq adapter requires the WCF clients to set the **IsOneWay** property to **true**.</span></span>  
  
## <a name="an-isolated-host-instance-can-run-only-one-adapter"></a><span data-ttu-id="4d39a-123">外掛式主控件執行個體只能執行一個配接器：</span><span class="sxs-lookup"><span data-stu-id="4d39a-123">An isolated host instance can run only one adapter</span></span>  
 <span data-ttu-id="4d39a-124">外掛式主控件執行個體只能執行一個配接器。</span><span class="sxs-lookup"><span data-stu-id="4d39a-124">An isolated host instance can run only one adapter.</span></span> <span data-ttu-id="4d39a-125">若是使用單一外掛式主控件設定多個隔離之配接器 (例如，HTTP 和 SOAP 和 WCF 配接器) 的接收處理常式，您就必須建立多個應用程式集區，讓每個配接器使用一個應用程式集區。</span><span class="sxs-lookup"><span data-stu-id="4d39a-125">If you configure the receive handlers of multiple isolated adapters such as HTTP, SOAP, and WCF adapters with one isolated host, you must create multiple application pools, one application pool for each adapter.</span></span> <span data-ttu-id="4d39a-126">如需 BizTalk 外掛式主控件的詳細資訊，請參閱[啟用 Web 服務](../core/enabling-web-services.md)。</span><span class="sxs-lookup"><span data-stu-id="4d39a-126">For more information about BizTalk isolated hosts, see [Enabling Web Services](../core/enabling-web-services.md).</span></span>  
  
## <a name="use-the-template----content-specified-by-template-option-when-sending-non-xml-content-as-response-messages"></a><span data-ttu-id="4d39a-127">傳送非 XML 內容為回應訊息時，使用範本 -- 由範本指定的內容選項</span><span class="sxs-lookup"><span data-stu-id="4d39a-127">Use the "Template -- content specified by template" option when sending non-XML content as response messages</span></span>  
 <span data-ttu-id="4d39a-128">使用 WCF 配接器**內文--BizTalk 回應訊息內文**（預設值） 選項不允許傳送非 XML 訊息，例如字元資料和點陣圖影像。</span><span class="sxs-lookup"><span data-stu-id="4d39a-128">The WCF adapters with **Body -- BizTalk response message body** (the default value) option do not allow sending non-XML messages such as character data and bitmap images.</span></span> <span data-ttu-id="4d39a-129">您可以使用**範本--由範本指定內容**WCF 配接器傳送非 XML 訊息的選項。</span><span class="sxs-lookup"><span data-stu-id="4d39a-129">You can use the **Template -- content specified by template** option for the WCF adapters to send non-XML messages.</span></span> <span data-ttu-id="4d39a-130">如需如何使用範本的詳細資訊，請參閱[指定 WCF 配接器的訊息內文](../core/specifying-the-message-body-for-the-wcf-adapters.md)。</span><span class="sxs-lookup"><span data-stu-id="4d39a-130">For more information about how to use the template, see [Specifying the Message Body for the WCF Adapters](../core/specifying-the-message-body-for-the-wcf-adapters.md).</span></span>  
  
## <a name="setting-up-the-permissions-for-a-wcf-service-published-with-the-wcf-service-publishing-wizard"></a><span data-ttu-id="4d39a-131">設定透過 WCF 服務發佈精靈所發佈 WCF 服務的權限</span><span class="sxs-lookup"><span data-stu-id="4d39a-131">Setting up the permissions for a WCF service published with the WCF Service Publishing Wizard</span></span>  
 <span data-ttu-id="4d39a-132">使用上與 WCF 服務發佈精靈所建立的 ASP.NET 應用程式時[!INCLUDE[btsWinSvr2k8](../includes/btswinsvr2k8-md.md)]或[!INCLUDE[btsWinSvr2k8R2](../includes/btswinsvr2k8r2-md.md)]平台，與 WCF 服務引動過程期間存取 Dll 可能會發生錯誤。</span><span class="sxs-lookup"><span data-stu-id="4d39a-132">When using ASP.NET applications created with the WCF Service Publishing Wizard on the [!INCLUDE[btsWinSvr2k8](../includes/btswinsvr2k8-md.md)] or [!INCLUDE[btsWinSvr2k8R2](../includes/btswinsvr2k8r2-md.md)] platform, errors relating to accessing DLLs during WCF service invocation may occur.</span></span> <span data-ttu-id="4d39a-133">這些錯誤通常與預設的 [!INCLUDE[btsWinSvr2k8](../includes/btswinsvr2k8-md.md)] 和 [!INCLUDE[btsWinSvr2k8R2](../includes/btswinsvr2k8r2-md.md)] 安全性問題有關。</span><span class="sxs-lookup"><span data-stu-id="4d39a-133">These errors are typically related to issues with default [!INCLUDE[btsWinSvr2k8](../includes/btswinsvr2k8-md.md)] and [!INCLUDE[btsWinSvr2k8R2](../includes/btswinsvr2k8r2-md.md)] security.</span></span> <span data-ttu-id="4d39a-134">如需這些錯誤的詳細資訊，請參閱 Microsoft 說明及支援的發行項呼叫，會收到"System.IO.FileNotFoundException"錯誤時用戶端應用程式呼叫 Web 服務 」 在說明及支援網站[ http://go.microsoft.com/fwlink/?LinkId=43659](http://go.microsoft.com/fwlink/?LinkId=43659).</span><span class="sxs-lookup"><span data-stu-id="4d39a-134">For more information about these errors, see the Microsoft Help and Support article called "You Receive a "System.IO.FileNotFoundException" Error When the Client Application Calls a Web Service" on the Help and Support Web site at [http://go.microsoft.com/fwlink/?LinkId=43659](http://go.microsoft.com/fwlink/?LinkId=43659).</span></span>  
  
 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]<span data-ttu-id="4d39a-135"> 需要執行的 WCF 服務的處理序會授與適當的權限，是否內含式主控件，或外掛式主控件執行服務。</span><span class="sxs-lookup"><span data-stu-id="4d39a-135"> requires that the process running the WCF service is granted the appropriate permissions whether an in-process host or an isolated host runs the service.</span></span> <span data-ttu-id="4d39a-136">底下[!INCLUDE[btsWinSvr2k8](../includes/btswinsvr2k8-md.md)]和[!INCLUDE[btsWinSvr2k8R2](../includes/btswinsvr2k8r2-md.md)]外掛式主控件的預設 Windows 群組是外掛式主控件使用者群組，因此加入外掛式主控件使用者群組的權限應該會解決此問題。</span><span class="sxs-lookup"><span data-stu-id="4d39a-136">Under [!INCLUDE[btsWinSvr2k8](../includes/btswinsvr2k8-md.md)] and [!INCLUDE[btsWinSvr2k8R2](../includes/btswinsvr2k8r2-md.md)] the default Windows group for isolated hosts is the Isolated Host Users Group, so adding the permissions to the Isolated Host Users Group should resolve this issue.</span></span>  
  
#### <a name="to-add-the-permissions-to-the-isolated-host-users-group"></a><span data-ttu-id="4d39a-137">若要加入外掛式主控件使用者群組的權限</span><span class="sxs-lookup"><span data-stu-id="4d39a-137">To add the permissions to the Isolated Host Users Group</span></span>  
  
1.  <span data-ttu-id="4d39a-138">在 [Microsoft Windows 檔案總管] 中，找出 %windir%\temp 目錄。</span><span class="sxs-lookup"><span data-stu-id="4d39a-138">In Microsoft Windows Explorer, locate the %windir%\temp directory.</span></span>  
  
2.  <span data-ttu-id="4d39a-139">Windir%\temp，以滑鼠右鍵按一下，然後按一下**屬性**。</span><span class="sxs-lookup"><span data-stu-id="4d39a-139">Right-click %windir%\temp, and then click **Properties**.</span></span>  
  
3.  <span data-ttu-id="4d39a-140">在 **屬性** 對話方塊中，按一下**安全性** 索引標籤。</span><span class="sxs-lookup"><span data-stu-id="4d39a-140">In the **Properties** dialog box, click the **Security** tab.</span></span>  
  
4.  <span data-ttu-id="4d39a-141">按一下 **新增**，選取**外掛式主控件使用者群組**，然後按一下**確定**。</span><span class="sxs-lookup"><span data-stu-id="4d39a-141">Click **Add**, select **the Isolated Host Users Group**, and then click **OK**.</span></span>  
  
## <a name="setting-up-the-permissions-for-a-wcf-receive-location-with-the-wcf-netmsmq-adapter"></a><span data-ttu-id="4d39a-142">設定具 WCF-NetMsmq 配接器之 WCF 接收位置的權限</span><span class="sxs-lookup"><span data-stu-id="4d39a-142">Setting up the permissions for a WCF receive location with the WCF-NetMsmq adapter</span></span>  
 <span data-ttu-id="4d39a-143">當使用 NetMsmqBinding 的 WCF 用戶端將訊息傳送到透過 WCF-NetMsmq 配接器所發佈 WCF 服務時，該用戶端會將訊息定址至目標佇列，也就是由服務佇列管理員管理的佇列。</span><span class="sxs-lookup"><span data-stu-id="4d39a-143">When a WCF client using the NetMsmqBinding sends a message to a WCF service published with the WCF-NetMsmq adapter, it addresses the message to the target queue, which is the queue managed by the service's queue manager.</span></span> <span data-ttu-id="4d39a-144">用戶端的佇列管理員會將訊息傳送至傳輸 (或外寄) 佇列。</span><span class="sxs-lookup"><span data-stu-id="4d39a-144">The queue manager on the client sends the message to a transmission (or outgoing) queue.</span></span> <span data-ttu-id="4d39a-145">傳輸佇列是用戶端的佇列管理員，會儲存傳輸至目標佇列的訊息。</span><span class="sxs-lookup"><span data-stu-id="4d39a-145">The transmission queue is a queue on the client-side queue manager that stores messages for transmission to the target queue.</span></span>  
  
 <span data-ttu-id="4d39a-146">針對定址至服務之所有目標佇列的訊息，服務的佇列管理員會接受並加以儲存。</span><span class="sxs-lookup"><span data-stu-id="4d39a-146">The service's queue manager accepts messages addressed to the target queues it owns and stores the messages.</span></span> <span data-ttu-id="4d39a-147">接著，服務會要求讀取目標佇列，佇列管理員再將訊息傳遞至服務。</span><span class="sxs-lookup"><span data-stu-id="4d39a-147">Then, the service makes requests to read from the target queue, and the queue manager delivers the messages to the service.</span></span> <span data-ttu-id="4d39a-148">因此，裝載接收位置的 BizTalk 主控件執行個體服務帳戶，應擁有從目標佇列進行讀取的權限。</span><span class="sxs-lookup"><span data-stu-id="4d39a-148">For this reason, the service account for the BizTalk host instance hosting the receive location should have the permissions to read from the target queue.</span></span>  
  
## <a name="use-an-empty-body-path-expression-to-receive-a-soap-message-with-character-data-in-the-content-of-the-soap-body-element"></a><span data-ttu-id="4d39a-149">使用空白內文路徑運算式接收 SOAP 訊息，其 SOAP Body 項目內容中含字元資料</span><span class="sxs-lookup"><span data-stu-id="4d39a-149">Use an empty body path expression to receive a SOAP message with character data in the content of the SOAP Body element</span></span>  
 <span data-ttu-id="4d39a-150">Wcf 接收配接器從 SOAP 的內容中含字元資料的內送回應訊息建立 BizTalk 訊息**主體**項目，如所示在下列範例中，您應該讓**內文路徑運算式**文字方塊中空白**訊息**WCF 配接器傳輸屬性對話方塊中的索引標籤。</span><span class="sxs-lookup"><span data-stu-id="4d39a-150">For a WCF receive adapter to create a BizTalk message from an incoming response message with character data in the content of the SOAP **Body** element, as shown in the following example, you should leave the **Body path expression** text box empty on the **Message** tab in the WCF adapter transport properties dialog box.</span></span>  
  
```  
<s:Envelope xmlns:s="http://www.w3.org/2003/05/soap-envelope" xmlns:a="http://www.w3.org/2005/08/addressing">  
    <s:Header>  
      ...  
    </s:Header>  
    <s:Body>Contoso</s:Body>  
</s:Envelope>  
```  
  
 <span data-ttu-id="4d39a-151">如果您選取**信封**或是**主體**選項時，配接器無法建立 BizTalk 訊息從先前的內送訊息。</span><span class="sxs-lookup"><span data-stu-id="4d39a-151">If you select the **Envelope** or **Body** option, the adapter cannot create the BizTalk message from the previous incoming message.</span></span> <span data-ttu-id="4d39a-152">訊息不會遭擱置，因為輸入 SOAP 封送處理時失敗的訊息不會遭擱置。</span><span class="sxs-lookup"><span data-stu-id="4d39a-152">The message is not suspended because messages that fail in the inbound SOAP marshaling processing are not suspended.</span></span> <span data-ttu-id="4d39a-153">如需有關如何使用上的內文路徑運算式**訊息**索引標籤上，請參閱[指定 WCF 配接器的訊息內文](../core/specifying-the-message-body-for-the-wcf-adapters.md)。</span><span class="sxs-lookup"><span data-stu-id="4d39a-153">For more information about how to use the body path expression on the **Message** tab, see [Specifying the Message Body for the WCF Adapters](../core/specifying-the-message-body-for-the-wcf-adapters.md).</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="4d39a-154">設定 BTSNTSvc.exe.config. 檔，即可使用 Windows SDK 內的 TraceViewer 工具 (SvcTraceViewer.exe)。</span><span class="sxs-lookup"><span data-stu-id="4d39a-154">You can use the TraceViewer tool (SvcTraceViewer.exe) in the Windows SDK by configuring the BTSNTSvc.exe.config.file.</span></span> <span data-ttu-id="4d39a-155">如需有關 Windows SDK 的詳細資訊，請參閱 < 什麼是 Windows SDK 的新 >，網址[ http://go.microsoft.com/fwlink/?LinkId=75219 ](http://go.microsoft.com/fwlink/?LinkId=75219)。</span><span class="sxs-lookup"><span data-stu-id="4d39a-155">For more information about the Windows SDK, see "What's New in the Windows SDK" at [http://go.microsoft.com/fwlink/?LinkId=75219](http://go.microsoft.com/fwlink/?LinkId=75219).</span></span> <span data-ttu-id="4d39a-156">TraceViewer 工具的詳細資訊，請參閱 < TraceViewer 工具 (SvcTraceViewer.exe) >，網址[ http://go.microsoft.com/fwlink/?LinkId=75218 ](http://go.microsoft.com/fwlink/?LinkId=75218)。</span><span class="sxs-lookup"><span data-stu-id="4d39a-156">For more information about the TraceViewer tool, see "TraceViewer Tool (SvcTraceViewer.exe)" at [http://go.microsoft.com/fwlink/?LinkId=75218](http://go.microsoft.com/fwlink/?LinkId=75218).</span></span>  
  
## <a name="using-schemas-that-reference-other-schemas"></a><span data-ttu-id="4d39a-157">使用參考其他結構描述的結構描述</span><span class="sxs-lookup"><span data-stu-id="4d39a-157">Using schemas that reference other schemas</span></span>  
 <span data-ttu-id="4d39a-158">您可以使用**redefine**，**包含**，並**匯入**項目時您的結構描述變大變複雜，或當結構描述代表您不同類型的執行個體訊息有通用的部分。</span><span class="sxs-lookup"><span data-stu-id="4d39a-158">You can use the **redefine**, **include**, and **import** elements when your schemas become large and complex, or when the schemas that represent your different types of instance messages have some portions in common.</span></span> <span data-ttu-id="4d39a-159">將較小的結構描述，組合成最後會定義打算用來與交易夥伴交換之執行個體訊息之結構的結構描述，是一種很有用的做法。</span><span class="sxs-lookup"><span data-stu-id="4d39a-159">It can be useful to combine smaller schemas into the schemas that ultimately define the structure of the instance messages you plan to exchange with trading partners.</span></span> <span data-ttu-id="4d39a-160">您可以使用「BizTalk WCF 服務發佈精靈」，將這些結構描述發佈為 WCF 服務。</span><span class="sxs-lookup"><span data-stu-id="4d39a-160">You can publish these schemas as WCF services by using the BizTalk WCF Service Publishing Wizard.</span></span>  
  
 <span data-ttu-id="4d39a-161">您應該使用「BizTalk WCF 服務使用精靈」，建立從 BizTalk 專案中使用 WCF 服務時所需要的 BizTalk 成品。</span><span class="sxs-lookup"><span data-stu-id="4d39a-161">You should use the BizTalk WCF Service Consuming Wizard to create the BizTalk artifacts necessary to consume the WCF services from a BizTalk project.</span></span> <span data-ttu-id="4d39a-162">若要從 .NET 應用程式使用 WCF 服務，您應該要使用 ServiceModel Metadata Utility 工具 (Svcutil.exe)，建立該 WCF 服務適用的 Proxy 類別。</span><span class="sxs-lookup"><span data-stu-id="4d39a-162">If you want to consume the WCF services from a .NET application, you should use the Service Model Metadata Utility tool (Svcutil.exe) to create the proxy class for the WCF services.</span></span> <span data-ttu-id="4d39a-163">如需如何使用參考其他結構描述的結構描述的詳細資訊，請參閱[，使用其他結構描述](../core/schemas-that-use-other-schemas.md)並[如何建立可使用其他結構描述](../core/how-to-create-schemas-that-use-other-schemas.md)。</span><span class="sxs-lookup"><span data-stu-id="4d39a-163">For more information about how to use schemas that reference other schemas, see [Schemas That Use Other Schemas](../core/schemas-that-use-other-schemas.md) and [How to Create Schemas That Use Other Schemas](../core/how-to-create-schemas-that-use-other-schemas.md).</span></span> <span data-ttu-id="4d39a-164">Svcutil.exe 的詳細資訊，請參閱 「 服務模型中繼資料公用程式工具 （Svcutil.exe) >，網址[ http://go.microsoft.com/fwlink/?LinkID=74696 ](http://go.microsoft.com/fwlink/?LinkID=74696)。</span><span class="sxs-lookup"><span data-stu-id="4d39a-164">For more information about Svcutil.exe, see "Service Model Metadata Utility Tool (Svcutil.exe)" at [http://go.microsoft.com/fwlink/?LinkID=74696](http://go.microsoft.com/fwlink/?LinkID=74696).</span></span>  
  
 <span data-ttu-id="4d39a-165">下表針對配合會應用到其他結構描述之結構描述所發佈的 WCF 服務，列出這類服務在使用時要注意到的限制和考量。</span><span class="sxs-lookup"><span data-stu-id="4d39a-165">The following table shows the limitations and considerations that you need to know when consuming published WCF services with schemas that use other schemas.</span></span>  
  
|<span data-ttu-id="4d39a-166">XML 結構描述項目</span><span class="sxs-lookup"><span data-stu-id="4d39a-166">XML schema element</span></span>|<span data-ttu-id="4d39a-167">使用透過 BizTalk WCF 服務發佈精靈所發佈的 WCF 服務</span><span class="sxs-lookup"><span data-stu-id="4d39a-167">Consuming WCF services published with the BizTalk WCF Service Publishing Wizard</span></span>|<span data-ttu-id="4d39a-168">使用 .NET 應用程式所裝載的 WCF 服務</span><span class="sxs-lookup"><span data-stu-id="4d39a-168">Consuming WCF services hosted by .NET applications</span></span>|  
|------------------------|-------------------------------------------------------------------------------------|--------------------------------------------------------|  
|<span data-ttu-id="4d39a-169">\<import\></span><span class="sxs-lookup"><span data-stu-id="4d39a-169">\<import\></span></span>|<span data-ttu-id="4d39a-170">BizTalk WCF 服務使用精靈和 Svcutil.exe 皆支援</span><span class="sxs-lookup"><span data-stu-id="4d39a-170">Supported with both the BizTalk WCF Service Consuming Wizard and Svcutil.exe</span></span>|<span data-ttu-id="4d39a-171">BizTalk WCF 服務使用精靈和 Svcutil.exe 皆支援</span><span class="sxs-lookup"><span data-stu-id="4d39a-171">Supported with both the BizTalk WCF Service Consuming Wizard and Svcutil.exe</span></span>|  
|<span data-ttu-id="4d39a-172">\<包含\></span><span class="sxs-lookup"><span data-stu-id="4d39a-172">\<include\></span></span>|<span data-ttu-id="4d39a-173">支援使用 BizTalk WCF 服務使用精靈和 Svcutil.exe**附註：** Svcutil.exe 建立 proxy 類別時，可能會引發一則警告訊息。</span><span class="sxs-lookup"><span data-stu-id="4d39a-173">Supported with both the BizTalk WCF Service Consuming Wizard and Svcutil.exe **Note:**  Svcutil.exe may raise a warning message when creating the proxy class.</span></span>|<span data-ttu-id="4d39a-174">支援使用 BizTalk WCF 服務使用精靈和 Svcutil.exe**附註：** Svcutil.exe 建立 proxy 類別時，可能會引發一則警告訊息。</span><span class="sxs-lookup"><span data-stu-id="4d39a-174">Supported with both the BizTalk WCF Service Consuming Wizard and Svcutil.exe **Note:**  Svcutil.exe may raise a warning message when creating the proxy class.</span></span>|  
|<span data-ttu-id="4d39a-175">\<redefine\></span><span class="sxs-lookup"><span data-stu-id="4d39a-175">\<redefine\></span></span>|<span data-ttu-id="4d39a-176">支援使用 BizTalk WCF 服務使用精靈</span><span class="sxs-lookup"><span data-stu-id="4d39a-176">-   Supported with the BizTalk WCF Service Consuming Wizard</span></span><br /><span data-ttu-id="4d39a-177">-有限的支援，由 Svcutil.exe**附註：** Svcutil.exe 具有相同的限制，如**重新定義**xsd.exe 的項目。</span><span class="sxs-lookup"><span data-stu-id="4d39a-177">-   Limited support by Svcutil.exe **Note:**  Svcutil.exe has the same limitation for the **redefine** element as XSD.exe has.</span></span>|<span data-ttu-id="4d39a-178">支援使用 BizTalk WCF 服務使用精靈和 Svcutil.exe**附註：** Svcutil.exe 建立 proxy 類別時，可能會引發一則警告訊息。</span><span class="sxs-lookup"><span data-stu-id="4d39a-178">Supported with both the BizTalk WCF Service Consuming Wizard and Svcutil.exe **Note:**  Svcutil.exe may raise a warning message when creating the proxy class.</span></span>|  
  
> [!NOTE]
>  <span data-ttu-id="4d39a-179">建立 proxy 類別，針對已發佈的 BizTalk WCF 服務使用的結構描述時，Svcutil.exe 可能會發出警告訊息**包括**並**重新定義**項目。</span><span class="sxs-lookup"><span data-stu-id="4d39a-179">Svcutil.exe may raise a warning message when creating the proxy class against the published BizTalk WCF service with the schemas using the **include** and **redefine** elements.</span></span> <span data-ttu-id="4d39a-180">例如，「已經宣告全域項目」。</span><span class="sxs-lookup"><span data-stu-id="4d39a-180">For example, "The global element has already been declared."</span></span>  
  
## <a name="ensure-that-an-in-process-wcf-receive-location-is-not-disabled-after-you-change-the-computer-name-part-in-its-service-endpoint-address"></a><span data-ttu-id="4d39a-181">確定在您變更服務端點位址中的電腦名稱部分之後，內含式 WCF 接收位置未遭停用</span><span class="sxs-lookup"><span data-stu-id="4d39a-181">Ensure that an in-process WCF receive location is not disabled after you change the computer name part in its service endpoint address</span></span>  
 <span data-ttu-id="4d39a-182">如果您變更電腦名稱部分**位址 (URI)** 文字方塊執行內含式 WCF 接收位置時，我們建議您使用 BizTalk 管理主控台，來檢查是否仍執行接收位置。</span><span class="sxs-lookup"><span data-stu-id="4d39a-182">If you change the computer name part in the **Address (URI)** text box of a running in-process WCF receive location, we recommend that you use the BizTalk Administration console to check whether the receive location is still running.</span></span> <span data-ttu-id="4d39a-183">比方說，如果您變更服務端點位址使用 Wcf-nettcp 接收配接器**net.tcp://\<**<em>您的電腦名稱</em>**\>/samplepath**，以**net.tcp://localhost/samplepath**，可能會停用接收位置，與**Service.InvalidOperationException**。</span><span class="sxs-lookup"><span data-stu-id="4d39a-183">For example, if you change a service endpoint address using the WCF-NetTcp receive adapter, **net.tcp://\<**<em>Your Computer Name</em>**\>/samplepath**, to **net.tcp://localhost/samplepath**, the receive location may be disabled with a **Service.InvalidOperationException**.</span></span> <span data-ttu-id="4d39a-184">如果您只變更服務端點位址的電腦名稱部分而不修改路徑部分，請確定該接收位置未遭停用，並在必要情況下啟用該位置。</span><span class="sxs-lookup"><span data-stu-id="4d39a-184">If you change only the computer name part in the service endpoint address without modifying the path part, make sure that the receive location is not disabled, and enable it if necessary.</span></span>  
  
## <a name="set-the-appropriate-msdtc-security-configuration-options-on-client-computers-communicating-with-remote-wcf-receive-locations-through-a-transaction-protocol"></a><span data-ttu-id="4d39a-185">在透過交易通訊協定和遠端 WCF 接收位置通訊的用戶端電腦上設定適當的 MSDTC 安全性組態選項</span><span class="sxs-lookup"><span data-stu-id="4d39a-185">Set the appropriate MSDTC Security Configuration options on client computers communicating with remote WCF receive locations through a transaction protocol</span></span>  
 <span data-ttu-id="4d39a-186">Wcf-nettcp、 Wcf-wshttp 和 Wcf-netnamedpipe 接收配接器使用 WCF 用戶端管理的交易式協調程序可以參與**WS-AtomicTransaction**和**OleTransaction**交易通訊協定。</span><span class="sxs-lookup"><span data-stu-id="4d39a-186">WCF-NetTcp, WCF-WSHttp, and WCF-NetNamedPipe receive adapters can participate in transactional coordination processes that WCF clients manage with the **WS-AtomicTransaction** and **OleTransaction** transaction protocols.</span></span> <span data-ttu-id="4d39a-187">在交易內容中使用這些交易通訊協定，即可將訊息傳輸到目的接收位置，以及從 MessageBox 資料庫中加以刪除。</span><span class="sxs-lookup"><span data-stu-id="4d39a-187">Messages can be transmitted to the destination receive locations and deleted from the MessageBox database in a transactional context by using the transaction protocols.</span></span>  
  
 <span data-ttu-id="4d39a-188">若要與遠端 WCF 接收位置所使用的交易通訊協定，您必須適當地設定 MSDTC**安全性設定**WCF 用戶端電腦上的選項。</span><span class="sxs-lookup"><span data-stu-id="4d39a-188">To communicate with remote WCF receive locations by using the transaction protocols, you must appropriately configure MSDTC **Security Configuration** options on WCF client computers.</span></span> <span data-ttu-id="4d39a-189">下表列出 MSDTC 中可用的選項的必要的值**安全性設定** 對話方塊中：</span><span class="sxs-lookup"><span data-stu-id="4d39a-189">The following table lists the required values for the options that are available in the MSDTC **Security Configuration** dialog box:</span></span>  
  
|<span data-ttu-id="4d39a-190">組態選項</span><span class="sxs-lookup"><span data-stu-id="4d39a-190">Configuration option</span></span>|<span data-ttu-id="4d39a-191">預設值</span><span class="sxs-lookup"><span data-stu-id="4d39a-191">Default value</span></span>|<span data-ttu-id="4d39a-192">建議值</span><span class="sxs-lookup"><span data-stu-id="4d39a-192">Recommended value</span></span>|  
|--------------------------|-------------------|-----------------------|  
|<span data-ttu-id="4d39a-193">網路 DTC 存取</span><span class="sxs-lookup"><span data-stu-id="4d39a-193">Network DTC Access</span></span>|<span data-ttu-id="4d39a-194">已停用</span><span class="sxs-lookup"><span data-stu-id="4d39a-194">Disabled</span></span>|<span data-ttu-id="4d39a-195">已啟用</span><span class="sxs-lookup"><span data-stu-id="4d39a-195">Enabled</span></span>|  
|<span data-ttu-id="4d39a-196">允許輸出</span><span class="sxs-lookup"><span data-stu-id="4d39a-196">Allow Outbound</span></span>|<span data-ttu-id="4d39a-197">已停用</span><span class="sxs-lookup"><span data-stu-id="4d39a-197">Disabled</span></span>|<span data-ttu-id="4d39a-198">已啟用</span><span class="sxs-lookup"><span data-stu-id="4d39a-198">Enabled</span></span>|  
|<span data-ttu-id="4d39a-199">需要相互驗證</span><span class="sxs-lookup"><span data-stu-id="4d39a-199">Mutual Authentication Required</span></span>|<span data-ttu-id="4d39a-200">已啟用</span><span class="sxs-lookup"><span data-stu-id="4d39a-200">Enabled</span></span>|<span data-ttu-id="4d39a-201">如果對應的遠端接收位置正在執行 Windows Server 2003 SP1 或 SP2，並且設定為已啟用**要求相互驗證**。</span><span class="sxs-lookup"><span data-stu-id="4d39a-201">Enabled if the corresponding remote receive locations are running Windows Server 2003 SP1 or SP2, and are configured with **Mutual Authentication Required**.</span></span>|  
|<span data-ttu-id="4d39a-202">要求對連入呼叫者驗證</span><span class="sxs-lookup"><span data-stu-id="4d39a-202">Incoming Caller Authentication Required</span></span>|<span data-ttu-id="4d39a-203">已停用</span><span class="sxs-lookup"><span data-stu-id="4d39a-203">Disabled</span></span>|<span data-ttu-id="4d39a-204">如果在叢集上執行 MSDTC，則為「已啟用」。</span><span class="sxs-lookup"><span data-stu-id="4d39a-204">Enabled if running MSDTC on a cluster.</span></span>|  
  
 <span data-ttu-id="4d39a-205">在套用這些變更後，您必須重新啟動 MSDTC 服務。</span><span class="sxs-lookup"><span data-stu-id="4d39a-205">After you apply these changes, you have to restart the MSDTC service.</span></span>  
  
 <span data-ttu-id="4d39a-206">若要存取 MSDTC**安全性設定**對話方塊方塊中，請遵循下列步驟：</span><span class="sxs-lookup"><span data-stu-id="4d39a-206">To access the MSDTC **Security Configuration** dialog box, follow these steps:</span></span>  
  
1.  <span data-ttu-id="4d39a-207">按一下**開始**，按一下**執行**，然後輸入**dcomcnfg**啟動**元件服務**管理主控台。</span><span class="sxs-lookup"><span data-stu-id="4d39a-207">Click **Start**, click **Run**, and type **dcomcnfg** to launch the **Component Services** Management console.</span></span>  
  
2.  <span data-ttu-id="4d39a-208">依序展開**元件服務**，展開**電腦**，以滑鼠右鍵按一下**我的電腦**，然後按一下**屬性**。</span><span class="sxs-lookup"><span data-stu-id="4d39a-208">Expand **Component Services**, expand **Computers**, right-click **My Computer**, and then click **Properties**.</span></span>  
  
3.  <span data-ttu-id="4d39a-209">在**我的電腦內容** 對話方塊中，按一下**MSDTC**索引標籤，然後再按**安全性組態**以顯示**安全性設定**  對話方塊。</span><span class="sxs-lookup"><span data-stu-id="4d39a-209">In the **My Computer Properties** dialog box, click the **MSDTC** tab, and then click **Security Configuration** to display the **Security Configuration** dialog box.</span></span>  
  
## <a name="explanation-of-the-soap-wrapper-when-using-the-biztalk-wcf-service-publishing-wizard"></a><span data-ttu-id="4d39a-210">使用 BizTalk WCF 服務發佈精靈時之 SOAP 包裝函式的說明</span><span class="sxs-lookup"><span data-stu-id="4d39a-210">Explanation of the SOAP wrapper when using the BizTalk WCF Service Publishing Wizard</span></span>  
 <span data-ttu-id="4d39a-211">使用 [!INCLUDE[firstref_btsWinCommFoundation](../includes/firstref-btswincommfoundation-md.md)] 服務發佈精靈將協調流程公開為 [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] 服務時，會產生包裝函式。</span><span class="sxs-lookup"><span data-stu-id="4d39a-211">When an orchestration is exposed as a [!INCLUDE[firstref_btsWinCommFoundation](../includes/firstref-btswincommfoundation-md.md)] service by using the [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] Service Publishing Wizard, a wrapper is generated.</span></span> <span data-ttu-id="4d39a-212">這個包裝函式會使用的連接埠傳送訊息的 XML 訊息中的方法名稱。</span><span class="sxs-lookup"><span data-stu-id="4d39a-212">This wrapper uses the method name of the port in the XML message to which the message is sent.</span></span> <span data-ttu-id="4d39a-213">這個包裝函式是 Microsoft 的 SOAP envelope 的預設值。</span><span class="sxs-lookup"><span data-stu-id="4d39a-213">This wrapper is the default for Microsoft SOAP envelopes.</span></span> <span data-ttu-id="4d39a-214">它可讓[!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)]包裝一個配接器傳送至端點的 WCF 訊息中的多部分的 SOAP 訊息。</span><span class="sxs-lookup"><span data-stu-id="4d39a-214">It allows [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] to wrap the multi-part SOAP message in one WCF message to be transmitted to the endpoint by the adapter.</span></span>  
  
 <span data-ttu-id="4d39a-215">最佳做法，其中一個寄件者應該使用包裝函式和接收者應該預期，或寄件者不應該使用包裝函式，接收者應該預期原始[!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)]訊息。</span><span class="sxs-lookup"><span data-stu-id="4d39a-215">As a best practice, either the sender should use a wrapper and the receiver should expect it, or the sender should not use a wrapper and the receiver should expect the raw [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] message.</span></span> <span data-ttu-id="4d39a-216">事先同意的是否要使用的包裝函式失敗，可能會導致不相容間傳送和收到的問題。</span><span class="sxs-lookup"><span data-stu-id="4d39a-216">Failure to agree ahead of time on whether to use a wrapper can cause incompatibility issues between what is sent and what is received.</span></span>