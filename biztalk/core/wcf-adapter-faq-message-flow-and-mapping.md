---
title: WCF 配接器常見問題集： 訊息流程和對應 |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: 907e5c6a-a095-4b3a-9362-506832b6bc8c
caps.latest.revision: 4
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: ae55b6447923e9618a3e4776284659d48a2b25a9
ms.sourcegitcommit: 266308ec5c6a9d8d80ff298ee6051b4843c5d626
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 06/27/2018
ms.locfileid: "36968175"
---
# <a name="wcf-adapter-faq-message-flow-and-mapping"></a><span data-ttu-id="589d8-102">WCF 配接器常見問題集： 訊息流程和對應</span><span class="sxs-lookup"><span data-stu-id="589d8-102">WCF Adapter FAQ: Message Flow and Mapping</span></span>
## <a name="what-is-the-message-flow-within-the-wcf-and-biztalk-systems"></a><span data-ttu-id="589d8-103">何謂 WCF 和 BizTalk 系統內的訊息流程</span><span class="sxs-lookup"><span data-stu-id="589d8-103">What is the message flow within the WCF and BizTalk systems?</span></span>  
 <span data-ttu-id="589d8-104">以下是流程的 BizTalk Server 內送 WCF 訊息的描述：</span><span class="sxs-lookup"><span data-stu-id="589d8-104">Here is a description of the flow of an incoming WCF message to BizTalk Server:</span></span>  
  
1. <span data-ttu-id="589d8-105">WCF 訊息到達接收位置，以及 BizTalk Server 具現化裝載的 WCF 服務。</span><span class="sxs-lookup"><span data-stu-id="589d8-105">A WCF message arrives at a receive location, and BizTalk Server instantiates a hosted WCF service.</span></span>  
  
2. <span data-ttu-id="589d8-106">服務的通道堆疊和它的通道接聽程式，具現化 WCF 執行階段。</span><span class="sxs-lookup"><span data-stu-id="589d8-106">The WCF runtime instantiates the service’s channel stack and its channel listeners.</span></span> <span data-ttu-id="589d8-107">通道堆疊是一連串的處理不同的處理工作階段。</span><span class="sxs-lookup"><span data-stu-id="589d8-107">A channel stack is a sequence of stages that handle differing processing tasks.</span></span> <span data-ttu-id="589d8-108">每個通道堆疊是由至少傳輸通道、 最常訊息編碼器，以及零或多個通訊協定通道所組成。</span><span class="sxs-lookup"><span data-stu-id="589d8-108">Each channel stack consists of at least a transport channel, most often a message encoder, and zero or more protocol channels.</span></span> <span data-ttu-id="589d8-109">傳輸通道會讀取內送的訊息資料流在到達時。</span><span class="sxs-lookup"><span data-stu-id="589d8-109">The transport channel reads the incoming message stream upon arrival.</span></span> <span data-ttu-id="589d8-110">它會叫用的編碼器解譯訊息，並產生 WCF Message 物件。</span><span class="sxs-lookup"><span data-stu-id="589d8-110">It invokes an encoder to interpret the message and to produce a WCF Message object.</span></span> <span data-ttu-id="589d8-111">目前每個通訊協定通道會有機會作用於 WCF 訊息的順序。</span><span class="sxs-lookup"><span data-stu-id="589d8-111">At this point each protocol channel will have an opportunity to operate on the WCF message in order.</span></span>  
  
3. <span data-ttu-id="589d8-112">接聽程式，將它轉送到已設定的 WCF 通道堆疊，並將它分派至適當的服務執行個體所接收 WCF 訊息。</span><span class="sxs-lookup"><span data-stu-id="589d8-112">The WCF message is received by a listener that forwards it through the configured WCF channel stack and dispatches it to the proper service instance.</span></span> <span data-ttu-id="589d8-113">此時將 WCF 訊息會轉換 （對應） 成 BizTalk 訊息。</span><span class="sxs-lookup"><span data-stu-id="589d8-113">At this point the WCF message is converted (mapped) to a BizTalk message.</span></span> <span data-ttu-id="589d8-114">簡單來說，WCF 訊息的標頭會寫入 BizTalk 訊息內容中，與 WCF 訊息內文寫入 BizTalk 訊息內文部分。</span><span class="sxs-lookup"><span data-stu-id="589d8-114">Briefly stated, the WCF message headers are written into the BizTalk message context, and the WCF message body is written into the  BizTalk message body part.</span></span> <span data-ttu-id="589d8-115">對應可讓您控制 WCF 訊息的哪些部分會變成 BizTalk 訊息內文： 信封、 主體或子元素。</span><span class="sxs-lookup"><span data-stu-id="589d8-115">Mapping controls what part of the WCF message becomes the BizTalk message body: Envelope, body, or sub-element.</span></span>  
  
4. <span data-ttu-id="589d8-116">接收位置中所設定的任何管線元件會處理 BizTalk 訊息。</span><span class="sxs-lookup"><span data-stu-id="589d8-116">Any pipeline components configured in the receive location processes the BizTalk message.</span></span>  
  
5. <span data-ttu-id="589d8-117">BizTalk 訊息會儲存在 MessageBox 資料庫。</span><span class="sxs-lookup"><span data-stu-id="589d8-117">The BizTalk message is stored in the MessageBox database.</span></span>  
  
   <span data-ttu-id="589d8-118">以下是從 BizTalk Server 的外寄 WCF 訊息流程的描述：</span><span class="sxs-lookup"><span data-stu-id="589d8-118">Here is a description of the flow of an outgoing WCF message from BizTalk Server:</span></span>  
  
6. <span data-ttu-id="589d8-119">BizTalk 訊息是透過傳送埠，根據其訂用帳戶接收。</span><span class="sxs-lookup"><span data-stu-id="589d8-119">A BizTalk message is received by a send port according to its subscription.</span></span>  
  
7. <span data-ttu-id="589d8-120">在傳送連接埠的處理程序中設定的任何管線元件的 BizTalk 訊息。</span><span class="sxs-lookup"><span data-stu-id="589d8-120">Any pipeline components configured in the send port process the BizTalk message.</span></span>  
  
8. <span data-ttu-id="589d8-121">WCF 通道堆疊會具現化，以及 BizTalk 訊息根據服務的外部可見的合約的 WCF 訊息是 已轉換 （對應）。</span><span class="sxs-lookup"><span data-stu-id="589d8-121">A WCF channel stack is instantiated, and the BizTalk message is converted (mapped) into a WCF message based upon the service’s external visible contract.</span></span>  
  
9. <span data-ttu-id="589d8-122">WCF 通道堆疊 WCF 將訊息傳送至外部 WCF 服務。</span><span class="sxs-lookup"><span data-stu-id="589d8-122">The WCF channel stack transmits the WCF message to the external WCF service.</span></span>  
  
## <a name="how-is-a-wcf-message-converted-mapped-into-a-biztalk-message"></a><span data-ttu-id="589d8-123">如何為 WCF 訊息轉換 （對應） 成 BizTalk 訊息？</span><span class="sxs-lookup"><span data-stu-id="589d8-123">How is a WCF message converted (mapped) into a BizTalk message?</span></span>  
 <span data-ttu-id="589d8-124">若要了解此對應，我們要看看 WCF 訊息 」 和 「 BizTalk 訊息的結構。</span><span class="sxs-lookup"><span data-stu-id="589d8-124">In order to understand the mapping, we need to look at the structure of a WCF message and a BizTalk message.</span></span>  
  
 <span data-ttu-id="589d8-125">WCF 訊息根據 SOAP 訊息結構和訊息屬性、 訊息標頭和單一訊息本文組成。</span><span class="sxs-lookup"><span data-stu-id="589d8-125">A WCF message is modeled on the SOAP message structure and consists of message properties, message headers, and a single message body.</span></span>  
  
- <span data-ttu-id="589d8-126">**訊息屬性**是附加至訊息物件的 Common Language Runtime (CLR) 物件。</span><span class="sxs-lookup"><span data-stu-id="589d8-126">The **message properties** are Common Language Runtime (CLR) objects that are attached to the Message object.</span></span> <span data-ttu-id="589d8-127">屬性是 WCF 堆疊和通訊的每一端的使用者的應用程式內部。</span><span class="sxs-lookup"><span data-stu-id="589d8-127">Properties are internal to the WCF stack and the user’s application at each end of the communication.</span></span> <span data-ttu-id="589d8-128">它們永遠不會直接傳送用戶端與伺服器之間。</span><span class="sxs-lookup"><span data-stu-id="589d8-128">They are never directly transferred between client and server.</span></span>  
  
- <span data-ttu-id="589d8-129">**訊息標頭**，不過，用戶端與伺服器之間傳送。</span><span class="sxs-lookup"><span data-stu-id="589d8-129">**Message headers**, however, are transferred between client and server.</span></span> <span data-ttu-id="589d8-130">上一則訊息，可以有許多的標頭只能有一個訊息主體，但標頭與訊息內文資料流處理。</span><span class="sxs-lookup"><span data-stu-id="589d8-130">There can be many headers on a message, but there is only one message body, and unlike the headers the message body is streamed.</span></span> <span data-ttu-id="589d8-131">訊息標頭和訊息內文定義為 XML Infoset。</span><span class="sxs-lookup"><span data-stu-id="589d8-131">Both the message headers and the message body are defined as an XML Infoset.</span></span>  
  
- <span data-ttu-id="589d8-132">**主體**WCF 訊息是為其屬性和標頭提供的詳細資訊訊息的主要內容。</span><span class="sxs-lookup"><span data-stu-id="589d8-132">The **body** of a WCF message is the main content of the message for which the properties and headers provide more information.</span></span>  
  
  <span data-ttu-id="589d8-133">BizTalk 訊息的結構。</span><span class="sxs-lookup"><span data-stu-id="589d8-133">A BizTalk message has a different structure.</span></span>  
  
- <span data-ttu-id="589d8-134">沒有一組每個訊息上的內容屬性。</span><span class="sxs-lookup"><span data-stu-id="589d8-134">There is a single set of context properties on each message.</span></span> <span data-ttu-id="589d8-135">每個內容屬性是由命名空間名稱/值組所組成。</span><span class="sxs-lookup"><span data-stu-id="589d8-135">Each context property consists of a namespace name/value pair.</span></span> <span data-ttu-id="589d8-136">內容屬性可以升級或寫入。</span><span class="sxs-lookup"><span data-stu-id="589d8-136">Context properties can be either promoted or written.</span></span> <span data-ttu-id="589d8-137">如果升級，他們可以參與 BizTalk Server 內執行的路由規則。</span><span class="sxs-lookup"><span data-stu-id="589d8-137">If they are promoted, they can take part in the routing rules that execute within BizTalk Server.</span></span>  
  
- <span data-ttu-id="589d8-138">在 BizTalk Server 中訊息的資料可以包含多個資料流。</span><span class="sxs-lookup"><span data-stu-id="589d8-138">The data of a message in BizTalk Server can consist of multiple streams.</span></span> <span data-ttu-id="589d8-139">因為每個資料流可以獨立讀取，是多部分 BizTalk 訊息。</span><span class="sxs-lookup"><span data-stu-id="589d8-139">A BizTalk message is multipart because each stream can be read independently.</span></span> <span data-ttu-id="589d8-140">其中一個訊息部分是特殊的它稱為內文部分。</span><span class="sxs-lookup"><span data-stu-id="589d8-140">One of the message parts is special and it is referred to as the body part.</span></span>  
  
  <span data-ttu-id="589d8-141">因為通訊有時可以是雙向的 WCF 配接器可讓特定轉譯或對應至輸入和輸出的雙向訊息交換的設定。</span><span class="sxs-lookup"><span data-stu-id="589d8-141">Because the communication can sometimes be two-way, the WCF adapter allows the particular translation or mapping to be configured for both inbound and outbound directions of message exchange.</span></span> <span data-ttu-id="589d8-142">這可以為接收位置和傳送埠，BizTalk Server 內完成。</span><span class="sxs-lookup"><span data-stu-id="589d8-142">This can be done for both the receive locations and send ports within BizTalk Server.</span></span>  
  
  <span data-ttu-id="589d8-143">BizTalk WCF 配接器支援在執行階段，這些兩個訊息結構之間進行轉譯的排列數目。</span><span class="sxs-lookup"><span data-stu-id="589d8-143">The BizTalk WCF adapters support a number of permutations of translating at run time between these two message structures.</span></span> <span data-ttu-id="589d8-144">對應透過**訊息**索引標籤中**傳輸屬性**個 WCF 配接器 對話方塊。</span><span class="sxs-lookup"><span data-stu-id="589d8-144">Mapping is controlled through the **Messages** tab in the **Transport Properties** dialog box for a WCF adapter.</span></span> <span data-ttu-id="589d8-145">比方說，最明顯的轉譯，以及預設值時，傳入 WCF 訊息的主體會變成 BizTalk 訊息內文。</span><span class="sxs-lookup"><span data-stu-id="589d8-145">For example, the most obvious translation, and the default, is when the body of an inbound WCF message becomes the body of the BizTalk message.</span></span> <span data-ttu-id="589d8-146">如需對應模式的詳細資訊，請參閱[ http://go.microsoft.com/fwlink/?LinkID=119792 ](http://go.microsoft.com/fwlink/?LinkID=119792)。</span><span class="sxs-lookup"><span data-stu-id="589d8-146">For more information about mapping modes, see [http://go.microsoft.com/fwlink/?LinkID=119792](http://go.microsoft.com/fwlink/?LinkID=119792).</span></span>  
  
## <a name="how-can-you-preserve-the-complete-incoming-wcf-message-inside-the-biztalk-message"></a><span data-ttu-id="589d8-147">您可以保留在 BizTalk 訊息內完成的內送 WCF 訊息？</span><span class="sxs-lookup"><span data-stu-id="589d8-147">How can you preserve the complete incoming WCF message inside the BizTalk message?</span></span>  
 <span data-ttu-id="589d8-148">輸入 BizTalk 訊息內文的選項之一就是**信封**選項。</span><span class="sxs-lookup"><span data-stu-id="589d8-148">One of the inbound BizTalk message body options is the **Envelope** option.</span></span> <span data-ttu-id="589d8-149">選擇此選項會到內送的 BizTalk 訊息內文包含在 soap Envelope： 元素的整個 SOAP 訊息。</span><span class="sxs-lookup"><span data-stu-id="589d8-149">Choosing this option takes the entire SOAP message contained within the soap:Envelope element into the incoming BizTalk message body.</span></span> <span data-ttu-id="589d8-150">產生的 BizTalk 訊息包含信封標籤、 所有標頭和主體。</span><span class="sxs-lookup"><span data-stu-id="589d8-150">The resulting BizTalk message contains the Envelope tags, all the headers, and the body.</span></span>  
  
## <a name="how-can-you-extract-specific-elements-of-the-incoming-wcf-message-into-a-biztalk-message-or-map-elements-of-an-outgoing-biztalk-message-to-an-outgoing-wcf-message"></a><span data-ttu-id="589d8-151">您要如何將內送 WCF 訊息的特定項目擷取到 BizTalk 訊息，或將外寄 BizTalk 訊息的項目對應至外寄 WCF 訊息？</span><span class="sxs-lookup"><span data-stu-id="589d8-151">How can you extract specific elements of the incoming WCF message into a BizTalk message, or map elements of an outgoing BizTalk message to an outgoing WCF message?</span></span>  
 <span data-ttu-id="589d8-152">若要對應 WCF 或 BizTalk 訊息內文的區段，使用 路徑 或 範本選項。</span><span class="sxs-lookup"><span data-stu-id="589d8-152">To map a section of a WCF or BizTalk message body, use the Path or Template option.</span></span> <span data-ttu-id="589d8-153">這可讓您輸入 XPath 運算式來擷取訊息內文的特定部分。</span><span class="sxs-lookup"><span data-stu-id="589d8-153">This allows you to enter an XPath expression to extract specific parts of the message body.</span></span> <span data-ttu-id="589d8-154">完整的 XPath 語法不支援在此情況下擷取資料流處理，並讀取器必須因此一律逐步往前。</span><span class="sxs-lookup"><span data-stu-id="589d8-154">Full XPath syntax is not supported in this situation as the extraction is streamed and the reader must therefore always walk forward.</span></span> <span data-ttu-id="589d8-155">這也是為什麼在**訊息** 索引標籤，它會呼叫 路徑-內容由內文路徑定位 而不是"XPath-內容由內文路徑定位 」。</span><span class="sxs-lookup"><span data-stu-id="589d8-155">This is why in the **Messages** tab it is called “Path – content located by body path” instead of “XPath – content located by body path.”</span></span>  
  
 <span data-ttu-id="589d8-156">在接收端，使用路徑運算式，指出資料的讀取自 WCF 訊息的方式。</span><span class="sxs-lookup"><span data-stu-id="589d8-156">On the receive side, use a Path expression that dictates how data is to be read from the WCF message.</span></span> <span data-ttu-id="589d8-157">用於輸入訊息，BizTalk 訊息內容取得替代路徑陳述式所擷取的特定項目。</span><span class="sxs-lookup"><span data-stu-id="589d8-157">For an inbound message, the specific element extracted by the Path statement gets substituted for the content of the BizTalk message.</span></span> <span data-ttu-id="589d8-158">配接器會使用此路徑運算式，找出並擷取 BizTalk 訊息所需的資料。</span><span class="sxs-lookup"><span data-stu-id="589d8-158">The adapter uses this Path expression to locate and extract the desired data for the BizTalk message.</span></span>  
  
 <span data-ttu-id="589d8-159">在傳送端，使用範本來建立 WCF 訊息從 BizTalk 訊息。</span><span class="sxs-lookup"><span data-stu-id="589d8-159">On the send side, use a template to create a WCF message from the BizTalk message.</span></span> <span data-ttu-id="589d8-160">對於輸出訊息的 [範本] 選項可允許 XPath 選項完全相反。</span><span class="sxs-lookup"><span data-stu-id="589d8-160">The template option for outbound messages is designed to allow the exact opposite of the XPath option.</span></span> <span data-ttu-id="589d8-161">在 WCF 配接器組態中，XML 程式碼片段會作為基礎的外寄訊息的結構。</span><span class="sxs-lookup"><span data-stu-id="589d8-161">In the WCF adapter configuration, the snippet of XML is used as the basis for the structure of the outbound message.</span></span> <span data-ttu-id="589d8-162">BizTalk 訊息的內容會在執行階段插入這個結構。</span><span class="sxs-lookup"><span data-stu-id="589d8-162">The content of the BizTalk message is inserted at run time into this structure.</span></span>  
  
 <span data-ttu-id="589d8-163">外寄訊息，您也必須選擇使用 [節點編碼] 設定，從 XML、 Base64、 字串或十六進位寫入之項目的類型。</span><span class="sxs-lookup"><span data-stu-id="589d8-163">For an outgoing message, you must also choose the type of the element written by using the Node Encoding setting from XML, Base64, String, or Hexadecimal.</span></span> <span data-ttu-id="589d8-164">當您想要擷取 WCF 訊息中所包含的二進位資料流，此選項是很有幫助。</span><span class="sxs-lookup"><span data-stu-id="589d8-164">This option is very useful when you want to extract a binary data stream contained in a WCF message.</span></span> <span data-ttu-id="589d8-165">使用這項功能會指示 WCF 配接器使用 WCF 訊息本文讀取裝置上的 ReadContextAsBase64 呼叫。</span><span class="sxs-lookup"><span data-stu-id="589d8-165">Using this feature instructs the WCF Adapter to use the ReadContextAsBase64 calls on the body Reader of the WCF Message.</span></span> <span data-ttu-id="589d8-166">此呼叫可讓要讓使用此功能的二進位資料可以直接從移動 WCF 傳輸到 BizTalk MessageBox 資料庫直接透過 XmlReader API，讀取的二進位資料。</span><span class="sxs-lookup"><span data-stu-id="589d8-166">This call allows binary data to be read directly through the XmlReader API, so using this feature binary data can be moved directly from the WCF Transport into the BizTalk MessageBox database.</span></span> <span data-ttu-id="589d8-167">藉由將路徑寫入包含二進位資料的節點可以拉出，並將它放入 BizTalk 訊息。</span><span class="sxs-lookup"><span data-stu-id="589d8-167">By writing a path to the node containing the binary data you can pull it out and place it into the BizTalk message.</span></span>  
  
## <a name="how-do-you-access-wcf-message-properties-within-an-incoming-wcf-message"></a><span data-ttu-id="589d8-168">您要如何存取內送 WCF 訊息內的 WCF 訊息屬性？</span><span class="sxs-lookup"><span data-stu-id="589d8-168">How do you access WCF message properties within an incoming WCF message?</span></span>  
 <span data-ttu-id="589d8-169">若要存取內送 WCF 訊息內的屬性，它會轉換為 BizTalk 訊息之前，您可以使用自訂的 WCF 通道元件或服務模型與 WCF 行為的擴充點。</span><span class="sxs-lookup"><span data-stu-id="589d8-169">To access properties within an incoming WCF message before it is transformed into a BizTalk message, you can use a custom WCF channel component or a service model extensibility point with a WCF behavior.</span></span> <span data-ttu-id="589d8-170">例如， **IDispatchMessageInspector**物件。</span><span class="sxs-lookup"><span data-stu-id="589d8-170">For example, an **IDispatchMessageInspector** object.</span></span> <span data-ttu-id="589d8-171">BizTalk Wcf-custom 和 Wcf-customisolated 配接器提供簡單的方法，讓您的應用程式，可插入至使用的 WCF 行為的威力**行為**索引標籤中**傳輸屬性**對話方塊這些介面卡。</span><span class="sxs-lookup"><span data-stu-id="589d8-171">The BizTalk WCF-Custom and WCF-CustomIsolated adapters provide a simple way for your application to plug into the power of WCF behaviors using the **Behavior** tab in the **Transport Properties** dialog for those adapters.</span></span>  
  
 <span data-ttu-id="589d8-172">若要允許 WCF 訊息可供 WCF 配接器的屬性，這些屬性必須先寫入至訊息本文或標頭做為內容。</span><span class="sxs-lookup"><span data-stu-id="589d8-172">To allow the properties of a WCF message to be available to the WCF adapter, those properties first have to be written into the message body or header as content.</span></span> <span data-ttu-id="589d8-173">標頭會複製到 BizTalk 訊息內容會自動為您。</span><span class="sxs-lookup"><span data-stu-id="589d8-173">The headers are copied into the BizTalk message context automatically for you.</span></span> <span data-ttu-id="589d8-174">如果您想要升級的屬性值，您可以使用自訂的 BizTalk 管線元件先將 WCF 訊息屬性升級至 BizTalk 訊息內容中，從**IComponent： 執行**方法。</span><span class="sxs-lookup"><span data-stu-id="589d8-174">If you want a property value promoted, you can use a custom BizTalk pipeline component to promote the WCF message property into the BizTalk message context from within the **IComponent:Execute** method.</span></span> <span data-ttu-id="589d8-175">使用 WCF 自訂配接器自訂 WCF 行為，可讓您利用 WCF 及 BizTalk 功能更強大且富彈性，讓您的解決方案的擴充性。</span><span class="sxs-lookup"><span data-stu-id="589d8-175">Using custom WCF behaviors with the WCF custom adapters allows you to take advantage of both WCF and BizTalk extensibility to make your solution more powerful and flexible.</span></span> <span data-ttu-id="589d8-176">WCF 配接器可讓您結合現有的 BizTalk 和 WCF extensibilities 來解決問題。</span><span class="sxs-lookup"><span data-stu-id="589d8-176">The WCF adapter allows you to combine existing BizTalk and WCF extensibilities to solve your problem.</span></span>  
  
 <span data-ttu-id="589d8-177">好消息是這個通用的屬性大小寫的 WCF 配接器中沒有捷徑。</span><span class="sxs-lookup"><span data-stu-id="589d8-177">The good news is that there is a shortcut in the WCF adapter for this common property case.</span></span> <span data-ttu-id="589d8-178">您無須撰寫這兩個擴充性文本的內容，而只要讓 WCF 延伸模組去新建 WCF 配接器可理解的「已知」屬性即可。</span><span class="sxs-lookup"><span data-stu-id="589d8-178">Rather than writing to both extensibility stories, you can simply have the WCF extension create a new “well known” property that is understood by the WCF adapter.</span></span>  
  
 <span data-ttu-id="589d8-179">若要撰寫或升級至 BizTalk 訊息內容的 SOAP 標頭值，將 WCF 訊息必須包含屬性名稱和命名空間所組成的值組的集合。</span><span class="sxs-lookup"><span data-stu-id="589d8-179">In order to write or promote SOAP header values into the BizTalk message context, the WCF message must contain a collection of value pairs that consist of property names and namespaces.</span></span> <span data-ttu-id="589d8-180">這可讓 WCF 配接器可辨識的標頭值要寫入或升級。</span><span class="sxs-lookup"><span data-stu-id="589d8-180">This allows the WCF adapters to recognize that the header values are to be written or promoted.</span></span>  
  
 <span data-ttu-id="589d8-181">WCF 訊息必須包含下列訊息屬性，WCF 配接器才能將 SOAP 標頭值寫入或升級至 BizTalk 訊息內容：</span><span class="sxs-lookup"><span data-stu-id="589d8-181">A WCF adapter expects the following message properties in the WCF messages for writing or promoting SOAP header values to the BizTalk message context:</span></span>  
  
-   <span data-ttu-id="589d8-182">若要升級至 BizTalk 訊息內容的 SOAP 標頭值，WCF 配接器會尋找金鑰組**http://schemas.microsoft.com/BizTalk/2006/01/Adapters/WCF-properties/Promote**和值**清單 < KeyValuePair\<XmlQualifiedName，物件\>>**.</span><span class="sxs-lookup"><span data-stu-id="589d8-182">To promote the SOAP header values to the BizTalk message context, WCF adapters are looking for the pair of key **http://schemas.microsoft.com/BizTalk/2006/01/Adapters/WCF-properties/Promote** and value **List<KeyValuePair\<XmlQualifiedName, object\>>**.</span></span> <span data-ttu-id="589d8-183">使用此配對，WCF 配接器需要命名空間、 名稱和值**XmlQualifiedName**物件，並將它們用於升級的標頭值。</span><span class="sxs-lookup"><span data-stu-id="589d8-183">Using this pair, WCF adapters take the namespace, name, and value from the **XmlQualifiedName** object and use them for promoting the header values.</span></span>  
  
-   <span data-ttu-id="589d8-184">若要寫入此項目，但不是升級，SOAP 標頭值到 BizTalk 訊息內容中，WCF 配接器會尋找金鑰組**http://schemas.microsoft.com/BizTalk/2006/01/Adapters/WCF-properties/WriteToContext**和值**清單 < KeyValuePair\<XmlQualifiedName，物件\>>。**</span><span class="sxs-lookup"><span data-stu-id="589d8-184">To write, but not promote, the SOAP header values into the BizTalk message context, WCF adapters are looking for the pair of key **http://schemas.microsoft.com/BizTalk/2006/01/Adapters/WCF-properties/WriteToContext** and value **List<KeyValuePair\<XmlQualifiedName, object\>>.**</span></span> <span data-ttu-id="589d8-185">使用此配對，WCF 配接器便可將值寫入訊息內容。</span><span class="sxs-lookup"><span data-stu-id="589d8-185">Using this pair, WCF adapters write the values to the message context.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="589d8-186">升級的屬性也必須指定 BizTalk 屬性結構描述中才能被接受，BizTalk 執行階段。</span><span class="sxs-lookup"><span data-stu-id="589d8-186">Promoted properties must also be specified in a BizTalk property schema in order to be accepted by the BizTalk runtime.</span></span>  
  
## <a name="you-have-an-existing-orchestration-or-send-port-etc-that-expects-a-biztalk-multipart-message-how-can-you-get-a-multipart-message-in-the-wcf-scenario"></a><span data-ttu-id="589d8-187">您有現有的協調流程 （或傳送埠等），必須要有多部分 BizTalk 訊息。</span><span class="sxs-lookup"><span data-stu-id="589d8-187">You have an existing orchestration (or send port, etc.) that expects a BizTalk multipart message.</span></span> <span data-ttu-id="589d8-188">您要如何在 WCF 案例中取得多部分訊息？</span><span class="sxs-lookup"><span data-stu-id="589d8-188">How can you get a multipart message in the WCF scenario?</span></span>  
 <span data-ttu-id="589d8-189">多部分 BizTalk 訊息是由一或多個訊息部分所組成。</span><span class="sxs-lookup"><span data-stu-id="589d8-189">A BizTalk multipart message is composed of one or more message parts.</span></span> <span data-ttu-id="589d8-190">不過，WCF 會有沒有多部分訊息的概念。</span><span class="sxs-lookup"><span data-stu-id="589d8-190">However, WCF has no concept of a multipart message.</span></span> <span data-ttu-id="589d8-191">因為 WCF 不會使用多部分訊息，BizTalk WCF 配接器也不會使用它們。</span><span class="sxs-lookup"><span data-stu-id="589d8-191">Because WCF does not use multipart messages, the BizTalk WCF adapters also do not use them.</span></span> <span data-ttu-id="589d8-192">問題是您可能有現有的 BizTalk 協調流程或管線，以產生或取用多部分訊息會寫入。</span><span class="sxs-lookup"><span data-stu-id="589d8-192">The problem is that you may have an existing BizTalk orchestration or pipeline that is written to produce or consume multipart messages.</span></span>  
  
 <span data-ttu-id="589d8-193">如果您要進入 BizTalk Server 中的多部分訊息，使用內送 WCF 訊息和 WCF 配接器時，轉譯為 XML 多部分的資料，您的 WCF 訊息中。</span><span class="sxs-lookup"><span data-stu-id="589d8-193">If you need to get a multipart message into BizTalk Server by using an incoming WCF message and the WCF adapters, render your multipart data as XML in your WCF message.</span></span> <span data-ttu-id="589d8-194">開發自訂的 BizTalk 管線元件來處理內送的 XML 資料流 （WCF 訊息），並建立您的應用程式適當的 BizTalk 多部分訊息。</span><span class="sxs-lookup"><span data-stu-id="589d8-194">Develop a custom BizTalk pipeline component to process the incoming XML stream (WCF message) and create the appropriate BizTalk multipart message for your application.</span></span> <span data-ttu-id="589d8-195">如有需要，可以完成這些步驟，傳送端的反向。</span><span class="sxs-lookup"><span data-stu-id="589d8-195">These steps can be done in reverse for the Send side if required.</span></span>