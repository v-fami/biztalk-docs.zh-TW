---
title: 從 MSMQT 配接器移轉至 MSMQ 配接器 |Microsoft 文件
ms.custom: ''
ms.date: 12/07/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: 97126f70-0be5-4a2f-bcba-173fd932b6de
caps.latest.revision: 30
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 1696e732bdbd005b01f16834a075fe69460602f9
ms.sourcegitcommit: 32f380810b90b70e5df7be72a6a14988a747868e
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 02/28/2018
ms.locfileid: "29710185"
---
# <a name="migrate-from-the-msmqt-adapter-to-the-msmq-adapter"></a><span data-ttu-id="4c7d1-102">從 MSMQT 配接器移轉至 MSMQ 配接器</span><span class="sxs-lookup"><span data-stu-id="4c7d1-102">Migrate from the MSMQT Adapter to the MSMQ Adapter</span></span>
<span data-ttu-id="4c7d1-103">本主題討論的內容是將解決方案從 BizTalk 訊息佇列 (MSMQT) 配接器移轉至訊息佇列 (MSMQ) 配接器以前，考量有關端對端排序的傳遞、交易一致性、高可用性和擴充性的要點。</span><span class="sxs-lookup"><span data-stu-id="4c7d1-103">This topic discusses points to consider regarding end-to-end ordered delivery, transactional consistency, high availability, and scalability before migrating solutions from the BizTalk Message Queuing (MSMQT) adapter to the Message Queuing (MSMQ) adapter.</span></span> <span data-ttu-id="4c7d1-104">排序的傳遞、交易一致性、高可用性和擴充性等主題的用途定義如下：</span><span class="sxs-lookup"><span data-stu-id="4c7d1-104">For purposes of this topic ordered delivery, transactional consistency, high availability, and scalability are defined as follows:</span></span>  
  
-   <span data-ttu-id="4c7d1-105">**排序的傳遞。**</span><span class="sxs-lookup"><span data-stu-id="4c7d1-105">**Ordered delivery.**</span></span> <span data-ttu-id="4c7d1-106">保證訊息會以接收它們時相同的排序從 BizTalk Server 傳送出去。</span><span class="sxs-lookup"><span data-stu-id="4c7d1-106">Guarantee that messages are sent out of BizTalk Server in the same order that they are received.</span></span>  
  
-   <span data-ttu-id="4c7d1-107">**交易一致性。**</span><span class="sxs-lookup"><span data-stu-id="4c7d1-107">**Transactional consistency.**</span></span> <span data-ttu-id="4c7d1-108">保證已處理的訊息不會因為硬體、軟體或網路失敗而遺失或重複。</span><span class="sxs-lookup"><span data-stu-id="4c7d1-108">Guarantee that messages being processed are not lost or duplicated due to hardware, software, or network failure.</span></span>  
  
-   <span data-ttu-id="4c7d1-109">**高可用性。**</span><span class="sxs-lookup"><span data-stu-id="4c7d1-109">**High availability.**</span></span> <span data-ttu-id="4c7d1-110">保證用來處理訊息的服務永遠都可用於處理。</span><span class="sxs-lookup"><span data-stu-id="4c7d1-110">Guarantee that services used to process messages are always available for processing.</span></span>  
  
-   <span data-ttu-id="4c7d1-111">**擴充性。**</span><span class="sxs-lookup"><span data-stu-id="4c7d1-111">**Scalability.**</span></span> <span data-ttu-id="4c7d1-112">增加現有訊息處理容量的能力。</span><span class="sxs-lookup"><span data-stu-id="4c7d1-112">Ability to increase existing message-processing capacity.</span></span>  
  
## <a name="end-to-end-ordered-delivery"></a><span data-ttu-id="4c7d1-113">端對端排序的傳遞</span><span class="sxs-lookup"><span data-stu-id="4c7d1-113">End-to-End Ordered Delivery</span></span>  
 <span data-ttu-id="4c7d1-114">MSMQT 配接器可以確保訊息端對端排序的傳遞。</span><span class="sxs-lookup"><span data-stu-id="4c7d1-114">The MSMQT adapter ensures end-to-end ordered delivery of messages.</span></span> <span data-ttu-id="4c7d1-115">這表示若 MSMQ 應用程式傳送訊息 1、2 和 3 至繫結至 MSMQT 配接器的接收位置，接著在 BizTalk Server 中就會以相同的順序，將這些訊息遞送至協調流程或傳送埠：1、2、3。</span><span class="sxs-lookup"><span data-stu-id="4c7d1-115">This means that if an MSMQ application sends messages 1, 2, and 3 to a receive location bound to the MSMQT adapter, then these messages are delivered to an orchestration or send port in BizTalk Server in the same order: 1, 2, 3.</span></span> <span data-ttu-id="4c7d1-116">使用這項功能的一個可能包含股市必須提交和已接收的相同順序執行。</span><span class="sxs-lookup"><span data-stu-id="4c7d1-116">One use of this functionality might include stock market trades that must be submitted and executed in the same order that they are received.</span></span>  
  
 <span data-ttu-id="4c7d1-117">使用 MSMQT 的端對端排序的傳遞需要許多元件一起運作。</span><span class="sxs-lookup"><span data-stu-id="4c7d1-117">End-to-end in-order delivery with MSMQT requires many components to be working together.</span></span> <span data-ttu-id="4c7d1-118">下列連續事件說明如何使用 MSMQT 配接器來完成此過程：</span><span class="sxs-lookup"><span data-stu-id="4c7d1-118">The following sequence of events illustrates how this is done with the MSMQT adapter:</span></span>  
  
1.  <span data-ttu-id="4c7d1-119">遠端電腦上的 MSMQ API 依序接到訊息 1、2 和 3 後，會以相同的順序再將訊息推入交易式本機佇列中：1、2、3。</span><span class="sxs-lookup"><span data-stu-id="4c7d1-119">The MSMQ API on a remote computer receives messages 1, 2, and 3 in order and pushes them into a transactional, local queue in the same order: 1, 2, 3.</span></span>  
  
2.  <span data-ttu-id="4c7d1-120">遠端電腦上的 MSMQ 用戶端會擷取該佇列中的訊息，再將訊息依下列順序傳送至 MSMQ 佇列：1、2、3。</span><span class="sxs-lookup"><span data-stu-id="4c7d1-120">An MSMQ client on the remote computer takes the messages from the queue and sends them to the MSMQT queue in order: 1, 2, 3.</span></span>  
  
3.  <span data-ttu-id="4c7d1-121">MSMQ 配接器會依 1、2、3 的順序接收訊息，再將訊息依相同的順序傳送至 BizTalk MessageAgent 元件：1、2、3。</span><span class="sxs-lookup"><span data-stu-id="4c7d1-121">The MSMQT adapter receives the messages in order 1, 2, 3 and hands them to the BizTalk MessageAgent component in the same order: 1, 2, 3.</span></span>  
  
4.  <span data-ttu-id="4c7d1-122">BizTalk MessageAgent 元件會確保訊息是依下列順序傳送至 MessageBox：1、2、3。</span><span class="sxs-lookup"><span data-stu-id="4c7d1-122">The BizTalk MessageAgent component ensures that the messages are sent to the MessageBox in order: 1, 2, 3.</span></span>  
  
5.  <span data-ttu-id="4c7d1-123">MessageBox 會路由傳送訊息，並確保訊息路由傳送至協調流程或傳送埠的同一個執行個體時，會依相同的順序傳遞至此執行個體：1、2、3。</span><span class="sxs-lookup"><span data-stu-id="4c7d1-123">The MessageBox routes the messages and ensures that if they are routed to the same instance of an orchestration or a send port, that they are delivered to this instance in the same order: 1, 2, 3.</span></span>  
  
 <span data-ttu-id="4c7d1-124">在 BizTalk Server 2004，MSMQT 是唯一的配接器能夠保證端對端排序傳遞。</span><span class="sxs-lookup"><span data-stu-id="4c7d1-124">In BizTalk Server 2004, MSMQT was the only adapter capable of guaranteeing end-to end ordered delivery.</span></span> <span data-ttu-id="4c7d1-125">所有其他整合式 BizTalk 配接器都可能變更上述步驟 3 至 5 中的訊息排序。</span><span class="sxs-lookup"><span data-stu-id="4c7d1-125">All of the other integrated BizTalk adapters can potentially change the order of the messages in steps 3 through 5 listed above.</span></span> <span data-ttu-id="4c7d1-126">大多數其他整合式配接器可以使用如「結束點管理員」這種元件來完成步驟 3，因為「結束點管理員」原本就是多執行緒處理，所以不會保留排序。</span><span class="sxs-lookup"><span data-stu-id="4c7d1-126">Most of the other integrated adapters complete step 3 by the use of a component known as the End Point Manager, which is inherently multithreaded and therefore does not preserve order.</span></span> <span data-ttu-id="4c7d1-127">BizTalk Server 2004 MSMQ 配接器使用保留步驟 3，排序的 「 連續處理 」 功能，但不會再要求 MessageAgent 保留往，因此訊息可能會路由至協調流程或傳送埠失序的順序。</span><span class="sxs-lookup"><span data-stu-id="4c7d1-127">The BizTalk Server 2004 MSMQ adapter used a "Serial Processing" feature that preserves order for step 3, but it does not then ask the MessageAgent to preserve order going forward, so the messages may be routed to an orchestration or send port out of order.</span></span>  
  
 <span data-ttu-id="4c7d1-128">**端對端排序的傳遞與 MSMQ 配接器**</span><span class="sxs-lookup"><span data-stu-id="4c7d1-128">**End-to-end ordered delivery with the MSMQ adapter**</span></span>  
  
 <span data-ttu-id="4c7d1-129">若要達成端對端排序的傳遞與 MSMQ 配接器，請遵循下列步驟︰</span><span class="sxs-lookup"><span data-stu-id="4c7d1-129">To achieve end-to-end ordered delivery with the MSMQ adapter, follow these steps:</span></span>  
  
1.  <span data-ttu-id="4c7d1-130">啟用 **排序的傳遞** 屬性上接收訂閱的協調流程的連接埠或傳送埠。</span><span class="sxs-lookup"><span data-stu-id="4c7d1-130">Enable the **Ordered Delivery** property on the receive port for the subscribing orchestration or send port.</span></span> <span data-ttu-id="4c7d1-131">在 BizTalk Server 接收協調流程中的連接埠和傳送埠**排序的傳遞**組態選項。</span><span class="sxs-lookup"><span data-stu-id="4c7d1-131">In BizTalk Server, receive ports in orchestrations and send ports have an **Ordered Delivery** configuration option.</span></span> <span data-ttu-id="4c7d1-132">若啟用這個選項，則協調流程接收埠或傳送埠會要求 MessageBox 以訊息提交到 MessageBox 的相同排序將訊息傳遞給它。</span><span class="sxs-lookup"><span data-stu-id="4c7d1-132">If this option is enabled, then the orchestration receive port or the send port asks the MessageBox to deliver messages to it in the same order they were submitted into the MessageBox.</span></span>  
  
2.  <span data-ttu-id="4c7d1-133">設定 **排序的處理** 屬性繫結至 MSMQ 配接器的接收位置 `True`。</span><span class="sxs-lookup"><span data-stu-id="4c7d1-133">Set the **Ordered Processing** property for the receive location that is bound to the MSMQ adapter to `True`.</span></span> <span data-ttu-id="4c7d1-134">在 BizTalk Server 接收位置使用 MSMQ 傳輸，可以設定為使用 排序的處理它，如果啟用，可確保會將訊息傳送至 MessageBox 接收它們的順序相同。</span><span class="sxs-lookup"><span data-stu-id="4c7d1-134">In BizTalk Server, receive locations that use the MSMQ transport can be configured to use Ordered Processing which, if enabled, ensures that messages are sent to the MessageBox in the same order that they were received.</span></span>  
  
3.  <span data-ttu-id="4c7d1-135">設定 **交易式** 屬性繫結至 MSMQ 配接器的接收位置 `True`。</span><span class="sxs-lookup"><span data-stu-id="4c7d1-135">Set the **Transactional** property for the receive location that is bound to the MSMQ adapter to `True`.</span></span>  
  
4.  <span data-ttu-id="4c7d1-136">確保任何由 MSMQ 接收位置正在監控的 MSMQ 佇列都會標示為「交易式」。</span><span class="sxs-lookup"><span data-stu-id="4c7d1-136">Ensure that any MSMQ queues that are being monitored by the MSMQ receive locations are marked as "Transactional".</span></span> <span data-ttu-id="4c7d1-137">必須在佇列上設定此屬性，以確保訊息的排序傳遞。</span><span class="sxs-lookup"><span data-stu-id="4c7d1-137">This property must be set on the queues to ensure ordered delivery of messages.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="4c7d1-138">只有當 BizTalk 接收位置正在監控的 MSMQ 佇列是僅由一部電腦提供服務時，才能保證排序的傳遞。</span><span class="sxs-lookup"><span data-stu-id="4c7d1-138">Ordered delivery is guaranteed only if the MSMQ queue or queues that are being monitored by BizTalk receive locations is/are serviced by only one computer.</span></span> <span data-ttu-id="4c7d1-139">這可能會造成擴充性的問題，如下所述。</span><span class="sxs-lookup"><span data-stu-id="4c7d1-139">This can present problems for scalability, as described below.</span></span>  
  
## <a name="transaction-usage-when-processing-messages-with-the-msmqt-adapter-vs-the-msmq-adapter"></a><span data-ttu-id="4c7d1-140">使用 MSMQT 配接器與 MSMQ 配接器處理訊息時的不同交易用法</span><span class="sxs-lookup"><span data-stu-id="4c7d1-140">Transaction Usage When Processing Messages with the MSMQT Adapter vs. the MSMQ Adapter</span></span>  
 <span data-ttu-id="4c7d1-141">關於交易用法，MSMQT 與 MSMQ 配接器在處理訊息方面有一個主要差異。</span><span class="sxs-lookup"><span data-stu-id="4c7d1-141">With regard to transaction usage, there is a key difference between how the MSMQT and MSMQ adapters process messages.</span></span>  
  
 <span data-ttu-id="4c7d1-142">使用 MSMQT 配接器時，從網路接收訊息的程序與使用 BizTalk Server 處理訊息，是在單一交易之下進行。</span><span class="sxs-lookup"><span data-stu-id="4c7d1-142">When using the MSMQT adapter, the process of receiving a message from the network and processing it with BizTalk Server is handled under a single transaction.</span></span> <span data-ttu-id="4c7d1-143">使用 MSMQT 配接器時，為傳送者產生的 ACK 訊息是一項指示，指出已接收訊息且 BizTalk Server 已順利處理。</span><span class="sxs-lookup"><span data-stu-id="4c7d1-143">When using the MSMQT adapter, ACK messages generated for the sender are an indication that the message has been received and has been successfully processed by BizTalk Server.</span></span>  
  
 <span data-ttu-id="4c7d1-144">使用 MSMQ 配接器時，從網路接收訊息的程序與使用 BizTalk Server 處理訊息，是在兩個分開的交易之下進行，一個是從網路接收，另一個是使用 BizTalk 伺服器處理。</span><span class="sxs-lookup"><span data-stu-id="4c7d1-144">When using the MSMQ adapter, the processes of receiving a message from the network and processing it with BizTalk Server are handled under two separate transactions, one for receiving from the network and one for processing it with BizTalk Server.</span></span> <span data-ttu-id="4c7d1-145">使用 MSMQ 配接器時，為傳送者產生的 ACK 訊息只是一項指示，指出已從網路順利接收訊息，但不會指出訊息已由 BizTalk Server 順利處理。</span><span class="sxs-lookup"><span data-stu-id="4c7d1-145">When using the MSMQ adapter, ACK messages generated for the sender are only an indication that the message has been successfully received from the network, not that the message has been successfully processed by BizTalk Server.</span></span> <span data-ttu-id="4c7d1-146">當訊息從網路接收並且保存至本機 MSMQ 佇列時，傳送者會從 Microsoft Message Queuing 伺服器接收一個 ACK，不論 BizTalk Server 是否已安裝。</span><span class="sxs-lookup"><span data-stu-id="4c7d1-146">The sender receives an ACK from the Microsoft Message Queuing server when the message is received from the network and persisted into the local MSMQ queue regardless of whether BizTalk Server is installed.</span></span> <span data-ttu-id="4c7d1-147">在訊息已保存至 MSMQ 佇列之後，BizTalk MSMQ 配接器會拾取訊息、處理訊息並將訊息發佈至 MessageBox。</span><span class="sxs-lookup"><span data-stu-id="4c7d1-147">After the message has been persisted to the MSMQ queue, the BizTalk MSMQ adapter picks it up, processes it, and publishes it to the MessageBox.</span></span> <span data-ttu-id="4c7d1-148">若這項程序失敗，訊息就會傳送到 BizTalk 擱置佇列或留在本機 MSMQ 佇列 (當使用交易式處理時)，而傳送者不會得知訊息在 BizTalk Server 中處理時已失敗。</span><span class="sxs-lookup"><span data-stu-id="4c7d1-148">If this process fails, the message is either sent to the BizTalk suspended queue or left in the local MSMQ queue (when using transactional processing), and the sender has no indication that the message failed processing in BizTalk Server.</span></span>  
  
 <span data-ttu-id="4c7d1-149">若您的架構需要您在 BizTalk Server 順利處理訊息時接收 ACK，那麼當您從 MSMQT 配接器移轉至 MSMQ 配接器時，您必須新增應用程式層級的 ACK。</span><span class="sxs-lookup"><span data-stu-id="4c7d1-149">If your architecture requires that you receive ACKs when your messages are successfully processed by BizTalk Server, then you must add application-level ACKs if you are migrating from the MSMQT adapter to the MSMQ adapter.</span></span> <span data-ttu-id="4c7d1-150">您必須更新協調流程和傳送應用程式，才能實作應用程式層級的通知。</span><span class="sxs-lookup"><span data-stu-id="4c7d1-150">You will need to update your orchestration and sending application to implement application-level ACKs.</span></span>  
  
## <a name="high-availability-transactional-in-order"></a><span data-ttu-id="4c7d1-151">高可用性 (交易式，依排序)</span><span class="sxs-lookup"><span data-stu-id="4c7d1-151">High Availability (Transactional, in Order)</span></span>  
 <span data-ttu-id="4c7d1-152">若要為 MSMQT 配接器提供高可用性您可以將多部電腦新增至接收主控件，並設定網路負載平衡 (NLB) 的容錯或可以叢集化預設 BizTalk 主控件。</span><span class="sxs-lookup"><span data-stu-id="4c7d1-152">To provide high availability for the MSMQT adapter you can either add multiple computers to the receive host and configure Network Load Balancing (NLB) for fault tolerance or you can cluster the default BizTalk Host.</span></span> <span data-ttu-id="4c7d1-153">若您結合 NLB 來執行 MSMQT 配接器，則其中一部伺服器當機時，其他伺服器就會接手處理負載。</span><span class="sxs-lookup"><span data-stu-id="4c7d1-153">If you are running the MSMQT adapter in conjunction with NLB, if one server goes down the other servers handle the load.</span></span> <span data-ttu-id="4c7d1-154">若您在叢集化的主控件中執行 MSMQT 配接器處理常式，當其中一個主控件節點失敗時，叢集軟體就會將叢集化節點容錯移轉到其他節點。</span><span class="sxs-lookup"><span data-stu-id="4c7d1-154">If you are running the MSMQT adapter handlers on a clustered host, if one host node fails, cluster software fails over the clustered host to the other node.</span></span> <span data-ttu-id="4c7d1-155">使用 MSMQ 配接器時，若您需要交易式處理，且不遺失資料，則 NLB 不會運作，因為 MSMQ 配接器使用本機 MSMQ 佇列以進行中繼儲存。</span><span class="sxs-lookup"><span data-stu-id="4c7d1-155">When using the MSMQ adapter, NLB does not work if you need transactional processing with no data loss because the MSMQ adapter uses local MSMQ queues for intermediate storage.</span></span> <span data-ttu-id="4c7d1-156">在此實例中，若訊息已傳遞至本機 MSMQ 佇列但是沒有被 MSMQ 配接器取用，則在電腦當機時，就會遺失訊息。</span><span class="sxs-lookup"><span data-stu-id="4c7d1-156">In this scenario, if a message has been delivered to the local MSMQ queue but has not been consumed by the MSMQ adapter, the message is lost if the computer fails.</span></span>  
  
 <span data-ttu-id="4c7d1-157">若要使用 MSMQ 配接器提供高可用性與交易一致性，您應該執行下列作業︰</span><span class="sxs-lookup"><span data-stu-id="4c7d1-157">To provide high availability and transactional consistency with the MSMQ adapter, you should do the following:</span></span>  
  
1.  <span data-ttu-id="4c7d1-158">在 BizTalk Server 的 Windows 伺服器叢集群組中將 Microsoft Message Queuing (MSMQ) 設定為叢集資源。</span><span class="sxs-lookup"><span data-stu-id="4c7d1-158">Configure Microsoft Message Queuing (MSMQ) as a clustered resource in a Windows Server cluster group on your BizTalk servers.</span></span>  
  
2.  <span data-ttu-id="4c7d1-159">在 BizTalk 主控件執行個體中設定 MSMQ 配接器的傳送和接收處理常式，此執行個體已在與叢集 MSMQ 資源相同的叢集群組中設定為叢集資源。</span><span class="sxs-lookup"><span data-stu-id="4c7d1-159">Configure the MSMQ adapter receive handler in a BizTalk Host instance that has been configured as a cluster resource in the same cluster group as the clustered MSMQ resource.</span></span>  
  
3.  <span data-ttu-id="4c7d1-160">設定 BizTalk 主控件執行個體的叢集資源，這樣它才會維持對叢集化 MSMQ 資源的相依性。</span><span class="sxs-lookup"><span data-stu-id="4c7d1-160">Configure the cluster resource for the BizTalk Host instance so that it maintains a dependency on the clustered MSMQ resource.</span></span>  
  
 <span data-ttu-id="4c7d1-161">若要實作此架構與排序的傳遞，請依照稍早所呈現 「 端對端排序的傳遞與 MSMQ 配接器。 」 底下的步驟</span><span class="sxs-lookup"><span data-stu-id="4c7d1-161">To implement ordered delivery with this architecture, follow the steps presented earlier under "End-to-end ordered delivery with the MSMQ adapter."</span></span>  
  
## <a name="high-availability-nontransactional-not-in-order"></a><span data-ttu-id="4c7d1-162">高可用性 (非交易式，非依排序)</span><span class="sxs-lookup"><span data-stu-id="4c7d1-162">High Availability (Nontransactional, Not in Order)</span></span>  
 <span data-ttu-id="4c7d1-163">若您需要高可用性，但是不需要交易式處理，您可以實作 NLB 及執行主控件執行個體 (在 NLB 背後的多部 BizTalk 伺服器上使用 MSMQ 傳送與接收處理常式來設定)，使用 MSMQ 配接器來滿足需求。</span><span class="sxs-lookup"><span data-stu-id="4c7d1-163">If you need high availability but do not need transactional processing, you can achieve this with the MSMQ adapter by implementing NLB and running instances of a host configured with the MSMQ send and receive handlers on multiple BizTalk servers behind NLB.</span></span> <span data-ttu-id="4c7d1-164">當 MSMQ 實作 NLB 時您應該遵循最佳作法，如 Microsoft 知識庫文件中所述[899611： 訊息佇列的方式透過網路負載平衡 (NLB) 功能可以](https://support.microsoft.com/help/899611/how-message-queuing-can-function-over-network-load-balancing-nlb)。</span><span class="sxs-lookup"><span data-stu-id="4c7d1-164">When implementing NLB with MSMQ you should follow best practices as documented in Microsoft Knowledge Base article [899611 : How Message Queuing can function over Network Load Balancing (NLB)](https://support.microsoft.com/help/899611/how-message-queuing-can-function-over-network-load-balancing-nlb).</span></span> <span data-ttu-id="4c7d1-165">在此實例中，若其中一部 BizTalk 伺服器當機，在 BizTalk 伺服器上的主控件執行個體中執行之訊息，在 BizTalk 伺服器復原以前都將無法使用。</span><span class="sxs-lookup"><span data-stu-id="4c7d1-165">In this scenario, if one of the BizTalk servers fails, the messages that are running in the host instance on that BizTalk server will be unavailable until the BizTalk server is recovered.</span></span> <span data-ttu-id="4c7d1-166">這個組態可提供高可用性，因為若其中一部 BizTalk 伺服器無法使用，NLB 會將要求路由到其他 BizTalk 伺服器。</span><span class="sxs-lookup"><span data-stu-id="4c7d1-166">This configuration provides high availability because if one of the BizTalk servers is not available, NLB routes requests to the other BizTalk server.</span></span>  
  
## <a name="scalability-nontransactional-not-in-order"></a><span data-ttu-id="4c7d1-167">擴充性 (非交易式，非依排序)</span><span class="sxs-lookup"><span data-stu-id="4c7d1-167">Scalability (Nontransactional, Not in Order)</span></span>  
 <span data-ttu-id="4c7d1-168">您可以遵循下列高可用性 (非交易式) 的指導方針來以及新增主控件執行個體來達到擴充性。</span><span class="sxs-lookup"><span data-stu-id="4c7d1-168">You can achieve scalability by following the guidelines for high availability (nontransactional) and adding additional host instances.</span></span> <span data-ttu-id="4c7d1-169">這個架構提供快速傳遞與擴充性，但是不提供排序的傳遞。</span><span class="sxs-lookup"><span data-stu-id="4c7d1-169">This architecture provides fast delivery as well as scalability, but does not provide ordered delivery.</span></span>  
  
## <a name="scalability-transactional-not-in-order"></a><span data-ttu-id="4c7d1-170">擴充性 (交易式，非依排序)</span><span class="sxs-lookup"><span data-stu-id="4c7d1-170">Scalability (Transactional, Not in Order)</span></span>  
 <span data-ttu-id="4c7d1-171">如需訊息的交易式遞送而無須排序的傳遞，您可以同時使用 NLB 與 MSMQ 以及 Windows 叢集。</span><span class="sxs-lookup"><span data-stu-id="4c7d1-171">For transactional delivery of messages without ordered delivery, you can combine the use of NLB with MSMQ and Windows clustering.</span></span> <span data-ttu-id="4c7d1-172">這個架構需要您遵循「高可用性 (交易，依排序)」之中的步驟，在兩個分開的 Windows 叢集環境中為每個 Windows 叢集設定至少兩個叢集群組。</span><span class="sxs-lookup"><span data-stu-id="4c7d1-172">This architecture requires that you configure at least two cluster groups on two separate Windows Cluster environments following the steps under "High Availability (Transactional, in Order)" for each Windows Cluster.</span></span> <span data-ttu-id="4c7d1-173">然後您可以實作 NLB 來分散叢集群組之間的負載。</span><span class="sxs-lookup"><span data-stu-id="4c7d1-173">You then implement NLB to distribute load between the cluster groups.</span></span> <span data-ttu-id="4c7d1-174">因為 Windows 叢集上不支援執行 Windows NLB，所以這個實例需要硬體 NLB 解決方案。</span><span class="sxs-lookup"><span data-stu-id="4c7d1-174">Because Windows NLB is not supported running on a Windows Cluster, this scenario requires a hardware NLB solution.</span></span> <span data-ttu-id="4c7d1-175">下圖說明這個架構。</span><span class="sxs-lookup"><span data-stu-id="4c7d1-175">The following diagram illustrates this architecture.</span></span>  
  
 <span data-ttu-id="4c7d1-176">![叢集群組之間的負載平衡](../core/media/scaleclusteredmsmqwithnlb.gif "ScaleClusteredMSMQwithNLB")</span><span class="sxs-lookup"><span data-stu-id="4c7d1-176">![Load balancing between cluster groups](../core/media/scaleclusteredmsmqwithnlb.gif "ScaleClusteredMSMQwithNLB")</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="4c7d1-177">這個架構不提供排序的傳遞。</span><span class="sxs-lookup"><span data-stu-id="4c7d1-177">This architecture does not provide ordered delivery.</span></span>  
  
## <a name="scalability-transactional-in-order"></a><span data-ttu-id="4c7d1-178">擴充性 (交易式，依排序)</span><span class="sxs-lookup"><span data-stu-id="4c7d1-178">Scalability (Transactional, in Order)</span></span>  
 <span data-ttu-id="4c7d1-179">當使用 MSMQ 3.0 或更早的版本時，提供高可用性、交易一致性和排序傳遞的向外擴充架構會有問題，因為不支援遠端交易讀取，除非 BizTalk Server 電腦和遠端 MSMQ 伺服器都執行 MSMQ 4.0。</span><span class="sxs-lookup"><span data-stu-id="4c7d1-179">Scaling out an architecture that provides high availability, transactional consistency, and ordered delivery is problematic when using MSMQ 3.0 or earlier because remote transactional reads are not supported unless both the BizTalk Server computer and the remote MSMQ server are running MSMQ 4.0.</span></span> <span data-ttu-id="4c7d1-180">當使用 MSMQ 3.0 或更早的版本時，必須使用多個本機 MSMQ 佇列達成向外擴充。</span><span class="sxs-lookup"><span data-stu-id="4c7d1-180">When using MSMQ 3.0 or earlier, scale out must be achieved using multiple local MSMQ queues.</span></span> <span data-ttu-id="4c7d1-181">此外，在此案例中，如果 MSMQ 工作階段到 NLB 的 TCP/IP 連線已中斷，它可能接著還原 nlb 到不同的電腦，可能會造成順序錯亂傳遞。</span><span class="sxs-lookup"><span data-stu-id="4c7d1-181">Furthermore, in this scenario, if the TCP/IP connection for the MSMQ session to the NLB is broken, it may subsequently be restored by NLB to a different computer, which can cause out-of-order delivery.</span></span>  
  
 <span data-ttu-id="4c7d1-182">對於這項限制的一個可能的解決方法，就是配置目的地佇列到不同的電腦來手動載入平衡訊息傳遞。</span><span class="sxs-lookup"><span data-stu-id="4c7d1-182">One possible workaround to this limitation is to manually load balance message delivery by allocating destination queues to different computers.</span></span> <span data-ttu-id="4c7d1-183">您也可以輸入特定 BizTalk 主控件執行個體到特定 MSMQ 佇列來達到這項目的。</span><span class="sxs-lookup"><span data-stu-id="4c7d1-183">You can so this by tying specific BizTalk Host instances to specific MSMQ queues.</span></span> <span data-ttu-id="4c7d1-184">例如，若您從某一個交易夥伴接收大量的文件，請為該交易夥伴在特定 BizTalk 伺服器上建立個別的主控件與接收佇列。</span><span class="sxs-lookup"><span data-stu-id="4c7d1-184">So for example, if you receive a large number of documents from one particular trading partner, create a separate host and receive queue on a particular BizTalk server for just that trading partner.</span></span>  
  
 <span data-ttu-id="4c7d1-185">當您需要遠端交易讀取以及負載平衡時，可能的話，請執行在遠端電腦上 MSMQ 4.0。</span><span class="sxs-lookup"><span data-stu-id="4c7d1-185">If possible, run MSMQ 4.0 on remote computers when both remote transactional reads and load balancing are required.</span></span>  
  
## <a name="summary"></a><span data-ttu-id="4c7d1-186">摘要</span><span class="sxs-lookup"><span data-stu-id="4c7d1-186">Summary</span></span>  
 <span data-ttu-id="4c7d1-187">下表摘要敘述您可以實作的架構，以啟動特定的功能。</span><span class="sxs-lookup"><span data-stu-id="4c7d1-187">The following table summarizes the architectures that you can implement to accommodate specific functionality.</span></span>  
  
|<span data-ttu-id="4c7d1-188">**功能**</span><span class="sxs-lookup"><span data-stu-id="4c7d1-188">**Functionality**</span></span>|<span data-ttu-id="4c7d1-189">**NLB 不叢集**</span><span class="sxs-lookup"><span data-stu-id="4c7d1-189">**Neither NLB nor cluster**</span></span>|<span data-ttu-id="4c7d1-190">**NLB**</span><span class="sxs-lookup"><span data-stu-id="4c7d1-190">**NLB**</span></span>|<span data-ttu-id="4c7d1-191">**叢集**</span><span class="sxs-lookup"><span data-stu-id="4c7d1-191">**Cluster**</span></span>|<span data-ttu-id="4c7d1-192">**NLB 和叢集**</span><span class="sxs-lookup"><span data-stu-id="4c7d1-192">**NLB and cluster**</span></span>|  
|-----------------------|---------------------------------|-------------|-----------------|-------------------------|  
|<span data-ttu-id="4c7d1-193">端對端排序的傳遞</span><span class="sxs-lookup"><span data-stu-id="4c7d1-193">End-to-end ordered delivery</span></span>|<span data-ttu-id="4c7d1-194">是</span><span class="sxs-lookup"><span data-stu-id="4c7d1-194">Yes</span></span>|<span data-ttu-id="4c7d1-195">否</span><span class="sxs-lookup"><span data-stu-id="4c7d1-195">No</span></span>|<span data-ttu-id="4c7d1-196">是</span><span class="sxs-lookup"><span data-stu-id="4c7d1-196">Yes</span></span>|<span data-ttu-id="4c7d1-197">手動組態可能可行</span><span class="sxs-lookup"><span data-stu-id="4c7d1-197">Possible with manual configuration</span></span>|  
|<span data-ttu-id="4c7d1-198">交易一致性</span><span class="sxs-lookup"><span data-stu-id="4c7d1-198">Transactional consistency</span></span>|<span data-ttu-id="4c7d1-199">否 (若發生服務失敗，訊息可能會遺失或重複)</span><span class="sxs-lookup"><span data-stu-id="4c7d1-199">No (messages can be lost or duplicated if service failure occurs)</span></span>|<span data-ttu-id="4c7d1-200">否</span><span class="sxs-lookup"><span data-stu-id="4c7d1-200">No</span></span>|<span data-ttu-id="4c7d1-201">是</span><span class="sxs-lookup"><span data-stu-id="4c7d1-201">Yes</span></span>|<span data-ttu-id="4c7d1-202">是</span><span class="sxs-lookup"><span data-stu-id="4c7d1-202">Yes</span></span>|  
|<span data-ttu-id="4c7d1-203">高度可用</span><span class="sxs-lookup"><span data-stu-id="4c7d1-203">Highly available</span></span>|<span data-ttu-id="4c7d1-204">否</span><span class="sxs-lookup"><span data-stu-id="4c7d1-204">No</span></span>|<span data-ttu-id="4c7d1-205">是</span><span class="sxs-lookup"><span data-stu-id="4c7d1-205">Yes</span></span>|<span data-ttu-id="4c7d1-206">是</span><span class="sxs-lookup"><span data-stu-id="4c7d1-206">Yes</span></span>|<span data-ttu-id="4c7d1-207">是</span><span class="sxs-lookup"><span data-stu-id="4c7d1-207">Yes</span></span>|  
|<span data-ttu-id="4c7d1-208">可擴充</span><span class="sxs-lookup"><span data-stu-id="4c7d1-208">Scalable</span></span>|<span data-ttu-id="4c7d1-209">否</span><span class="sxs-lookup"><span data-stu-id="4c7d1-209">No</span></span>|<span data-ttu-id="4c7d1-210">是</span><span class="sxs-lookup"><span data-stu-id="4c7d1-210">Yes</span></span>|<span data-ttu-id="4c7d1-211">否</span><span class="sxs-lookup"><span data-stu-id="4c7d1-211">No</span></span>|<span data-ttu-id="4c7d1-212">是</span><span class="sxs-lookup"><span data-stu-id="4c7d1-212">Yes</span></span>|  
  
## <a name="see-also"></a><span data-ttu-id="4c7d1-213">另請參閱</span><span class="sxs-lookup"><span data-stu-id="4c7d1-213">See Also</span></span>  
 [<span data-ttu-id="4c7d1-214">使用 Windows 伺服器叢集以提供高可用性的 BizTalk Server Hosts2</span><span class="sxs-lookup"><span data-stu-id="4c7d1-214">Using Windows Server Cluster to Provide High Availability for BizTalk Server Hosts2</span></span>](../core/use-windows-cluster-to-provide-high-availability-for-biztalk-hosts.md)