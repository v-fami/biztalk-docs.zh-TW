---
title: 保留收到的批次 EDI 交換 |Microsoft 文件
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: 10d21b9b-9684-422a-8948-8bd71a4d5a10
caps.latest.revision: 20
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: de14760110eedd002ee01527d57f82c3d6a1aa02
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 09/20/2017
ms.locfileid: "22265678"
---
# <a name="preserving-a-received-batched-edi-interchange"></a><span data-ttu-id="2316a-102">保留收到的批次處理 EDI 交換</span><span class="sxs-lookup"><span data-stu-id="2316a-102">Preserving a Received Batched EDI Interchange</span></span>
> [!NOTE]
>  <span data-ttu-id="2316a-103">本主題中提及的所有使用者介面選項都可用於**本機主機設定**頁面 (**接收者的設定**區段) 中的雙向協議索引標籤**協議屬性** 對話方塊。</span><span class="sxs-lookup"><span data-stu-id="2316a-103">All the user interface options mentioned in this topic are available in the **Local Host Settings** page (**Receiver’s Settings** section) of the bi-directional agreement tabs in the **Agreement Properties** dialog box.</span></span>  
  
 <span data-ttu-id="2316a-104">當 EDI 接收管線保留輸入的批次處理 EDI 交換時，就不會執行將每個交易集/訊息剖析成個別中繼 XML 檔案的一般作業。</span><span class="sxs-lookup"><span data-stu-id="2316a-104">When the EDI receive pipeline preserves an inbound batched EDI interchange, the normal parsing of each transaction set/message into separate intermediate XML files is not performed.</span></span> <span data-ttu-id="2316a-105">EDI 接收管線會以單一文件的方式處理該次交換，而不會分割交易集/訊息。</span><span class="sxs-lookup"><span data-stu-id="2316a-105">The EDI receive pipeline processes the interchange as one document without splitting the transaction sets/messages.</span></span> <span data-ttu-id="2316a-106">發生這種情況時**輸入批次處理選項**屬性設定為**保留交換-發生錯誤時暫停交換**或**保留交換-發生時暫停交易集錯誤**。</span><span class="sxs-lookup"><span data-stu-id="2316a-106">This occurs when the **Inbound batch processing option** property is set to **Preserve Interchange - suspend Interchange on Error** or **Preserve Interchange - suspend Transaction Sets on Error**.</span></span>  
  
 <span data-ttu-id="2316a-107">**結構描述驗證**</span><span class="sxs-lookup"><span data-stu-id="2316a-107">**Schema Validation**</span></span>  
  
 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]<span data-ttu-id="2316a-108"> 會使用批次結構描述和服務結構描述來驗證保留批次的信封。</span><span class="sxs-lookup"><span data-stu-id="2316a-108"> validates the envelope of a preserved batch using the batch schemas and the service schemas.</span></span> <span data-ttu-id="2316a-109">批次結構描述可用來驗證保留訊息的根節點，而服務結構描述則用於驗證交換、群組，以及交易集標頭和結尾。</span><span class="sxs-lookup"><span data-stu-id="2316a-109">The batch schema is used to validate the root node of the preserved message; the service schemas are used to validate the interchange, group, and transaction set headers and trailers.</span></span> <span data-ttu-id="2316a-110">如需批次結構描述的詳細資訊，請參閱[EDI 批次結構描述](../core/edi-batch-schemas.md)。</span><span class="sxs-lookup"><span data-stu-id="2316a-110">For more information about the batch schemas, see [EDI Batch Schemas](../core/edi-batch-schemas.md).</span></span> <span data-ttu-id="2316a-111">如需有關服務結構描述的詳細資訊，請參閱[EDI 服務和控制結構描述](../core/edi-service-and-control-schemas.md)。</span><span class="sxs-lookup"><span data-stu-id="2316a-111">For more information on the service schemas, see [EDI Service and Control Schemas](../core/edi-service-and-control-schemas.md).</span></span>  
  
 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]<span data-ttu-id="2316a-112"> 會使用專案中的文件結構描述來驗證批次交換中的文件。</span><span class="sxs-lookup"><span data-stu-id="2316a-112"> validates the documents in a batched interchange using the document schemas in your project.</span></span>  
  
 <span data-ttu-id="2316a-113">**接收端處理**</span><span class="sxs-lookup"><span data-stu-id="2316a-113">**Receive-Side Processing**</span></span>  
  
 <span data-ttu-id="2316a-114">EDI 解譯器處理保留批次的方式如下：</span><span class="sxs-lookup"><span data-stu-id="2316a-114">The EDI Disassembler processes preserved batches as follows:</span></span>  
  
-   <span data-ttu-id="2316a-115">當 EDI 解譯器處理要保留的批次時，它會將一般檔案格式轉換成 XML，並加入 X12InterchangeXML 或 EdifactInterchangeXML 做為 XML 根節點。</span><span class="sxs-lookup"><span data-stu-id="2316a-115">When the EDI Disassembler processes a batch to be preserved, it converts the flat file format to XML and adds the X12InterchangeXML or EdifactInterchangeXML as the XML root node.</span></span> <span data-ttu-id="2316a-116">這個步驟讓傳送管線知道它應該保留批次交換，也表示系統應該使用 Edifact_BatchSchema 結構描述或 X12_BatchSchema 結構描述來驗證根節點。</span><span class="sxs-lookup"><span data-stu-id="2316a-116">This indicates to the send pipeline that the batched interchange should be preserved, and indicates that the Edifact_BatchSchema schema or X12_BatchSchema schema should be used to validate the root node.</span></span>  
  
-   <span data-ttu-id="2316a-117">解譯器會將 DelimiterSetSerializedData 屬性 (Attribute) 加入至批次 XML 訊息的根節點，以指定傳送管線在從 XML 訊息產生批次 EDI 交換時所要使用的分隔符號。</span><span class="sxs-lookup"><span data-stu-id="2316a-117">The Disassembler adds the DelimiterSetSerializedData attribute to the root node of a batched XML message to indicate the separators to be used by the send pipeline when generating a batched EDI interchange from the XML message.</span></span> <span data-ttu-id="2316a-118">若 XML 訊息是保留的批次，接收管線就會從內送訊息中使用的分隔符號填入這個屬性。</span><span class="sxs-lookup"><span data-stu-id="2316a-118">When the XML message is a preserved batch, the attribute is populated by the receive pipeline from the separators used in the incoming message.</span></span> <span data-ttu-id="2316a-119">在批次協調流程產生批次 XML 時，則會根據協議屬性 (Property) 中指定的值填入此屬性 (Attribute)。</span><span class="sxs-lookup"><span data-stu-id="2316a-119">When the batched XML is produced by the batching orchestration, the attribute is populated from the value specified in agreement properties.</span></span>  
  
-   <span data-ttu-id="2316a-120">在建立 XML 編碼的保留交換時，解譯器會使用下列其中一個命名空間：`http://schemas.microsoft.com/BizTalk/EDI/EDIFACT/2006/InterchangeXML` or `http://schemas.microsoft.com/BizTalk/EDI/X12/2006/InterchangeXML`。</span><span class="sxs-lookup"><span data-stu-id="2316a-120">The Disassembler uses one of the following namespaces when it creates an XML-encoded preserved interchange: `http://schemas.microsoft.com/BizTalk/EDI/EDIFACT/2006/InterchangeXML` or `http://schemas.microsoft.com/BizTalk/EDI/X12/2006/InterchangeXML`.</span></span>  
  
-   <span data-ttu-id="2316a-121">解譯器會升級內容屬性 `EDI.ReuseEnvelope == True`，以識別保留的交換。</span><span class="sxs-lookup"><span data-stu-id="2316a-121">The Disassembler promotes the context property `EDI.ReuseEnvelope == True` to identify the interchange as preserved.</span></span> <span data-ttu-id="2316a-122">這可讓您建立傳送埠，以訂閱保留的所有批次交換。</span><span class="sxs-lookup"><span data-stu-id="2316a-122">This enables you to create a send port that subscribes to all batched interchanges that are preserved.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="2316a-123">HIPAA 文件才不會分割成子文件**輸入批次處理選項**設**保留交換**。</span><span class="sxs-lookup"><span data-stu-id="2316a-123">A HIPAA document will not be split into subdocuments if the **Inbound batch processing option** is set to **Preserve Interchange**.</span></span> <span data-ttu-id="2316a-124">即使 HIPAA 結構描述內的子文件建立分頁註解設定為 "Yes" 也一樣。</span><span class="sxs-lookup"><span data-stu-id="2316a-124">This will be the case even if the subdocument creation break annotation within the HIPAA schema is set to "Yes".</span></span>  
  
 <span data-ttu-id="2316a-125">**錯誤處理**</span><span class="sxs-lookup"><span data-stu-id="2316a-125">**Error Processing**</span></span>  
  
 <span data-ttu-id="2316a-126">如果您已選取**保留交換-發生錯誤時暫停交換**如**輸入批次處理選項**，會因任何錯誤而擱置整個交換。</span><span class="sxs-lookup"><span data-stu-id="2316a-126">If you have selected **Preserve Interchange - suspend Interchange on Error** for the **Inbound batch processing option**, the entire interchange will be suspended as a result of any error.</span></span> <span data-ttu-id="2316a-127">如果 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 擱置了整個保留的交換，交換結構以及交換內交易集的順序都會保留。</span><span class="sxs-lookup"><span data-stu-id="2316a-127">If [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] suspends the entire preserved interchange, the interchange structure and the ordering of the transaction sets within the interchange will be preserved.</span></span> <span data-ttu-id="2316a-128">發生錯誤時，[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 會在事件日誌中公佈一個合併的錯誤項目。</span><span class="sxs-lookup"><span data-stu-id="2316a-128">In the event of an error, [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] will post one consolidated error entry in the event log.</span></span> <span data-ttu-id="2316a-129">這個項目將包括交換、功能群組與交易集等層級中的所有錯誤。</span><span class="sxs-lookup"><span data-stu-id="2316a-129">This entry will include any errors in the interchange, functional group, and transaction set levels.</span></span>  
  
 <span data-ttu-id="2316a-130">如果您已選取**保留交換-發生錯誤時暫停交易集**輸入批次處理選項，EDI 接收管線會將任何無效的交易集從交換中捨棄，然後再繼續建立交換 XML。</span><span class="sxs-lookup"><span data-stu-id="2316a-130">If you have selected **Preserve Interchange - suspend Transaction Sets on Error** for the inbound batch processing option, the EDI receive pipeline will drop any invalid transaction set from the interchange and proceed with the creation of the interchange XML.</span></span> <span data-ttu-id="2316a-131">產生的交換 XML 必須重複使用現有的控制區段信封 (適用於 X12 編碼交換的 ISA、GS、GE 和 IEA，或適用於 EDIFACT 編碼交換的 UNA、UNB、UNG、UNE 和 UNZ)。</span><span class="sxs-lookup"><span data-stu-id="2316a-131">The resulting interchange XML is required to reuse the existing control segment envelopes (ISA, GS, GE, and IEA for X12-encoded interchanges or UNA, UNB, UNG, UNE, and UNZ for EDIFACT-encoded interchanges).</span></span> <span data-ttu-id="2316a-132">系統會將這個交換視為已成功處理完成的文件；不過，事件檢視器中將會報告錯誤，而且如果已經產生功能通知，通知中也會報告錯誤。</span><span class="sxs-lookup"><span data-stu-id="2316a-132">The interchange will be considered a successfully processed document; however, the error will be reported in the event viewer and if a functional acknowledgment is generated, it will report the error.</span></span> [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]<span data-ttu-id="2316a-133">將事件記錄檔中的每個交易集發生錯誤，建立個別的項目。</span><span class="sxs-lookup"><span data-stu-id="2316a-133"> will create a separate entry in the event log for each transaction set that is in error.</span></span> <span data-ttu-id="2316a-134">如果[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]錯誤交易集從交換，交換結構和順序可能不保留卸除。</span><span class="sxs-lookup"><span data-stu-id="2316a-134">If [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] drops an erroneous transaction set from the interchange, the interchange structure and ordering may not be preserved.</span></span> [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]<span data-ttu-id="2316a-135">將會更新交換中交易集數目。</span><span class="sxs-lookup"><span data-stu-id="2316a-135"> will update the number of transaction sets in the interchange.</span></span>  
  
 <span data-ttu-id="2316a-136">下列特殊案例適用於發生錯誤時擱置交易集的情況：</span><span class="sxs-lookup"><span data-stu-id="2316a-136">The following special cases apply to suspending transaction sets on error:</span></span>  
  
-   <span data-ttu-id="2316a-137">如果群組中所有的交易集全都無效，則會個別擱置每個交易集；不過，群組控制區段 (沒有交易集，因為已經捨棄) 將會包含在產生的交換 XML 中。</span><span class="sxs-lookup"><span data-stu-id="2316a-137">If all transaction sets in a group are invalid, then each transaction set is suspended individually; however, the group control segments (with no transaction sets, because they have been dropped) will be included in the generated interchange XML.</span></span>  
  
-   <span data-ttu-id="2316a-138">如果交換中所有的交易集全都無效，則會個別擱置每個交易集；不過，交換控制區段 (沒有交易集，因為已經捨棄) 將會包含在產生的交換 XML 中。</span><span class="sxs-lookup"><span data-stu-id="2316a-138">If all transaction sets in an interchange are invalid, then each transaction set is suspended individually; however, the interchange control segments (with no transaction sets, because they have been dropped) will be included in the generated interchange XML.</span></span>  
  
-   <span data-ttu-id="2316a-139">如果群組控制區段無效，將會個別擱置群組中的所有交易集。</span><span class="sxs-lookup"><span data-stu-id="2316a-139">If the group control segments are invalid, all transaction sets in the group will be suspended individually.</span></span>  
  
-   <span data-ttu-id="2316a-140">如果交換控制區段無效，將會個別擱置交換中的所有交易集，而且不會產生交換 XML。</span><span class="sxs-lookup"><span data-stu-id="2316a-140">If the interchange control segments are invalid, all transaction sets in the interchange will be suspended individually, and the interchange XML will not be generated.</span></span> <span data-ttu-id="2316a-141">事件檢視器中將會建立已拒絕之交換的記錄檔。</span><span class="sxs-lookup"><span data-stu-id="2316a-141">A log in the event viewer will be created for the rejected interchange.</span></span>