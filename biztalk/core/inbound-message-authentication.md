---
title: "輸入訊息驗證 |Microsoft 文件"
ms.custom: 
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
helpviewer_keywords:
- messages, authenticating
- processing, inbound messages
- messages, inbound
- processing, security
- security, messages
- inbound messages
ms.assetid: 34c06283-667d-4498-8544-dea6e87f276f
caps.latest.revision: "12"
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 49ada514c771f4e6dbf0abad3f23cab54721299d
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 09/20/2017
---
# <a name="inbound-message-authentication"></a><span data-ttu-id="b42c7-102">輸入訊息驗證</span><span class="sxs-lookup"><span data-stu-id="b42c7-102">Inbound Message Authentication</span></span>
<span data-ttu-id="b42c7-103">BizTalk Server 可以驗證訊息的傳送者 (使用憑證資訊或 Windows 整合安全性)，以驗證訊息傳送者的識別。</span><span class="sxs-lookup"><span data-stu-id="b42c7-103">BizTalk Server can authenticate the sender of a message (either by using the certificate information or Windows integrated security) in order to validate the identity of the sender of the message.</span></span> <span data-ttu-id="b42c7-104">下圖顯示可在 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 中用來驗證輸入訊息的安全性功能。</span><span class="sxs-lookup"><span data-stu-id="b42c7-104">The following figure shows the security features in [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] that you can use to authenticate inbound messages.</span></span>  
  
 <span data-ttu-id="b42c7-105">![驗證輸入的訊息的安全性功能](../core/media/ebiz-plan-secoverview-auth-inbound.gif "ebiz_plan_secoverview_auth_inbound")</span><span class="sxs-lookup"><span data-stu-id="b42c7-105">![Security features authenticating inbound messages](../core/media/ebiz-plan-secoverview-auth-inbound.gif "ebiz_plan_secoverview_auth_inbound")</span></span>  
<span data-ttu-id="b42c7-106">BizTalk Server 用來驗證輸入訊息的安全性功能。</span><span class="sxs-lookup"><span data-stu-id="b42c7-106">Security features BizTalk Server uses to authenticate inbound messages.</span></span>  
  
 <span data-ttu-id="b42c7-107">當 BizTalk Server 收到加密簽署的訊息時，會採取下列步驟來確定已辨識傳送端合作對象。</span><span class="sxs-lookup"><span data-stu-id="b42c7-107">When BizTalk Server receives an encrypted and signed message, it takes the following steps to ensure that the sending party is recognized.</span></span>  
  
1.  <span data-ttu-id="b42c7-108">當訊息抵達 BizTalk Server 接收位置時，接收處理常式會嘗試從傳送程序中取得傳送者的 Windows 安全性識別碼 (SSID)。</span><span class="sxs-lookup"><span data-stu-id="b42c7-108">When a message arrives at a BizTalk Server receive location, the receive handler attempts to obtain the sender's Windows security ID (SSID) from the sending process.</span></span> <span data-ttu-id="b42c7-109">接收位置會向下游傳遞 SSID 以支援簽章訊息通過待命程式驗證的事例。</span><span class="sxs-lookup"><span data-stu-id="b42c7-109">The receive location passes the SSID downstream to support cases where the listener has already authenticated a signed message.</span></span> <span data-ttu-id="b42c7-110">如果能取得用戶端憑證資訊 (例如由 BizTalk 訊息佇列或 HTTP 配接器取得)，BizTalk Server 接收位置就可以取得該項憑證資訊來一併傳送，以便稍後在接收管線進行合作對象解析。</span><span class="sxs-lookup"><span data-stu-id="b42c7-110">If client-side certificate information can be obtained (for example by the BizTalk Message Queuing or HTTP adapter), the BizTalk Server receive location can obtain that certificate information and pass it along for party resolution later on in the receive pipeline.</span></span> <span data-ttu-id="b42c7-111">如果接收處理常式無法取得 SSID，這個欄位將保留空白。</span><span class="sxs-lookup"><span data-stu-id="b42c7-111">If the receive handler cannot obtain the SSID, this field is left blank.</span></span>  
  
     <span data-ttu-id="b42c7-112">接收處理常式會傳送訊息至接收管線，這個管線將會解密訊息、驗證數位簽章，並進行合作對象解析 (管線有合作對象解析元件的話)。</span><span class="sxs-lookup"><span data-stu-id="b42c7-112">The receive handler sends the message to the receive pipeline, where the message is decrypted, the digital signature is verified, and the party resolution takes place if the pipeline has a party resolution component.</span></span> <span data-ttu-id="b42c7-113">如果傳送者在內送訊息上使用簽章憑證，則 MIME/SMIME 解碼器元件會覆寫從配接器取得的任何憑證資訊。</span><span class="sxs-lookup"><span data-stu-id="b42c7-113">If the sender used a signing certificate on the incoming message, then the MIME/SMIME decoder component overwrites any certificate information obtained from the adapter.</span></span>  
  
2.  <span data-ttu-id="b42c7-114">如果傳送者加密了訊息，則 MIME/SMIME 解碼器會從主控件執行個體服務帳戶的個人憑證存放區中擷取解密憑證，然後使用私密金鑰來解密訊息。</span><span class="sxs-lookup"><span data-stu-id="b42c7-114">If the sender encrypted the message, the MIME/SMIME decoder retrieves the decryption certificate from the personal certificate store for the host instance service account and uses the private key to decrypt the message.</span></span>  
  
     <span data-ttu-id="b42c7-115">如果傳送者簽署了訊息，則 MIME/SMIME 解碼器會檢查內容雜湊是否有遭修改的跡象以驗證數位簽章，然後從憑證存放區擷取憑證以驗證簽章。</span><span class="sxs-lookup"><span data-stu-id="b42c7-115">If the sender signed the message, the MIME/SMIME decoder authenticates the digital signature by verifying the payload hash for signs of tampering, and then retrieving the certificate from the certificate store to verify the signature.</span></span> <span data-ttu-id="b42c7-116">如果簽章者的公開金鑰就在訊息中，則 MIME/SMIME 解碼器不會從憑證存放區擷取憑證，而會使用訊息提供的公開金鑰。</span><span class="sxs-lookup"><span data-stu-id="b42c7-116">If the public key of the signer is on the message itself, the MIME/SMIME decoder does not retrieve the certificate from the certificate store, but uses the public key that came with the message.</span></span>  
  
3.  <span data-ttu-id="b42c7-117">通常，管線內的最終處理步驟是合作對象解析。</span><span class="sxs-lookup"><span data-stu-id="b42c7-117">Usually, the final processing step in the pipeline is party resolution.</span></span> <span data-ttu-id="b42c7-118">使用 [BizTalk 總管] 或 [BizTalk Server 管理] 主控台時，您可以建立合作對象；將合作對象對應到簽章憑證；或建立合作對象別名。</span><span class="sxs-lookup"><span data-stu-id="b42c7-118">Using BizTalk Explorer or BizTalk Server Administration console, you can create parties, map the party to a signing certificate, or create party aliases.</span></span> <span data-ttu-id="b42c7-119">在 [BizTalk 總管] 中定義的所有合作對象都會有唯一的合作對象識別項 (PID)。</span><span class="sxs-lookup"><span data-stu-id="b42c7-119">All parties you define in BizTalk Explorer have a unique party identifier (PID).</span></span> <span data-ttu-id="b42c7-120">BizTalk Server 會取得 PID，再放到訊息內容中。</span><span class="sxs-lookup"><span data-stu-id="b42c7-120">BizTalk Server obtains the PID and places it in the message context.</span></span> <span data-ttu-id="b42c7-121">BizTalk 使用下列其中一個方法來取得 PID：</span><span class="sxs-lookup"><span data-stu-id="b42c7-121">BizTalk obtains the PID by one of the following methods:</span></span>  
  
    1.  <span data-ttu-id="b42c7-122">如果傳送者簽署了訊息，或接收處理常式能夠取得用戶端憑證，而且您選擇使用憑證解析合作對象的選項，則 BizTalk 會使用對應的簽章或用戶端憑證來尋查 PID。</span><span class="sxs-lookup"><span data-stu-id="b42c7-122">If the sender signed the message or if the receive handler was able to obtain a client-side certificate, and you selected the option to resolve the party by using the certificate, then BizTalk uses the corresponding signature or client-side certificate to lookup the PID.</span></span> <span data-ttu-id="b42c7-123">您必須先將該憑證當做屬性值來設定合作對象，才能開始接收其訊息。</span><span class="sxs-lookup"><span data-stu-id="b42c7-123">You must configure the party with the certificate as a property before you start receiving its messages.</span></span> <span data-ttu-id="b42c7-124">如需如何設定合作對象，請參閱[使用憑證進行合作對象解析](../core/using-certificates-for-party-resolution.md)。</span><span class="sxs-lookup"><span data-stu-id="b42c7-124">For more information how to configure the party, see [Using Certificates for Party Resolution](../core/using-certificates-for-party-resolution.md).</span></span>  
  
    2.  <span data-ttu-id="b42c7-125">如果傳送者沒有使用訊息上的簽章憑證，而您選擇使用傳送者的安全性識別碼 (SSID) 解析合作對象的選項，則合作對象解析元件會使用 SSID 來尋查 PID。</span><span class="sxs-lookup"><span data-stu-id="b42c7-125">If the sender did not use a signing certificate on the message, and you have selected the option to resolve the party by using the Sender's Security ID (SSID), the party resolution component uses the SSID to look up the PID.</span></span> <span data-ttu-id="b42c7-126">您必須先設定合作對象以使用 SSID 做為別名，才能開始接收其訊息。</span><span class="sxs-lookup"><span data-stu-id="b42c7-126">You must configure the party to use the SSID as an alias before you start receiving its messages.</span></span> <span data-ttu-id="b42c7-127">如需 「 合作對象解析 」 元件的詳細資訊，請參閱[合作對象解析管線元件](../core/party-resolution-pipeline-component.md)。</span><span class="sxs-lookup"><span data-stu-id="b42c7-127">For more information about the party resolution component, see [Party Resolution Pipeline Component](../core/party-resolution-pipeline-component.md).</span></span>  
  
        > [!NOTE]
        >  <span data-ttu-id="b42c7-128">在定義合作對象的別名時，BizTalk Server 會使用帳戶名稱，而非實際的 Windows SID。</span><span class="sxs-lookup"><span data-stu-id="b42c7-128">BizTalk Server uses the account name rather than the actual Windows SID when defining aliases for parties.</span></span>  
  
    3.  <span data-ttu-id="b42c7-129">如果無法解析合作對象，則管線會將 PID 設定為 Guest。</span><span class="sxs-lookup"><span data-stu-id="b42c7-129">If the party cannot be resolved, the pipeline sets the PID to Guest.</span></span>  
  
4.  <span data-ttu-id="b42c7-130">如果將接收埠標示成「需要驗證」，而且 BizTalk Server 取得有效的 PID 並解析成已知的合作對象，則訊息會排入 MessageBox 資料庫的佇列等待處理。</span><span class="sxs-lookup"><span data-stu-id="b42c7-130">If you marked the receive port as Authentication Required, and BizTalk Server obtained a valid PID and resolved it to a known party, the message is then queued to the MessageBox database.</span></span> <span data-ttu-id="b42c7-131">如果 SSID 是空白，或 PID 為 Guest 識別碼，則 BizTalk Server 會捨棄訊息，或將其傳送至擱置的佇列 (視 [需要驗證] 屬性的組態而定)。</span><span class="sxs-lookup"><span data-stu-id="b42c7-131">If the SSID is blank or the PID is a guest ID, BizTalk Server either discards the message or sends it to the suspended queue (depending on your configuration of the Authentication Required property).</span></span> <span data-ttu-id="b42c7-132">您可以使用 [需要驗證] 屬性做為對策，以降低可能從未知合作對象接收大量訊息的負面影響。</span><span class="sxs-lookup"><span data-stu-id="b42c7-132">You can use the Authentication Required property as a way of minimizing the negative effect of receiving a large quantity of messages from an unknown party.</span></span> <span data-ttu-id="b42c7-133">如需接收埠的驗證選項的詳細資訊，請參閱[如何設定接收埠的驗證選項](../core/how-to-configure-authentication-options-for-a-receive-port.md)。</span><span class="sxs-lookup"><span data-stu-id="b42c7-133">For more information about the authentication options for receive ports, see [How to Configure Authentication Options for a Receive Port](../core/how-to-configure-authentication-options-for-a-receive-port.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="b42c7-134">另請參閱</span><span class="sxs-lookup"><span data-stu-id="b42c7-134">See Also</span></span>  
 <span data-ttu-id="b42c7-135">[驗證的處理序之間的訊息](../core/authentication-of-messages-between-processes.md) </span><span class="sxs-lookup"><span data-stu-id="b42c7-135">[Authentication of Messages Between Processes](../core/authentication-of-messages-between-processes.md) </span></span>  
 <span data-ttu-id="b42c7-136">[輸出訊息保護](../core/outbound-message-protection.md) </span><span class="sxs-lookup"><span data-stu-id="b42c7-136">[Outbound Message Protection](../core/outbound-message-protection.md) </span></span>  
 <span data-ttu-id="b42c7-137">[驗證訊息的寄件者](../core/authenticating-the-sender-of-a-message.md) </span><span class="sxs-lookup"><span data-stu-id="b42c7-137">[Authenticating the Sender of a Message](../core/authenticating-the-sender-of-a-message.md) </span></span>  
 <span data-ttu-id="b42c7-138">[授權訊息接收器](../core/authorizing-the-receiver-of-a-message.md) </span><span class="sxs-lookup"><span data-stu-id="b42c7-138">[Authorizing the Receiver of a Message](../core/authorizing-the-receiver-of-a-message.md) </span></span>  
 <span data-ttu-id="b42c7-139">[如何設定 BizTalk Server 來接收簽署的訊息](../core/how-to-configure-biztalk-server-for-receiving-signed-messages.md) </span><span class="sxs-lookup"><span data-stu-id="b42c7-139">[How to Configure BizTalk Server for Receiving Signed Messages](../core/how-to-configure-biztalk-server-for-receiving-signed-messages.md) </span></span>  
 [<span data-ttu-id="b42c7-140">BizTalk Server 用於簽章訊息的憑證</span><span class="sxs-lookup"><span data-stu-id="b42c7-140">Certificates that BizTalk Server Uses for Signed Messages</span></span>](../core/certificates-that-biztalk-server-uses-for-signed-messages.md)