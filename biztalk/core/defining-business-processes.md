---
title: 定義商務程序 |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: e5e0fdfe-e298-4f32-a7c5-d081b926a206
caps.latest.revision: 16
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 50d4d884f60e53fbad465d2b22948a6df6b69256
ms.sourcegitcommit: 266308ec5c6a9d8d80ff298ee6051b4843c5d626
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 06/27/2018
ms.locfileid: "37002207"
---
# <a name="defining-business-processes"></a><span data-ttu-id="cafa6-102">定義商務程序</span><span class="sxs-lookup"><span data-stu-id="cafa6-102">Defining Business Processes</span></span>
<span data-ttu-id="cafa6-103">不同系統之間的訊息交換是 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 著重要解決的問題之必要部分。</span><span class="sxs-lookup"><span data-stu-id="cafa6-103">The exchange of messages between different systems is a necessary part of solving the problems that [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] addresses.</span></span> <span data-ttu-id="cafa6-104">不過，真正的目標是定義並執行以這些應用程式為基礎的商務程序。</span><span class="sxs-lookup"><span data-stu-id="cafa6-104">The real goal, however, is to define and execute business processes based on the applications.</span></span> <span data-ttu-id="cafa6-105">[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 引擎使用協調流程來定義商務程序的邏輯。</span><span class="sxs-lookup"><span data-stu-id="cafa6-105">The [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] engine uses orchestrations to define the logic of these business processes.</span></span> <span data-ttu-id="cafa6-106">若要建立和評估商務規則群組，會使用「商務規則引擎」。</span><span class="sxs-lookup"><span data-stu-id="cafa6-106">To create and evaluate groups of business rules, it uses the Business Rule Engine.</span></span> <span data-ttu-id="cafa6-107">本節會說明協調流程及「商務規則引擎」。</span><span class="sxs-lookup"><span data-stu-id="cafa6-107">This section describes both orchestrations and the Business Rule Engine.</span></span>  
  
## <a name="using-orchestrations"></a><span data-ttu-id="cafa6-108">使用協調流程</span><span class="sxs-lookup"><span data-stu-id="cafa6-108">Using Orchestrations</span></span>  
 <span data-ttu-id="cafa6-109">自動商務程序的邏輯可直接以 Microsoft Visual Basic 或 Microsoft Visual C# 這類語言實作。</span><span class="sxs-lookup"><span data-stu-id="cafa6-109">The logic of an automated business process can be implemented directly in a language such as Microsoft Visual Basic or Microsoft Visual C#.</span></span> <span data-ttu-id="cafa6-110">不過，以傳統程式語言建立、維護以及管理複雜的商務程序是一大挑戰。</span><span class="sxs-lookup"><span data-stu-id="cafa6-110">Yet creating, maintaining, and managing complex business processes in conventional programming languages can be challenging.</span></span> <span data-ttu-id="cafa6-111">不同於之前的版本，[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 採用了不同的方法。</span><span class="sxs-lookup"><span data-stu-id="cafa6-111">Unlike its predecessors, [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] takes a different approach.</span></span> <span data-ttu-id="cafa6-112">可讓商務經理人或開發人員以圖形化方式定義商務程序。</span><span class="sxs-lookup"><span data-stu-id="cafa6-112">It enables business managers or developers to define a business process graphically.</span></span> <span data-ttu-id="cafa6-113">這樣會比直接用程式語言建立商務程序更快速，而且更易於瞭解、說明和變更程序。</span><span class="sxs-lookup"><span data-stu-id="cafa6-113">Doing this can be faster than building the process directly in a programming language, and it also makes the process easier to understand, explain, and change.</span></span> <span data-ttu-id="cafa6-114">拜「商務活動監控」(BAM) 技術之賜，以此方法建置的商務程序也更易於監控。</span><span class="sxs-lookup"><span data-stu-id="cafa6-114">Business processes built in this fashion can also be monitored more easily, a fact that is exploited by the Business Activity Monitoring (BAM) technology.</span></span>  
  
 <span data-ttu-id="cafa6-115">開發人員，建立協調流程依賴三個主要工具: [BizTalk 編輯器] 來建立 XML 結構描述，BizTalk 對應工具，來定義這些結構描述和協調流程設計工具，用於指定的商務邏輯之間的翻譯處理程序。</span><span class="sxs-lookup"><span data-stu-id="cafa6-115">For a developer, creating an orchestration relies on three primary tools: the BizTalk Editor for creating XML schemas, the BizTalk Mapper for defining translations between those schemas, and the Orchestration Designer for specifying the logic of business processes.</span></span> <span data-ttu-id="cafa6-116">這些工具全部位於 [!INCLUDE[btsVStudioNoVersion](../includes/btsvstudionoversion-md.md)] 內，為開發人員提供一致性的環境。</span><span class="sxs-lookup"><span data-stu-id="cafa6-116">All of these tools are hosted inside [!INCLUDE[btsVStudioNoVersion](../includes/btsvstudionoversion-md.md)], providing a consistent environment for developers.</span></span> <span data-ttu-id="cafa6-117">此節會敘述這些工具的功能以及它們如何共同作業。</span><span class="sxs-lookup"><span data-stu-id="cafa6-117">This section describes what each of these tools does and how they work together.</span></span>  
  
### <a name="creating-schemas-the-biztalk-editor"></a><span data-ttu-id="cafa6-118">建立結構描述: 「 BizTalk 編輯器</span><span class="sxs-lookup"><span data-stu-id="cafa6-118">Creating Schemas: The BizTalk Editor</span></span>  
 <span data-ttu-id="cafa6-119">協調流程使用 XML 文件，每一個都符合部分 XML 結構描述。</span><span class="sxs-lookup"><span data-stu-id="cafa6-119">Orchestrations work with XML documents, each of which conforms to some XML schema.</span></span> <span data-ttu-id="cafa6-120">開發人員可以使用「BizTalk 編輯器」來定義這些結構描述，而這些結構描述基本上是使用 XML 結構描述定義語言 (XSD) 定義文件資訊的結構及類型。</span><span class="sxs-lookup"><span data-stu-id="cafa6-120">The BizTalk Editor enables developers to define these schemas, which essentially define the structure and types of a document’s information, using the XML Schema Definition language (XSD).</span></span>  
  
 <span data-ttu-id="cafa6-121">不使用工具支援來建立原始 XSD 結構描述是一大挑戰。</span><span class="sxs-lookup"><span data-stu-id="cafa6-121">Creating raw XSD schemas without some tool support is not simple.</span></span> <span data-ttu-id="cafa6-122">為了更容易實行此必要步驟，BizTalk 編輯器允許使用者 (可能是開發人員) 以圖形階層方式定義元素，以建立結構描述。</span><span class="sxs-lookup"><span data-stu-id="cafa6-122">To make this necessary step more approachable, the BizTalk Editor enables users—probably developers—to build a schema by defining its elements in a graphical hierarchy.</span></span> <span data-ttu-id="cafa6-123">您也可以從檔案或者可存取的 Web 服務匯入現有的結構描述。</span><span class="sxs-lookup"><span data-stu-id="cafa6-123">Existing schemas can also be imported from either files or accessible Web services.</span></span> <span data-ttu-id="cafa6-124">無論如何取得，結構描述都是 BizTalk 對應的基礎。</span><span class="sxs-lookup"><span data-stu-id="cafa6-124">However they’re acquired, schemas are used as the basis for BizTalk maps.</span></span>  
  
### <a name="mapping-between-schemas-the-biztalk-mapper"></a><span data-ttu-id="cafa6-125">BizTalk 對應的結構描述之間的對應：</span><span class="sxs-lookup"><span data-stu-id="cafa6-125">Mapping Between Schemas: The BizTalk Mapper</span></span>  
 <span data-ttu-id="cafa6-126">一個實作商務程序的協調流程，一般來說會收到某些文件並傳送其他文件。</span><span class="sxs-lookup"><span data-stu-id="cafa6-126">An orchestration implementing a business process typically receives some documents and sends others.</span></span> <span data-ttu-id="cafa6-127">通常接收文件中的部分資訊會轉送至傳送文件，也許在某些方面有點改變。</span><span class="sxs-lookup"><span data-stu-id="cafa6-127">Often, part of the information in the received documents is transferred to the sent documents, perhaps transformed in some way.</span></span> <span data-ttu-id="cafa6-128">例如，訂單履行程序可能收到一些項目的訂單，然後傳回因為某些原因訂單已被拒絕的訊息。</span><span class="sxs-lookup"><span data-stu-id="cafa6-128">For example, an order fulfillment process might receive an order for some number of items, then send back a message indicating that the order was declined for some reason.</span></span> <span data-ttu-id="cafa6-129">像是要求識別項及訂購數量等的訂單資訊，可從接收訂單訊息的欄位複製到拒絕訊息欄位中。</span><span class="sxs-lookup"><span data-stu-id="cafa6-129">Information from the order, such as a request identifier and the quantity ordered, might be copied from fields in the received order message into fields in the rejection message.</span></span> <span data-ttu-id="cafa6-130">BizTalk 對應工具可用來定義在文件間的轉換，稱為對應。</span><span class="sxs-lookup"><span data-stu-id="cafa6-130">The BizTalk Mapper can be used to define a transformation, called a map, from one document to the other.</span></span>  
  
 <span data-ttu-id="cafa6-131">![結構描述之間的對應](../core/media/understandingbts-2010-mapper.gif "UnderstandingBTS_2010_Mapper")</span><span class="sxs-lookup"><span data-stu-id="cafa6-131">![Mapping Between Schemas](../core/media/understandingbts-2010-mapper.gif "UnderstandingBTS_2010_Mapper")</span></span>  
  
 <span data-ttu-id="cafa6-132">如上圖所示，每個對應都會以圖形化相互關聯顯示在兩個 XML 結構描述中，且對應會定義這些結構描述中元素間的關係。</span><span class="sxs-lookup"><span data-stu-id="cafa6-132">As the figure above shows, each map is expressed as a graphical correlation between two XML schemas that defines a relationship between elements in those schemas.</span></span> <span data-ttu-id="cafa6-133">「全球資訊網協會」(W3C) 已定義「可延伸樣式表語言轉換」(XSLT) 做為在 XML 結構描述之間轉換的標準方法，所以 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 中的對應會以 XSLT 轉換的形式實作。</span><span class="sxs-lookup"><span data-stu-id="cafa6-133">The World Wide Web Consortium (W3C) has defined the Extensible Stylesheet Language Transformation (XSLT) as a standard way to express these kinds of transformations between XML schemas, and so maps in [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] are implemented as XSLT transformations.</span></span>  
  
 <span data-ttu-id="cafa6-134">在對應中定義的轉換可以很簡單，例如從某一文件複製值到其他文件，沒有任何變更。</span><span class="sxs-lookup"><span data-stu-id="cafa6-134">The transformation defined in a map can be simple, such as copying values unchanged from one document to another.</span></span> <span data-ttu-id="cafa6-135">像這種直接的資料複製可用連結表示，該連結在 BizTalk 對應工具中顯示成一條連接來源結構描述適當元素，以及在目的結構描述的相應元素之間的線條。</span><span class="sxs-lookup"><span data-stu-id="cafa6-135">Direct data copies like this are expressed using a link, which is shown in the BizTalk Mapper as a line connecting the appropriate elements in the source schema with their counterparts in the destination schema.</span></span> <span data-ttu-id="cafa6-136">使用運算質也可以進行更複雜的轉換。</span><span class="sxs-lookup"><span data-stu-id="cafa6-136">More complex transformations are also possible using functoids.</span></span> <span data-ttu-id="cafa6-137">運算質是大量可執行的程式碼，可任意定義 XML 結構描述間的複雜對應，且如上圖所示，BizTalk 對應工具會將其表示為連線轉換元素線條上的方塊。</span><span class="sxs-lookup"><span data-stu-id="cafa6-137">A functoid is a chunk of executable code that can define arbitrarily complex mappings between XML schemas, and as shown above, the BizTalk Mapper represents it as a box on the line connecting the elements being transformed.</span></span> <span data-ttu-id="cafa6-138">因為某些轉換相當普通，所以 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 包含一些內建的運算質。</span><span class="sxs-lookup"><span data-stu-id="cafa6-138">Because some of those transformations are fairly common, [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] includes a number of built-in functoids.</span></span> <span data-ttu-id="cafa6-139">這些內建運算質劃分成多個類別，包括以下各項：</span><span class="sxs-lookup"><span data-stu-id="cafa6-139">These built-in functoids are grouped into categories, which include the following:</span></span>  
  
- <span data-ttu-id="cafa6-140">執行計算的數學運算質，像是加、減、乘、除來源文件中的欄位值，以及將結果儲存至目標文件中的欄位。</span><span class="sxs-lookup"><span data-stu-id="cafa6-140">Mathematical functoids that perform operations such as adding, multiplying, and dividing the values of fields in the source document and storing the result in a field in the target document.</span></span>  
  
- <span data-ttu-id="cafa6-141">將數值轉換成 ASCII 相對值的轉換運算質，反之亦然。</span><span class="sxs-lookup"><span data-stu-id="cafa6-141">Conversion functoids that convert a numeric value to its ASCII equivalent and vice-versa.</span></span>  
  
- <span data-ttu-id="cafa6-142">邏輯運算質，利用邏輯比較來源文件中特定的值，來決定元素或屬性是否應該建立在目標文件中。</span><span class="sxs-lookup"><span data-stu-id="cafa6-142">Logical functoids that can be used to determine whether an element or attribute should be created in the target document based on a logical comparison between specified values in the source document.</span></span> <span data-ttu-id="cafa6-143">可以用等於、大於小於或其他方式來比較這些值。</span><span class="sxs-lookup"><span data-stu-id="cafa6-143">Those values can be compared for equality, greater than/less than, and in other ways.</span></span>  
  
- <span data-ttu-id="cafa6-144">累計運算質，計算平均值、總計或其他來源文件不同欄位的值，然後將結果儲存至目標文件中的單一欄位。</span><span class="sxs-lookup"><span data-stu-id="cafa6-144">Cumulative functoids that compute averages, sums, or other values from various fields in the source document, then store the result in a single field in the target document.</span></span>  
  
- <span data-ttu-id="cafa6-145">可存取儲存在資料庫中的資訊之資料庫運算質。</span><span class="sxs-lookup"><span data-stu-id="cafa6-145">Database functoids that can access information stored in a database.</span></span>  
  
  <span data-ttu-id="cafa6-146">您也可以直接在 XSLT 中，或使用像 Visual C# 及 Visual Basic 這類支援 .NET 的語言，建立自訂運算質。</span><span class="sxs-lookup"><span data-stu-id="cafa6-146">It is also possible to create custom functoids directly in XSLT or using .NET-enabled languages like Visual C# and Visual Basic.</span></span> <span data-ttu-id="cafa6-147">運算質也可以按照順序結合，將其中一個的輸出排列在其他的輸入下方。</span><span class="sxs-lookup"><span data-stu-id="cafa6-147">Functoids can also be combined in sequences, cascading the output of one into the input of another.</span></span>  
  
  <span data-ttu-id="cafa6-148">重要的是要有方法可定義文件的 XML 結構描述，以及對應不同結構描述的多個文件資訊的機制。</span><span class="sxs-lookup"><span data-stu-id="cafa6-148">It is essential that you have a way to define a document’s XML schema, as well as a mechanism for mapping information across documents with different schemas.</span></span> <span data-ttu-id="cafa6-149">BizTalk 編輯器和 BizTalk 對應工具可解決這兩個問題。</span><span class="sxs-lookup"><span data-stu-id="cafa6-149">The BizTalk Editor and BizTalk Mapper address these two problems.</span></span> <span data-ttu-id="cafa6-150">但是定義結構描述及對應只是程序的一部分而已。</span><span class="sxs-lookup"><span data-stu-id="cafa6-150">Yet defining schemas and maps is only part of the process.</span></span> <span data-ttu-id="cafa6-151">您還必須指定會使用結構描述與叫用對應的商務邏輯。</span><span class="sxs-lookup"><span data-stu-id="cafa6-151">You must also specify the business logic that will use the schemas and invoke the maps.</span></span>  
  
### <a name="defining-business-logic-the-orchestration-designer"></a><span data-ttu-id="cafa6-152">協調流程設計師中定義的商務邏輯：</span><span class="sxs-lookup"><span data-stu-id="cafa6-152">Defining Business Logic: The Orchestration Designer</span></span>  
 <span data-ttu-id="cafa6-153">商務程序是一組動作，結合後滿足某些商務需求。</span><span class="sxs-lookup"><span data-stu-id="cafa6-153">A business process is a set of actions that together meet some useful business need.</span></span> <span data-ttu-id="cafa6-154">在 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 中，開發人員可以使用「協調流程設計師」，以圖形方式定義這些動作。</span><span class="sxs-lookup"><span data-stu-id="cafa6-154">With [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)], a developer can use the Orchestration Designer to define these actions graphically.</span></span> <span data-ttu-id="cafa6-155">此工具不使用某些程式語言來表達步驟，開發人員可以用邏輯的方式，將一系列圖形連接在一起以建立協調流程。</span><span class="sxs-lookup"><span data-stu-id="cafa6-155">Instead of expressing the steps in some programming language, a developer can create an orchestration by connecting together a series of shapes in a logical way.</span></span> <span data-ttu-id="cafa6-156">「協調流程設計師」中可用的圖形包含：</span><span class="sxs-lookup"><span data-stu-id="cafa6-156">The shapes available in the Orchestration Designer include:</span></span>  
  
- <span data-ttu-id="cafa6-157">接收圖形，讓協調流程接收訊息。</span><span class="sxs-lookup"><span data-stu-id="cafa6-157">The Receive shape, which allows the orchestration to receive messages.</span></span> <span data-ttu-id="cafa6-158">接收圖形可具有定義要接收之訊息類型的篩選，也可以設定為當新訊息到達時便啟動新的協調流程執行個體。</span><span class="sxs-lookup"><span data-stu-id="cafa6-158">A Receive shape can have a filter that defines the types of messages that will be received, and it can also be configured to start a new instance of an orchestration when a new message arrives.</span></span>  
  
- <span data-ttu-id="cafa6-159">傳送圖形，讓協調流程傳送訊息。</span><span class="sxs-lookup"><span data-stu-id="cafa6-159">The Send shape, which allows the orchestration to send messages.</span></span>  
  
- <span data-ttu-id="cafa6-160">連接埠圖形，定義訊息傳輸的方式。</span><span class="sxs-lookup"><span data-stu-id="cafa6-160">The Port shape, which defines how messages are transmitted.</span></span> <span data-ttu-id="cafa6-161">連接埠圖形的每個執行個體若不是連接到傳送圖形就是連接到接收圖形。</span><span class="sxs-lookup"><span data-stu-id="cafa6-161">Each instance of a Port shape is connected to either a Send or Receive shape.</span></span> <span data-ttu-id="cafa6-162">每個連接埠也都有類型，可定義連接埠可接收的訊息類型；方向，如傳送或接收；繫結，可決定傳送或接收訊息的方法，如指定特定 URL 及其他資訊。</span><span class="sxs-lookup"><span data-stu-id="cafa6-162">Each port also has a type, which defines things such as the kinds of messages the port can receive; a direction, such as send or receive; and a binding, which determines how a message is sent or received by, for example, specifying a particular URL and other information.</span></span>  
  
- <span data-ttu-id="cafa6-163">決定圖形代表 if-then-else 陳述式，可以讓協調流程根據布林值條件執行不同工作。</span><span class="sxs-lookup"><span data-stu-id="cafa6-163">The Decide shape, which represents an if-then-else statement that allows an orchestration to perform different tasks based on Boolean conditions.</span></span> <span data-ttu-id="cafa6-164">運算式編輯器是協調流程設計師的一部分，可用來指定此條件陳述式。</span><span class="sxs-lookup"><span data-stu-id="cafa6-164">An Expression Editor, part of the Orchestration Designer, can be used to specify this conditional statement.</span></span>  
  
- <span data-ttu-id="cafa6-165">迴圈圖形，在某些條件為真時控制動作的重複執行。</span><span class="sxs-lookup"><span data-stu-id="cafa6-165">The Loop shape, which controls the repeated performing of an action while some condition is true.</span></span>  
  
- <span data-ttu-id="cafa6-166">建構訊息圖形，可建置訊息。</span><span class="sxs-lookup"><span data-stu-id="cafa6-166">The Construct Message shape, which allows building a message.</span></span>  
  
- <span data-ttu-id="cafa6-167">傳輸圖形，可將一個文件的資訊傳輸到另一個文件，並叫用 BizTalk 對應工具定義的對應進行傳輸。</span><span class="sxs-lookup"><span data-stu-id="cafa6-167">The Transform shape, which allows the transfer of information from one document to another, and transforming it by invoking maps defined with the BizTalk Mapper.</span></span>  
  
- <span data-ttu-id="cafa6-168">平行動作圖形，可讓開發人員指定應平行執行而不是以序列方式執行的多個作業。</span><span class="sxs-lookup"><span data-stu-id="cafa6-168">The Parallel Actions shape, which allows a developer to specify that multiple operations should be performed in parallel rather than in sequence.</span></span> <span data-ttu-id="cafa6-169">所有平行動作完成後，之後的圖形才可以執行。</span><span class="sxs-lookup"><span data-stu-id="cafa6-169">The shape that follows this one is not executed until all of the parallel actions have completed.</span></span>  
  
- <span data-ttu-id="cafa6-170">範圍圖形，允許一組作業進入交易，並定義錯誤處理的例外狀況處理常式。</span><span class="sxs-lookup"><span data-stu-id="cafa6-170">The Scope shape, which allows the grouping of operations into transactions and defining exception handlers for error handling.</span></span> <span data-ttu-id="cafa6-171">支援傳統的不可部分完成交易及長時間執行交易。</span><span class="sxs-lookup"><span data-stu-id="cafa6-171">Both traditional atomic transactions and long-running transactions are supported.</span></span> <span data-ttu-id="cafa6-172">與不可部分完成交易不同，長時間執行交易依賴補償邏輯而非回復以處理未預期的事件。</span><span class="sxs-lookup"><span data-stu-id="cafa6-172">Unlike atomic transactions, long-running transactions rely on compensating logic rather than rollback to handle unexpected events.</span></span>  
  
- <span data-ttu-id="cafa6-173">訊息指派圖形，可指派值到協調流程變數。</span><span class="sxs-lookup"><span data-stu-id="cafa6-173">The Message Assignment shape, which allows assigning values to orchestration variables.</span></span> <span data-ttu-id="cafa6-174">這些變數可用來儲存協調流程使用的狀態資訊，如建立的訊息或字元字串。</span><span class="sxs-lookup"><span data-stu-id="cafa6-174">These variables can be used to store state information used by the orchestration, such as a message being created or a character string.</span></span>  
  
  <span data-ttu-id="cafa6-175">下圖顯示使用少數這些圖形在協調流程設計師建立的協調流程。</span><span class="sxs-lookup"><span data-stu-id="cafa6-175">The figure below shows an orchestration created in the Orchestration Designer using a few of these shapes.</span></span> <span data-ttu-id="cafa6-176">在這個簡單的範例中，已收到訊息並已根據訊息的內容制訂決策，結果是執行兩個路徑中的其中一個。</span><span class="sxs-lookup"><span data-stu-id="cafa6-176">In this simple example, a message is received, a decision is made based on the content of that message, and one of two paths is executed as a result of that decision.</span></span> <span data-ttu-id="cafa6-177">解決真正問題的協調流程可能會比這個範例更為複雜；為了便於使用更複雜的圖表，協調流程設計師還有放大和縮小功能。開發人員可以只檢視他們目前在協調流程中感興趣的那些部分。</span><span class="sxs-lookup"><span data-stu-id="cafa6-177">Orchestrations that solve real problems can be significantly more complex than this; to make these more complex diagrams easier to work with, the Orchestration Designer includes the ability to zoom in and out. Developers can view only those parts of an orchestration that they are currently interested in.</span></span>  
  
  <span data-ttu-id="cafa6-178">![](../core/media/understandingbts-08-orchestration.gif "UnderstandingBTS_08_Orchestration")</span><span class="sxs-lookup"><span data-stu-id="cafa6-178">![](../core/media/understandingbts-08-orchestration.gif "UnderstandingBTS_08_Orchestration")</span></span>  
  
  <span data-ttu-id="cafa6-179">開發人員定義協調流程後，圖形群組及圖形之間的關係會轉換為 .NET Framework 之 Common Language Runtime (CLR) 使用的 Microsoft Intermediate Language (MSIL)。</span><span class="sxs-lookup"><span data-stu-id="cafa6-179">After a developer has defined an orchestration, the group of shapes and relations between them is converted into the Microsoft Intermediate Language (MSIL) used by the .NET Framework’s Common Language Runtime (CLR).</span></span> <span data-ttu-id="cafa6-180">最後，BizTalk Server 開發人員定義的圖形群組會變成啟用 .NET 的標準組件。</span><span class="sxs-lookup"><span data-stu-id="cafa6-180">Ultimately, the group of shapes defined by a BizTalk Server developer becomes just a standard .NET-enabled assembly.</span></span> <span data-ttu-id="cafa6-181">當需要從圖形內呼叫 COM 或 .NET 物件時，您也可以新增明確的程式碼到協調流程中。</span><span class="sxs-lookup"><span data-stu-id="cafa6-181">You can also add explicit code to an orchestration when necessary by calling a COM or .NET object from inside a shape.</span></span>  
  
### <a name="the-role-of-web-services"></a><span data-ttu-id="cafa6-182">Web 服務的角色</span><span class="sxs-lookup"><span data-stu-id="cafa6-182">The Role of Web Services</span></span>  
 <span data-ttu-id="cafa6-183">Web 服務可讓應用程式使用 SOAP 交換 XML 文件，並在整合平台中具有重要的影響。</span><span class="sxs-lookup"><span data-stu-id="cafa6-183">Web services allow applications to exchange XML documents using SOAP, and have had a significant impact on integration platforms.</span></span> <span data-ttu-id="cafa6-184">若要存取外部 Web 服務，協調流程的建立者可使用 [!INCLUDE[btsVStudioNoVersion](../includes/btsvstudionoversion-md.md)] 中的 [加入 Web 參考] 選項及 Web 服務配接器直接叫用作業。</span><span class="sxs-lookup"><span data-stu-id="cafa6-184">To access an external Web service, an orchestration’s creator can use the Add Web Reference option in [!INCLUDE[btsVStudioNoVersion](../includes/btsvstudionoversion-md.md)] along with the Web Services adapter to directly invoke operations.</span></span> <span data-ttu-id="cafa6-185">同樣地，[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 提供 Web 服務發佈精靈，可以產生 ASP.NET Web 服務專案，將一或多個協調流程作業公佈為 SOAP 可呼叫的 Web 服務。</span><span class="sxs-lookup"><span data-stu-id="cafa6-185">Similarly, [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] provides a Web Services Publishing wizard that can generate an ASP.NET Web service project exposing one or more of an orchestration’s operations as SOAP-callable Web services.</span></span> <span data-ttu-id="cafa6-186">這兩個選項可以讓開發人員從商務程序存取現有的 Web 服務，以及將協調流程的功能公佈成其他商務程序的 Web 服務。</span><span class="sxs-lookup"><span data-stu-id="cafa6-186">These two options allow developers to both access existing Web services from within a business process and expose an orchestration’s functionality as a Web service to other business processes.</span></span>  
  
- <span data-ttu-id="cafa6-187">Web 服務的崛起對定義商務程序的方式有重大的影響。</span><span class="sxs-lookup"><span data-stu-id="cafa6-187">The rise of Web services also has an impact on how business processes are defined.</span></span> <span data-ttu-id="cafa6-188">例如，想像兩個組織使用 Web 服務互動的案例。</span><span class="sxs-lookup"><span data-stu-id="cafa6-188">For example, think about the case where two organizations interact using Web services.</span></span> <span data-ttu-id="cafa6-189">為了更有效率的互通，可能需要每個互動的合作對象都瞭解另一方使用的商務程序。</span><span class="sxs-lookup"><span data-stu-id="cafa6-189">To interoperate effectively, it might be necessary for each party to the interaction to know something about the business process the other is using.</span></span> <span data-ttu-id="cafa6-190">若兩個組織都使用 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]，這就不是大問題；可以使用交易夥伴管理技術等工具來傳遞這項資訊。</span><span class="sxs-lookup"><span data-stu-id="cafa6-190">If both organizations use [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)], this isn’t a big problem; tools such as the Trading Partner Management technology can be used to distribute this knowledge.</span></span> <span data-ttu-id="cafa6-191">但是若他們使用不同產品呢？</span><span class="sxs-lookup"><span data-stu-id="cafa6-191">But what if they use different products?</span></span> <span data-ttu-id="cafa6-192">這時能以非廠商指定的方式來描述商務程序的概念就很有用了。</span><span class="sxs-lookup"><span data-stu-id="cafa6-192">For cases like this, it is useful to have a way to describe aspects of business processes in a non-vendor specific way.</span></span>  
  
  <span data-ttu-id="cafa6-193">為此，Microsoft、IBM 及其他廠商已經建立商務程序執行語言 (BPEL)。</span><span class="sxs-lookup"><span data-stu-id="cafa6-193">To allow this, Microsoft, IBM, and others have created the Business Process Execution Language (BPEL).</span></span> <span data-ttu-id="cafa6-194">使用協調流程設計師定義的商務程序可以匯出為 BPEL，而且 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 也可以匯入以 BPEL 定義的程序。</span><span class="sxs-lookup"><span data-stu-id="cafa6-194">A business process defined using the Orchestration Designer can be exported to BPEL, and [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] can also import processes defined in BPEL.</span></span> <span data-ttu-id="cafa6-195">此語言可用來描述並共用商務程序外部的可見組件，而 BPEL 則著重在解決這個問題，而不是跨平台的完整執行商務程序。</span><span class="sxs-lookup"><span data-stu-id="cafa6-195">While the language is useful for describing and sharing externally visible parts of a business process, BPEL is focused more on solving this problem than on cross-platform execution of complete business processes.</span></span> <span data-ttu-id="cafa6-196">也請務必瞭解 BPEL 是完全建置在 Web 服務上，而支援此語言的 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 及其他產品則可提供更多功能。</span><span class="sxs-lookup"><span data-stu-id="cafa6-196">It’s also important to understand that BPEL is built entirely on Web services, while [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] and other products that support this language provide more.</span></span> <span data-ttu-id="cafa6-197">例如，[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 支援不同 XML 結構描述之間的對應、在本機物件呼叫方法以及 BPEL 不提供的其他功能。</span><span class="sxs-lookup"><span data-stu-id="cafa6-197">For example, [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] supports mapping between different XML schemas, calling methods in local objects, and other features that aren’t available in BPEL.</span></span> <span data-ttu-id="cafa6-198">諸如以上及其他種種原因，BPEL 不是用來定義商務程序的完整語言。</span><span class="sxs-lookup"><span data-stu-id="cafa6-198">For these and other reasons, BPEL isn’t a complete language for defining business processes.</span></span> <span data-ttu-id="cafa6-199">且由於 BPEL 仍處於 Organization for the Advancement of Structured Information Standards (OASIS) 加以標準化的階段，因此目前還很難將其視為完全成熟的技術。</span><span class="sxs-lookup"><span data-stu-id="cafa6-199">And given that BPEL is still in the process of being standardized by the Organization for the Advancement of Structured Information Standards (OASIS), it’s hard to view it today as a fully mature technology.</span></span>  
  
- <span data-ttu-id="cafa6-200">協調流程是在 BizTalk Server 中建立商務程序的基礎機制。</span><span class="sxs-lookup"><span data-stu-id="cafa6-200">Orchestrations are the fundamental mechanism for creating business processes in BizTalk Server.</span></span> <span data-ttu-id="cafa6-201">但協調流程中有某些方面的變更頻率特別高。</span><span class="sxs-lookup"><span data-stu-id="cafa6-201">Some aspects of an orchestration tend to change more often than others, however.</span></span> <span data-ttu-id="cafa6-202">特別是，商務程序中的決策 (商務規則) 通常是最常變動的部分。</span><span class="sxs-lookup"><span data-stu-id="cafa6-202">In particular, the decisions embedded in a business process—the business rules—are commonly its most volatile aspect.</span></span> <span data-ttu-id="cafa6-203">管理員的消費限制美金 $100,000 元那麼最後一週，但升遷到 $500000 或從 100 單位至 10 的延遲付款客戶最大允許的順序減少。</span><span class="sxs-lookup"><span data-stu-id="cafa6-203">A manager’s spending limit was $100,000 last week, but her promotion bumps this up to $500,000, or a slow-paying customer’s maximum allowed order decreases from 100 units to only 10.</span></span> <span data-ttu-id="cafa6-204">您可以指定並更新這些使用 「 商務規則引擎的規則。</span><span class="sxs-lookup"><span data-stu-id="cafa6-204">You can specify and update these rules using the  Business Rule Engine.</span></span>  
  
## <a name="using-the-business-rule-engine"></a><span data-ttu-id="cafa6-205">使用商務規則引擎</span><span class="sxs-lookup"><span data-stu-id="cafa6-205">Using the Business Rule Engine</span></span>  
 <span data-ttu-id="cafa6-206">協調流程設計師加上 BizTalk 編輯器和 BizTalk 對應工具，提供有效的方法以定義商務程序及其使用的規則。</span><span class="sxs-lookup"><span data-stu-id="cafa6-206">The Orchestration Designer, together with the BizTalk Editor and the BizTalk Mapper, provide an effective way to define a business process and the rules it uses.</span></span> <span data-ttu-id="cafa6-207">不過，若有更簡單的方法可定義及變更商務規則，它就更實用了。</span><span class="sxs-lookup"><span data-stu-id="cafa6-207">It can be useful, however, to have an easier way to define and change business rules.</span></span> <span data-ttu-id="cafa6-208">為此，BizTalk Server 提供了「商務規則引擎」(BRE)。</span><span class="sxs-lookup"><span data-stu-id="cafa6-208">To allow this, BizTalk Server provides the Business Rule Engine (BRE).</span></span> <span data-ttu-id="cafa6-209">開發人員通常會使用 BRE，但是商務導向的使用者可使用名為「商務規則編輯器」的工具建立和修改商務規則組。</span><span class="sxs-lookup"><span data-stu-id="cafa6-209">Developers will most often use the BRE, but more business-oriented users can create and modify sets of business rules using a tool called the Business Rule Composer.</span></span>  
  
 <span data-ttu-id="cafa6-210">當必須評估複雜的商務規則組時，BRE 就很有用。</span><span class="sxs-lookup"><span data-stu-id="cafa6-210">One situation in which the BRE is useful is when a complex set of business rules must be evaluated.</span></span> <span data-ttu-id="cafa6-211">例如，決定是否要同意借款，可能必須根據客戶的信用記錄、收入及其他因素來使用大量規則組。</span><span class="sxs-lookup"><span data-stu-id="cafa6-211">Deciding whether to grant a loan, for example, might entail working through a large set of rules based on the customer’s credit history, income, and other factors.</span></span> <span data-ttu-id="cafa6-212">同樣的，決定是否將壽險賣給保險人也需要根據幾個因素，包括保險人的年紀、性別及健康狀況。</span><span class="sxs-lookup"><span data-stu-id="cafa6-212">Similarly, determining whether to sell life insurance to an applicant depends on a number of things, including the applicant’s age, gender, and health.</span></span> <span data-ttu-id="cafa6-213">透過協調流程的「決定」圖形等方式將這些規則皆呈現為條件陳述式或許是可行的，但是實作上會相當複雜。</span><span class="sxs-lookup"><span data-stu-id="cafa6-213">Expressing all of these rules as conditional statements using, say, an orchestration’s Decide shape might be possible, but would be fairly complex to implement.</span></span> <span data-ttu-id="cafa6-214">在這樣充滿大量規則的程序中，BRE 可簡化開發人員的工作。</span><span class="sxs-lookup"><span data-stu-id="cafa6-214">For rule-intensive processes like these, the BRE can make a developer’s life simpler.</span></span>  
  
 <span data-ttu-id="cafa6-215">使用 BRE，開發人員可視需要快速輕鬆地變更規則。</span><span class="sxs-lookup"><span data-stu-id="cafa6-215">Using the BRE, developers can quickly and easily change rules as needed.</span></span> <span data-ttu-id="cafa6-216">若要瞭解原因，請試想變更在協調流程中實作的商務規則所需要的條件為何？</span><span class="sxs-lookup"><span data-stu-id="cafa6-216">To see why, think about what’s required to change a business rule that’s implemented within an orchestration.</span></span> <span data-ttu-id="cafa6-217">開發人員必須先在 [!INCLUDE[btsVStudioNoVersion](../includes/btsvstudionoversion-md.md)] 中開啟協調流程、修改適當的圖形 (可能還包括圖形所叫用的 .NET 或 COM 物件)，然後建置並部署修改的組件。</span><span class="sxs-lookup"><span data-stu-id="cafa6-217">A developer must first open the orchestration in [!INCLUDE[btsVStudioNoVersion](../includes/btsvstudionoversion-md.md)], modify the appropriate shapes (and perhaps the .NET or COM objects they invoke), and then build and deploy the modified assembly.</span></span> <span data-ttu-id="cafa6-218">這些工作還需要停止並重新啟動包含此協調流程的 BizTalk 應用程式。</span><span class="sxs-lookup"><span data-stu-id="cafa6-218">Doing this also requires stopping and restarting the BizTalk application that includes this orchestration.</span></span> <span data-ttu-id="cafa6-219">若是使用 BRE 實作商務規則，無須重新編譯或重新啟動任何應用程式就可以進行修改。</span><span class="sxs-lookup"><span data-stu-id="cafa6-219">If instead this business rule is implemented using the BRE, it can be modified without recompiling or restarting anything.</span></span> <span data-ttu-id="cafa6-220">您僅需要使用「商務規則編輯器」變更想要的規則，然後重新部署新的規則組。</span><span class="sxs-lookup"><span data-stu-id="cafa6-220">All that’s needed is to use the Business Rule Composer to change the desired rule, then redeploy the new set of rules.</span></span> <span data-ttu-id="cafa6-221">變更會立即生效。</span><span class="sxs-lookup"><span data-stu-id="cafa6-221">The change takes effect immediately.</span></span> <span data-ttu-id="cafa6-222">而且雖然協調流程一般是由開發人員建立和維護的，但在某些情況下商務分析師可自行理解商務規則並進行修改，無須技術人員協助。</span><span class="sxs-lookup"><span data-stu-id="cafa6-222">And while orchestrations are typically created and maintained by developers, business rules are readable enough that in some cases they can be modified by business analysts without the need to involve more technical people.</span></span>  
  
 <span data-ttu-id="cafa6-223">商務規則組的建立者一般會使用「商務規則編輯器」開始，以定義用來指定這些規則的詞彙。</span><span class="sxs-lookup"><span data-stu-id="cafa6-223">The creator of a set of business rules typically begins by using the Business Rule Composer to define a vocabulary for use in specifying those rules.</span></span> <span data-ttu-id="cafa6-224">詞彙中的每一個名詞提供部分資訊的易記名稱。</span><span class="sxs-lookup"><span data-stu-id="cafa6-224">Each term in the vocabulary provides a user-friendly name for some information.</span></span> <span data-ttu-id="cafa6-225">例如，詞彙可能會定義像「出貨量」或「項目的數量上限」或「核准限制」等術語。</span><span class="sxs-lookup"><span data-stu-id="cafa6-225">For example, a vocabulary might define terms such as Number Shipped or Maximum Quantity of Items or Approval Limit.</span></span> <span data-ttu-id="cafa6-226">這些術語可各自設定為常數，或對應到某個 XML 結構描述中的特定元素或屬性中 (因此也會在內送訊息中)，或對應到某些資料庫的 SQL 查詢結果，或甚至 .NET 物件中的值。</span><span class="sxs-lookup"><span data-stu-id="cafa6-226">Each of these terms can be set to a constant or be mapped to a particular element or attribute in some XML schema (and thus in an incoming message) or to the result of a SQL query against some database or even to a value in a .NET object.</span></span>  
  
 <span data-ttu-id="cafa6-227">詞彙定義完成後，「商務規則編輯器」可用來建立使用此詞彙的商務原則。</span><span class="sxs-lookup"><span data-stu-id="cafa6-227">After a vocabulary has been defined, the Business Rule Composer can be used to create business policies that use this vocabulary.</span></span> <span data-ttu-id="cafa6-228">每一個原則可包含一或多個商務規則。</span><span class="sxs-lookup"><span data-stu-id="cafa6-228">Each policy can contain one or more business rules.</span></span> <span data-ttu-id="cafa6-229">規則會使用某些詞彙中定義的術語及邏輯運算子，如 Greater Than、Less Than、Is Equal To 及其他運算子來定義商務程序運作的方式。</span><span class="sxs-lookup"><span data-stu-id="cafa6-229">A rule uses the terms defined in some vocabulary together with logical operators such as Greater Than, Less Than, Is Equal To, and others to define how a business process operates.</span></span> <span data-ttu-id="cafa6-230">商務規則可定義接收 XML 文件中包含的值對傳送 XML 文件內所建立之值的影響，或這些接收值對寫入資料庫中之值的影響，或其他等等。</span><span class="sxs-lookup"><span data-stu-id="cafa6-230">A business rule can define how values contained in a received XML document should affect the values created in an XML document that’s sent, or how those received values should affect what value is written in a database, or other things.</span></span>  
  
 <span data-ttu-id="cafa6-231">為了執行商務原則，協調流程會使用 CallRules 圖形。</span><span class="sxs-lookup"><span data-stu-id="cafa6-231">To execute a business policy, an orchestration uses a CallRules shape.</span></span> <span data-ttu-id="cafa6-232">這個圖形建立 BRE 的執行個體、指定要執行的原則，然後傳遞此原則需要的資訊，如接收的 XML 文件。</span><span class="sxs-lookup"><span data-stu-id="cafa6-232">This shape creates an instance of the BRE, specifies which policy to execute, then passes in the information this policy needs, such as a received XML document.</span></span> <span data-ttu-id="cafa6-233">也可使用以 .NET 為基礎的物件模型以程式設計方式叫用 BRE，這樣可讓不是使用 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 的應用程式呼叫 BRE。</span><span class="sxs-lookup"><span data-stu-id="cafa6-233">The BRE can also be invoked programmatically using a .NET-based object model, which allows it to be called from applications that don’t use [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)].</span></span> <span data-ttu-id="cafa6-234">這表示該 Windows Forms 應用程式、 軟體公開 Web 服務和其他建置在.NET Framework 上的任何項目可能使用 BRE 每當它可協助解決眼前的問題。</span><span class="sxs-lookup"><span data-stu-id="cafa6-234">This means that Windows Forms applications, software exposing Web services, and anything else built on the .NET Framework can potentially use the BRE whenever it helps solve the problem at hand.</span></span>  
  
 <span data-ttu-id="cafa6-235">詞彙和商務規則都可能比這裡所描述的簡單範例更為複雜且功能更多。</span><span class="sxs-lookup"><span data-stu-id="cafa6-235">Both vocabularies and business rules can be much more complicated—and much more powerful—than the simple examples described here.</span></span> <span data-ttu-id="cafa6-236">但定義詞彙、然後定義規則來使用詞彙的基本觀念，乃是「商務規則引擎」的核心。</span><span class="sxs-lookup"><span data-stu-id="cafa6-236">But the core idea of defining a vocabulary, then defining sets of rules that use that vocabulary is the heart of the Business Rule Engine.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="cafa6-237">另請參閱</span><span class="sxs-lookup"><span data-stu-id="cafa6-237">See Also</span></span>  
 [<span data-ttu-id="cafa6-238">BizTalk Server 傳訊引擎</span><span class="sxs-lookup"><span data-stu-id="cafa6-238">The BizTalk Server Messaging Engine</span></span>](../core/the-biztalk-server-messaging-engine.md)