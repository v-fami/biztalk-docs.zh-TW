---
title: 使用 POP3 配接器的處理多部分訊息 |Microsoft 文件
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: 56ad041f-f155-4c1c-ab87-1405c80d9b68
caps.latest.revision: 6
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 26aff4569414103ad8c4f37a9e4699a85874e481
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 09/20/2017
ms.locfileid: "22266438"
---
# <a name="processing-multi-part-messages-with-the-pop3-adapter"></a><span data-ttu-id="60cc3-102">使用 POP3 配接器處理多部分訊息</span><span class="sxs-lookup"><span data-stu-id="60cc3-102">Processing Multi Part Messages with the POP3 Adapter</span></span>
<span data-ttu-id="60cc3-103">POP3 配接器可以處理符合在 IETF 標準的 MIME 編碼訊息[RFC 2045](http://go.microsoft.com/fwlink/?LinkId=58810)， [RFC 2046](http://go.microsoft.com/fwlink/?LinkId=58811)，和[RFC 2047](http://go.microsoft.com/fwlink/?LinkId=58812)。</span><span class="sxs-lookup"><span data-stu-id="60cc3-103">The POP3 Adapter can process MIME-encoded messages that conform to the IETF standards documented in [RFC 2045](http://go.microsoft.com/fwlink/?LinkId=58810), [RFC 2046](http://go.microsoft.com/fwlink/?LinkId=58811), and [RFC 2047](http://go.microsoft.com/fwlink/?LinkId=58812).</span></span> <span data-ttu-id="60cc3-104">MIME 編碼訊息可以有一或多個內容類型不同的部分。</span><span class="sxs-lookup"><span data-stu-id="60cc3-104">MIME encoded messages can have from one to many parts with different content types.</span></span> <span data-ttu-id="60cc3-105">本主題將討論 POP3 配接器如何處理多部分 MIME 編碼訊息。</span><span class="sxs-lookup"><span data-stu-id="60cc3-105">This topic discusses the how the POP3 adapter processes multi part MIME encoded messages.</span></span>  
  
## <a name="receiving-multi-part-messages-with-the-pop3-adapter"></a><span data-ttu-id="60cc3-106">使用 POP3 配接器接收多部分訊息</span><span class="sxs-lookup"><span data-stu-id="60cc3-106">Receiving Multi part Messages with the POP3 Adapter</span></span>  
 <span data-ttu-id="60cc3-107">使用 POP3 配接器的接收位置是否有**套用 MIME 解碼**選項設定為**True**則 POP3 配接器接收 MIME 編碼訊息時，請執行下列動作：</span><span class="sxs-lookup"><span data-stu-id="60cc3-107">If a receive location that uses the POP3 adapter has the **Apply MIME Decoding** option set to **True** then the POP3 adapter performs the following actions when receiving a MIME-encoded message:</span></span>  
  
1.  <span data-ttu-id="60cc3-108">從收到的 MIME 編碼訊息部分建立多部分 BizTalk 訊息。</span><span class="sxs-lookup"><span data-stu-id="60cc3-108">Creates a multi part BizTalk message from the parts of the MIME encoded message that it receives.</span></span> <span data-ttu-id="60cc3-109">這個多部分訊息可能包含一或多個部分，包含的部分數目會與所收到 MIME 編碼訊息的部分數目相同。</span><span class="sxs-lookup"><span data-stu-id="60cc3-109">This multi part message can contain from 1 to many parts and will contain the same number of parts as the MIME encoded message that is received.</span></span>  
  
2.  <span data-ttu-id="60cc3-110">掃描 MIME 編碼訊息的標頭。</span><span class="sxs-lookup"><span data-stu-id="60cc3-110">Scans the headers of the MIME encoded message.</span></span> <span data-ttu-id="60cc3-111">如果任何標頭符合所列主題中的屬性清單[POP3 配接器屬性結構描述和屬性](../core/pop3-adapter-property-schema-and-properties.md)然後這些標頭升級至多部分 BizTalk 訊息內容屬性。</span><span class="sxs-lookup"><span data-stu-id="60cc3-111">If any headers match the list of properties documented in the topic [POP3 Adapter Property Schema and Properties](../core/pop3-adapter-property-schema-and-properties.md) then these headers are promoted to the multi part BizTalk message as context properties.</span></span>  
  
3.  <span data-ttu-id="60cc3-112">使用可設定的演算法，將 MIME 編碼訊息的其中一個部分指定為 BizTalk 訊息內文部分。</span><span class="sxs-lookup"><span data-stu-id="60cc3-112">Uses a configurable algorithm to designate one of the parts of the MIME encoded message as the BizTalk message body part.</span></span> <span data-ttu-id="60cc3-113">用來決定哪一個訊息部分將 BizTalk 訊息內文部分的演算法如下一節所述**POP3 配接器所使用的內文部分選取演算法**。</span><span class="sxs-lookup"><span data-stu-id="60cc3-113">The algorithm used to determine which message part will be the BizTalk message body part is described below in the section **Body Part Selection Algorithm Used by the POP3 Adapter**.</span></span>  
  
4.  <span data-ttu-id="60cc3-114">將多部分 BizTalk 訊息發佈至 MessageBox。</span><span class="sxs-lookup"><span data-stu-id="60cc3-114">Publishes the multi part BizTalk message to the MessageBox.</span></span>  
  
## <a name="body-part-selection-algorithm-used-by-the-pop3-adapter"></a><span data-ttu-id="60cc3-115">POP3 配接器使用的內文部分選取演算法</span><span class="sxs-lookup"><span data-stu-id="60cc3-115">Body Part Selection Algorithm Used by the POP3 Adapter</span></span>  
 <span data-ttu-id="60cc3-116">當 POP3 配接器從所收到 MIME 編碼訊息的部分建立多部分 BizTalk 訊息時，它會選取其中一個訊息部分做為 BizTalk 訊息內文部分。</span><span class="sxs-lookup"><span data-stu-id="60cc3-116">When the POP3 adapter creates a multipart BizTalk message from the parts of the MIME-encoded message that it receives, it selects one of the message parts as the BizTalk message body part.</span></span> <span data-ttu-id="60cc3-117">BizTalk Server 會使用 BizTalk 訊息內文部分來執行訊息驗證、對應、屬性升級、一般檔案組合以及其他作業。</span><span class="sxs-lookup"><span data-stu-id="60cc3-117">The BizTalk message body part is used by BizTalk Server for things such as message validation, mapping, property promotion, flat file assembly and other operations.</span></span> <span data-ttu-id="60cc3-118">多部分 BizTalk 訊息的訂閱者會收到所有訊息部分，但除非使用可以瞭解多部分訊息的協調流程、自訂管線或配接器，否則只會使用指定的 BizTalk 訊息內文部分。</span><span class="sxs-lookup"><span data-stu-id="60cc3-118">Subscribers to a multi part BizTalk message receive all of the message parts but will only consume the designated BizTalk message body part unless using an orchestration, a custom pipeline, or an adapter that can understand multi part messages.</span></span> <span data-ttu-id="60cc3-119">例如，您可以設定協調流程讀取多部分訊息的所有部分、SMTP 配接器可以讀取多部分訊息的所有部分，以及自訂管線經過設定後便可以使用 MIME/SMIME 編碼器管線元件。</span><span class="sxs-lookup"><span data-stu-id="60cc3-119">For example, you can configure an orchestration to read all parts of multi part message; the SMTP adapter can read all of the parts of a multi part message, and a custom pipeline can be configured to use the MIME/SMIME encoder pipeline component.</span></span> <span data-ttu-id="60cc3-120">如需使用協調流程取用多部分訊息詳細資訊，請參閱下節，**協調流程中處理多部分訊息**。</span><span class="sxs-lookup"><span data-stu-id="60cc3-120">For more information about using an orchestration to consume a multi part message see the section below, **Processing Multi Part Messages in Orchestrations**.</span></span>  
  
 <span data-ttu-id="60cc3-121">POP3 配接器會從提供的值為基礎的可用的內文部分選取 BizTalk 訊息內文部分**內文部分索引**和**內文部分內容類型**。</span><span class="sxs-lookup"><span data-stu-id="60cc3-121">The POP3 adapter selects the BizTalk message body part from the available body parts based upon the values supplied for the **Body Part Index** and the **Body Part Content Type**.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="60cc3-122">POP3 配接器可辨識的內文部分內容類型中定義的[RFC 2046](http://go.microsoft.com/fwlink/?LinkId=119569)。</span><span class="sxs-lookup"><span data-stu-id="60cc3-122">The POP3 adapter is designed to recognize the Body Part Content Types that are defined in [RFC 2046](http://go.microsoft.com/fwlink/?LinkId=119569).</span></span>  
  
 <span data-ttu-id="60cc3-123">下面說明用來選取電子郵件之 BizTalk 訊息內文部分的演算法：</span><span class="sxs-lookup"><span data-stu-id="60cc3-123">The algorithm that is used to select the BizTalk message body part of an e-mail is described below:</span></span>  
  
1.  <span data-ttu-id="60cc3-124">如果**內文部分索引**設為 0 和**內文部分內容類型**為空白，則會使用下列演算法來選取 BizTalk 訊息內文部分：</span><span class="sxs-lookup"><span data-stu-id="60cc3-124">If the **Body Part Index** is set to 0 and the **Body Part Content Type** is blank then the following algorithm is used to select the BizTalk message body part:</span></span>  
  
    -   <span data-ttu-id="60cc3-125">使用 Content-Description 標頭設定為 "body" 的第一個 MIME 部分。</span><span class="sxs-lookup"><span data-stu-id="60cc3-125">Use the first MIME part with the Content-Description header set to "body".</span></span>  
  
    -   <span data-ttu-id="60cc3-126">否則使用 Content-Type 標頭設定為 "text/xml" 的第一個 MIME 部分。</span><span class="sxs-lookup"><span data-stu-id="60cc3-126">Otherwise use the first MIME part with the Content-Type header set to "text/xml".</span></span>  
  
    -   <span data-ttu-id="60cc3-127">否則使用 Content-Type 標頭設定為 "text/plain" 的第一個 MIME 部分。</span><span class="sxs-lookup"><span data-stu-id="60cc3-127">Otherwise use the first MIME part with the Content-Type header set to "text/plain".</span></span>  
  
    -   <span data-ttu-id="60cc3-128">否則使用 Content-Type 標頭設定為 "text/" 的第一個 MIME 部分。</span><span class="sxs-lookup"><span data-stu-id="60cc3-128">Otherwise use the first MIME part with the Content-Type header set to "text/".</span></span>  
  
    -   <span data-ttu-id="60cc3-129">否則使用第一個 MIME 部分。</span><span class="sxs-lookup"><span data-stu-id="60cc3-129">Otherwise use the first MIME part.</span></span>  
  
2.  <span data-ttu-id="60cc3-130">否則如果**內文部分索引**設為 0 和**內文部分內容類型**，則符合指定的內送訊息的第一個內文部分**內文部分內容類型**選定為 BizTalk 訊息內文部分。</span><span class="sxs-lookup"><span data-stu-id="60cc3-130">Otherwise if the **Body Part Index** is set to 0 and the **Body Part Content Type** is set, then the first body part of the incoming message that matches the specified **Body Part Content Type** is selected as the BizTalk message body part.</span></span> <span data-ttu-id="60cc3-131">如果沒有部分具有相符的內容類型，則訊息將遭擱置。</span><span class="sxs-lookup"><span data-stu-id="60cc3-131">If there are no parts with a matching content type then the message is suspended.</span></span>  
  
3.  <span data-ttu-id="60cc3-132">否則如果**內文部分索引**設為值大於 0 和**內文部分內容類型**為空白，則具有指定之索引的內文部分當做 BizTalk 訊息內文部分。</span><span class="sxs-lookup"><span data-stu-id="60cc3-132">Otherwise if the **Body Part Index** is set to a value greater than 0 and the **Body Part Content Type** is blank, then the body part with the specified index is selected as the BizTalk message body part.</span></span> <span data-ttu-id="60cc3-133">如果指定的索引大於內文部分數目，則訊息將遭擱置。</span><span class="sxs-lookup"><span data-stu-id="60cc3-133">If the specified index is greater than the number of body parts then the message is suspended.</span></span>  
  
4.  <span data-ttu-id="60cc3-134">否則如果**內文部分索引**設為值大於 0 和**內文部分內容類型**設定，然後在**內文部分索引**僅會套用的主體組件的符合指定**內文部分內容類型**和對應的內文部分當做 BizTalk 訊息內文部分。</span><span class="sxs-lookup"><span data-stu-id="60cc3-134">Otherwise if the **Body Part Index** is set to a value greater than 0 and the **Body Part Content Type** is set, then the **Body Part Index** is only applied to those body parts that match the specified **Body Part Content Type** and the corresponding body part is selected as the BizTalk message body part.</span></span> <span data-ttu-id="60cc3-135">如果指定的索引大於內容類型相符的內文部分數目，則訊息將遭擱置。</span><span class="sxs-lookup"><span data-stu-id="60cc3-135">If the specified index is greater than the number of parts with a matching content type then the message is suspended.</span></span> <span data-ttu-id="60cc3-136">如果沒有部分具有相符的內容類型，則訊息將遭擱置。</span><span class="sxs-lookup"><span data-stu-id="60cc3-136">If there are no parts with a matching content type then the message is suspended.</span></span>  
  
5.  <span data-ttu-id="60cc3-137">選取做為 BizTalk 訊息內文部分的部分會成為發佈至 MessageBox 之多部分 BizTalk 訊息的第一個部分，訊息的其餘部分則保留當初在原始 MIME 編碼訊息中的順序。</span><span class="sxs-lookup"><span data-stu-id="60cc3-137">The part that is selected as the BizTalk message body part becomes the first part of the multi part BizTalk message that is published to the MessageBox, the remaining parts of the message maintain the order that they had in the original MIME encoded message.</span></span>  
  
## <a name="processing-multi-part-messages-in-orchestrations"></a><span data-ttu-id="60cc3-138">在協調流程中處理多部分訊息</span><span class="sxs-lookup"><span data-stu-id="60cc3-138">Processing Multi Part Messages in Orchestrations</span></span>  
 <span data-ttu-id="60cc3-139">當 POP3 配接器從接收的 MIME 編碼訊息建立多部分 BizTalk 訊息時，所有部分都會發佈至 MessageBox 資料庫，即使其中只有一個部分會指定為 BizTalk 訊息內文部分也一樣。</span><span class="sxs-lookup"><span data-stu-id="60cc3-139">When the POP3 adapter creates a multi part BizTalk message from a MIME encoded message that it receives, all of the parts are published to the MessageBox database even though only one of the parts is designated as the BizTalk message body part.</span></span> <span data-ttu-id="60cc3-140">這些部分接著會由訂閱多部分訊息的協調流程使用。</span><span class="sxs-lookup"><span data-stu-id="60cc3-140">These parts can be subsequently consumed by an orchestration that subscribes to the multi part message.</span></span> <span data-ttu-id="60cc3-141">本節將說明在協調流程中處理多部分訊息的一些考量。</span><span class="sxs-lookup"><span data-stu-id="60cc3-141">This section documents some considerations when processing multi part messages in an orchestration.</span></span>  
  
### <a name="processing-multi-part-messages-with-a-known-number-of-parts-and-known-part-types"></a><span data-ttu-id="60cc3-142">處理部分數目已知且部分類型已知的多部分訊息</span><span class="sxs-lookup"><span data-stu-id="60cc3-142">Processing multi part messages with a known number of parts and known part types</span></span>  
 <span data-ttu-id="60cc3-143">如果協調流程接收的多部分訊息是已知部分數目且已知部分類型，則您可以在協調流程中宣告多部分訊息，然後在設計階段設定部分數目和部分類型。</span><span class="sxs-lookup"><span data-stu-id="60cc3-143">If your orchestration is receiving a multi part message with a known number of parts and known part types then you can declare a multi part message in the orchestration and set the number of parts and part types at design time.</span></span>  
  
### <a name="processing-multi-part-messages-with-unknown-part-types"></a><span data-ttu-id="60cc3-144">處理部分類型未知的多部分訊息</span><span class="sxs-lookup"><span data-stu-id="60cc3-144">Processing multi part messages with unknown part types</span></span>  
 <span data-ttu-id="60cc3-145">如果您的協調流程接收多部分訊息部分類型未知，則您可以宣告多部分訊息在協調流程並使用**XmlDocument**每個組件的類型是未知的類型。</span><span class="sxs-lookup"><span data-stu-id="60cc3-145">If your orchestration is receiving a multi part message with unknown part types then you can declare a multi part message in the orchestration and use the **XmlDocument** type for each of the parts for which the type is unknown.</span></span>  
  
### <a name="processing-multi-part-messages-with-an-unknown-number-of-parts-and-all-of-the-part-types-are-unknown"></a><span data-ttu-id="60cc3-146">處理部分數目未知且所有部分類型都未知的多部分訊息</span><span class="sxs-lookup"><span data-stu-id="60cc3-146">Processing multi part messages with an unknown number of parts and all of the part types are unknown</span></span>  
 <span data-ttu-id="60cc3-147">如果您的協調流程接收多部分訊息的部分數目未知，則您可以宣告多部分訊息的單一組件與**XmlDocument**協調流程中接收訊息的類型。</span><span class="sxs-lookup"><span data-stu-id="60cc3-147">If your orchestration is receiving a multi part message with an unknown number of parts then you can declare a multi part message with a single part of the **XmlDocument** type in the orchestration to receive the message.</span></span> <span data-ttu-id="60cc3-148">如果收到包含大於宣告的部分數目的多部分訊息時，有多少部分是在訊息中的協調流程引擎讀取然後建構適當的部分類型符合的組件中宣告的訊息數目的組件類型，然後建構**XmlDocument**組件的其餘部分。</span><span class="sxs-lookup"><span data-stu-id="60cc3-148">If a multi part message that contains greater than the number of declared parts is received, the orchestration engine reads how many parts there are in the message, then constructs the proper part types for the parts that match the number of parts in the declared message type and then constructs **XmlDocument** parts for the remaining parts.</span></span>