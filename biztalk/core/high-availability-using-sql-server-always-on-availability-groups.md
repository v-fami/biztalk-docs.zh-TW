---
title: 使用 SQL Server Always On 可用性群組的高可用性 |Microsoft Docs
description: 群組以取得高可用性 (HA) 解決方案，使用 SQL Server Alwayson 可用群組 (AG)，包括系統需求和限制的不同節點上的 BizTalk Server 資料庫。 Alwayson AG 需要 Windows Server 容錯移轉叢集 (WSFC)。
ms.custom: ''
ms.date: 07/8/2018
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: 4511a578-77d2-49ee-99bd-f0406ad625d0
caps.latest.revision: 10
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: d163c035cdf45ede600509783040114a0eaa0a2b
ms.sourcegitcommit: 1f0306e812c95dc32c4496345c19f141612cb2c1
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 07/09/2018
ms.locfileid: "37913855"
---
# <a name="high-availability-using-sql-server-always-on-availability-groups---biztalk-server"></a><span data-ttu-id="e0e20-104">使用 SQL Server Always On 可用性群組-BizTalk Server 的高可用性</span><span class="sxs-lookup"><span data-stu-id="e0e20-104">High Availability using SQL Server Always On Availability Groups - BizTalk Server</span></span>
<span data-ttu-id="e0e20-105">設定使用 SQL Server AlwaysOn 可用性群組的高可用性。</span><span class="sxs-lookup"><span data-stu-id="e0e20-105">Configure high availability using SQL Server AlwaysOn availability groups.</span></span>

> [!TIP]
> <span data-ttu-id="e0e20-106">[設定 BizTalk Server 2016 使用可用性群組實驗室](https://skastberg.wordpress.com/2017/02/22/setting-up-my-biztalk-server-2016-using-availability-groups-lab/)提供 Microsoft 現場工程師所撰寫的逐步指南。</span><span class="sxs-lookup"><span data-stu-id="e0e20-106">[Setting up BizTalk Server 2016 using availability groups LAB](https://skastberg.wordpress.com/2017/02/22/setting-up-my-biztalk-server-2016-using-availability-groups-lab/) provides a step-by-step guide written by a Microsoft field engineer.</span></span> <span data-ttu-id="e0e20-107">它根據實驗室環境，並包含一些觀察結果。</span><span class="sxs-lookup"><span data-stu-id="e0e20-107">It is based on a lab environment, and includes some observations.</span></span> <span data-ttu-id="e0e20-108">簽出。</span><span class="sxs-lookup"><span data-stu-id="e0e20-108">Check it out.</span></span>  
> 
> [!IMPORTANT]
> * <span data-ttu-id="e0e20-109">使用從 SQL Server 2016 always On 可用性群組。</span><span class="sxs-lookup"><span data-stu-id="e0e20-109">Always On Availability Groups is available starting with SQL Server 2016.</span></span> <span data-ttu-id="e0e20-110">如果您使用舊的 SQL Server 版本，本主題不適用於您。</span><span class="sxs-lookup"><span data-stu-id="e0e20-110">If you are using a previous SQL Server version, this topic does not apply to you.</span></span> 
> * <span data-ttu-id="e0e20-111">BizTalk Server 2016 支援的同步認可模式;不支援非同步認可模式。</span><span class="sxs-lookup"><span data-stu-id="e0e20-111">BizTalk Server 2016 supports synchronous-commit mode; asynchronous-commit mode is not supported.</span></span> <span data-ttu-id="e0e20-112">針對災害復原，建議設定 「 備份 BizTalk Server 」 工作，並使用記錄傳送。</span><span class="sxs-lookup"><span data-stu-id="e0e20-112">For disaster recovery, it is recommended to configure the Backup BizTalk Server job, and use log shipping.</span></span> <span data-ttu-id="e0e20-113">請參閱[備份和還原 BizTalk Server 資料庫](../core/backing-up-and-restoring-biztalk-server-databases.md)的特定詳細資料。</span><span class="sxs-lookup"><span data-stu-id="e0e20-113">See [Backing Up and Restoring BizTalk Server Databases](../core/backing-up-and-restoring-biztalk-server-databases.md) for specific details.</span></span>
> 
>    <span data-ttu-id="e0e20-114">[可用性模式](https://docs.microsoft.com/sql/database-engine/availability-groups/windows/availability-modes-always-on-availability-groups)詳細說明與 Alwayson 可用性群組的認可選項。</span><span class="sxs-lookup"><span data-stu-id="e0e20-114">[Availability Modes](https://docs.microsoft.com/sql/database-engine/availability-groups/windows/availability-modes-always-on-availability-groups) details the commit options with Always On Availability Groups.</span></span> 


## <a name="background-and-history"></a><span data-ttu-id="e0e20-115">背景和歷程記錄</span><span class="sxs-lookup"><span data-stu-id="e0e20-115">Background and history</span></span>

<span data-ttu-id="e0e20-116">BizTalk Server 依賴 SQL Server 以保存資料。</span><span class="sxs-lookup"><span data-stu-id="e0e20-116">BizTalk Server relies heavily on SQL Server for data persistence.</span></span> <span data-ttu-id="e0e20-117">整合不同的商業應用程式，例如，接收、 處理或路由訊息時，其他元件和 BizTalk Server 中的主控件都有特定的角色。</span><span class="sxs-lookup"><span data-stu-id="e0e20-117">Other components and hosts in BizTalk Server have specific roles when integrating disparate business applications, such as receiving, processing, or routing messages.</span></span> <span data-ttu-id="e0e20-118">資料庫電腦會擷取此工作，並將它保存到磁碟。</span><span class="sxs-lookup"><span data-stu-id="e0e20-118">The database computer captures this work, and persists it to disk.</span></span> 

<span data-ttu-id="e0e20-119">BizTalk 會使用 SQL Server 容錯移轉叢集和記錄傳送，以供其內部部署資料庫的高可用性、 備份和還原以及災害復原。</span><span class="sxs-lookup"><span data-stu-id="e0e20-119">BizTalk uses SQL Server Failover Clustering and Log Shipping to provide high availability, backup and restore, and disaster recovery for its on-premises databases.</span></span> <span data-ttu-id="e0e20-120">在 Azure IaaS （Azure 虛擬機器），舊版的 SQL Server 不支援容錯移轉叢集執行個體 （沒有 MSDTC 支援）。</span><span class="sxs-lookup"><span data-stu-id="e0e20-120">In Azure IaaS (Azure virtual machines), previous versions of SQL Server do not support Failover Cluster Instances (no MSDTC support).</span></span> <span data-ttu-id="e0e20-121">如此一來，BizTalk 沒有的 HA 解決方案使用 Azure Vm 時。</span><span class="sxs-lookup"><span data-stu-id="e0e20-121">As a result, BizTalk did not have a HA solution when using Azure VMs.</span></span>

<span data-ttu-id="e0e20-122">從 SQL Server 2016 開始，SQL Server AlwaysOn 可用性群組支援 MSDTC 內部部署和使用 Azure Vm。</span><span class="sxs-lookup"><span data-stu-id="e0e20-122">Starting with SQL Server 2016, SQL Server AlwaysOn Availability Groups supports MSDTC for on-premises and using Azure VMs.</span></span> <span data-ttu-id="e0e20-123">如此一來，BizTalk 資料庫內部部署或 Azure IaaS 案例中，被支援將 SQL Server 2016 AlwaysOn 功能。</span><span class="sxs-lookup"><span data-stu-id="e0e20-123">As a result, the SQL Server 2016 AlwaysOn feature is supported for BizTalk databases on-premises or in Azure IaaS scenarios.</span></span> 

## <a name="sql-server-2016-alwayson-availability-groups"></a><span data-ttu-id="e0e20-124">SQL Server 2016 AlwaysOn 可用性群組</span><span class="sxs-lookup"><span data-stu-id="e0e20-124">SQL Server 2016 AlwaysOn Availability Groups</span></span> 
<span data-ttu-id="e0e20-125">部署 AlwaysOn 可用性群組需要 Windows Server 容錯移轉叢集 (WSFC) 叢集。</span><span class="sxs-lookup"><span data-stu-id="e0e20-125">Deploying AlwaysOn Availability Groups requires a Windows Server Failover Clustering (WSFC) cluster.</span></span> <span data-ttu-id="e0e20-126">給定可用性群組的每個可用性複本都必須位在相同 WSFC 叢集的不同節點上。</span><span class="sxs-lookup"><span data-stu-id="e0e20-126">Each availability replica of a given availability group must reside on a different node of the same WSFC cluster.</span></span> <span data-ttu-id="e0e20-127">對於您建立的每個可用性群組，系統會建立一個 WSFC 資源群組。</span><span class="sxs-lookup"><span data-stu-id="e0e20-127">A WSFC resource group is created for every availability group that you create.</span></span> <span data-ttu-id="e0e20-128">WSFC 叢集會監視此資源群組，以評估主要複本的健康情況。</span><span class="sxs-lookup"><span data-stu-id="e0e20-128">The WSFC cluster monitors this resource group to evaluate the health of the primary replica.</span></span>  

<span data-ttu-id="e0e20-129">下圖顯示可用性群組，其中包含一個主要複本和四個次要複本。</span><span class="sxs-lookup"><span data-stu-id="e0e20-129">The following illustration shows an availability group that contains one primary replica and four secondary replicas.</span></span>  
 
 ![SQLAG_PrimaryReplica](../core/media/sqlag-primaryreplica.png)

<span data-ttu-id="e0e20-131">用戶端可以連線至使用可用性群組接聽程式的給定的可用性群組主要複本。</span><span class="sxs-lookup"><span data-stu-id="e0e20-131">Clients can connect to the primary replica of a given availability group using an availability group listener.</span></span> <span data-ttu-id="e0e20-132">可用性群組接聽程式會提供一組附加至給定的可用性群組的直接用戶端連接到適當的可用性複本的資源。</span><span class="sxs-lookup"><span data-stu-id="e0e20-132">An availability group listener provides a set of resources that are attached to a given availability group to direct client connections to the appropriate availability replica.</span></span> 

>[!IMPORTANT]
> <span data-ttu-id="e0e20-133">SQL Server 2016 支援 Windows Server 2016 和 Windows Server 2012 R2 上的 MSDTC 與 AlwaysOn 可用性群組 (AG)。</span><span class="sxs-lookup"><span data-stu-id="e0e20-133">SQL Server 2016 supports MSDTC with AlwaysOn Availability Groups (AG) on Windows Server 2016 and Windows Server 2012 R2.</span></span> <span data-ttu-id="e0e20-134">**Windows Server 2012 R2**需要[3090973](https://support.microsoft.com/kb/3090973)安裝的 Windows hotfix。</span><span class="sxs-lookup"><span data-stu-id="e0e20-134">**Windows Server 2012 R2** requires  the [3090973](https://support.microsoft.com/kb/3090973) Windows hotfix  to be installed.</span></span> 
> <span data-ttu-id="e0e20-135">**Windows Server 2016**要求[RemoteAccessEnabled 登錄機碼](https://support.microsoft.com/kb/3182294)啟用。</span><span class="sxs-lookup"><span data-stu-id="e0e20-135">**Windows Server 2016** requires that the [RemoteAccessEnabled registry key](https://support.microsoft.com/kb/3182294) be enabled.</span></span>

<span data-ttu-id="e0e20-136">SQL Server 2016 之前的任何版本不支援使用 AlwaysOn AG 的 MSDTC。</span><span class="sxs-lookup"><span data-stu-id="e0e20-136">SQL Server does not support MSDTC with AlwaysOn AG for any versions prior to 2016.</span></span>  

<span data-ttu-id="e0e20-137">相同的 SQL Server 執行個體上的資料庫之間的 MSDTC 無法使用 SQL Server AlwaysOn 可用性群組。</span><span class="sxs-lookup"><span data-stu-id="e0e20-137">MSDTC between databases on same SQL Server instance is not supported with SQL Server AlwaysOn Availability Groups.</span></span> <span data-ttu-id="e0e20-138">這表示，在分散式交易中的任何兩個 BizTalk 資料庫可裝載於相同的 SQL server 執行個體。</span><span class="sxs-lookup"><span data-stu-id="e0e20-138">This means that no two BizTalk databases in a distributed transaction can be hosted on the same SQL server instance.</span></span> <span data-ttu-id="e0e20-139">交易一致性，應該在不同的 SQL server 執行個體上裝載參與分散式交易的 BizTalk 資料庫。</span><span class="sxs-lookup"><span data-stu-id="e0e20-139">For transactional consistency, BizTalk databases participating in distributed transaction should be hosted on different SQL server instances.</span></span> <span data-ttu-id="e0e20-140">請注意，不論是否會在同一部電腦或不同的電腦上的 SQL 執行個體。</span><span class="sxs-lookup"><span data-stu-id="e0e20-140">Note that it does not matter whether SQL instances are on the same computer, or different computers.</span></span> 


## <a name="provide-high-availability-for-biztalk-databases-using-alwayson-availability-groups"></a><span data-ttu-id="e0e20-141">使用 AlwaysOn 可用性群組的 BizTalk 資料庫提供高可用性</span><span class="sxs-lookup"><span data-stu-id="e0e20-141">Provide high availability for BizTalk databases using AlwaysOn Availability Groups</span></span> 
<span data-ttu-id="e0e20-142">在 BizTalk Server 基本組態中，至少有 9 的資料庫會建立包含規則和 BAM 資料庫。</span><span class="sxs-lookup"><span data-stu-id="e0e20-142">In the basic configuration of BizTalk Server, a minimum of 9 databases are created including Rules and BAM databases.</span></span> <span data-ttu-id="e0e20-143">因為 MSDTC 可用性群組的限制，先前所述，如下列組態並不保證交易一致性。</span><span class="sxs-lookup"><span data-stu-id="e0e20-143">Due to the MSDTC limitation with Availability Groups mentioned previously, a configuration such as following does not ensure transactional consistency.</span></span> 

![SQLAG_NoTrans](../core/media/sqlag-notrans.gif)
 
<span data-ttu-id="e0e20-145">我們建議您在 BizTalk Server 資料庫分為下列四個 SQL Server 執行個體：</span><span class="sxs-lookup"><span data-stu-id="e0e20-145">We recommend that the BizTalk Server databases are grouped into the following four SQL Server instances:</span></span>
 
| <span data-ttu-id="e0e20-146">執行個體</span><span class="sxs-lookup"><span data-stu-id="e0e20-146">Instance</span></span> |<span data-ttu-id="e0e20-147">角色</span><span class="sxs-lookup"><span data-stu-id="e0e20-147">Role</span></span> |<span data-ttu-id="e0e20-148">該群組中的 BizTalk 資料庫</span><span class="sxs-lookup"><span data-stu-id="e0e20-148">BizTalk Databases in that group</span></span>  |
|--- | --- | ---|
|<span data-ttu-id="e0e20-149">1</span><span class="sxs-lookup"><span data-stu-id="e0e20-149">1</span></span> |<span data-ttu-id="e0e20-150">驗證</span><span class="sxs-lookup"><span data-stu-id="e0e20-150">Authentication</span></span> |<span data-ttu-id="e0e20-151">SSODB</span><span class="sxs-lookup"><span data-stu-id="e0e20-151">SSODB</span></span>|
|<span data-ttu-id="e0e20-152">2</span><span class="sxs-lookup"><span data-stu-id="e0e20-152">2</span></span> |<span data-ttu-id="e0e20-153">管理</span><span class="sxs-lookup"><span data-stu-id="e0e20-153">Management</span></span> |<span data-ttu-id="e0e20-154">BizTalkMgmtDb</span><span class="sxs-lookup"><span data-stu-id="e0e20-154">BizTalkMgmtDb</span></span>| 
|<span data-ttu-id="e0e20-155">3</span><span class="sxs-lookup"><span data-stu-id="e0e20-155">3</span></span> |<span data-ttu-id="e0e20-156">執行階段</span><span class="sxs-lookup"><span data-stu-id="e0e20-156">Runtime</span></span> |<span data-ttu-id="e0e20-157">BizTalkMsgBoxDb</span><span class="sxs-lookup"><span data-stu-id="e0e20-157">BizTalkMsgBoxDb</span></span><br/> <span data-ttu-id="e0e20-158">BizTalkRulesEngineDb</span><span class="sxs-lookup"><span data-stu-id="e0e20-158">BizTalkRulesEngineDb</span></span><br/> <span data-ttu-id="e0e20-159">BAMPrimaryImport</span><span class="sxs-lookup"><span data-stu-id="e0e20-159">BAMPrimaryImport</span></span><br/><span data-ttu-id="e0e20-160">BAMStarSchema</span><span class="sxs-lookup"><span data-stu-id="e0e20-160">BAMStarSchema</span></span> <br/><span data-ttu-id="e0e20-161">BAMAlertsApplication</span><span class="sxs-lookup"><span data-stu-id="e0e20-161">BAMAlertsApplication</span></span> |
|<span data-ttu-id="e0e20-162">4</span><span class="sxs-lookup"><span data-stu-id="e0e20-162">4</span></span> |<span data-ttu-id="e0e20-163">追蹤</span><span class="sxs-lookup"><span data-stu-id="e0e20-163">Tracking</span></span> |<span data-ttu-id="e0e20-164">BizTalkDTADb</span><span class="sxs-lookup"><span data-stu-id="e0e20-164">BizTalkDTADb</span></span><br/><span data-ttu-id="e0e20-165">EsbItineraryDb</span><span class="sxs-lookup"><span data-stu-id="e0e20-165">EsbItineraryDb</span></span><br/><span data-ttu-id="e0e20-166">EsbExceptionDb</span><span class="sxs-lookup"><span data-stu-id="e0e20-166">EsbExceptionDb</span></span> | 
 
<span data-ttu-id="e0e20-167">在相應放大 MessageBox 案例 （具有一個以上的 MessageBox 的組態） 中，沒有一個以上的 MessageBox 資料庫，且每個 MessageBox 資料庫必須在自己的 SQL Server 執行個體。</span><span class="sxs-lookup"><span data-stu-id="e0e20-167">In a scaled-out MessageBox scenario (a configuration with more than one MessageBox), there is more than one MessageBox database, and each MessageBox database must be on its own SQL Server instance.</span></span> 

<span data-ttu-id="e0e20-168">BizTalk Server 也取決於 SQL Server Analysis Services 與 BAM 分析和封存的 SQL Server Integration Services。</span><span class="sxs-lookup"><span data-stu-id="e0e20-168">BizTalk Server also depends on SQL Server Analysis Services and SQL Server Integration Services for BAM Analysis and Archiving.</span></span> <span data-ttu-id="e0e20-169">SQL Server 不提供 Integration Services 或 Analysis Services 在 Azure IaaS 中的高可用性解決方案。</span><span class="sxs-lookup"><span data-stu-id="e0e20-169">SQL Server does not provide a high availability solution for Integration Services or Analysis Services in Azure IaaS.</span></span> <span data-ttu-id="e0e20-170">因此建議用於 BAMArchive 和 BAMAnalysis Analysis Services 資料庫中的另一個獨立 SQL Server 執行個體。</span><span class="sxs-lookup"><span data-stu-id="e0e20-170">It is therefore recommended to use another standalone SQL Server instance for the BAMArchive and BAMAnalysis Analysis Services databases.</span></span> <span data-ttu-id="e0e20-171">若為內部部署安裝，SQL 容錯移轉叢集執行個體可用來設定高可用性組態。</span><span class="sxs-lookup"><span data-stu-id="e0e20-171">For on-premises installations, SQL Failover Clustering Instance can be used for setting up a high availability configuration.</span></span> 

<span data-ttu-id="e0e20-172">此組態，如下所示，建議您在可用性群組中的 BizTalk 資料庫：</span><span class="sxs-lookup"><span data-stu-id="e0e20-172">This configuration is illustrated below, and recommended for BizTalk Databases in Availability Groups:</span></span>  

![SQLAG_Recommended](../core/media/sqlag-recommended.png)
 
<span data-ttu-id="e0e20-174">SQL Server 資料庫，以及 BizTalk Server 組態也會建立 SQL Server 安全性登入和 SQL Agent 作業。</span><span class="sxs-lookup"><span data-stu-id="e0e20-174">Along with SQL Server databases, BizTalk Server configuration also creates SQL Server security logins and SQL Agent Jobs.</span></span> <span data-ttu-id="e0e20-175">AlwaysOn 可用性群組只會提供管理資料庫在可用性群組內的能力。</span><span class="sxs-lookup"><span data-stu-id="e0e20-175">AlwaysOn Availability Groups only provide the ability to manage databases inside an Availability Group.</span></span> <span data-ttu-id="e0e20-176">登入和 BizTalk 的 SQL 代理程式作業需要建立並更新/手動管理所有可用性複本上。</span><span class="sxs-lookup"><span data-stu-id="e0e20-176">Logins and SQL Agent Jobs for BizTalk need to be created and updated/managed manually on all the availability replicas.</span></span>  

> [!NOTE]
> <span data-ttu-id="e0e20-177">SQL Server 2016 Service Pack 2 和更新版本的支援 DTC 交易，在相同的可用性群組內的多個資料庫之間。</span><span class="sxs-lookup"><span data-stu-id="e0e20-177">SQL Server 2016 Service Pack 2 and newer supports DTC transactions between multiple databases within the same Availability Group.</span></span> <span data-ttu-id="e0e20-178">BizTalk Server 支援開頭為 CU5 這項功能。</span><span class="sxs-lookup"><span data-stu-id="e0e20-178">BizTalk Server supports this functionality starting with CU5.</span></span>
> <span data-ttu-id="e0e20-179">當使用 SQL Server 2016 Service Pack 2 及更新版本，請設定 BizTalk Server 2016，所有的 BizTalk Server 資料庫可以部署到單一可用性群組。</span><span class="sxs-lookup"><span data-stu-id="e0e20-179">When configuring BizTalk Server 2016 with SQL Server 2016 Service Pack 2 and newer, all BizTalk Server databases can be deployed to a single Availability Group.</span></span>

<span data-ttu-id="e0e20-180">下列清單中的 SQL Server 安全性登入是與 BizTalk Server 相關聯。</span><span class="sxs-lookup"><span data-stu-id="e0e20-180">The following list of SQL Server security logins are associated with BizTalk Server.</span></span> <span data-ttu-id="e0e20-181">您可能必須建立的 BizTalk Server 應用程式的其他登入。</span><span class="sxs-lookup"><span data-stu-id="e0e20-181">You may have additional logins created for your BizTalk Server applications.</span></span> <span data-ttu-id="e0e20-182">如果是這樣，您需要複寫它們在每個裝載 BizTalk 資料庫之複本的 SQL Server 執行個體上。</span><span class="sxs-lookup"><span data-stu-id="e0e20-182">If so, you need to replicate them on every instance of SQL Server hosting a replica of BizTalk databases.</span></span> 

1. <span data-ttu-id="e0e20-183">BizTalk 應用程式使用者 （一或多個對應至每個內含式主控件）</span><span class="sxs-lookup"><span data-stu-id="e0e20-183">BizTalk Application Users (one or more corresponding to each in-proc Host)</span></span> 
2. <span data-ttu-id="e0e20-184">BizTalk 外掛式主控件的使用者 （一或多個對應至每個外掛式主控件）</span><span class="sxs-lookup"><span data-stu-id="e0e20-184">BizTalk Isolated Host Users (one or more corresponding to each Isolated Host)</span></span> 
3. <span data-ttu-id="e0e20-185">BizTalk Server 系統管理員</span><span class="sxs-lookup"><span data-stu-id="e0e20-185">BizTalk Server Administrators</span></span> 
4. <span data-ttu-id="e0e20-186">BizTalk Server B2B 操作員</span><span class="sxs-lookup"><span data-stu-id="e0e20-186">BizTalk Server B2B Operators</span></span> 
5. <span data-ttu-id="e0e20-187">BizTalk Server 操作員</span><span class="sxs-lookup"><span data-stu-id="e0e20-187">BizTalk Server Operators</span></span> 
6. <span data-ttu-id="e0e20-188">SSO 系統管理員</span><span class="sxs-lookup"><span data-stu-id="e0e20-188">SSO Administrators</span></span> 
7. <span data-ttu-id="e0e20-189">BAM 警示使用者</span><span class="sxs-lookup"><span data-stu-id="e0e20-189">BAM Alerts User</span></span> 
8. <span data-ttu-id="e0e20-190">BAM 管理 Web 服務使用者</span><span class="sxs-lookup"><span data-stu-id="e0e20-190">BAM Management Web Service User</span></span> 
9. <span data-ttu-id="e0e20-191">規則引擎更新服務帳戶</span><span class="sxs-lookup"><span data-stu-id="e0e20-191">Rule Engine Update Service Account</span></span> 

<span data-ttu-id="e0e20-192">如果您已建立其他主機，或稍後再建立其他主機，會有此程序的過程中建立新的 SQL 登入。</span><span class="sxs-lookup"><span data-stu-id="e0e20-192">If you have created additional hosts or will create additional hosts later, there will be new SQL logins created as part of this process.</span></span> <span data-ttu-id="e0e20-193">您必須確定對應的複本上手動建立這些 SQL 登入。</span><span class="sxs-lookup"><span data-stu-id="e0e20-193">You must make sure to create these SQL logins manually on the corresponding replicas.</span></span>

<span data-ttu-id="e0e20-194">下列的 SQL Server Agent 作業會與 BizTalk Server 相關聯。</span><span class="sxs-lookup"><span data-stu-id="e0e20-194">The following SQL Server Agent jobs are associated with BizTalk Server.</span></span> <span data-ttu-id="e0e20-195">安裝在每一部伺服器上的作業會安裝及設定的功能而有所不同。</span><span class="sxs-lookup"><span data-stu-id="e0e20-195">The jobs installed on each server are different depending on which features are installed and configured.</span></span> <span data-ttu-id="e0e20-196">大部分的這些作業會在 BizTalk Server 組態期間建立。</span><span class="sxs-lookup"><span data-stu-id="e0e20-196">Most of these jobs are created during BizTalk Server configuration.</span></span> <span data-ttu-id="e0e20-197">設定記錄傳送時，會建立數個項目。</span><span class="sxs-lookup"><span data-stu-id="e0e20-197">Several are created when configuring log shipping.</span></span> <span data-ttu-id="e0e20-198">這些作業需要在其對應的 BizTalk 資料庫的 SQL Server 裝載複本的每個執行個體上複寫。</span><span class="sxs-lookup"><span data-stu-id="e0e20-198">These jobs need to be replicated on each instance of SQL Server hosting replica of their corresponding BizTalk database.</span></span> <span data-ttu-id="e0e20-199">這必須以手動方式執行。</span><span class="sxs-lookup"><span data-stu-id="e0e20-199">This must be performed manually.</span></span> 

- <span data-ttu-id="e0e20-200">BizTalkMgmtDb 作業：</span><span class="sxs-lookup"><span data-stu-id="e0e20-200">BizTalkMgmtDb jobs:</span></span> 
    - <span data-ttu-id="e0e20-201">備份 BizTalk Server (BizTalkMgmtDb)</span><span class="sxs-lookup"><span data-stu-id="e0e20-201">Backup BizTalk Server (BizTalkMgmtDb)</span></span> 
    - <span data-ttu-id="e0e20-202">CleanupBTFExpiredEntriesJob_BizTalkMgmtDb</span><span class="sxs-lookup"><span data-stu-id="e0e20-202">CleanupBTFExpiredEntriesJob_BizTalkMgmtDb</span></span> 
    - <span data-ttu-id="e0e20-203">監控 BizTalk Server (BizTalkMgmtDb)</span><span class="sxs-lookup"><span data-stu-id="e0e20-203">Monitor BizTalk Server (BizTalkMgmtDb)</span></span> 
- <span data-ttu-id="e0e20-204">BizTalkMsgBoxDb 作業：</span><span class="sxs-lookup"><span data-stu-id="e0e20-204">BizTalkMsgBoxDb jobs:</span></span> 
    - <span data-ttu-id="e0e20-205">MessageBox_DeadProcesses_Cleanup_BizTalkMsgBoxDb</span><span class="sxs-lookup"><span data-stu-id="e0e20-205">MessageBox_DeadProcesses_Cleanup_BizTalkMsgBoxDb</span></span> 
    - <span data-ttu-id="e0e20-206">MessageBox_Message_Cleanup_BizTalkMsgBoxDb</span><span class="sxs-lookup"><span data-stu-id="e0e20-206">MessageBox_Message_Cleanup_BizTalkMsgBoxDb</span></span>
    - <span data-ttu-id="e0e20-207">MessageBox_Message_ManageRefCountLog_BizTalkMsgBoxDb</span><span class="sxs-lookup"><span data-stu-id="e0e20-207">MessageBox_Message_ManageRefCountLog_BizTalkMsgBoxDb</span></span>
    - <span data-ttu-id="e0e20-208">MessageBox_Parts_Cleanup_BizTalkMsgBoxDb</span><span class="sxs-lookup"><span data-stu-id="e0e20-208">MessageBox_Parts_Cleanup_BizTalkMsgBoxDb</span></span> 
    - <span data-ttu-id="e0e20-209">MessageBox_UpdateStats_BizTalkMsgBoxDb</span><span class="sxs-lookup"><span data-stu-id="e0e20-209">MessageBox_UpdateStats_BizTalkMsgBoxDb</span></span> 
    - <span data-ttu-id="e0e20-210">Operations_OperateOnInstances_OnMaster_BizTalkMsgBoxDb</span><span class="sxs-lookup"><span data-stu-id="e0e20-210">Operations_OperateOnInstances_OnMaster_BizTalkMsgBoxDb</span></span> 
    - <span data-ttu-id="e0e20-211">PurgeSubscriptionsJob_BizTalkMsgBoxDb</span><span class="sxs-lookup"><span data-stu-id="e0e20-211">PurgeSubscriptionsJob_BizTalkMsgBoxDb</span></span> 
    - <span data-ttu-id="e0e20-212">TrackedMessages_Copy_BizTalkMsgBoxDb</span><span class="sxs-lookup"><span data-stu-id="e0e20-212">TrackedMessages_Copy_BizTalkMsgBoxDb</span></span> 
- <span data-ttu-id="e0e20-213">在其他 msgboxes 上的作業</span><span class="sxs-lookup"><span data-stu-id="e0e20-213">Jobs on additional msgboxes</span></span>
- <span data-ttu-id="e0e20-214">BizTalkDTADb 作業：</span><span class="sxs-lookup"><span data-stu-id="e0e20-214">BizTalkDTADb job:</span></span> 
    - <span data-ttu-id="e0e20-215">DTA 清除與封存 (BizTalkDTADb)</span><span class="sxs-lookup"><span data-stu-id="e0e20-215">DTA Purge and Archive (BizTalkDTADb)</span></span> 
- <span data-ttu-id="e0e20-216">BizTalkRulesEngineDb 作業：</span><span class="sxs-lookup"><span data-stu-id="e0e20-216">BizTalkRulesEngineDb job:</span></span> 
    - <span data-ttu-id="e0e20-217">Rules_Database_Cleanup_BizTalkRuleEngineDb</span><span class="sxs-lookup"><span data-stu-id="e0e20-217">Rules_Database_Cleanup_BizTalkRuleEngineDb</span></span> 
- <span data-ttu-id="e0e20-218">BAMAlertsApplication 作業：</span><span class="sxs-lookup"><span data-stu-id="e0e20-218">BAMAlertsApplication job:</span></span> 
    - <span data-ttu-id="e0e20-219">0 或更多的 DelAlertHistJob</span><span class="sxs-lookup"><span data-stu-id="e0e20-219">0 or more DelAlertHistJob</span></span> 

<span data-ttu-id="e0e20-220">不同於 SQL 容錯移轉叢集執行個體，在可用性群組中所有複本都是作用中、 正在執行且可用。</span><span class="sxs-lookup"><span data-stu-id="e0e20-220">Unlike SQL Failover Clustering Instances, in Availability Groups all replicas are active, running, and available.</span></span> <span data-ttu-id="e0e20-221">當 SQL Agent 作業會在容錯移轉的每個複本上重複時，它們會針對對應的複本，不論它是否目前在主要角色 」 或 「 次要角色中執行。</span><span class="sxs-lookup"><span data-stu-id="e0e20-221">When SQL Agent jobs are duplicated on each replica for failover, they run against the corresponding replica, irrespective of whether it is currently in primary role or secondary role.</span></span> <span data-ttu-id="e0e20-222">若要確定目前的主要複本上才會執行這些工作，每個作業中的每個步驟必須加上如果在區塊內，如所示：</span><span class="sxs-lookup"><span data-stu-id="e0e20-222">To make sure these jobs are executed only on the current primary replica, every step in every job must be enclosed within an IF block, as shown:</span></span> 

    ```
    IF (sys.fn_hadr_is_primary_replica(‘dbname’) = 1)  
    BEGIN  
    …  
    END
    ```
  
<span data-ttu-id="e0e20-223">取代`‘dbname’`與對應的資料庫名稱對其執行設定作業。</span><span class="sxs-lookup"><span data-stu-id="e0e20-223">Replace `‘dbname’` with the corresponding database name against which the job is configured to run.</span></span> <span data-ttu-id="e0e20-224">下列範例會顯示這項變更的 TrackedMessages_Copy_BizTalkMsgBoxDb BizTalkMsgBoxDb 上：</span><span class="sxs-lookup"><span data-stu-id="e0e20-224">The following example shows this change for TrackedMessages_Copy_BizTalkMsgBoxDb on BizTalkMsgBoxDb:</span></span> 
 
 ![SQLAG_AgentJob](../core/media/sqlag-agentjob.gif)

### <a name="configure-biztalk-when-availability-groups-are-already-set-up"></a><span data-ttu-id="e0e20-226">已經設定可用性群組時，將 BizTalk 設定</span><span class="sxs-lookup"><span data-stu-id="e0e20-226">Configure BizTalk when Availability Groups are already set up</span></span>

1. <span data-ttu-id="e0e20-227">請檢查您的作業系統需求：</span><span class="sxs-lookup"><span data-stu-id="e0e20-227">Check your OS requirements:</span></span> 
2. <span data-ttu-id="e0e20-228">在所有**Windows Server 2012 R2**的電腦，安裝[3090973 MSDTC hotfix](https://support.microsoft.com/kb/3090973) （開啟知識庫文章）</span><span class="sxs-lookup"><span data-stu-id="e0e20-228">On all **Windows Server 2012 R2** computers, install the [3090973 MSDTC hotfix](https://support.microsoft.com/kb/3090973) (opens a KB article)</span></span>
3. <span data-ttu-id="e0e20-229">在所有**Windows Server 2016**電腦，可以讓[RemoteAccessEnabled 登錄機碼](https://support.microsoft.com/kb/3182294)（開啟知識庫文章）</span><span class="sxs-lookup"><span data-stu-id="e0e20-229">On all **Windows Server 2016** computers, enable the [RemoteAccessEnabled registry key](https://support.microsoft.com/kb/3182294) (opens a KB article)</span></span>
4. <span data-ttu-id="e0e20-230">請務必擁有至少四個不同 SQL 執行個體將主控各種不同的 BizTalk 資料庫。</span><span class="sxs-lookup"><span data-stu-id="e0e20-230">Make sure to have at least four different SQL instances which will host the various BizTalk databases.</span></span> <span data-ttu-id="e0e20-231">次要複本應該也會設定在不同的 SQL 執行個體。</span><span class="sxs-lookup"><span data-stu-id="e0e20-231">The secondary replicas should also be set up on different SQL instances.</span></span> <span data-ttu-id="e0e20-232">這會導致最少 8 個 SQL 執行個體 （1 個主要和 1 個次要複本的每 4 個執行個體），以及至少 4 個可用性群組。</span><span class="sxs-lookup"><span data-stu-id="e0e20-232">This results in a minimum of 8 SQL instances (1 primary and 1 secondary replica for each of the 4 instances), and a minimum of 4 Availability Groups.</span></span> <span data-ttu-id="e0e20-233">請參閱上面的圖例中針對此可用性群組設定。</span><span class="sxs-lookup"><span data-stu-id="e0e20-233">See the above illustration for this Availability Group configuration.</span></span> <span data-ttu-id="e0e20-234">請確定可用性群組會建立具有**每個資料庫 DTC 支援**選項，如這稍後無法變更。</span><span class="sxs-lookup"><span data-stu-id="e0e20-234">Make sure Availability Groups are created with the **Per Database DTC Support** option as this cannot be changed later.</span></span> 
5. <span data-ttu-id="e0e20-235">當設定 BizTalk Server，並指定 SQL 伺服器名稱，而不是實際的電腦名稱上使用可用性群組的接聽程式名稱。</span><span class="sxs-lookup"><span data-stu-id="e0e20-235">When configuring BizTalk Server and specifying the SQL server name, use the Availability Group’s listener name instead of the actual machine name.</span></span> <span data-ttu-id="e0e20-236">這會在目前的主要複本上建立的 BizTalk 資料庫、 登入和 SQL Agent 作業。</span><span class="sxs-lookup"><span data-stu-id="e0e20-236">This creates the BizTalk databases, logins, and SQL Agent jobs on the current primary replica.</span></span> 
6. <span data-ttu-id="e0e20-237">停止 BizTalk 處理 （主控件執行個體，SSO 服務、 IIS、 規則引擎更新服務、 BAMAlerts 服務等等），並停止 SQL Agent 作業。</span><span class="sxs-lookup"><span data-stu-id="e0e20-237">Stop BizTalk processing (Host Instances, SSO Service, IIS, Rules Engine Update Service, BAMAlerts Service, and so on), and stop the SQL Agent Jobs.</span></span> 
7. <span data-ttu-id="e0e20-238">現在加入個別的可用性群組的 BIzTalk 資料庫。</span><span class="sxs-lookup"><span data-stu-id="e0e20-238">Now add BIzTalk databases to the respective Availability Groups.</span></span> 
8. <span data-ttu-id="e0e20-239">括住主體內的 SQL Agent 作業步驟`IF`（先前所述） 來確定它們執行只有當目標為主要複本的區塊。</span><span class="sxs-lookup"><span data-stu-id="e0e20-239">Enclose body of SQL Agent job steps within `IF` block (mentioned previously) to make sure they run only if the target is the primary replica.</span></span> 
9. <span data-ttu-id="e0e20-240">編寫登入和 SQL Agent 作業，才能將它們對應的複本上的複寫。</span><span class="sxs-lookup"><span data-stu-id="e0e20-240">Script Logins and SQL Agent Jobs to replicate them on corresponding replica.</span></span> 
10. <span data-ttu-id="e0e20-241">複寫的 SQL DBMail 設定檔和對應的 SQL 執行個體裝載次要複本上 BAM 警示的帳戶。</span><span class="sxs-lookup"><span data-stu-id="e0e20-241">Replicate SQL DBMail Profile and Account for BAM Alerts on corresponding SQL instances hosting the secondary replica.</span></span> 
11. <span data-ttu-id="e0e20-242">如果您要加入其他的 message box 資料庫，或部署新 BAM 活動/檢視更新版本中，新增 SQL 作業會建立新的訊息方塊資料庫或目前的主要複本上的 BAM 警示資料庫。</span><span class="sxs-lookup"><span data-stu-id="e0e20-242">If you are adding an additional message box database or deploying a new BAM activity/view later, then new SQL jobs are created for new message box databases or BAM Alerts database on the current primary replica.</span></span> <span data-ttu-id="e0e20-243">請確定主要複本上進行編輯，然後在對應的次要複本上手動建立它們。</span><span class="sxs-lookup"><span data-stu-id="e0e20-243">Make sure to edit it on primary replica, and then create them manually on the corresponding secondary replicas.</span></span> 

<span data-ttu-id="e0e20-244">這項設定還可以使用裝載主要複本的 SQL 執行個體。</span><span class="sxs-lookup"><span data-stu-id="e0e20-244">This configuration can also be done using the SQL Instances hosting the primary replica.</span></span> <span data-ttu-id="e0e20-245">在此情況下，BizTalk 設定之後，執行`UpdateDatabase.vbs`和`UpdateRegistry.vbs`完成上述步驟之後的 BizTalk 機器上的指令碼。</span><span class="sxs-lookup"><span data-stu-id="e0e20-245">In this case, after the BizTalk configuration, run the `UpdateDatabase.vbs` and `UpdateRegistry.vbs` scripts on the BizTalk machines after the above steps.</span></span> <span data-ttu-id="e0e20-246">這會在下一節中詳細討論。</span><span class="sxs-lookup"><span data-stu-id="e0e20-246">This is discussed in more detail in the next section.</span></span>  
 
### <a name="move-existing-biztalk-databases-to-availability-groups"></a><span data-ttu-id="e0e20-247">將現有的 BizTalk 資料庫移至可用性群組</span><span class="sxs-lookup"><span data-stu-id="e0e20-247">Move existing BizTalk databases to Availability Groups</span></span>

1. <span data-ttu-id="e0e20-248">請檢查您的作業系統需求：</span><span class="sxs-lookup"><span data-stu-id="e0e20-248">Check your OS requirements:</span></span> 
2. <span data-ttu-id="e0e20-249">在所有**Windows Server 2012 R2**的電腦，安裝[3090973 MSDTC hotfix](https://support.microsoft.com/kb/3090973) （開啟知識庫文章）</span><span class="sxs-lookup"><span data-stu-id="e0e20-249">On all **Windows Server 2012 R2** computers, install the [3090973 MSDTC hotfix](https://support.microsoft.com/kb/3090973) (opens a KB article)</span></span>
3. <span data-ttu-id="e0e20-250">在所有**Windows Server 2016**電腦，可以讓[RemoteAccessEnabled 登錄機碼](https://support.microsoft.com/kb/3182294)（開啟知識庫文章）</span><span class="sxs-lookup"><span data-stu-id="e0e20-250">On all **Windows Server 2016** computers, enable the [RemoteAccessEnabled registry key](https://support.microsoft.com/kb/3182294) (opens a KB article)</span></span>
4. <span data-ttu-id="e0e20-251">請務必擁有至少四個不同 SQL 執行個體將主控各種不同的 BizTalk 資料庫。</span><span class="sxs-lookup"><span data-stu-id="e0e20-251">Make sure to have at least four different SQL instances which will host the various BizTalk databases.</span></span> <span data-ttu-id="e0e20-252">次要複本應該也會設定在不同的 SQL 執行個體。</span><span class="sxs-lookup"><span data-stu-id="e0e20-252">The secondary replicas should also be set up on different SQL instances.</span></span> <span data-ttu-id="e0e20-253">這會導致最少 8 個 SQL 執行個體 （1 個主要和 1 個次要複本的每 4 個執行個體），以及至少 4 個可用性群組。</span><span class="sxs-lookup"><span data-stu-id="e0e20-253">This results in a minimum of 8 SQL instances (1 primary and 1 secondary replica for each of the 4 instances), and a minimum of 4 Availability Groups.</span></span> <span data-ttu-id="e0e20-254">請參閱上面的圖例中針對此可用性群組設定。</span><span class="sxs-lookup"><span data-stu-id="e0e20-254">See the above illustration for this Availability Group configuration.</span></span> <span data-ttu-id="e0e20-255">請確定可用性群組會建立具有**每個資料庫 DTC 支援**選項，如這稍後無法變更。</span><span class="sxs-lookup"><span data-stu-id="e0e20-255">Make sure Availability Groups are created with **Per Database DTC Support** option as this cannot be changed later.</span></span>  
5. <span data-ttu-id="e0e20-256">停止 BizTalk 處理程序和 SQL Agent 作業。</span><span class="sxs-lookup"><span data-stu-id="e0e20-256">Stop BizTalk processing and SQL Agent Jobs.</span></span> 
6. <span data-ttu-id="e0e20-257">執行完整備份所有 BizTalk 資料庫。</span><span class="sxs-lookup"><span data-stu-id="e0e20-257">Perform full backup of all BizTalk Databases.</span></span> 
7. <span data-ttu-id="e0e20-258">還原目前在可用性群組中的主要角色中的 SQL 執行個體上的 BizTalk 資料庫。</span><span class="sxs-lookup"><span data-stu-id="e0e20-258">Restore BizTalk databases on the SQL instances currently in the primary role in the Availability Group.</span></span> 
8. <span data-ttu-id="e0e20-259">指令碼登入 」 和 「 SQL 代理程式目前在可用性群組中的主要角色中的對應 SQL 執行個體上的作業。</span><span class="sxs-lookup"><span data-stu-id="e0e20-259">Script Logins and SQL Agent jobs on corresponding SQL Instances currently in the primary role in the Availability Group.</span></span>  
9. <span data-ttu-id="e0e20-260">執行`UpdateDatabase.vbs`和`UpdateRegistry.vbs`使用下列步驟在 BizTalk 機器上的指令碼。</span><span class="sxs-lookup"><span data-stu-id="e0e20-260">Run the `UpdateDatabase.vbs` and `UpdateRegistry.vbs` scripts on the BizTalk machines using the following steps.</span></span> <span data-ttu-id="e0e20-261">輸入可用性群組接聽程式做為輸入的更新資訊的 xml 中新的伺服器名稱。</span><span class="sxs-lookup"><span data-stu-id="e0e20-261">Enter the Availability Group Listener as the new server name in the input update info xml.</span></span>  
    1. <span data-ttu-id="e0e20-262">在 BizTalk Server 上停止所有 BizTalk 服務和企業單一登入服務。</span><span class="sxs-lookup"><span data-stu-id="e0e20-262">Stop all BizTalk services and Enterprise SSO services on BizTalk Server.</span></span> <span data-ttu-id="e0e20-263">SQL Server 上停止 SQL Agent 服務。</span><span class="sxs-lookup"><span data-stu-id="e0e20-263">Stop SQL Agent Service on SQL Server.</span></span> 
    2. <span data-ttu-id="e0e20-264">在 BizTalk 伺服器上，編輯 SampleUpdateInfo.xml 下列資料夾中：</span><span class="sxs-lookup"><span data-stu-id="e0e20-264">On BizTalk Server, edit SampleUpdateInfo.xml in the following folder:</span></span> 
 
        <span data-ttu-id="e0e20-265">32 位元電腦： `%SystemRoot%\Program Files\Microsoft BizTalk Server 20xx\Schema\Restore`</span><span class="sxs-lookup"><span data-stu-id="e0e20-265">32-bit computer: `%SystemRoot%\Program Files\Microsoft BizTalk Server 20xx\Schema\Restore`</span></span>
 
        <span data-ttu-id="e0e20-266">64 位元電腦： `%SystemRoot%\Program Files (x86)\Microsoft BizTalk Server 20xx\Bins32\Schema\Restore`</span><span class="sxs-lookup"><span data-stu-id="e0e20-266">64-bit computer: `%SystemRoot%\Program Files (x86)\Microsoft BizTalk Server 20xx\Bins32\Schema\Restore`</span></span>
 
            1. Replace "SourceServer" with the source server name (old SQL Server hosting old databases).  
            2. Replace "DestinationServer" with the name of the destination server, which should be the availability group listener name.  
            3. If you have the BAMAnalysis, BAM databases or RuleEngineDB, uncomment the appropriate sections. 

    3. <span data-ttu-id="e0e20-267">開啟命令提示字元，並移至：</span><span class="sxs-lookup"><span data-stu-id="e0e20-267">Open a command prompt, and go to:</span></span> 
 
        <span data-ttu-id="e0e20-268">32 位元電腦： `%SystemRoot%\Program Files\Microsoft BizTalk Server 20xx\Schema\Restore`</span><span class="sxs-lookup"><span data-stu-id="e0e20-268">32-bit computer: `%SystemRoot%\Program Files\Microsoft BizTalk Server 20xx\Schema\Restore`</span></span> 
 
        <span data-ttu-id="e0e20-269">64 位元電腦： `%SystemRoot%\Program Files (x86)\Microsoft BizTalk Server 20xx\Bins32\Schema\Restore`</span><span class="sxs-lookup"><span data-stu-id="e0e20-269">64-bit computer: `%SystemRoot%\Program Files (x86)\Microsoft BizTalk Server 20xx\Bins32\Schema\Restore`</span></span> 
 
        <span data-ttu-id="e0e20-270">在命令提示字元中，執行：</span><span class="sxs-lookup"><span data-stu-id="e0e20-270">At the command prompt, run:</span></span>  
    `cscript UpdateDatabase.vbs SampleUpdateInfo.xml`  
 
        <span data-ttu-id="e0e20-271">在 BizTalk 群組中只有一部伺服器上執行 UpdateDatabase.vbs。</span><span class="sxs-lookup"><span data-stu-id="e0e20-271">Run UpdateDatabase.vbs on only one server in the BizTalk group.</span></span> 

    4. <span data-ttu-id="e0e20-272">已編輯的 SampleUpdateInfo.xml 檔案複製到此 BizTalk 群組中每個 BizTalk Server 電腦上的下列資料夾：</span><span class="sxs-lookup"><span data-stu-id="e0e20-272">Copy the edited SampleUpdateInfo.xml file to the following folder on every BizTalk Server computer in this BizTalk group:</span></span> 
 
        <span data-ttu-id="e0e20-273">32 位元電腦： `%SystemRoot%\Program Files\Microsoft BizTalk Server 20xx\Schema\Restore`</span><span class="sxs-lookup"><span data-stu-id="e0e20-273">32-bit computer: `%SystemRoot%\Program Files\Microsoft BizTalk Server 20xx\Schema\Restore`</span></span> 
 
        <span data-ttu-id="e0e20-274">64 位元電腦： `%SystemRoot%\Program Files (x86)\Microsoft BizTalk Server 20xx\Bins32\Schema\Restore`</span><span class="sxs-lookup"><span data-stu-id="e0e20-274">64-bit computer: `%SystemRoot%\Program Files (x86)\Microsoft BizTalk Server 20xx\Bins32\Schema\Restore`</span></span> 
 
    5. <span data-ttu-id="e0e20-275">每一部 BizTalk Server 群組中，開啟命令提示字元，並移至：</span><span class="sxs-lookup"><span data-stu-id="e0e20-275">On each computer in the BizTalk Server group, open a command prompt, and go to:</span></span> 
 
        <span data-ttu-id="e0e20-276">32 位元電腦： `%SystemRoot%\Program Files\Microsoft BizTalk Server 20xx\Schema\Restore`</span><span class="sxs-lookup"><span data-stu-id="e0e20-276">32-bit computer: `%SystemRoot%\Program Files\Microsoft BizTalk Server 20xx\Schema\Restore`</span></span>
 
        <span data-ttu-id="e0e20-277">64 位元電腦： `%SystemRoot%\Program Files (x86)\Microsoft BizTalk Server 20xx\Bins32\Schema\Restore`</span><span class="sxs-lookup"><span data-stu-id="e0e20-277">64-bit computer: `%SystemRoot%\Program Files (x86)\Microsoft BizTalk Server 20xx\Bins32\Schema\Restore`</span></span> 
 
        <span data-ttu-id="e0e20-278">在命令提示字元中，執行：</span><span class="sxs-lookup"><span data-stu-id="e0e20-278">At the command prompt, run:</span></span>  
    `cscript UpdateRegistry.vbs SampleUpdateInfo.xml` 
 
        <span data-ttu-id="e0e20-279">在 BizTalk 群組中的每一部伺服器上執行 UpdateRegistry.vbs。</span><span class="sxs-lookup"><span data-stu-id="e0e20-279">Run UpdateRegistry.vbs on every server in the BizTalk group.</span></span> 
 
10. <span data-ttu-id="e0e20-280">現在，將資料庫移到個別的可用性群組。</span><span class="sxs-lookup"><span data-stu-id="e0e20-280">Now move the databases to their respective Availability Groups.</span></span> 
11. <span data-ttu-id="e0e20-281">SQL DBMail 設定檔和帳戶 BAM 警示的 sql 執行個體裝載 BAMAlerts 資料庫之複本的複寫。</span><span class="sxs-lookup"><span data-stu-id="e0e20-281">Replicate the SQL DBMail Profile and Account for BAM Alerts on the SQL instances hosting the replica of the BAMAlerts database.</span></span> 
12. <span data-ttu-id="e0e20-282">將 SQL Agent 作業步驟，以確定它們的目標是主要時，才執行 IF 區塊內的主體。</span><span class="sxs-lookup"><span data-stu-id="e0e20-282">Enclose the body of SQL Agent job steps within an IF block to make sure they run only if the target is the primary.</span></span> 
13. <span data-ttu-id="e0e20-283">編寫登入和 SQL Agent 作業，才能將它們對應的複本上的複寫。</span><span class="sxs-lookup"><span data-stu-id="e0e20-283">Script Logins and SQL Agent Jobs to replicate them on the corresponding replica.</span></span> <span data-ttu-id="e0e20-284">UpdateDatabase 指令碼也會更新 Operations_OperateOnInstances_OnMaster_BizTalkMsgBoxDb 和 TrackedMessages_Copy_BizTalkMsgBoxDb 作業中的伺服器名稱。</span><span class="sxs-lookup"><span data-stu-id="e0e20-284">The UpdateDatabase script also updates the server name in the Operations_OperateOnInstances_OnMaster_BizTalkMsgBoxDb and TrackedMessages_Copy_BizTalkMsgBoxDb jobs.</span></span> <span data-ttu-id="e0e20-285">這樣的指令碼執行 UpdateDatabase 指令碼之後，只有 SQL Agent 作業。</span><span class="sxs-lookup"><span data-stu-id="e0e20-285">So script the SQL Agent Jobs only after running the UpdateDatabase script.</span></span> 

## <a name="requirements"></a><span data-ttu-id="e0e20-286">需求</span><span class="sxs-lookup"><span data-stu-id="e0e20-286">Requirements</span></span> 
* <span data-ttu-id="e0e20-287">BizTalk Server 2016 Enterprise</span><span class="sxs-lookup"><span data-stu-id="e0e20-287">BizTalk Server 2016 Enterprise</span></span>
* <span data-ttu-id="e0e20-288">SQL Server 2016 Enterprise 或 SQL Server 2016 Standard (請參閱**已知限制**本主題中)</span><span class="sxs-lookup"><span data-stu-id="e0e20-288">SQL Server 2016 Enterprise or SQL Server 2016 Standard (see **Known limitations** in this topic)</span></span>
* <span data-ttu-id="e0e20-289">Windows Server 2012 R2 或 Windows Server 2016</span><span class="sxs-lookup"><span data-stu-id="e0e20-289">Windows Server 2012 R2 or Windows Server 2016</span></span> 

### <a name="availability-group-listener-configured-with-non-default-port-1433"></a><span data-ttu-id="e0e20-290">使用非預設設定的可用性群組接聽程式通訊埠 (1433)</span><span class="sxs-lookup"><span data-stu-id="e0e20-290">Availability Group Listener configured with non-default port (1433)</span></span> 
<span data-ttu-id="e0e20-291">使用 SQL 別名在 BizTalk Server 電腦上。</span><span class="sxs-lookup"><span data-stu-id="e0e20-291">Use SQL alias on BizTalk Server machines.</span></span> 

### <a name="support-availability-group-multi-subnet-failovers"></a><span data-ttu-id="e0e20-292">支援可用性群組多重子網路容錯移轉</span><span class="sxs-lookup"><span data-stu-id="e0e20-292">Support Availability Group Multi-Subnet Failovers</span></span> 
<span data-ttu-id="e0e20-293">BizTalk Server 會使用 Microsoft OLE DB 的資料庫連線，不支援**MultiSubnetFailover**連接選項。</span><span class="sxs-lookup"><span data-stu-id="e0e20-293">BizTalk Server uses Microsoft OLE DB for database connections, which does not support the **MultiSubnetFailover** connection option.</span></span> <span data-ttu-id="e0e20-294">BizTalk Server 不支援`MultiSubnetFailover (=TRUE)`連接選項，而這可能會導致在多重子網路容錯移轉期間更高的復原時間。</span><span class="sxs-lookup"><span data-stu-id="e0e20-294">BizTalk Server does not support the `MultiSubnetFailover (=TRUE)` connection option, and this may cause higher recovery time during multi-subnet failover.</span></span> 

### <a name="read-only-routing"></a><span data-ttu-id="e0e20-295">唯讀路由</span><span class="sxs-lookup"><span data-stu-id="e0e20-295">Read-Only Routing</span></span> 
<span data-ttu-id="e0e20-296">唯讀路由是指 SQL Server 可用性群組接聽程式的內送連接路由至次要複本設定為允許唯讀工作負載的能力。</span><span class="sxs-lookup"><span data-stu-id="e0e20-296">Read-only routing refers to the ability of SQL Server to route incoming connections for an availability group listener to a secondary replica that is configured to allow read-only workloads.</span></span> 

<span data-ttu-id="e0e20-297">BizTalk 不使用唯讀路由的任何資料庫的連接。</span><span class="sxs-lookup"><span data-stu-id="e0e20-297">BizTalk does not use Read-Only Routing for any of the connections to its databases.</span></span> <span data-ttu-id="e0e20-298">這表示可用性複本上可用性群組中的 「 可讀取次要複本 」 選項 BizTalk 資料庫連接上沒有任何影響。</span><span class="sxs-lookup"><span data-stu-id="e0e20-298">This means the “Readable Secondary” option on Availability Replicas in the availability group does not have any impact on BizTalk database connections.</span></span> 

### <a name="behavior-of-biztalk-host-instances-during-sql-server-failover"></a><span data-ttu-id="e0e20-299">SQL Server 容錯移轉期間的 BizTalk 主控件執行個體的行為</span><span class="sxs-lookup"><span data-stu-id="e0e20-299">Behavior of BizTalk Host Instances during SQL Server Failover</span></span> 
<span data-ttu-id="e0e20-300">如果 SQL Server 可用性群組發生容錯移轉，可用性群組上的 BizTalk Server 資料庫會暫時無法使用。</span><span class="sxs-lookup"><span data-stu-id="e0e20-300">If the SQL Server availability group experiences a failover, the BizTalk Server databases on the availability group are temporarily unavailable.</span></span> 

#### <a name="behavior-of-in-process-host-instances-during-sql-server-failover"></a><span data-ttu-id="e0e20-301">SQL Server 容錯移轉期間的內含式主控件執行個體行為</span><span class="sxs-lookup"><span data-stu-id="e0e20-301">Behavior of In-Process Host Instances during SQL Server Failover</span></span> 
<span data-ttu-id="e0e20-302">如果無法使用 BizTalk Server 資料庫，然後內含式 BizTalk Server 主控件執行個體就會回收直到 SQL Server 的連線還原為止。</span><span class="sxs-lookup"><span data-stu-id="e0e20-302">If the BizTalk Server databases are unavailable, then an in-process instance of a BizTalk Server host is recycled until the connection to the SQL Server is restored.</span></span> <span data-ttu-id="e0e20-303">一旦還原 SQL Server 資料庫的連接之後，繼續正常處理文件。</span><span class="sxs-lookup"><span data-stu-id="e0e20-303">Once the connection to the SQL Server databases is restored, document processing resumes normally.</span></span>
 
#### <a name="behavior-of-isolated-host-instances-during-sql-server-failover"></a><span data-ttu-id="e0e20-304">SQL Server 容錯移轉期間的外掛式主控件執行個體行為</span><span class="sxs-lookup"><span data-stu-id="e0e20-304">Behavior of Isolated Host Instances During SQL Server Failover</span></span> 
<span data-ttu-id="e0e20-305">如果 BizTalk Server 資料庫無法使用，便會暫停，BizTalk Server 主控件的隔離執行個體，並在 BizTalk Server 應用程式記錄檔中會產生類似下面的錯誤：</span><span class="sxs-lookup"><span data-stu-id="e0e20-305">If the BizTalk Server databases are unavailable, then an isolated instance of a BizTalk Server host pauses, and an error similar to the following is generated in the BizTalk Server Application log:</span></span> 

    All receive locations are being temporarily disabled because either the MessageBox or Configuration database is not available. When these databases become available, the receive locations will be automatically enabled.
 
<span data-ttu-id="e0e20-306">一旦還原 SQL Server 資料庫的連接之後，如下所示的告知性訊息寫入至 BizTalk Server 應用程式記錄檔和文件處理然後繼續正常：</span><span class="sxs-lookup"><span data-stu-id="e0e20-306">Once the connection to the SQL Server databases is restored, an informational message similar to the following is written to the BizTalk Server Application log, and then document processing resumes normally:</span></span> 

    All receive locations are being enabled because both the MessageBox and Configuration databases are back online.

#### <a name="log-shipping-for-disaster-recovery"></a><span data-ttu-id="e0e20-307">記錄傳送災害復原</span><span class="sxs-lookup"><span data-stu-id="e0e20-307">Log Shipping for Disaster Recovery</span></span> 
<span data-ttu-id="e0e20-308">BizTalk Server 實作資料庫待命的功能，透過使用資料庫記錄傳送。</span><span class="sxs-lookup"><span data-stu-id="e0e20-308">BizTalk Server implements database standby capabilities through the use of database log shipping.</span></span> <span data-ttu-id="e0e20-309">BizTalk Server 記錄傳送自動備份和還原的資料庫和其交易記錄檔，可讓待命伺服器，在繼續處理資料庫的生產環境資料庫伺服器的事件中，就會失敗。</span><span class="sxs-lookup"><span data-stu-id="e0e20-309">BizTalk Server log shipping automates the backup and restore of databases and their transaction log files, allowing a standby server to resume database processing in the event that the production database server fails.</span></span> 

<span data-ttu-id="e0e20-310">**可用性群組中的次要資料庫不是備份。**</span><span class="sxs-lookup"><span data-stu-id="e0e20-310">**Secondary databases in availability group are not backups.**</span></span> <span data-ttu-id="e0e20-311">繼續備份 BizTalk 資料庫，而其交易記錄使用 BizTalk Server 記錄傳送作業。</span><span class="sxs-lookup"><span data-stu-id="e0e20-311">Continue to backup BizTalk databases and their transaction logs using BizTalk Server Log Shipping jobs.</span></span> <span data-ttu-id="e0e20-312">BizTalk 記錄傳送實作的方式可確保一律會針對每個資料庫的目前主要複本執行備份。</span><span class="sxs-lookup"><span data-stu-id="e0e20-312">The way BizTalk Log Shipping is implemented ensures that backups are always performed against the current primary replica of every database.</span></span> <span data-ttu-id="e0e20-313">BizTalk Server 記錄傳送作業不會接受在可用性群組備份喜好設定。</span><span class="sxs-lookup"><span data-stu-id="e0e20-313">The backup preference setting on the availability group is not honored by the BizTalk Server Log Shipping jobs.</span></span> 

<span data-ttu-id="e0e20-314">如果您要新增其他 BizTalk 資料庫至 BizTalk 資料庫備份作業，請務必使用可用性群組接聽程式名稱做為資料庫伺服器，為他們設定備份時。</span><span class="sxs-lookup"><span data-stu-id="e0e20-314">If you are adding other BizTalk databases to the BizTalk Databases Backup job, be sure to use the Availability Group Listener name as the database server for them when setting up the Backup.</span></span>  
 
## <a name="references"></a><span data-ttu-id="e0e20-315">參考</span><span class="sxs-lookup"><span data-stu-id="e0e20-315">References</span></span> 
 
* [<span data-ttu-id="e0e20-316">為 BizTalk Server 資料庫提供高可用性</span><span class="sxs-lookup"><span data-stu-id="e0e20-316">Providing High Availability for BizTalk Server Databases</span></span>](../core/providing-high-availability-for-biztalk-server-databases.md)  
* [<span data-ttu-id="e0e20-317">Microsoft Azure 虛擬機器的 Microsoft 伺服器軟體支援</span><span class="sxs-lookup"><span data-stu-id="e0e20-317">Microsoft server software support for Microsoft Azure virtual machines</span></span>](https://support.microsoft.com/kb/2721672)  
* [<span data-ttu-id="e0e20-318">SQL Server 資料庫鏡像、磁碟區陰影複製服務和 AlwaysOn</span><span class="sxs-lookup"><span data-stu-id="e0e20-318">SQL Server database mirroring, Volume Shadow Copy service and AlwaysOn</span></span>](../core/sql-server-database-mirroring-volume-shadow-copy-service-and-alwayson.md)  
* [<span data-ttu-id="e0e20-319">AlwaysOn 可用性群組 (SQL Server) 概觀</span><span class="sxs-lookup"><span data-stu-id="e0e20-319">Overview of AlwaysOn Availability Groups (SQL Server)</span></span>](https://msdn.microsoft.com/library/ff877884.aspx)  
* [<span data-ttu-id="e0e20-320">跨資料庫交易支援資料庫鏡像或 AlwaysOn 可用性群組 (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="e0e20-320">Cross-Database Transactions Support For Database Mirroring or AlwaysOn Availability Groups (SQL Server)</span></span>](https://msdn.microsoft.com/library/ms366279.aspx)  
* [<span data-ttu-id="e0e20-321">當 SQL Server 收到 Windows Server 2012 R2 中的 MSDTC 交易結果時，不能呼叫 reenlist</span><span class="sxs-lookup"><span data-stu-id="e0e20-321">Reenlist can't be called when SQL Server receives transaction outcome from MSDTC in Windows Server 2012 R2</span></span>](https://support.microsoft.com/kb/3090973)  
* [<span data-ttu-id="e0e20-322">備份和還原 BizTalk Server 資料庫</span><span class="sxs-lookup"><span data-stu-id="e0e20-322">Backing Up and Restoring BizTalk Server Databases</span></span>](../core/backing-up-and-restoring-biztalk-server-databases.md)  
* [<span data-ttu-id="e0e20-323">如何移動 BizTalk Server 資料庫</span><span class="sxs-lookup"><span data-stu-id="e0e20-323">How to Move the BizTalk Server Databases</span></span>](../core/how-to-move-the-biztalk-server-databases.md)  
* [<span data-ttu-id="e0e20-324">如何還原資料庫</span><span class="sxs-lookup"><span data-stu-id="e0e20-324">How to Restore Your Databases</span></span>](../core/how-to-restore-your-databases.md)   
* [<span data-ttu-id="e0e20-325">多重子網路可用性群組中的連線逾時</span><span class="sxs-lookup"><span data-stu-id="e0e20-325">Connection Timeouts in Multi-subnet Availability Group</span></span>](https://blogs.msdn.microsoft.com/alwaysonpro/2014/06/03/connection-timeouts-in-multi-subnet-availability-group/)  
 
## <a name="known-limitations"></a><span data-ttu-id="e0e20-326">已知的限制</span><span class="sxs-lookup"><span data-stu-id="e0e20-326">Known limitations</span></span> 

<span data-ttu-id="e0e20-327">這些限制適用於 BizTalk Server，SQL Server AlwaysOn 可用性群組和 Azure 虛擬機器。</span><span class="sxs-lookup"><span data-stu-id="e0e20-327">These limitations are for BizTalk Server, SQL Server AlwaysOn Availability Group, and Azure Virtual Machines.</span></span> <span data-ttu-id="e0e20-328">這些限制可能的或在未來可能不取得解決。</span><span class="sxs-lookup"><span data-stu-id="e0e20-328">These limitations may or may not get addressed in future.</span></span> 

* <span data-ttu-id="e0e20-329">登入、 SQL Agent 作業、 SQL DB 郵件設定檔和帳戶並不管理可用性群組內。</span><span class="sxs-lookup"><span data-stu-id="e0e20-329">Logins, SQL Agent Jobs, the SQL DB Mail profile, and accounts are not managed within Availability Groups.</span></span> <span data-ttu-id="e0e20-330">這需要手動修改，以確定它們對主要複本執行的作業中。</span><span class="sxs-lookup"><span data-stu-id="e0e20-330">This requires manual modification in Jobs to make sure they run against the primary replica.</span></span> 
* <span data-ttu-id="e0e20-331">SQL Server Analysis Services 和 SQL Server Integration Services 不參與可用性群組。</span><span class="sxs-lookup"><span data-stu-id="e0e20-331">SQL Server Analysis Services and SQL Server Integration Services do not participate in Availability Groups.</span></span> <span data-ttu-id="e0e20-332">如果沒有此支援從 SQL Server 中，沒有任何這些 Azure 虛擬機器中的 HA 解決方案。</span><span class="sxs-lookup"><span data-stu-id="e0e20-332">Without this support from SQL Server, there is no HA solution for these in Azure Virtual Machines.</span></span> <span data-ttu-id="e0e20-333">BizTalk Server BAM 功能會相依於這些服務。</span><span class="sxs-lookup"><span data-stu-id="e0e20-333">BizTalk Server’s BAM capabilities are dependent on these services.</span></span> 
* <span data-ttu-id="e0e20-334">在 SQL Server 2016 SP2 之前, 可用性群組不支援相同 SQL 執行個體上的資料庫之間的 MSDTC。</span><span class="sxs-lookup"><span data-stu-id="e0e20-334">Prior to SQL Server 2016 SP2, Availability Groups don't support MSDTC between databases on the same SQL instance.</span></span> <span data-ttu-id="e0e20-335">因此，最小 8 個 SQL 執行個體，才能將 BizTalk 設定。</span><span class="sxs-lookup"><span data-stu-id="e0e20-335">Therefore, a minimum 8 SQL instances are required to configure BizTalk.</span></span> 

  <span data-ttu-id="e0e20-336">啟動 SQL Server 2016 sp2*並*BizTalk Server 2016 [CU5](https://support.microsoft.com/help/2555976/service-pack-and-cumulative-update-list-for-biztalk-server)，BizTalk 資料庫可以使用相同的 SQL Server 執行個體。</span><span class="sxs-lookup"><span data-stu-id="e0e20-336">Starting with SQL Server 2016 SP2 *and* BizTalk Server 2016 [CU5](https://support.microsoft.com/help/2555976/service-pack-and-cumulative-update-list-for-biztalk-server), the BizTalk databases can use the same SQL Server instance.</span></span> 

* <span data-ttu-id="e0e20-337">若要解決 MSDTC 以使用可用性群組，BizTalk 資料庫的限制，都可以使用至少兩部伺服器裝載四個 SQL 執行個體每一個來設定。</span><span class="sxs-lookup"><span data-stu-id="e0e20-337">To address MSDTC limitations with Availability Groups, BizTalk databases can be configured using a minimum of two servers hosting four SQL instances each.</span></span> <span data-ttu-id="e0e20-338">您也可以使用[與 Azure Load Balancer 的多個 IP 位址](https://docs.microsoft.com/azure/load-balancer/load-balancer-multivip-overview)。</span><span class="sxs-lookup"><span data-stu-id="e0e20-338">You can also use [multiple IP addresses with the Azure Load Balancer](https://docs.microsoft.com/azure/load-balancer/load-balancer-multivip-overview).</span></span> <span data-ttu-id="e0e20-339">因此，如果您想要在單一伺服器上的通訊埠 1433年上使用四個預設 SQL 執行個體，您會需要四個 IP 位址。</span><span class="sxs-lookup"><span data-stu-id="e0e20-339">So if you want to use four default SQL instances on port 1433 on a single server, you need four IP addresses.</span></span> <span data-ttu-id="e0e20-340">如果您僅限於一個 IP 位址，而且您想要裝載在相同伺服器上的多個 SQL 執行個體，然後請務必要用於每個 SQL 執行個體中的自訂連接埠。</span><span class="sxs-lookup"><span data-stu-id="e0e20-340">If you are restricted to one IP address, and you want to host multiple SQL instances on the same server, then be sure to use a custom port for each SQL instance.</span></span> 

  <span data-ttu-id="e0e20-341">啟動 SQL Server 2016 sp2*並*BizTalk Server 2016 [CU5](https://support.microsoft.com/help/2555976/service-pack-and-cumulative-update-list-for-biztalk-server)，BizTalk Server 資料庫可以使用相同的 SQL Server 執行個體。</span><span class="sxs-lookup"><span data-stu-id="e0e20-341">Starting with SQL Server 2016 SP2 *and* BizTalk Server 2016 [CU5](https://support.microsoft.com/help/2555976/service-pack-and-cumulative-update-list-for-biztalk-server), the BizTalk Server databases can use the same SQL Server instance.</span></span> 

* <span data-ttu-id="e0e20-342">BizTalk Server 不能使用唯讀路由。</span><span class="sxs-lookup"><span data-stu-id="e0e20-342">BizTalk Server cannot use Read-Only Routing.</span></span> 
* <span data-ttu-id="e0e20-343">BizTalk Server 不會設定`MultiSubnetFailover`連接屬性。</span><span class="sxs-lookup"><span data-stu-id="e0e20-343">BizTalk Server does not set the `MultiSubnetFailover` connection property.</span></span> 
* <span data-ttu-id="e0e20-344">BizTalk 使用記錄傳送的備份作業會一律為目標的主要複本，無論可用性群組上設定的備份喜好設定。</span><span class="sxs-lookup"><span data-stu-id="e0e20-344">BizTalk Backup Jobs using Log Shipping will always target the primary replica irrespective of the backup preference set on the Availability Group.</span></span> 
* <span data-ttu-id="e0e20-345">SQL Server 2016 Standard 支援只有一個單一資料庫中的每個 SQL AlwaysOn AG。</span><span class="sxs-lookup"><span data-stu-id="e0e20-345">SQL Server 2016 Standard supports only one single database in each SQL AlwaysOn AG.</span></span> <span data-ttu-id="e0e20-346">由於 BizTalk 會使用多個資料庫，通常建議將 SQL Server Enterprise edition。</span><span class="sxs-lookup"><span data-stu-id="e0e20-346">Since BizTalk uses many databases, SQL Server Enterprise edition is typically recommended.</span></span>
* <span data-ttu-id="e0e20-347">如果使用 Azure Vm，建議使用專用的 MSDTC 固定 TCP/IP 通訊埠。</span><span class="sxs-lookup"><span data-stu-id="e0e20-347">If using Azure VMs, it's recommended to use a dedicated fixed TCP/IP port for MSDTC.</span></span> <span data-ttu-id="e0e20-348">當使用固定的 TCP/IP 通訊埠，您不限制您常用的較舊的作業系統; 的 RPC 連接埠範圍它可協助簡化您的防火牆和負載平衡器規則。</span><span class="sxs-lookup"><span data-stu-id="e0e20-348">When using a fixed TCP/IP port, you aren't limiting your RPC port range typically used with older operating systems; and it helps simplify your firewall and load balancer rules.</span></span> <span data-ttu-id="e0e20-349">若要避免已知較低的連接埠衝突，請考慮使用較高的固定通訊埠 (例如 > 20000)。</span><span class="sxs-lookup"><span data-stu-id="e0e20-349">To avoid conflicts with known lower ports, consider using a higher fixed port (such as >20000).</span></span> <span data-ttu-id="e0e20-350">[設定單一連接埠支援 DTC](https://msdn.microsoft.com/library/windows/desktop/dd573191(v=vs.85).aspx)描述`ServerTcpPort`登錄機碼。</span><span class="sxs-lookup"><span data-stu-id="e0e20-350">[Configuring DTC Single Port Support](https://msdn.microsoft.com/library/windows/desktop/dd573191(v=vs.85).aspx) describes the `ServerTcpPort` registry key.</span></span> <span data-ttu-id="e0e20-351">除了 MSDTC 的固定連接埠，也會使用主要的 RPC 連接埠 135。</span><span class="sxs-lookup"><span data-stu-id="e0e20-351">In addition to the fixed port for MSDTC, the main RPC port 135 is also used.</span></span> 
