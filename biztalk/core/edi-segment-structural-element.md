---
title: "EDI 區段結構項目 |Microsoft 文件"
ms.custom: 
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 1f474a3d-004a-4981-b155-b0a5775918ba
caps.latest.revision: "6"
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 5b05d7a793fe515b8d0254d63b9b96994ddb35d9
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 09/20/2017
---
# <a name="edi-segment-structural-element"></a>EDI 區段結構項目
此區段包含一個或多個資料項目，而且是訊息中的中繼資訊單位。 每個區段三個字元的資料區段的識別項，以開始和結尾區段結束字元 （依預設單引號 （'））。 區段中的資料項目是以資料項目分隔符號分隔。 預設的資料項目分隔符號是加號 (+)。 區段可分類為強制或選用兩種。 外寄交換的分隔符號可以設定兩個交易夥伴之間，或做為後援交易夥伴協議一部分的協議中。  
  
## <a name="nesting"></a>巢狀  
 呼叫階層式關聯性來分組區段**巢狀**。 有兩個不同的巢狀類型： 明確和隱含。 不過您在任何一個交換內，都只能使用一種巢狀類型。  
  
-   明確巢狀使用具有巢狀迴圈的明確指示。 使用明確巢狀時，區段標記中的第一個元件資料項目將會是區段代碼。 這個項目後面接著條件式元件資料項目，用來指出區段的層級和重複發生率。 這種用途的元件資料項目數目依據區段出現在訊息結構中的階層式層級而定。 如果區段出現在第一個層級，便會使用緊接在區段代碼後面的元件資料項目。 如果區段出現在第二個層級，則會同時使用緊接在區段代碼後面的元件資料項目，以及下一個元件資料項目。 如果區段出現在第三個層級，將會使用接在區段代碼後面的三個元件資料項目。 管線無法執行比較資料與階層的結構驗證。  
  
-   在隱含巢狀中，系統會嚴格遵守訊息結構中指定的區段順序。 區段之間具有隱含的巢狀關係，而且不需要其他任何指示就可以處理。  
  
## <a name="loops"></a>迴圈  
 一或多個區段可以重複步驟，**迴圈**交易集內。 有兩個不同類型的迴圈： 未繫結和繫結。  
  
### <a name="unbounded-loops"></a>未繫結迴圈  
 未繫結迴圈沒有用來標記迴圈開頭和結尾的唯一識別區段。 未繫結迴圈會根據某個計數重複。 如果計數沒有值，迴圈將會重複兩次。 迴圈中的每個區段只能按照指定的順序出現一次。  
  
 未繫結迴圈的開頭是由第一個唯一的資料項目所建立。 第一個項目只能在每一次的迴圈中出現一次。 未繫結迴圈可按巢狀結構放在迴圈內；若是如此，內部的未繫結迴圈就不能從與任何外部迴圈相同的序數位置開始，而且開頭也不能使用與任何外部迴圈相同的區段識別碼做為開頭。 巢狀迴圈包含的區段不能同時做為相同巢狀結構內任何外部迴圈的開頭區段。  
  
### <a name="bounded-loops"></a>已繫結迴圈  
 已繫結迴圈開頭為預先定義的區段 LS (迴圈啟動)，而結尾則是預先定義的區段 LE (迴圈結束)。 LS 區段的選擇性必須符合迴圈中的第一個區段。 繫結迴圈可以包含另一個繫結迴圈。  
  
> [!NOTE]
>  X12 中的繫結迴圈與 EDIFACT 中的明確迴圈功能相等。  
  
 迴圈中使用繫結來解決模稜兩可的問題。 LS/LE 區段上的需求指示項符合迴圈中第一個區段的需求指示項。 繫結可放寬某些經常重複之區段在用途上的結構化限制。 繫結區段沒有任何關於開頭區段 ID 的限制。 如此一來，同一個區段就可以啟動繫結迴圈，也可以在迴圈外使用，如下列範例所示：  
  
```  
AA  
LS  
BB  
CC  
LE  
BB  
```  
  
 允許有從屬迴圈 (迴圈內的迴圈)。 如果繫結迴圈按巢狀結構放在迴圈內，內部迴圈不能從與任何外部迴圈相同的序數位置開始。 內部繫結迴圈必須在緊接的外部迴圈之前結束。  
  
 交易集內的每個繫結迴圈都必須擁有唯一定義的 <loop_id> 值，內含一到四個大寫字母或一到四位數字。 建議您在對應的 LS 和 LE 區段中包含相同的唯一 <loop_id> 值。 < Loop_id > 資料項目將做為 「 一般 」 資料項目處理，並驗證資料型別、 最小/最大長度、 選用性等等。跨區段驗證 （跨 LS 和 LE） 將不會執行。BizTalk Server 會透過確認只有 LS 和 LE 區段而無其他內容存在，驗證模稜兩可解析。 若發生違反資料項目規則的情況，將會接受交易集並產生錯誤，而且 BizTalk Server 也會在通知中傳回 AK501=E 和 AK2/AK3 的適當評估。  
  
 您也必須強制執行 LS/LE 區段的剖析作業。 如果出現不相符的情況，便會因為原有的模稜兩可解析問題而拒絕交易集，並於事件檢視器和 997 通知中傳回 AK501 = E 和 AK502 = 5。 當遺失 LS/LE 這兩個或其中一個區段，但交易集並未模稜兩可時，將會接受交易集並產生錯誤，而且會傳回 AK501=E 和 AK502 = 5。  
  
 LS/LE 配對可以是選擇性或強制性的。 不過，除非這個配對包含在可重複的父迴圈中，否則此將永遠不可重複。 不論是哪一種情況，LS/LE 配對的 MaxOccurs 都可以是 1，但不能大於 1。這是結構描述驗證中的強制條件。  
  
 EDI 解譯器和 EDI 組合器會處理 LS 和 LE 區段。 在剖析過程中，解譯器會建立 LS 和 LE 區段的 XML 節點，並驗證區段。 在序列化過程中，組合器則會從 XML 節點建立 LS 和 LE 區段，並驗證這兩個區段。 如果預期的 LS 或 LE 區段遺失，交易就會擱置/拒絕 AK501 = E 和 AK502 = 5。 如果 LS/LE 區段存在但沒有對應的資料元素，而且已啟用 EDI 驗證，交易集已接受，發生錯誤和 AK501 = E 和 AK502 = 5 會顯示在 事件檢視器和 997 通知。