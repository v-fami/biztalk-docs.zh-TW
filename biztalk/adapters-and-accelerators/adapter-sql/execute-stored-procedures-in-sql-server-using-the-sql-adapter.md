---
title: 使用 SQL 配接器的 SQL Server 中執行預存程序 |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: 245626a7-f546-4aca-90df-c0579139a872
caps.latest.revision: 16
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: c6515baa313fc6b68c62556ad5b5883500cfde8a
ms.sourcegitcommit: 266308ec5c6a9d8d80ff298ee6051b4843c5d626
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 06/27/2018
ms.locfileid: "37021551"
---
# <a name="execute-stored-procedures-in-sql-server-using-the-sql-adapter"></a><span data-ttu-id="45a1b-102">使用 SQL 配接器的 SQL Server 中執行預存程序</span><span class="sxs-lookup"><span data-stu-id="45a1b-102">Execute Stored Procedures in SQL Server using the SQL adapter</span></span>
<span data-ttu-id="45a1b-103">TRANSACT-SQL 和 SQL Server 中的 CLR 預存程序會顯示為中的作業[!INCLUDE[adaptersql](../../includes/adaptersql-md.md)]底下**程序**時使用的節點[!INCLUDE[consumeadapterservshort](../../includes/consumeadapterservshort-md.md)]或[!INCLUDE[addadapterservrefshort](../../includes/addadapterservrefshort-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="45a1b-103">The Transact-SQL and CLR stored procedures in SQL Server are surfaced as operations in [!INCLUDE[adaptersql](../../includes/adaptersql-md.md)] under the **Procedures** node while using the [!INCLUDE[consumeadapterservshort](../../includes/consumeadapterservshort-md.md)] or [!INCLUDE[addadapterservrefshort](../../includes/addadapterservrefshort-md.md)].</span></span> <span data-ttu-id="45a1b-104">所公開的作業名稱[!INCLUDE[adaptersqlshort](../../includes/adaptersqlshort-md.md)]與 SQL Server 中的預存程序的名稱相同。</span><span class="sxs-lookup"><span data-stu-id="45a1b-104">The operation names exposed by the [!INCLUDE[adaptersqlshort](../../includes/adaptersqlshort-md.md)] are the same as the name of the stored procedure in SQL Server.</span></span> <span data-ttu-id="45a1b-105">預存程序中的所有參數會都公開在對應的作業。</span><span class="sxs-lookup"><span data-stu-id="45a1b-105">All the parameters in the stored procedure are exposed in the corresponding operation.</span></span> <span data-ttu-id="45a1b-106">OUT 參數會包含預存程序的傳回值。</span><span class="sxs-lookup"><span data-stu-id="45a1b-106">The OUT parameter contains the return value of the stored procedure.</span></span> <span data-ttu-id="45a1b-107">預存程序的結果集是資料集的陣列。</span><span class="sxs-lookup"><span data-stu-id="45a1b-107">The result set of the stored procedure is an array of DataSet.</span></span> <span data-ttu-id="45a1b-108">如需有關資料集的詳細資訊，請參閱 < [ http://go.microsoft.com/fwlink/?LinkId=196853 ](http://go.microsoft.com/fwlink/?LinkId=196853)。</span><span class="sxs-lookup"><span data-stu-id="45a1b-108">For more information about DataSet, see [http://go.microsoft.com/fwlink/?LinkId=196853](http://go.microsoft.com/fwlink/?LinkId=196853).</span></span> <span data-ttu-id="45a1b-109">目標物件的結構描述資訊是在執行階段取得回應訊息的一部分。</span><span class="sxs-lookup"><span data-stu-id="45a1b-109">The schema information of the target object is obtained as part of the response message at run time.</span></span>  

 <span data-ttu-id="45a1b-110">不過，如果您想要取得在設計階段的目標物件的結構描述資訊時，您必須產生結構描述下的程序**Strongly-Typed 程序**中的節點[!INCLUDE[consumeadapterservshort](../../includes/consumeadapterservshort-md.md)]或[!INCLUDE[addadapterservrefshort](../../includes/addadapterservrefshort-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="45a1b-110">However, if you want to obtain the schema information of the target object at design time, you must generate schemas for the procedures under the **Strongly-Typed Procedures** node in the [!INCLUDE[consumeadapterservshort](../../includes/consumeadapterservshort-md.md)] or [!INCLUDE[addadapterservrefshort](../../includes/addadapterservrefshort-md.md)].</span></span> <span data-ttu-id="45a1b-111">請注意，相同的預存程序會在呈現**程序**並**Strongly-Typed 程序**節點。</span><span class="sxs-lookup"><span data-stu-id="45a1b-111">Note that the same stored procedures are surfaced under the **Procedures** and the **Strongly-Typed Procedures** node.</span></span> <span data-ttu-id="45a1b-112">預存程序傳回值為強型別，而不只是資料集的陣列。</span><span class="sxs-lookup"><span data-stu-id="45a1b-112">The return value of the stored procedure is strongly typed, and not just an array of DataSet.</span></span> <span data-ttu-id="45a1b-113">因為在設計階段使用的結構描述資訊，您可以使用它的預存程序的結構描述對應到另一個結構描述不同的作業。</span><span class="sxs-lookup"><span data-stu-id="45a1b-113">As the schema information is available at the design time, you can use it to map the schema of the stored procedure to another schema for a different operation.</span></span> <span data-ttu-id="45a1b-114">比方說，您可以對應至資料庫資料表上的插入作業所產生的結構描述的強型別 」 程序所產生的結構描述。</span><span class="sxs-lookup"><span data-stu-id="45a1b-114">For example, you can map the schema generated for a strongly-typed procedure to the schema generated for the Insert operation on a database table.</span></span>  

> [!NOTE]
>  <span data-ttu-id="45a1b-115">您無法檢視的強類型的預存程序在設計階段的結構描述資訊，如果：</span><span class="sxs-lookup"><span data-stu-id="45a1b-115">You will not be able to view the schema information at design time for a strongly-typed stored procedure if:</span></span>  
> 
> - <span data-ttu-id="45a1b-116">您正在使用資料指標，也就是另一個預存程序，傳回值做為輸入參數為強類型的預存程序。</span><span class="sxs-lookup"><span data-stu-id="45a1b-116">You are using a cursor, which is a return value of another stored procedure, as the input parameter for the strongly-typed stored procedure.</span></span>  
>   -   <span data-ttu-id="45a1b-117">它是 CLR 預存程序，以在資料表上的某些作業。</span><span class="sxs-lookup"><span data-stu-id="45a1b-117">It is a CLR stored procedure that performs some operations on a table.</span></span>  

## <a name="support-for-stored-procedures-with-for-xml-clause"></a><span data-ttu-id="45a1b-118">搭配 FOR XML 子句的預存程序的支援</span><span class="sxs-lookup"><span data-stu-id="45a1b-118">Support for Stored Procedures with FOR XML Clause</span></span>  
 <span data-ttu-id="45a1b-119">[!INCLUDE[adaptersqlshort](../../includes/adaptersqlshort-md.md)]也可讓您執行具有 FOR XML 子句的 SELECT 陳述式的預存程序。</span><span class="sxs-lookup"><span data-stu-id="45a1b-119">The [!INCLUDE[adaptersqlshort](../../includes/adaptersqlshort-md.md)] also enables you to execute stored procedures that have a SELECT statement with a FOR XML clause.</span></span> <span data-ttu-id="45a1b-120">FOR XML 子句用於 SELECT 陳述式中，以 XML 形式傳回結果，而不是資料列集。</span><span class="sxs-lookup"><span data-stu-id="45a1b-120">A FOR XML clause is used in a SELECT statement to return the results as XML instead of a rowset.</span></span> <span data-ttu-id="45a1b-121">如需有關 FOR XML 子句的詳細資訊，請參閱 < [ http://go.microsoft.com/fwlink/?LinkId=131402 ](http://go.microsoft.com/fwlink/?LinkId=131402)。</span><span class="sxs-lookup"><span data-stu-id="45a1b-121">For more information about the FOR XML clause, see [http://go.microsoft.com/fwlink/?LinkId=131402](http://go.microsoft.com/fwlink/?LinkId=131402).</span></span>  

> [!NOTE]
>  <span data-ttu-id="45a1b-122">「 原生 」[!INCLUDE[adaptersqlshort](../../includes/adaptersqlshort-md.md)]適用於[!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)]支援僅的預存程序傳回的 XML，也就是有 FOR XML 子句的 SELECT 陳述式中。</span><span class="sxs-lookup"><span data-stu-id="45a1b-122">The “native” [!INCLUDE[adaptersqlshort](../../includes/adaptersqlshort-md.md)] available with [!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)] supports only those stored procedures that return XML, that is, have the FOR XML clause in the SELECT statement.</span></span> <span data-ttu-id="45a1b-123">搭配 FOR XML 子句的預存程序的支援，您可以執行這些預存程序，使用以 WCF 為基礎[!INCLUDE[adaptersqlshort](../../includes/adaptersqlshort-md.md)]而不需要對預存程序定義中的任何變更。</span><span class="sxs-lookup"><span data-stu-id="45a1b-123">With the support for stored procedures with FOR XML clause, you can execute these stored procedures using the WCF-based [!INCLUDE[adaptersqlshort](../../includes/adaptersqlshort-md.md)] without making any changes to the stored procedure definition.</span></span>  

## <a name="support-for-stored-procedures-with-temporary-tables"></a><span data-ttu-id="45a1b-124">使用暫存資料表的預存程序的支援</span><span class="sxs-lookup"><span data-stu-id="45a1b-124">Support for Stored Procedures with Temporary Tables</span></span>  
 <span data-ttu-id="45a1b-125">[!INCLUDE[adaptersqlshort](../../includes/adaptersqlshort-md.md)]可讓您產生包含其定義中的暫存資料表的預存程序的中繼資料。</span><span class="sxs-lookup"><span data-stu-id="45a1b-125">The [!INCLUDE[adaptersqlshort](../../includes/adaptersqlshort-md.md)] enables you to generate metadata for stored procedures that contain temporary tables in their definitions.</span></span> <span data-ttu-id="45a1b-126">不過，這類預存程序則必須產生中繼資料選取預存程序，只能從**程序**節點，同時使用[!INCLUDE[addadapterservrefshort](../../includes/addadapterservrefshort-md.md)]或[!INCLUDE[consumeadapterservshort](../../includes/consumeadapterservshort-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="45a1b-126">However, for such stored procedures you must generate metadata by selecting the stored procedures only from the **Procedures** node, while using the [!INCLUDE[addadapterservrefshort](../../includes/addadapterservrefshort-md.md)] or [!INCLUDE[consumeadapterservshort](../../includes/consumeadapterservshort-md.md)].</span></span> <span data-ttu-id="45a1b-127">配接器不支援從在這類預存程序產生的中繼資料**Strongly-Typed 程序**節點。</span><span class="sxs-lookup"><span data-stu-id="45a1b-127">The adapter does not support generating metadata for such stored procedures from under the **Strongly-Typed Procedures** node.</span></span>  

## <a name="support-for-result-sets-containing-columns-without-names-or-with-same-names"></a><span data-ttu-id="45a1b-128">支援結果集包含資料行沒有名稱或相同的名稱</span><span class="sxs-lookup"><span data-stu-id="45a1b-128">Support for Result Sets Containing Columns Without Names or With Same Names</span></span>  
 <span data-ttu-id="45a1b-129">下表列出了[!INCLUDE[adaptersqlshort](../../includes/adaptersqlshort-md.md)]處理而不需要名稱和預存程序和強型別的預存程序之結果集內的相同名稱的資料行。</span><span class="sxs-lookup"><span data-stu-id="45a1b-129">The following table lists how the [!INCLUDE[adaptersqlshort](../../includes/adaptersqlshort-md.md)] handles columns without names and same names in the result sets for stored procedures and strongly-typed stored procedures.</span></span>  


|    <span data-ttu-id="45a1b-130">結果集包含...</span><span class="sxs-lookup"><span data-stu-id="45a1b-130">Result set contains…</span></span>     |                                                                                                                                                       <span data-ttu-id="45a1b-131">預存程序</span><span class="sxs-lookup"><span data-stu-id="45a1b-131">Stored Procedure</span></span>                                                                                                                                                       |                                                                                                           <span data-ttu-id="45a1b-132">強型別的預存程序</span><span class="sxs-lookup"><span data-stu-id="45a1b-132">Strongly-Typed Stored Procedure</span></span>                                                                                                            |
|-----------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|  <span data-ttu-id="45a1b-133">**沒有名稱的資料行**</span><span class="sxs-lookup"><span data-stu-id="45a1b-133">**Columns without names**</span></span>  | <span data-ttu-id="45a1b-134">[!INCLUDE[adaptersqlshort](../../includes/adaptersqlshort-md.md)]以下列方式產生資料行的名稱： 沒有資料行產生唯一識別碼 (GUID)"-"（連字號），然後 GUID 字串前面加上"C"因為產生的 GUID 可能會以數字開頭，但 XML 標記名稱不能和。</span><span class="sxs-lookup"><span data-stu-id="45a1b-134">The [!INCLUDE[adaptersqlshort](../../includes/adaptersqlshort-md.md)] generates a name for the column in the following way: a unique ID (GUID) is generated for the column without "-" (hyphen), and then the GUID string is prefixed by "C" because the generated GUID might start with a digit but an XML tag name cannot.</span></span> |                                <span data-ttu-id="45a1b-135">[!INCLUDE[adaptersqlshort](../../includes/adaptersqlshort-md.md)]會產生下列資料行名稱:"UnNamedColumn [column_index] 」，從 '0' column_index 開始的位置。</span><span class="sxs-lookup"><span data-stu-id="45a1b-135">The [!INCLUDE[adaptersqlshort](../../includes/adaptersqlshort-md.md)] generates the following name for the column: “UnNamedColumn[column_index]”,  where column_index starts from ‘0’.</span></span>                                |
| <span data-ttu-id="45a1b-136">**具有相同名稱的資料行**</span><span class="sxs-lookup"><span data-stu-id="45a1b-136">**Columns with same names**</span></span> |                                                                                <span data-ttu-id="45a1b-137">第一個以外的資料行的名稱再加上"*"（底線） 後面接著隨機的 GUID，而不"-"（連字號）。例如:"\\*[GUID]"。</span><span class="sxs-lookup"><span data-stu-id="45a1b-137">The names of the columns other than the first one are appended with “*” (underscore) followed by a random GUID without "-" (hyphen). For example: “\\*[GUID]”.</span></span>                                                                                | <span data-ttu-id="45a1b-138">[!INCLUDE[adaptersqlshort](../../includes/adaptersqlshort-md.md)]結果集中不支援具有相同名稱的資料行，而且會擲回例外狀況。</span><span class="sxs-lookup"><span data-stu-id="45a1b-138">The [!INCLUDE[adaptersqlshort](../../includes/adaptersqlshort-md.md)] does not support columns with same names in the result sets, and throws an exception.</span></span> <span data-ttu-id="45a1b-139">**重要事項：** 您必須確定在結果集中的資料行名稱有唯一的名稱。</span><span class="sxs-lookup"><span data-stu-id="45a1b-139">**Important:**  You must ensure that the column names in a result set have unique names.</span></span> |

> [!NOTE]
>  <span data-ttu-id="45a1b-140">一般情況下，建議結果中的所有資料行設定預存程序和強型別的預存程序必須名稱，並且具有唯一的名稱。</span><span class="sxs-lookup"><span data-stu-id="45a1b-140">In general, it is recommended that all the columns in a result set for stored procedures and strongly-typed stored procedures must be named, and have unique names.</span></span>  

 <span data-ttu-id="45a1b-141">如需詳細資訊：</span><span class="sxs-lookup"><span data-stu-id="45a1b-141">For more information about:</span></span>  

-   <span data-ttu-id="45a1b-142">如何執行預存程序，請參閱[使用 BizTalk Server 的 SQL Server 中執行預存程序](../../adapters-and-accelerators/adapter-sql/execute-stored-procedures-in-sql-server-using-biztalk-server.md)。</span><span class="sxs-lookup"><span data-stu-id="45a1b-142">How to execute stored procedures, see [Execute stored procedures in SQL Server using BizTalk Server](../../adapters-and-accelerators/adapter-sql/execute-stored-procedures-in-sql-server-using-biztalk-server.md).</span></span>  

-   <span data-ttu-id="45a1b-143">執行具有 FOR XML 子句的預存程序，請參閱[執行具有 FOR XML 子句中使用 BizTalk Server 的 SQL Server 中的預存程序](../../adapters-and-accelerators/adapter-sql/execute-stored-procedures-having-a-for-xml-clause-in-sql-server-using-biztalk.md)。</span><span class="sxs-lookup"><span data-stu-id="45a1b-143">How to execute stored procedures having a FOR XML clause, see [Execute stored procedures having a FOR XML clause in SQL Server using BizTalk Server](../../adapters-and-accelerators/adapter-sql/execute-stored-procedures-having-a-for-xml-clause-in-sql-server-using-biztalk.md).</span></span>  

-   <span data-ttu-id="45a1b-144">訊息的預存程序的結構描述，請參閱 <<c0> [ 程序和函式的訊息結構描述](../../adapters-and-accelerators/adapter-sql/message-schemas-for-procedures-and-functions.md)。</span><span class="sxs-lookup"><span data-stu-id="45a1b-144">Message schemas for the stored procedures, see [Message Schemas for Procedures and Functions](../../adapters-and-accelerators/adapter-sql/message-schemas-for-procedures-and-functions.md).</span></span>  

## <a name="see-also"></a><span data-ttu-id="45a1b-145">另請參閱</span><span class="sxs-lookup"><span data-stu-id="45a1b-145">See Also</span></span>  
 [<span data-ttu-id="45a1b-146">連接到 SAP 系統使用配接器</span><span class="sxs-lookup"><span data-stu-id="45a1b-146">Connect to an SAP system using the adapter</span></span>](../../adapters-and-accelerators/adapter-sap/connect-to-an-sap-system-using-the-adapter.md)