---
title: "使用 BizTalk Server sql 接收查詢通知上的多個接收位置 |Microsoft 文件"
ms.custom: 
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 9afbe98e-8901-417c-a807-8db97fd7a24b
caps.latest.revision: "7"
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: fa858483914b8325e9250e1e41f99ae03226f3ee
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 09/20/2017
---
# <a name="receive-query-notifications-on-multiple-receive-locations-from-sql-using-biztalk-server"></a><span data-ttu-id="1fc2d-102">使用 BizTalk Server sql 接收查詢通知上的多個接收位置</span><span class="sxs-lookup"><span data-stu-id="1fc2d-102">Receive query notifications On Multiple Receive Locations from SQL using BizTalk Server</span></span>
<span data-ttu-id="1fc2d-103">假設您有多個接收位置設定為接收查詢通知，相同的資料表 （例如員工） 不同的 BizTalk 應用程式的過程中建立相同的資料庫中。</span><span class="sxs-lookup"><span data-stu-id="1fc2d-103">Consider a scenario where you have multiple receive locations created as part of different BizTalk applications configured to receive query notifications for the same table (e.g. Employee) in the same database.</span></span> <span data-ttu-id="1fc2d-104">如果一百記錄插入相同的資料表時，所有接收位置會都收到通知訊息。</span><span class="sxs-lookup"><span data-stu-id="1fc2d-104">If a hundred records are inserted into the same table, all the receive locations will get the notification message.</span></span> <span data-ttu-id="1fc2d-105">有效地接收通知，跨多個接收位置，您可以從 BizTalk 應用程式中的其中一個接收到通知時，如果接收位置的方式呼叫作業、 其他接收位置不會取得相同的通知。</span><span class="sxs-lookup"><span data-stu-id="1fc2d-105">To effectively receive notifications across multiple receive locations, you can call operations from your BizTalk application in such a way that if a notification is received by one receive location, the other receive location does not get the same notification.</span></span> <span data-ttu-id="1fc2d-106">因此，您可以有效地收到多個位置上的負載平衡通知。</span><span class="sxs-lookup"><span data-stu-id="1fc2d-106">So, you can effectively load-balance notifications received on multiple locations.</span></span>  
  
 <span data-ttu-id="1fc2d-107">若要設定負載平衡接收通知的協調流程所需的工作會與針對相同[接收查詢通知以累加方式使用 BizTalk Server 的 sql](../../adapters-and-accelerators/adapter-sql/receive-query-notifications-incrementally-from-sql-using-biztalk-server.md)。</span><span class="sxs-lookup"><span data-stu-id="1fc2d-107">The tasks required to set up an orchestration to load-balance receiving notifications are same as that for [Receive Query Notifications Incrementally from SQL using BizTalk Server](../../adapters-and-accelerators/adapter-sql/receive-query-notifications-incrementally-from-sql-using-biztalk-server.md).</span></span> <span data-ttu-id="1fc2d-108">本主題列出只有兩種方法之間的差異。</span><span class="sxs-lookup"><span data-stu-id="1fc2d-108">This topic lists the only the difference between the two approaches.</span></span>  
  
## <a name="load-balancing-query-notifications-across-multiple-receive-locations"></a><span data-ttu-id="1fc2d-109">跨多個負載平衡查詢通知的接收位置</span><span class="sxs-lookup"><span data-stu-id="1fc2d-109">Load-Balancing Query Notifications Across Multiple Receive Locations</span></span>  
 <span data-ttu-id="1fc2d-110">如同本主題在[接收查詢通知以累加方式使用 BizTalk Server 的 sql](../../adapters-and-accelerators/adapter-sql/receive-query-notifications-incrementally-from-sql-using-biztalk-server.md)，都已收到通知的記錄上執行 UPDATE 陳述式設定累加通知。</span><span class="sxs-lookup"><span data-stu-id="1fc2d-110">Like in the topic [Receive Query Notifications Incrementally from SQL using BizTalk Server](../../adapters-and-accelerators/adapter-sql/receive-query-notifications-incrementally-from-sql-using-biztalk-server.md), you configured incremental notifications by executing an UPDATE statement on the records that are already notified for.</span></span> <span data-ttu-id="1fc2d-111">若要設定負載平衡，您無法執行刪除已收到通知的記錄的預存程序。</span><span class="sxs-lookup"><span data-stu-id="1fc2d-111">To configure load-balancing, you could execute a stored procedure that deletes the records that have been notified for.</span></span> <span data-ttu-id="1fc2d-112">例如，請考慮具有下列定義的預存程序 PROCESS_EMPLOYEE:</span><span class="sxs-lookup"><span data-stu-id="1fc2d-112">For example, consider a stored procedure PROCESS_EMPLOYEE with the following definition:</span></span>  
  
```  
DECLARE @var int  
SELECT TOP 1 @var = Employee_ID FROM Employee  
SELECT * FROM Employee WHERE Employee_ID=@var  
DELETE FROM Employee WHERE Employee_ID=@var  
```  
  
 <span data-ttu-id="1fc2d-113">當您執行這個預存程序做為 BizTalk 應用程式的一部分時，已收到通知的記錄會被刪除。</span><span class="sxs-lookup"><span data-stu-id="1fc2d-113">When you execute this stored procedure as part of the BizTalk application, the record for which notification is already received gets deleted.</span></span> <span data-ttu-id="1fc2d-114">因此，其他接收位置取得下一筆記錄的通知。</span><span class="sxs-lookup"><span data-stu-id="1fc2d-114">So, the other receive location gets notification for the next record.</span></span>  
  
 <span data-ttu-id="1fc2d-115">以下是您必須執行來設定負載平衡接收通知的概要步驟。</span><span class="sxs-lookup"><span data-stu-id="1fc2d-115">Here are the high-level steps you must perform to configure load-balancing for receiving notifications.</span></span>  
  
1.  <span data-ttu-id="1fc2d-116">建立結構描述**通知**（輸入作業） 和**PROCESS_EMPLOYEE**預存程序 （輸出作業）。</span><span class="sxs-lookup"><span data-stu-id="1fc2d-116">Create schema for **Notification** (inbound operation) and **PROCESS_EMPLOYEE** stored procedure (outbound operation).</span></span>  
  
2.  <span data-ttu-id="1fc2d-117">新增協調流程，並加入三則訊息來接收通知、 執行預存程序，並取得回應的預存程序。</span><span class="sxs-lookup"><span data-stu-id="1fc2d-117">Add an orchestration and add three messages for receiving notification, executing stored procedure, and getting response for the stored procedure.</span></span>  
  
3.  <span data-ttu-id="1fc2d-118">新增傳送和接收圖形、 建構訊息 」 圖形和連接埠，以建立協調流程。</span><span class="sxs-lookup"><span data-stu-id="1fc2d-118">Create an orchestration by adding Send and Receive shapes, Construct Message shape, and ports.</span></span> <span data-ttu-id="1fc2d-119">您可以使用相同的範例程式碼建構的訊息，來叫用 PROCESS_EMPLOYEE 預存程序。</span><span class="sxs-lookup"><span data-stu-id="1fc2d-119">You can use the same sample code for constructing a message to invoke the PROCESS_EMPLOYEE stored procedure.</span></span> <span data-ttu-id="1fc2d-120">請注意，在執行中的作業時[!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)]管理主控台中，您必須擁有 PROCESS_EMPLOYEE 的要求訊息中的位置 C:\TestLocation\MessageIn 預存程序。</span><span class="sxs-lookup"><span data-stu-id="1fc2d-120">Note that while performing the operation in [!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)] Administration console, you must have the request message for the PROCESS_EMPLOYEE stored procedure in the location C:\TestLocation\MessageIn.</span></span> <span data-ttu-id="1fc2d-121">您因為程式碼片段您叫用做為建立的協調流程的一部分[接收查詢通知以累加方式使用 BizTalk Server 的 sql](../../adapters-and-accelerators/adapter-sql/receive-query-notifications-incrementally-from-sql-using-biztalk-server.md)建立根據要求出現在 C:\ XML 要求訊息TestLocation\MessageIn。</span><span class="sxs-lookup"><span data-stu-id="1fc2d-121">You do so because the code snippet you invoke as part of the orchestration created in [Receive Query Notifications Incrementally from SQL using BizTalk Server](../../adapters-and-accelerators/adapter-sql/receive-query-notifications-incrementally-from-sql-using-biztalk-server.md) creates a request message based on the request XML present in C:\TestLocation\MessageIn.</span></span>  
  
4.  <span data-ttu-id="1fc2d-122">建置和部署應用程式。</span><span class="sxs-lookup"><span data-stu-id="1fc2d-122">Build and deploy the application.</span></span> <span data-ttu-id="1fc2d-123">若要示範負載平衡，您至少必須部署此協調流程有兩個不同的電腦上[!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)]和[!INCLUDE[adaptersqlshort](../../includes/adaptersqlshort-md.md)]安裝。</span><span class="sxs-lookup"><span data-stu-id="1fc2d-123">To demonstrate load-balancing, you must deploy this orchestration at least on two different computers that have [!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)] and [!INCLUDE[adaptersqlshort](../../includes/adaptersqlshort-md.md)] installed.</span></span>  
  
5.  <span data-ttu-id="1fc2d-124">在[!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)]兩部電腦上的管理主控台可讓您指定下列的繫結屬性，Wcf-custom 或 WCF SQL 接收位置：</span><span class="sxs-lookup"><span data-stu-id="1fc2d-124">In the [!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)] Administration console on both the computers, specify the following binding properties for the WCF-Custom or WCF-SQL receive location:</span></span>  
  
    |<span data-ttu-id="1fc2d-125">繫結屬性</span><span class="sxs-lookup"><span data-stu-id="1fc2d-125">Binding Property</span></span>|<span data-ttu-id="1fc2d-126">值</span><span class="sxs-lookup"><span data-stu-id="1fc2d-126">Value</span></span>|  
    |----------------------|-----------|  
    |<span data-ttu-id="1fc2d-127">**InboundOperationType**</span><span class="sxs-lookup"><span data-stu-id="1fc2d-127">**InboundOperationType**</span></span>|<span data-ttu-id="1fc2d-128">將此設**通知**。</span><span class="sxs-lookup"><span data-stu-id="1fc2d-128">Set this to **Notification**.</span></span>|  
    |<span data-ttu-id="1fc2d-129">**NotificationStatement**</span><span class="sxs-lookup"><span data-stu-id="1fc2d-129">**NotificationStatement**</span></span>|<span data-ttu-id="1fc2d-130">將此值設定為：</span><span class="sxs-lookup"><span data-stu-id="1fc2d-130">Set this to:</span></span><br /><br /> `SELECT Employee_ID, Name FROM dbo.Employee WHERE Status=0`<br /><br /> <span data-ttu-id="1fc2d-131">**注意：**通知陳述式，您永遠必須指定資料表名稱，以及結構描述名稱。</span><span class="sxs-lookup"><span data-stu-id="1fc2d-131">**Note:** For notification statements, you must always specify the table name along with the schema name.</span></span> <span data-ttu-id="1fc2d-132">例如， `dbo.Employee`。</span><span class="sxs-lookup"><span data-stu-id="1fc2d-132">For example, `dbo.Employee`.</span></span>|  
    |<span data-ttu-id="1fc2d-133">**NotifyOnListenerStart**</span><span class="sxs-lookup"><span data-stu-id="1fc2d-133">**NotifyOnListenerStart**</span></span>|<span data-ttu-id="1fc2d-134">將此設**True**。</span><span class="sxs-lookup"><span data-stu-id="1fc2d-134">Set this to **True**.</span></span>|  
  
6.  <span data-ttu-id="1fc2d-135">啟動 BizTalk 應用程式。</span><span class="sxs-lookup"><span data-stu-id="1fc2d-135">Start the BizTalk application.</span></span>  
  
7.  <span data-ttu-id="1fc2d-136">若要開始接收通知，將一百記錄插入員工資料表。</span><span class="sxs-lookup"><span data-stu-id="1fc2d-136">To start receiving notifications, insert a hundred records into the EMPLOYEE table.</span></span> <span data-ttu-id="1fc2d-137">在此情況下，務必要求 XML PROCESS_EMPLOYEE 叫用預存程序是用於 C:\TestLocation\MessageIn。</span><span class="sxs-lookup"><span data-stu-id="1fc2d-137">While doing so, make sure the request XML for invoking the PROCESS_EMPLOYEE stored procedure is available in C:\TestLocation\MessageIn.</span></span>  
  
8.  <span data-ttu-id="1fc2d-138">監視其中的 BizTalk 應用程式將會卸除的通知訊息的位置 （在兩部電腦）。</span><span class="sxs-lookup"><span data-stu-id="1fc2d-138">Monitor the location (on both the computers) where the BizTalk application will be dropping the notification messages.</span></span> <span data-ttu-id="1fc2d-139">您會發現，插入的數百個記錄，一個位置取得某些記錄的通知而在其他位置取得其餘的記錄的通知。</span><span class="sxs-lookup"><span data-stu-id="1fc2d-139">You will notice that of the hundred records inserted, one location gets notifications for some records while the other location gets notification for the remaining records.</span></span> <span data-ttu-id="1fc2d-140">在一起，這兩個位置會收到所有數百個記錄的通知。</span><span class="sxs-lookup"><span data-stu-id="1fc2d-140">Together, both the locations will get notification for all the hundred records.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="1fc2d-141">另請參閱</span><span class="sxs-lookup"><span data-stu-id="1fc2d-141">See Also</span></span>  
 [<span data-ttu-id="1fc2d-142">接收使用 BizTalk Server 的 SQL 查詢通知</span><span class="sxs-lookup"><span data-stu-id="1fc2d-142">Receive SQL Query Notifications using BizTalk Server</span></span>](../../adapters-and-accelerators/adapter-sql/receive-sql-query-notifications-using-biztalk-server.md)