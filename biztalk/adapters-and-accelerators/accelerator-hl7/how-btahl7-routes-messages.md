---
title: BTAHL7 如何路由傳送訊息 |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
helpviewer_keywords:
- routing, about routing
- routing, messages
- messages, routing
- BTAHL7, message routing
ms.assetid: 555696c7-6023-44eb-b13d-cf7527bbc92f
caps.latest.revision: 7
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 7c64cd0620dacf835d3765510ea74c2a8cc80c4a
ms.sourcegitcommit: 266308ec5c6a9d8d80ff298ee6051b4843c5d626
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 06/27/2018
ms.locfileid: "36999287"
---
# <a name="how-btahl7-routes-messages"></a><span data-ttu-id="7793d-102">BTAHL7 如何路由傳送訊息</span><span class="sxs-lookup"><span data-stu-id="7793d-102">How BTAHL7 Routes Messages</span></span>
<span data-ttu-id="7793d-103">Microsoft BizTalk Accelerator for HL7 ([!INCLUDE[btaBTAHL71.3abbrevnonumber](../../includes/btabtahl71-3abbrevnonumber-md.md)]) 會利用訊息處理功能的 Microsoft [!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)]，但還擴充它專屬於 HL7 傳訊需求的數種方式中。</span><span class="sxs-lookup"><span data-stu-id="7793d-103">Microsoft BizTalk Accelerator for HL7 ([!INCLUDE[btaBTAHL71.3abbrevnonumber](../../includes/btabtahl71-3abbrevnonumber-md.md)]) leverages the message processing capabilities of Microsoft [!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)], but also extends it in several ways that are specific to HL7 messaging requirements.</span></span>  

## <a name="routing-overview"></a><span data-ttu-id="7793d-104">路由概觀</span><span class="sxs-lookup"><span data-stu-id="7793d-104">Routing overview</span></span>

<span data-ttu-id="7793d-105">HL7 從企業營運 (LOB) 系統中，接收訊息，而且可能會收到使用 MLLP 配接器。</span><span class="sxs-lookup"><span data-stu-id="7793d-105">HL7 receives messages from a Line of Business (LOB) system, and may receive them using the MLLP adapter.</span></span> <span data-ttu-id="7793d-106">LOB 系統連線至 MLLP 配接器上[!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)]透過 TCP 連接埠，然後再將訊息傳送至 MLLP 配接器。</span><span class="sxs-lookup"><span data-stu-id="7793d-106">The LOB system connects to MLLP adapter on [!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)] over a TCP port, and then sends messages to the MLLP adapter.</span></span>

<span data-ttu-id="7793d-107">在   **[!INCLUDE[bts2013r2_md](../../includes/bts2013r2-md.md)]和舊版**，HL7 MLLP 接收遠端 LOB 系統連線至 MLLP 傳輸配接器等候。</span><span class="sxs-lookup"><span data-stu-id="7793d-107">In **[!INCLUDE[bts2013r2_md](../../includes/bts2013r2-md.md)] and older versions**, the HL7 MLLP receive transport adapter waits for the remote LOB system to connect to MLLP.</span></span> <span data-ttu-id="7793d-108">一旦遠端 LOB 系統連線時，LOB 系統使用傳送訊息至 MLLP [!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="7793d-108">Once the remote LOB system connects, the LOB system sends the messages using MLLP to the [!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)].</span></span> <span data-ttu-id="7793d-109">具體來說：</span><span class="sxs-lookup"><span data-stu-id="7793d-109">Specifically:</span></span> 

1. <span data-ttu-id="7793d-110">遠端 LOB 系統連接到在本機上的 MLLP 配接器[!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)]使用 TCP 連接埠</span><span class="sxs-lookup"><span data-stu-id="7793d-110">The remote LOB system connects to the MLLP adapter on the local [!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)] using a TCP port</span></span> 
2. <span data-ttu-id="7793d-111">BTA4HL7 接收位置使用 MLLP 配接器接受連線</span><span class="sxs-lookup"><span data-stu-id="7793d-111">The BTA4HL7 receive location with MLLP Adapter accepts the connection</span></span> 
3. <span data-ttu-id="7793d-112">遠端 LOB 系統會傳送一個或多個訊息</span><span class="sxs-lookup"><span data-stu-id="7793d-112">The remote LOB system delivers one or more messages</span></span> 
4. <span data-ttu-id="7793d-113">中斷遠端 LOB 系統的連線</span><span class="sxs-lookup"><span data-stu-id="7793d-113">The remote LOB system disconnects</span></span>

<span data-ttu-id="7793d-114">在   **[!INCLUDE[bts2016_md](../../includes/bts2016-md.md)]和較新版本**MLLP 配接器起始連接至 LOB 系統，然後 MLLP LOB 系統的推播訊息接收。</span><span class="sxs-lookup"><span data-stu-id="7793d-114">In **[!INCLUDE[bts2016_md](../../includes/bts2016-md.md)] and newer versions**, the connection to the LOB system is initiated by the MLLP adapter, and then the LOB system pushes messages to the MLLP receive.</span></span> <span data-ttu-id="7793d-115">換句話說，遠端 LOB 系統的連接，再將訊息傳送至 MLLP 而等候。</span><span class="sxs-lookup"><span data-stu-id="7793d-115">In other words, the remote LOB system waits for the connection before sending messagings to MLLP.</span></span> <span data-ttu-id="7793d-116">具體來說：</span><span class="sxs-lookup"><span data-stu-id="7793d-116">Specifically:</span></span> 

1. <span data-ttu-id="7793d-117">本機[!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)]連線到遠端的 LOB 系統使用 TCP 連接埠</span><span class="sxs-lookup"><span data-stu-id="7793d-117">The local [!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)] connects to the remote LOB system using a TCP port</span></span> 
2. <span data-ttu-id="7793d-118">BTA4HL7 接收位置使用 MLLP 配接器起始連接</span><span class="sxs-lookup"><span data-stu-id="7793d-118">The BTA4HL7 receive location with MLLP adapter initiates the connection</span></span> 
3. <span data-ttu-id="7793d-119">遠端 LOB 系統會傳送一個或多個訊息</span><span class="sxs-lookup"><span data-stu-id="7793d-119">The remote LOB system delivers one or more messages</span></span> 
4. <span data-ttu-id="7793d-120">中斷遠端 LOB 系統的連線</span><span class="sxs-lookup"><span data-stu-id="7793d-120">The remote LOB system disconnects</span></span> 

<span data-ttu-id="7793d-121">為了回溯相容性，您可以使用原始的預設行為遠端 LOB 系統會起始連線。</span><span class="sxs-lookup"><span data-stu-id="7793d-121">For backwards-compatibility, you can use the original default behavior where the remote LOB system initiates the connections.</span></span> <span data-ttu-id="7793d-122">此選項是可設定在 MLLP 接收位置屬性。</span><span class="sxs-lookup"><span data-stu-id="7793d-122">This option is configurable in the MLLP receive location properties.</span></span> 
 
<span data-ttu-id="7793d-123">一旦接收 HL7 訊息，然後提交給 HL7 接收管線。</span><span class="sxs-lookup"><span data-stu-id="7793d-123">Once the HL7 message is received, it is then submitted to an HL7 receive pipeline.</span></span> <span data-ttu-id="7793d-124">此管線中，內 HL7 反組譯工具就會剖析訊息，並將驗證根據適當的結構描述定義和驗證組態訊息。</span><span class="sxs-lookup"><span data-stu-id="7793d-124">Within this pipeline, the HL7 disassembler will parse the message, and will validate the message according to the appropriate schema definition and validation configuration.</span></span> <span data-ttu-id="7793d-125">此時，HL7 通知訊息可能會產生 （成功或錯誤），根據訊息和相關的通知設定的有效性。</span><span class="sxs-lookup"><span data-stu-id="7793d-125">At this point, an HL7 acknowledgment message may be generated (success or error), according to the validity of the message and the relevant acknowledgment configuration.</span></span> <span data-ttu-id="7793d-126">從這裡開始，管線就會提交至 MessageBox 資料庫，以便進一步處理和路由的選擇性通知與訊息執行個體。</span><span class="sxs-lookup"><span data-stu-id="7793d-126">From here, the pipeline will submit the message instance and optional acknowledgment to the MessageBox database for further processing and routing.</span></span>  
  
 <span data-ttu-id="7793d-127">一旦到達 MessageBox 資料庫中的訊息執行個體[!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)]檢查篩選為基礎的訂用帳戶，並會將訊息路由至一或多個傳送埠 （可能是 MLLP 連接埠） 透過 HL7 傳送管線。</span><span class="sxs-lookup"><span data-stu-id="7793d-127">Once a message instance arrives in the MessageBox database, [!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)] checks filter-based subscriptions and routes the message to one or more send ports (possibly MLLP ports) through an HL7 send pipeline.</span></span> <span data-ttu-id="7793d-128">傳送管線可以驗證訊息執行個體，根據適當的結構描述定義和驗證組態。</span><span class="sxs-lookup"><span data-stu-id="7793d-128">The send pipeline may validate the message instances according to the appropriate schema definition and validation configuration.</span></span> <span data-ttu-id="7793d-129">除了驗證，就可以覆寫指定外寄訊息的 MSH 區段中的欄位值。</span><span class="sxs-lookup"><span data-stu-id="7793d-129">In addition to validation, it is possible to override certain field values in the MSH segment of the outgoing message.</span></span> <span data-ttu-id="7793d-130">如果多個連接埠已訂閱的訊息，而且每個接收應用程式唯一的期望 MSH 區段值範圍內，這項覆寫功能就特別有用。</span><span class="sxs-lookup"><span data-stu-id="7793d-130">This override ability is especially useful if multiple ports have subscribed to a message and each receiving application has unique expectations within the MSH segment values.</span></span>  
  
 <span data-ttu-id="7793d-131">當然，所有其他[!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)]傳送和接收連接埠功能可供 HL7 訊息，以及一些功能，可能是唯一選取的連接埠類型，例如 MLLP 傳送連接埠參數。</span><span class="sxs-lookup"><span data-stu-id="7793d-131">Of course, all of the other [!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)] send and receive port capabilities will be available to HL7 messages, along with some capabilities that may be unique to the selected port type, such as MLLP send-port parameters.</span></span> <span data-ttu-id="7793d-132">相關範例[!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)]功能是能夠套用至外寄訊息的轉換對應。</span><span class="sxs-lookup"><span data-stu-id="7793d-132">An example of the relevant [!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)] capabilities would be the ability to apply a transformation map to an outbound message.</span></span>  
  
## <a name="how-routing-works"></a><span data-ttu-id="7793d-133">路由的運作方式</span><span class="sxs-lookup"><span data-stu-id="7793d-133">How Routing Works</span></span>

<span data-ttu-id="7793d-134">[!INCLUDE[btaBTAHL7NoNumber_md](../../includes/btabtahl7nonumber-md.md)]路由 HL7 訊息根據 MessageBox 資料庫所管理的訂用帳戶的執行個體。</span><span class="sxs-lookup"><span data-stu-id="7793d-134">The [!INCLUDE[btaBTAHL7NoNumber_md](../../includes/btabtahl7nonumber-md.md)] routes HL7 message instances according to subscriptions that the MessageBox database manages.</span></span> <span data-ttu-id="7793d-135">這些訂用帳戶會使用您所定義的篩選器，每個傳送埠。</span><span class="sxs-lookup"><span data-stu-id="7793d-135">These subscriptions use filters that you define for each send port.</span></span> <span data-ttu-id="7793d-136">範例篩選器可能會包括路由以在接收連接埠識別碼和/或 HL7 訊息類型 (ADT ^ 將 adt^a03，例如) 及/或傳送應用程式 （MSH3.1 值）。</span><span class="sxs-lookup"><span data-stu-id="7793d-136">Example filters might include routing based on receive port ID and/or HL7 message type (ADT^A03, for example) and/or sending application (MSH3.1 value).</span></span>  
  
 <span data-ttu-id="7793d-137">除了設定[!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)]訂用帳戶，您需要執行一些 HL7 特定訊息的組態會影響 HL7 訊息執行個體，做為[!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)]路由傳送。</span><span class="sxs-lookup"><span data-stu-id="7793d-137">In addition to setting up [!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)] subscriptions, you need to perform some HL7-specific messaging configuration that will affect HL7 message instances as [!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)] routes them.</span></span> <span data-ttu-id="7793d-138">此額外設定可讓您套用唯一 HL7 驗證規則、 自動產生的通知，以及能夠覆寫 MSH 值。</span><span class="sxs-lookup"><span data-stu-id="7793d-138">This additional configuration enables you to apply unique HL7 validation rules, automatic generation of acknowledgments, and the ability to override MSH values.</span></span> [!INCLUDE[HL7_CurrentVersion_abbrev_md](../../includes/hl7-currentversion-abbrev-md.md)]<span data-ttu-id="7793d-139"> 適用於此合作對象層級的設定。</span><span class="sxs-lookup"><span data-stu-id="7793d-139"> applies this configuration at the party level.</span></span> <span data-ttu-id="7793d-140">您需要定義合作對象，BizTalk 總管 中的，並執行相關的 HL7 組態內[!INCLUDE[HL7_CurrentVersion_abbrev_md](../../includes/hl7-currentversion-abbrev-md.md)]組態總管。</span><span class="sxs-lookup"><span data-stu-id="7793d-140">You need to define parties within BizTalk Explorer and perform the related HL7 configuration within [!INCLUDE[HL7_CurrentVersion_abbrev_md](../../includes/hl7-currentversion-abbrev-md.md)] Configuration Explorer.</span></span>  
  
 <span data-ttu-id="7793d-141">若要套用至多個訂閱的訊息的傳送埠的唯一 HL7 傳訊組態 （例如驗證或 MSH 覆寫），您需要建立合作對象之間的關聯和傳送埠。</span><span class="sxs-lookup"><span data-stu-id="7793d-141">To apply unique HL7 messaging configuration (for example, validation or MSH overrides) to multiple send ports that subscribe to a message, you need to create associations between parties and send ports.</span></span> <span data-ttu-id="7793d-142">您可將合作對象-傳送埠關聯設定為 [BizTalk 總管] 中的合作對象屬性中。</span><span class="sxs-lookup"><span data-stu-id="7793d-142">You configure party-to-send port associations as party properties within BizTalk Explorer.</span></span>  
  
 <span data-ttu-id="7793d-143">如果您不需要將訊息路由 HL7 至多個傳送埠，或將唯一 HL7 處理組態套用至多個傳送埠，您可以避免將合作對象與傳送埠產生關聯的步驟。</span><span class="sxs-lookup"><span data-stu-id="7793d-143">If you do not need to route HL7 messages to multiple send ports, or apply unique HL7 processing configuration to multiple send ports, you can eliminate the step of associating parties with send ports.</span></span> <span data-ttu-id="7793d-144">在此情況下，[!INCLUDE[HL7_CurrentVersion_abbrev_md](../../includes/hl7-currentversion-abbrev-md.md)]關聯接收 HL7 訊息 (MSH 3.1) 中的應用程式欄位透過其 HL7 傳訊組態的合作對象。</span><span class="sxs-lookup"><span data-stu-id="7793d-144">In this case, [!INCLUDE[HL7_CurrentVersion_abbrev_md](../../includes/hl7-currentversion-abbrev-md.md)] associates the party with its HL7 messaging configuration through the receiving application field in the HL7 message (MSH 3.1).</span></span> <span data-ttu-id="7793d-145">這種情況下是最有可能發生在 HL7 interrogative （要求/回應） 訊息交換。</span><span class="sxs-lookup"><span data-stu-id="7793d-145">This situation is most likely to occur in an HL7 interrogative (request/response) message exchange.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="7793d-146">另請參閱</span><span class="sxs-lookup"><span data-stu-id="7793d-146">See Also</span></span>  
 [<span data-ttu-id="7793d-147">訊息驗證</span><span class="sxs-lookup"><span data-stu-id="7793d-147">Message Validation</span></span>](../../adapters-and-accelerators/accelerator-hl7/message-validation.md)