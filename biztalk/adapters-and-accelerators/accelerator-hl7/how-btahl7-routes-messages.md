---
title: BTAHL7 將訊息路由 |Microsoft 文件
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
helpviewer_keywords:
- routing, about routing
- routing, messages
- messages, routing
- BTAHL7, message routing
ms.assetid: 555696c7-6023-44eb-b13d-cf7527bbc92f
caps.latest.revision: 7
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 61dd223a014ae8ea7de35d8d73f1a7cf7ef35449
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 09/20/2017
ms.locfileid: "22205094"
---
# <a name="how-btahl7-routes-messages"></a><span data-ttu-id="4a837-102">BTAHL7 將訊息路由</span><span class="sxs-lookup"><span data-stu-id="4a837-102">How BTAHL7 Routes Messages</span></span>
[!INCLUDE[btsCoName](../../includes/btsconame-md.md)]<span data-ttu-id="4a837-103">BizTalk Accelerator for HL7 ([!INCLUDE[btaBTAHL71.3abbrevnonumber](../../includes/btabtahl71-3abbrevnonumber-md.md)]) 的訊息處理功能會利用[!INCLUDE[btsCoName](../../includes/btsconame-md.md)] [!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)]，但還擴充它 HL7 訊息需求所特定的數個方式。</span><span class="sxs-lookup"><span data-stu-id="4a837-103"> BizTalk Accelerator for HL7 ([!INCLUDE[btaBTAHL71.3abbrevnonumber](../../includes/btabtahl71-3abbrevnonumber-md.md)]) leverages the message processing capabilities of [!INCLUDE[btsCoName](../../includes/btsconame-md.md)] [!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)], but also extends it in several ways that are specific to HL7 messaging requirements.</span></span>  

## <a name="routing-overview"></a><span data-ttu-id="4a837-104">路由概觀</span><span class="sxs-lookup"><span data-stu-id="4a837-104">Routing overview</span></span>

<span data-ttu-id="4a837-105">HL7 從企業營運 (LOB) 系統接收訊息，並可能會收到使用 MLLP 配接器。</span><span class="sxs-lookup"><span data-stu-id="4a837-105">HL7 receives messages from a Line of Business (LOB) system, and may receive them using the MLLP adapter.</span></span> <span data-ttu-id="4a837-106">MLLP 配接器至 LOB 系統連接[!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)]透過 TCP 連接埠，然後再將訊息傳送至 MLLP 配接器。</span><span class="sxs-lookup"><span data-stu-id="4a837-106">The LOB system connects to MLLP adapter on [!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)] over a TCP port, and then sends messages to the MLLP adapter.</span></span>

<span data-ttu-id="4a837-107">在**[!INCLUDE[bts2013r2_md](../../includes/bts2013r2-md.md)]和較舊版本**，HL7 MLLP 接收傳輸配接器等候的遠端連線到 MLLP LOB 系統。</span><span class="sxs-lookup"><span data-stu-id="4a837-107">In **[!INCLUDE[bts2013r2_md](../../includes/bts2013r2-md.md)] and older versions**, the HL7 MLLP receive transport adapter waits for the remote LOB system to connect to MLLP.</span></span> <span data-ttu-id="4a837-108">LOB 系統遠端 LOB 系統連線時，一旦傳送訊息使用到 MLLP [!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="4a837-108">Once the remote LOB system connects, the LOB system sends the messages using MLLP to the [!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)].</span></span> <span data-ttu-id="4a837-109">具體來說：</span><span class="sxs-lookup"><span data-stu-id="4a837-109">Specifically:</span></span> 

1. <span data-ttu-id="4a837-110">遠端部署 LOB 系統連線至 MLLP 配接器在本機[!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)]使用 TCP 連接埠</span><span class="sxs-lookup"><span data-stu-id="4a837-110">The remote LOB system connects to the MLLP adapter on the local [!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)] using a TCP port</span></span> 
2. <span data-ttu-id="4a837-111">BTA4HL7 使用接收位置 MLLP 配接器接受連線</span><span class="sxs-lookup"><span data-stu-id="4a837-111">The BTA4HL7 receive location with MLLP Adapter accepts the connection</span></span> 
3. <span data-ttu-id="4a837-112">遠端部署 LOB 系統會傳遞一或多個訊息</span><span class="sxs-lookup"><span data-stu-id="4a837-112">The remote LOB system delivers one or more messages</span></span> 
4. <span data-ttu-id="4a837-113">遠端部署 LOB 系統中斷連接</span><span class="sxs-lookup"><span data-stu-id="4a837-113">The remote LOB system disconnects</span></span>

<span data-ttu-id="4a837-114">在**[!INCLUDE[bts2016_md](../../includes/bts2016-md.md)]和較新版本**MLLP 配接器，由起始連接至 LOB 系統，然後 MLLP LOB 系統推播通知訊息接收。</span><span class="sxs-lookup"><span data-stu-id="4a837-114">In **[!INCLUDE[bts2016_md](../../includes/bts2016-md.md)] and newer versions**, the connection to the LOB system is initiated by the MLLP adapter, and then the LOB system pushes messages to the MLLP receive.</span></span> <span data-ttu-id="4a837-115">換句話說，遠端 LOB 系統的連接，再將訊息傳送至 MLLP 而等候。</span><span class="sxs-lookup"><span data-stu-id="4a837-115">In other words, the remote LOB system waits for the connection before sending messagings to MLLP.</span></span> <span data-ttu-id="4a837-116">具體來說：</span><span class="sxs-lookup"><span data-stu-id="4a837-116">Specifically:</span></span> 

1. <span data-ttu-id="4a837-117">本機[!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)]連線到遠端的 LOB 系統使用 TCP 連接埠</span><span class="sxs-lookup"><span data-stu-id="4a837-117">The local [!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)] connects to the remote LOB system using a TCP port</span></span> 
2. <span data-ttu-id="4a837-118">BTA4HL7 使用接收位置 MLLP 配接器會起始連線</span><span class="sxs-lookup"><span data-stu-id="4a837-118">The BTA4HL7 receive location with MLLP adapter initiates the connection</span></span> 
3. <span data-ttu-id="4a837-119">遠端部署 LOB 系統會傳遞一或多個訊息</span><span class="sxs-lookup"><span data-stu-id="4a837-119">The remote LOB system delivers one or more messages</span></span> 
4. <span data-ttu-id="4a837-120">遠端部署 LOB 系統中斷連接</span><span class="sxs-lookup"><span data-stu-id="4a837-120">The remote LOB system disconnects</span></span> 

<span data-ttu-id="4a837-121">為了回溯相容性，您可以使用原始的預設行為遠端 LOB 系統會起始連線。</span><span class="sxs-lookup"><span data-stu-id="4a837-121">For backwards-compatibility, you can use the original default behavior where the remote LOB system initiates the connections.</span></span> <span data-ttu-id="4a837-122">此選項為 MLLP 中可設定接收位置屬性。</span><span class="sxs-lookup"><span data-stu-id="4a837-122">This option is configurable in the MLLP receive location properties.</span></span> 
 
<span data-ttu-id="4a837-123">一旦收到 HL7 訊息，然後提交給 HL7 接收管線。</span><span class="sxs-lookup"><span data-stu-id="4a837-123">Once the HL7 message is received, it is then submitted to an HL7 receive pipeline.</span></span> <span data-ttu-id="4a837-124">此管線中，內 HL7 解譯器就會剖析訊息，並將驗證根據適當的結構描述定義和驗證設定將訊息。</span><span class="sxs-lookup"><span data-stu-id="4a837-124">Within this pipeline, the HL7 disassembler will parse the message, and will validate the message according to the appropriate schema definition and validation configuration.</span></span> <span data-ttu-id="4a837-125">此時，可能會有通知訊息 HL7 產生 （成功或錯誤），根據訊息和相關的通知設定的有效性。</span><span class="sxs-lookup"><span data-stu-id="4a837-125">At this point, an HL7 acknowledgment message may be generated (success or error), according to the validity of the message and the relevant acknowledgment configuration.</span></span> <span data-ttu-id="4a837-126">從這裡，管線就會送出的訊息執行個體和選擇性通知至 MessageBox 資料庫，以便進一步處理和路由。</span><span class="sxs-lookup"><span data-stu-id="4a837-126">From here, the pipeline will submit the message instance and optional acknowledgment to the MessageBox database for further processing and routing.</span></span>  
  
 <span data-ttu-id="4a837-127">一旦在 MessageBox 資料庫中，抵達的訊息執行個體[!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)]檢查篩選器為基礎的訂閱，並將訊息路由傳送至一個或多個傳送埠 （可能是 MLLP 連接埠） 透過 HL7 傳送管線。</span><span class="sxs-lookup"><span data-stu-id="4a837-127">Once a message instance arrives in the MessageBox database, [!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)] checks filter-based subscriptions and routes the message to one or more send ports (possibly MLLP ports) through an HL7 send pipeline.</span></span> <span data-ttu-id="4a837-128">傳送管線會驗證訊息執行個體，以根據適當的結構描述定義和驗證組態。</span><span class="sxs-lookup"><span data-stu-id="4a837-128">The send pipeline may validate the message instances according to the appropriate schema definition and validation configuration.</span></span> <span data-ttu-id="4a837-129">除了驗證，很可能覆寫指定外寄訊息的 MSH 區段中的欄位值。</span><span class="sxs-lookup"><span data-stu-id="4a837-129">In addition to validation, it is possible to override certain field values in the MSH segment of the outgoing message.</span></span> <span data-ttu-id="4a837-130">如果多個連接埠已訂閱訊息，而且每個接收應用程式的 MSH 區段值內的唯一期望，覆寫這項功能就特別有用。</span><span class="sxs-lookup"><span data-stu-id="4a837-130">This override ability is especially useful if multiple ports have subscribed to a message and each receiving application has unique expectations within the MSH segment values.</span></span>  
  
 <span data-ttu-id="4a837-131">當然，所有其他[!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)]傳送和接收埠將提供給 HL7 訊息，以及一些功能，可能是唯一選取的連接埠的型別，例如 MLLP 傳送埠參數的功能。</span><span class="sxs-lookup"><span data-stu-id="4a837-131">Of course, all of the other [!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)] send and receive port capabilities will be available to HL7 messages, along with some capabilities that may be unique to the selected port type, such as MLLP send-port parameters.</span></span> <span data-ttu-id="4a837-132">相關的範例[!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)]功能會將轉換對應套用至外寄訊息的能力。</span><span class="sxs-lookup"><span data-stu-id="4a837-132">An example of the relevant [!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)] capabilities would be the ability to apply a transformation map to an outbound message.</span></span>  
  
## <a name="how-routing-works"></a><span data-ttu-id="4a837-133">路由的運作方式</span><span class="sxs-lookup"><span data-stu-id="4a837-133">How Routing Works</span></span>

<span data-ttu-id="4a837-134">[!INCLUDE[btaBTAHL7NoNumber_md](../../includes/btabtahl7nonumber-md.md)]路由 HL7 訊息根據管理 MessageBox 資料庫的訂用帳戶的執行個體。</span><span class="sxs-lookup"><span data-stu-id="4a837-134">The [!INCLUDE[btaBTAHL7NoNumber_md](../../includes/btabtahl7nonumber-md.md)] routes HL7 message instances according to subscriptions that the MessageBox database manages.</span></span> <span data-ttu-id="4a837-135">這些訂用帳戶會使用您定義的篩選條件，每個傳送埠。</span><span class="sxs-lookup"><span data-stu-id="4a837-135">These subscriptions use filters that you define for each send port.</span></span> <span data-ttu-id="4a837-136">範例篩選器可能會包括路由基礎在接收連接埠 ID 及/或 HL7 訊息類型 (ADT ^ A03，例如) 和/或傳送應用程式 （MSH3.1 值）。</span><span class="sxs-lookup"><span data-stu-id="4a837-136">Example filters might include routing based on receive port ID and/or HL7 message type (ADT^A03, for example) and/or sending application (MSH3.1 value).</span></span>  
  
 <span data-ttu-id="4a837-137">除了設定[!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)]訂用帳戶，您需要執行一些 HL7 特定訊息設定會影響 HL7 訊息執行個體做為[!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)]路由傳送。</span><span class="sxs-lookup"><span data-stu-id="4a837-137">In addition to setting up [!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)] subscriptions, you need to perform some HL7-specific messaging configuration that will affect HL7 message instances as [!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)] routes them.</span></span> <span data-ttu-id="4a837-138">此額外的設定可讓您套用唯一 HL7 驗證規則，自動產生的通知，並覆寫的 MSH 值的能力。</span><span class="sxs-lookup"><span data-stu-id="4a837-138">This additional configuration enables you to apply unique HL7 validation rules, automatic generation of acknowledgments, and the ability to override MSH values.</span></span> [!INCLUDE[HL7_CurrentVersion_abbrev_md](../../includes/hl7-currentversion-abbrev-md.md)]<span data-ttu-id="4a837-139">套用此設定在合作對象層級。</span><span class="sxs-lookup"><span data-stu-id="4a837-139"> applies this configuration at the party level.</span></span> <span data-ttu-id="4a837-140">您需要定義合作對象在 BizTalk 總管 中，執行中的相關的 HL7 組態[!INCLUDE[HL7_CurrentVersion_abbrev_md](../../includes/hl7-currentversion-abbrev-md.md)]Configuration 總管。</span><span class="sxs-lookup"><span data-stu-id="4a837-140">You need to define parties within BizTalk Explorer and perform the related HL7 configuration within [!INCLUDE[HL7_CurrentVersion_abbrev_md](../../includes/hl7-currentversion-abbrev-md.md)] Configuration Explorer.</span></span>  
  
 <span data-ttu-id="4a837-141">若要套用至多個訂閱訊息的傳送埠的唯一 HL7 訊息的組態 （例如，驗證或 MSH 覆寫），您需要建立合作對象之間的關聯和傳送埠。</span><span class="sxs-lookup"><span data-stu-id="4a837-141">To apply unique HL7 messaging configuration (for example, validation or MSH overrides) to multiple send ports that subscribe to a message, you need to create associations between parties and send ports.</span></span> <span data-ttu-id="4a837-142">將合作對象的傳送埠關聯設定為在 BizTalk 總管 中的合作對象屬性。</span><span class="sxs-lookup"><span data-stu-id="4a837-142">You configure party-to-send port associations as party properties within BizTalk Explorer.</span></span>  
  
 <span data-ttu-id="4a837-143">如果您不需要將訊息路由 HL7 至多個傳送埠，或唯一 HL7 處理設定套用至多個傳送埠，您可以排除的步驟，將合作對象與傳送埠產生關聯。</span><span class="sxs-lookup"><span data-stu-id="4a837-143">If you do not need to route HL7 messages to multiple send ports, or apply unique HL7 processing configuration to multiple send ports, you can eliminate the step of associating parties with send ports.</span></span> <span data-ttu-id="4a837-144">在此情況下，[!INCLUDE[HL7_CurrentVersion_abbrev_md](../../includes/hl7-currentversion-abbrev-md.md)]合作對象關聯接收應用程式訊息中的欄位 HL7 (MSH 3.1) 透過其 HL7 訊息組態。</span><span class="sxs-lookup"><span data-stu-id="4a837-144">In this case, [!INCLUDE[HL7_CurrentVersion_abbrev_md](../../includes/hl7-currentversion-abbrev-md.md)] associates the party with its HL7 messaging configuration through the receiving application field in the HL7 message (MSH 3.1).</span></span> <span data-ttu-id="4a837-145">這種情況下是最有可能發生在 HL7 interrogative （要求/回應） 訊息交換。</span><span class="sxs-lookup"><span data-stu-id="4a837-145">This situation is most likely to occur in an HL7 interrogative (request/response) message exchange.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="4a837-146">另請參閱</span><span class="sxs-lookup"><span data-stu-id="4a837-146">See Also</span></span>  
 [<span data-ttu-id="4a837-147">訊息驗證</span><span class="sxs-lookup"><span data-stu-id="4a837-147">Message Validation</span></span>](../../adapters-and-accelerators/accelerator-hl7/message-validation.md)