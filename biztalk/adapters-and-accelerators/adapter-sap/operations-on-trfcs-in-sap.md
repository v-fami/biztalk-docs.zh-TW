---
title: 對 sap 的 Trfc 的作業 |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
helpviewer_keywords:
- RFCs, invoking transactional RFCs in an SAP System
- TID database
- transactional RFCs
- tRFCs, receiving inbound iransactional RFC calls from an SAP system
- tRFCs
- GUID parameter
- RFCs, processing inbound
- RfcConfirmTransID
- transaction ID (TID)
- tRFC Operations
- IDOCS, receiving IDOCs as a tRFC server
- adapters, operations on tRFCs
- RFC, invoking an RFC
ms.assetid: d6a5c515-d6aa-4b70-9c23-32d1dd94d473
caps.latest.revision: 5
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: b99822d838f0681cf9a6ce336ed1a23f4088c659
ms.sourcegitcommit: 266308ec5c6a9d8d80ff298ee6051b4843c5d626
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 06/27/2018
ms.locfileid: "36996135"
---
# <a name="operations-on-trfcs-in-sap"></a><span data-ttu-id="5f004-102">對 sap 的 Trfc 的作業</span><span class="sxs-lookup"><span data-stu-id="5f004-102">Operations on tRFCs in SAP</span></span>
<span data-ttu-id="5f004-103">交易式 Rfc (Trfc) 是工作的一個邏輯單位 (LUW) 的一部分叫用 Rfc。</span><span class="sxs-lookup"><span data-stu-id="5f004-103">Transactional RFCs (tRFCs) are RFCs that are invoked as part of a logical unit of work (LUW).</span></span> <span data-ttu-id="5f004-104">在 SAP 系統上，LUW 包含所有完成的商務或程式設計工作所需的步驟。</span><span class="sxs-lookup"><span data-stu-id="5f004-104">On an SAP system, an LUW contains all of the steps necessary to complete a business or programming task.</span></span> <span data-ttu-id="5f004-105">TRFC 代表一種叫用 RFC;它不是唯一的 SAP 成品。</span><span class="sxs-lookup"><span data-stu-id="5f004-105">A tRFC represents a way of invoking an RFC; it is not a unique SAP artifact.</span></span>  
  
 <span data-ttu-id="5f004-106">您可以使用[!INCLUDE[adaptersap](../../includes/adaptersap-md.md)]作為 tRFC 用戶端和 tRFC 伺服器。</span><span class="sxs-lookup"><span data-stu-id="5f004-106">You can use the [!INCLUDE[adaptersap](../../includes/adaptersap-md.md)] both as a tRFC client and as a tRFC server.</span></span>  
  
-   <span data-ttu-id="5f004-107">**TRFC 用戶端為**，配接器可讓您的應用程式叫用單一的 RFC LUW 上 SAP 系統中。</span><span class="sxs-lookup"><span data-stu-id="5f004-107">**As a tRFC client**, the adapter enables your application to invoke a single RFC in an LUW on the SAP system.</span></span> <span data-ttu-id="5f004-108">這可確保一次只執行 RFC。</span><span class="sxs-lookup"><span data-stu-id="5f004-108">This guarantees one-time only execution of the RFC.</span></span> <span data-ttu-id="5f004-109">它並不表示交易式的行為。</span><span class="sxs-lookup"><span data-stu-id="5f004-109">It does not imply transactional behavior.</span></span>  
  
-   <span data-ttu-id="5f004-110">**為 tRFC 伺服器**，配接器可讓您接收 LUW 內的多個 Rfc。</span><span class="sxs-lookup"><span data-stu-id="5f004-110">**As a tRFC server**, the adapter enables you to receive multiple RFCs inside an LUW.</span></span> <span data-ttu-id="5f004-111">配接器支援交易的內容; 中的輸入的 tRFC 呼叫這是認可，並且支援向前復原後的行為。</span><span class="sxs-lookup"><span data-stu-id="5f004-111">The adapter supports inbound tRFC calls in a transactional context; that is commit and roll back behavior are supported.</span></span>  
  
## <a name="trfc-operations"></a><span data-ttu-id="5f004-112">tRFC 作業</span><span class="sxs-lookup"><span data-stu-id="5f004-112">tRFC Operations</span></span>  
 <span data-ttu-id="5f004-113">TRFC 隱含的方式叫用 RFC;它不是個別的 SAP 成品。</span><span class="sxs-lookup"><span data-stu-id="5f004-113">A tRFC implies a way of invoking an RFC; it is not a separate SAP artifact.</span></span> <span data-ttu-id="5f004-114">（為其配接器可以擷取中繼資料） 的 SAP 系統上的每個 RFC 也因此，顯示為的 tRFC [!INCLUDE[adaptersap_short](../../includes/adaptersap-short-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="5f004-114">Therefore, every RFC on the SAP system (for which the adapter can retrieve metadata) is also surfaced as a tRFC by the [!INCLUDE[adaptersap_short](../../includes/adaptersap-short-md.md)].</span></span> <span data-ttu-id="5f004-115">Trfc 依 RFC 名稱顯示為的 TRFC 中繼資料類別目錄節點下的讀取作業。</span><span class="sxs-lookup"><span data-stu-id="5f004-115">tRFCs are surfaced by RFC name as operations under the TRFC metadata category node.</span></span> <span data-ttu-id="5f004-116">(您可以瀏覽或搜尋在 Trfc **TRFC**當您使用的節點[!INCLUDE[addadapterservrefshort](../../includes/addadapterservrefshort-md.md)]或[!INCLUDE[consumeadapterservshort](../../includes/consumeadapterservshort-md.md)]。)</span><span class="sxs-lookup"><span data-stu-id="5f004-116">(You can browse or search for tRFCs under the **TRFC** node when you use the [!INCLUDE[addadapterservrefshort](../../includes/addadapterservrefshort-md.md)] or the [!INCLUDE[consumeadapterservshort](../../includes/consumeadapterservshort-md.md)].)</span></span>  
  
 <span data-ttu-id="5f004-117">[!INCLUDE[adaptersap_short](../../includes/adaptersap-short-md.md)] Trfc 上支援下列：</span><span class="sxs-lookup"><span data-stu-id="5f004-117">The [!INCLUDE[adaptersap_short](../../includes/adaptersap-short-md.md)] supports the following on tRFCs:</span></span>  
  
-   <span data-ttu-id="5f004-118">匯入參數</span><span class="sxs-lookup"><span data-stu-id="5f004-118">IMPORT parameters</span></span>  
  
-   <span data-ttu-id="5f004-119">變更的參數 （支援變更參數的輸入的端）</span><span class="sxs-lookup"><span data-stu-id="5f004-119">CHANGING parameters (only the input side of the CHANGING parameter is supported)</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="5f004-120">Trfc 會以非同步方式執行，因此它們會不傳回任何輸出值 （匯出或變更參數）。</span><span class="sxs-lookup"><span data-stu-id="5f004-120">tRFCs are executed asynchronously, so no output values (EXPORT or CHANGING parameters) are returned for them.</span></span>  
  
 <span data-ttu-id="5f004-121">TRFC 作業的配接器，會顯示 GUID 參數。</span><span class="sxs-lookup"><span data-stu-id="5f004-121">A GUID parameter is surfaced by the adapter for tRFC operations.</span></span> <span data-ttu-id="5f004-122">此 GUID 被對應到 SAP 交易識別碼 (TID) tRFC 與相關聯的配接器。</span><span class="sxs-lookup"><span data-stu-id="5f004-122">This GUID is mapped by the adapter to the SAP transaction ID (TID) that is associated with the tRFC.</span></span> <span data-ttu-id="5f004-123">您可以使用此 GUID 參數：</span><span class="sxs-lookup"><span data-stu-id="5f004-123">You can use this GUID parameter to:</span></span>  
  
- <span data-ttu-id="5f004-124">確認 tRFC tRFC 用戶端呼叫中的 SAP 系統上。</span><span class="sxs-lookup"><span data-stu-id="5f004-124">Confirm the tRFC on the SAP system in tRFC client calls.</span></span> <span data-ttu-id="5f004-125">您可以叫用 RfcConfirmTransId 作業。</span><span class="sxs-lookup"><span data-stu-id="5f004-125">You do this by invoking the RfcConfirmTransId operation.</span></span> <span data-ttu-id="5f004-126">這是由配接器必須確認 TID SAP 系統上的顯示特殊作業。</span><span class="sxs-lookup"><span data-stu-id="5f004-126">This is a special operation surfaced by the adapter to confirm a TID on the SAP system.</span></span>  
  
- <span data-ttu-id="5f004-127">取得實際的 SAP TID tRFC tRFC 用戶端和 tRFC 伺服器案例中的配接器的使用。</span><span class="sxs-lookup"><span data-stu-id="5f004-127">Get the actual SAP TID used for a tRFC from the adapter in both tRFC client and tRFC server scenarios.</span></span> <span data-ttu-id="5f004-128">您可以叫用 SAP 公用程式方法，ConvertGuidToTid 即可。</span><span class="sxs-lookup"><span data-stu-id="5f004-128">You do this by invoking the SAP utility method, ConvertGuidToTid.</span></span>  
  
  <span data-ttu-id="5f004-129">如需有關這些作業的詳細資訊，請參閱 <<c0> [ 特殊作業](../../adapters-and-accelerators/adapter-sap/special-operations.md)。</span><span class="sxs-lookup"><span data-stu-id="5f004-129">For more information about these operations, see [Special Operations](../../adapters-and-accelerators/adapter-sap/special-operations.md).</span></span> <span data-ttu-id="5f004-130">如需有關用於 Trfc 配接器的 SOAP 動作與訊息結構的詳細資訊，請參閱[tRFC 作業的訊息結構描述](../../adapters-and-accelerators/adapter-sap/message-schemas-for-trfc-operations.md)。</span><span class="sxs-lookup"><span data-stu-id="5f004-130">For more information about the message structures and SOAP actions used for tRFCs by the adapter, see [Message Schemas for tRFC Operations](../../adapters-and-accelerators/adapter-sap/message-schemas-for-trfc-operations.md).</span></span>  
  
## <a name="invoking-transactional-rfcs-in-an-sap-system"></a><span data-ttu-id="5f004-131">叫用交易式的 Rfc，SAP 系統中</span><span class="sxs-lookup"><span data-stu-id="5f004-131">Invoking Transactional RFCs in an SAP System</span></span>  
 <span data-ttu-id="5f004-132">通常，將 Trfc 用來執行單一的 LUW; 內的一或多個 RFC 呼叫不過，由於 SAP RFC SDK 的限制[!INCLUDE[adaptersap_short](../../includes/adaptersap-short-md.md)]支援單一一個 tRFC 每 LUW。</span><span class="sxs-lookup"><span data-stu-id="5f004-132">Typically, tRFCs are used to execute one or more RFC calls inside a single LUW; however, due to limitations in the SAP RFC SDK, the [!INCLUDE[adaptersap_short](../../includes/adaptersap-short-md.md)] supports only a single tRFC per LUW.</span></span> <span data-ttu-id="5f004-133">基於這個理由，配接器會建立每個 tRFC 的 LUW (SAP TID)。</span><span class="sxs-lookup"><span data-stu-id="5f004-133">For this reason, the adapter creates an LUW (SAP TID) for each tRFC.</span></span> <span data-ttu-id="5f004-134">這類用戶端，SAP 會定義一個機制來保證會 「 單次 」 執行 RFC LUW，並不表示認可及回復交易。</span><span class="sxs-lookup"><span data-stu-id="5f004-134">For such clients, SAP defines an LUW as a mechanism to guarantee "one-time" execution of the RFC and does not imply commit and rollback-based transactions.</span></span>  
  
 <span data-ttu-id="5f004-135">下列步驟概述的工作執行的 RFC 用戶端呼叫使用[!INCLUDE[adaptersap_short](../../includes/adaptersap-short-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="5f004-135">The following steps summarize the tasks that are performed in an RFC client call using the [!INCLUDE[adaptersap_short](../../includes/adaptersap-short-md.md)].</span></span> <span data-ttu-id="5f004-136">其中某些步驟由配接器用戶端，部分由配接器。</span><span class="sxs-lookup"><span data-stu-id="5f004-136">Some of these steps are performed by the adapter client, and some are performed by the adapter.</span></span>  
  
1. <span data-ttu-id="5f004-137">配接器用戶端會傳送一個 tRFC 作業的要求訊息。</span><span class="sxs-lookup"><span data-stu-id="5f004-137">The adapter client sends a request message for the tRFC operation.</span></span> <span data-ttu-id="5f004-138">配接器用戶端可以選擇性地提供此訊息中的 GUID。</span><span class="sxs-lookup"><span data-stu-id="5f004-138">The adapter client can optionally supply a GUID in this message.</span></span>  
  
2. <span data-ttu-id="5f004-139">[!INCLUDE[adaptersap_short](../../includes/adaptersap-short-md.md)]接收要求訊息，並使用從 SAP 系統中取得的交易識別碼 (TID) 的 RFC SDK。</span><span class="sxs-lookup"><span data-stu-id="5f004-139">The [!INCLUDE[adaptersap_short](../../includes/adaptersap-short-md.md)] receives the request message and uses the RFC SDK to get a transaction ID (TID) from the SAP system.</span></span> <span data-ttu-id="5f004-140">如果要求訊息包含 GUID，配接器會將此 GUID 對應到 SAP TID;配接器，否則為建立新的 GUID，並將它對應至 SAP TID</span><span class="sxs-lookup"><span data-stu-id="5f004-140">If the request message contains a GUID, the adapter maps this GUID to the SAP TID; otherwise, the adapter creates a new GUID and maps it to the SAP TID</span></span>  
  
3. <span data-ttu-id="5f004-141">配接器會使用 TID，進行 tRFC 呼叫到 SAP 伺服器。</span><span class="sxs-lookup"><span data-stu-id="5f004-141">The adapter uses the TID to make the tRFC call to the SAP server.</span></span> <span data-ttu-id="5f004-142">TID 的狀態會標示為**已完成**SAP 系統上。</span><span class="sxs-lookup"><span data-stu-id="5f004-142">The status of the TID is marked as **FINISHED** on the SAP system.</span></span>  
  
4. <span data-ttu-id="5f004-143">配接器傳回至回應訊息的配接器用戶端的 GUID （也就對應至 TID）。</span><span class="sxs-lookup"><span data-stu-id="5f004-143">The adapter returns the GUID (that is mapped to the TID) to the adapter client in the response message.</span></span>  
  
5. <span data-ttu-id="5f004-144">配接器用戶端叫用 RfcConfirmTransID 作業介面卡上的與前一個步驟中所傳回的 GUID。</span><span class="sxs-lookup"><span data-stu-id="5f004-144">The adapter client invokes the RfcConfirmTransID operation on the adapter with the GUID returned in the previous step.</span></span>  
  
6. <span data-ttu-id="5f004-145">配接器 RfcConfirmTransID 要求訊息中會使用 GUID 來識別 SAP TID，並確認 SAP 系統上的 tRFC 呼叫。</span><span class="sxs-lookup"><span data-stu-id="5f004-145">The adapter uses the GUID in the RfcConfirmTransID request message to identify the SAP TID and confirms the tRFC call on the SAP system.</span></span> <span data-ttu-id="5f004-146">這會導致 SAP 伺服器，從其資料庫中刪除的 TID 項目。</span><span class="sxs-lookup"><span data-stu-id="5f004-146">This causes the SAP server to delete the TID entry from its database.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="5f004-147">tRFC 用戶端呼叫不會傳回匯出或變更參數。</span><span class="sxs-lookup"><span data-stu-id="5f004-147">tRFC client calls do not return EXPORT or CHANGING parameters.</span></span>  
  
 <span data-ttu-id="5f004-148">如需詳細資訊：</span><span class="sxs-lookup"><span data-stu-id="5f004-148">For more information about:</span></span>  
  
-   <span data-ttu-id="5f004-149">叫用 tRFC，使用 BizTalk Server，請參閱[叫用 Trfc SAP 使用 BizTalk Server 中的](../../adapters-and-accelerators/adapter-sap/invoke-trfcs-in-sap-using-biztalk-server.md)。</span><span class="sxs-lookup"><span data-stu-id="5f004-149">Invoking a tRFC using BizTalk Server, see [Invoke tRFCs in SAP using BizTalk Server](../../adapters-and-accelerators/adapter-sap/invoke-trfcs-in-sap-using-biztalk-server.md).</span></span>  
  
-   <span data-ttu-id="5f004-150">叫用 tRFC，使用 WCF 服務模型，請參閱[叫用中使用 WCF 服務模型的 SAP 的 Trfc](../../adapters-and-accelerators/adapter-sap/invoke-trfcs-in-sap-using-the-wcf-service-model.md)。</span><span class="sxs-lookup"><span data-stu-id="5f004-150">Invoking a tRFC using the WCF service model, see [Invoke tRFCs in SAP using the WCF Service Model](../../adapters-and-accelerators/adapter-sap/invoke-trfcs-in-sap-using-the-wcf-service-model.md).</span></span>  
  
-   <span data-ttu-id="5f004-151">訊息結構和叫用 tRFC 的 SOAP 動作，請參閱[tRFC 作業的訊息結構描述](../../adapters-and-accelerators/adapter-sap/message-schemas-for-trfc-operations.md)。</span><span class="sxs-lookup"><span data-stu-id="5f004-151">Message structures and SOAP action for invoking a tRFC, see [Message Schemas for tRFC Operations](../../adapters-and-accelerators/adapter-sap/message-schemas-for-trfc-operations.md).</span></span>  
  
## <a name="receiving-inbound-transactional-rfc-calls-from-an-sap-system"></a><span data-ttu-id="5f004-152">從 SAP 系統的接收傳入異動的 RFC 呼叫</span><span class="sxs-lookup"><span data-stu-id="5f004-152">Receiving Inbound Transactional RFC Calls from an SAP System</span></span>  
 <span data-ttu-id="5f004-153">您可以從 SAP 接收 Trfc 為 tRFC 伺服器使用配接器。</span><span class="sxs-lookup"><span data-stu-id="5f004-153">You can use the adapter as a tRFC server to receive tRFCs from SAP.</span></span> <span data-ttu-id="5f004-154">為 tRFC 伺服器，當配接器接收的 tRFC，它會叫用對應的 tRFC 作業，在您的應用程式。</span><span class="sxs-lookup"><span data-stu-id="5f004-154">As a tRFC server, when the adapter receives a tRFC, it invokes the corresponding tRFC operation on your application.</span></span> <span data-ttu-id="5f004-155">它會充當 tRFC 伺服器時，配接器支援下列功能：</span><span class="sxs-lookup"><span data-stu-id="5f004-155">The adapter supports the following functionality when it acts as a tRFC server:</span></span>  
  
- <span data-ttu-id="5f004-156">LUW （由 SAP TID 識別） 可以包含多個 Trfc （RFC 呼叫）。</span><span class="sxs-lookup"><span data-stu-id="5f004-156">An LUW (identified by a SAP TID) can contain multiple tRFCs (RFC calls).</span></span>  
  
- <span data-ttu-id="5f004-157">配接器會建立每個 SAP TID 認可的交易。</span><span class="sxs-lookup"><span data-stu-id="5f004-157">The adapter creates a committable transaction for each SAP TID.</span></span> <span data-ttu-id="5f004-158">應用程式程式碼可以在這個交易中編列。</span><span class="sxs-lookup"><span data-stu-id="5f004-158">Your application code can enlist in this transaction.</span></span>  
  
- <span data-ttu-id="5f004-159">支援認可和回復。</span><span class="sxs-lookup"><span data-stu-id="5f004-159">Commit and roll back are supported.</span></span>  
  
  <span data-ttu-id="5f004-160">本節的其餘部分會提供有關使用配接器做為 tRFC 伺服器的一般資訊。</span><span class="sxs-lookup"><span data-stu-id="5f004-160">The rest of this section provides general information about using the adapter as a tRFC server.</span></span> <span data-ttu-id="5f004-161">如需更特定的資訊：</span><span class="sxs-lookup"><span data-stu-id="5f004-161">For more specific information about:</span></span>  
  
- <span data-ttu-id="5f004-162">接收輸入的 tRFC 呼叫使用 BizTalk Server，請參閱 <<c0> [ 接收輸入的 tRFC 呼叫從使用 BizTalk Server 的 SAP](../../adapters-and-accelerators/adapter-sap/receive-inbound-trfc-calls-from-sap-using-biztalk-server.md)。</span><span class="sxs-lookup"><span data-stu-id="5f004-162">Receiving a inbound tRFC calls using BizTalk Server, see [Receive Inbound tRFC Calls from SAP using BizTalk Server](../../adapters-and-accelerators/adapter-sap/receive-inbound-trfc-calls-from-sap-using-biztalk-server.md).</span></span>  
  
- <span data-ttu-id="5f004-163">接收輸入的 tRFC 呼叫使用 WCF 服務模型，請參閱 <<c0> [ 接收輸入的 tRFC 呼叫中使用 WCF 服務模型的 SAP](../../adapters-and-accelerators/adapter-sap/receive-inbound-trfc-calls-in-sap-using-the-wcf-service-model.md)。</span><span class="sxs-lookup"><span data-stu-id="5f004-163">Receiving a inbound tRFC calls using the WCF service model, see [Receive Inbound tRFC Calls in SAP using the WCF Service Model](../../adapters-and-accelerators/adapter-sap/receive-inbound-trfc-calls-in-sap-using-the-wcf-service-model.md).</span></span>  
  
### <a name="the-tid-database"></a><span data-ttu-id="5f004-164">TID 資料庫</span><span class="sxs-lookup"><span data-stu-id="5f004-164">The TID Database</span></span>  
 <span data-ttu-id="5f004-165">當它作為 tRFC 伺服器時，配接器使用 SQL Server 資料庫 — TID 資料庫，來管理交易從 SAP 系統它接收的識別碼。</span><span class="sxs-lookup"><span data-stu-id="5f004-165">When it acts as a tRFC server, the adapter uses a SQL Server database—the TID database—to manage the transaction IDs that it receives from the SAP system.</span></span> <span data-ttu-id="5f004-166">比方說，它會使用 TID 資料庫來協助管理從 commit、 rollback SAP 系統的呼叫，以及確認 TID。</span><span class="sxs-lookup"><span data-stu-id="5f004-166">For example, it uses the TID database to help manage calls from the SAP system to commit, rollback, and confirm the TID.</span></span> <span data-ttu-id="5f004-167">配接器也會儲存的 GUID，它會建立並關聯 TID 資料庫中每個 SAP TID。</span><span class="sxs-lookup"><span data-stu-id="5f004-167">The adapter also stores the GUID that it creates and associates with each SAP TID in the TID database.</span></span>  
  
### <a name="prerequisites"></a><span data-ttu-id="5f004-168">必要條件</span><span class="sxs-lookup"><span data-stu-id="5f004-168">Prerequisites</span></span>  
 <span data-ttu-id="5f004-169">做為 tRFC 伺服器讓配接器，您必須確定在下列條件成立：</span><span class="sxs-lookup"><span data-stu-id="5f004-169">For the adapter to perform as a tRFC server, you must ensure that the following are true:</span></span>  
  
- <span data-ttu-id="5f004-170">必須宣告 RFC，SAP 系統上。</span><span class="sxs-lookup"><span data-stu-id="5f004-170">The RFC must be declared on the SAP system.</span></span> <span data-ttu-id="5f004-171">這是讓配接器可以擷取描述從 SAP 系統的 RFC 的中繼資料。</span><span class="sxs-lookup"><span data-stu-id="5f004-171">This is so the adapter can retrieve metadata that describes the RFC from the SAP system.</span></span> <span data-ttu-id="5f004-172">RFC 實際上是在您的應用程式中實作。</span><span class="sxs-lookup"><span data-stu-id="5f004-172">The RFC is actually implemented in your application.</span></span>  
  
- <span data-ttu-id="5f004-173">配接器必須向 SAP 閘道上的 RFC 目的地。</span><span class="sxs-lookup"><span data-stu-id="5f004-173">The adapter must register with an RFC destination on an SAP gateway.</span></span> <span data-ttu-id="5f004-174">註冊為基礎的邏輯名稱，叫做程式 id。</span><span class="sxs-lookup"><span data-stu-id="5f004-174">The registration is based on a logical name called a program ID.</span></span> <span data-ttu-id="5f004-175">提供連線至指定的程式識別碼 URI 參數 SAP 閘道，以及此註冊的 SAP 伺服器。</span><span class="sxs-lookup"><span data-stu-id="5f004-175">You supply parameters in the connection URI to specify the program ID, SAP gateway, and SAP server for this registration.</span></span>  
  
- <span data-ttu-id="5f004-176">TID 資料庫必須建立 SQL Server 中。</span><span class="sxs-lookup"><span data-stu-id="5f004-176">The TID database must be created in SQL Server.</span></span> <span data-ttu-id="5f004-177">若要這樣做，您必須執行安裝程式已安裝的 SQL 指令碼。</span><span class="sxs-lookup"><span data-stu-id="5f004-177">To do this, you must run a SQL script that is installed by the setup.</span></span> <span data-ttu-id="5f004-178">SQL 指令碼通常會安裝在\<安裝磁碟機\>: \Program Files\Microsoft [!INCLUDE[adapterpacknoversion](../../includes/adapterpacknoversion-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="5f004-178">The SQL script is typically installed at \<installation drive\>:\Program Files\Microsoft [!INCLUDE[adapterpacknoversion](../../includes/adapterpacknoversion-md.md)].</span></span> <span data-ttu-id="5f004-179">如需詳細資訊，請參閱[安裝 BizTalk Adapter Pack](http://msdn.microsoft.com/library/2ae27db5-b11b-42c3-a568-e2331badf80e)。</span><span class="sxs-lookup"><span data-stu-id="5f004-179">For more information see, [Installing the BizTalk Adapter Pack](http://msdn.microsoft.com/library/2ae27db5-b11b-42c3-a568-e2331badf80e).</span></span>  
  
- <span data-ttu-id="5f004-180">**TidDatabaseConnectionString**繫結屬性必須設為 TID 資料庫的 SQL 資料庫連接字串。</span><span class="sxs-lookup"><span data-stu-id="5f004-180">The **TidDatabaseConnectionString** binding property must be set to the SQL database connection string for the TID database.</span></span> <span data-ttu-id="5f004-181">如需詳細資訊**TidDatabaseConnectionString**繫結屬性，請參閱[了解 BizTalk Adapter for mySAP Business Suite 繫結屬性](../../adapters-and-accelerators/adapter-sap/read-about-biztalk-adapter-for-mysap-business-suite-binding-properties.md)。</span><span class="sxs-lookup"><span data-stu-id="5f004-181">For more information about the **TidDatabaseConnectionString** binding property, see [Read about BizTalk Adapter for mySAP Business Suite binding properties](../../adapters-and-accelerators/adapter-sap/read-about-biztalk-adapter-for-mysap-business-suite-binding-properties.md).</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="5f004-182">設定**TidDatabaseConnectionString**屬性繫結會設定要做為 tRFC 伺服器，而不是 RFC 伺服器的配接器。</span><span class="sxs-lookup"><span data-stu-id="5f004-182">Setting the **TidDatabaseConnectionString** binding property configures the adapter to act as a tRFC server rather than as an RFC server.</span></span> <span data-ttu-id="5f004-183">如果**TidDatabaseConnectionString**屬性繫結設定，且您的連線 URI 中指定的 RFC 目的地，配接器可做為來自 RFC 目的地的傳入呼叫的 tRFC 伺服器。</span><span class="sxs-lookup"><span data-stu-id="5f004-183">If the **TidDatabaseConnectionString** binding property is set and you specify an RFC destination in the connection URI, the adapter acts as a tRFC server for incoming calls from the RFC destination.</span></span> <span data-ttu-id="5f004-184">如果未設定這個繫結屬性，配接器可做為 RFC 伺服器中。</span><span class="sxs-lookup"><span data-stu-id="5f004-184">If this binding property is not set, the adapter acts as an RFC server.</span></span>  
  
### <a name="how-the-adapter-processes-inbound-trfcs"></a><span data-ttu-id="5f004-185">如何配接器處理程序輸入的 Trfc</span><span class="sxs-lookup"><span data-stu-id="5f004-185">How the Adapter Processes Inbound tRFCs</span></span>  
 <span data-ttu-id="5f004-186">下列步驟概述的工作由 RFC 用戶端呼叫使用[!INCLUDE[adaptersap_short](../../includes/adaptersap-short-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="5f004-186">The following steps summarize the tasks that are performed by the RFC client call using the [!INCLUDE[adaptersap_short](../../includes/adaptersap-short-md.md)].</span></span> <span data-ttu-id="5f004-187">其中某些步驟由配接器用戶端，部分由配接器。</span><span class="sxs-lookup"><span data-stu-id="5f004-187">Some of these steps are performed by the adapter client, and some are performed by the adapter.</span></span>  
  
1.  <span data-ttu-id="5f004-188">SAP 系統呼叫到配接器能 TID 是否已在使用中。</span><span class="sxs-lookup"><span data-stu-id="5f004-188">The SAP system calls into the adapter to enquire whether a TID has already been used.</span></span> <span data-ttu-id="5f004-189">配接器傳回 SAP 系統的適當回應。</span><span class="sxs-lookup"><span data-stu-id="5f004-189">The adapter returns the appropriate response to the SAP system.</span></span> <span data-ttu-id="5f004-190">如果是新的 TID，配接器會建立認可的交易。</span><span class="sxs-lookup"><span data-stu-id="5f004-190">If the TID is new, the adapter creates a committable transaction.</span></span> <span data-ttu-id="5f004-191">要在交易的方式保存 TID 資料庫 TID，SAP 程式執行的認可 (COMMIT WORK) 時，使用此交易。</span><span class="sxs-lookup"><span data-stu-id="5f004-191">This transaction is used to persist the TID to the TID database in a transactional manner when the SAP program performs a commit (COMMIT WORK).</span></span> <span data-ttu-id="5f004-192">它也會公開給應用程式程式碼會處理輸入的 Trfc。</span><span class="sxs-lookup"><span data-stu-id="5f004-192">It is also exposed to application code that handles the inbound tRFCs.</span></span> <span data-ttu-id="5f004-193">此外，配接器會建立一個會將 SAP TID 和關聯的 GUID。</span><span class="sxs-lookup"><span data-stu-id="5f004-193">Additionally, the adapter creates a GUID that it associates with the SAP TID.</span></span>  
  
2.  <span data-ttu-id="5f004-194">SAP 系統會傳送至配接器的一或多個交易式的 Rfc。</span><span class="sxs-lookup"><span data-stu-id="5f004-194">The SAP system sends one or more transactional RFCs to the adapter.</span></span> <span data-ttu-id="5f004-195">針對每個 tRFC，配接器叫用您的應用程式的適當 tRFC 作業。</span><span class="sxs-lookup"><span data-stu-id="5f004-195">For each tRFC, the adapter invokes the appropriate tRFC operation on your application.</span></span> <span data-ttu-id="5f004-196">配接器會在您的應用程式，每個作業的步驟 1 中建立的異動流動。</span><span class="sxs-lookup"><span data-stu-id="5f004-196">The adapter flows the transaction created in step 1 to your application for each operation.</span></span> <span data-ttu-id="5f004-197">配接器會將作業要求訊息中的步驟 1 中建立的 GUID。</span><span class="sxs-lookup"><span data-stu-id="5f004-197">The adapter passes the GUID created in step 1 in the request message for the operation.</span></span>  
  
3.  <span data-ttu-id="5f004-198">SAP 系統認可 LUW (COMMIT WORK)。</span><span class="sxs-lookup"><span data-stu-id="5f004-198">SAP system commits the LUW (COMMIT WORK).</span></span> <span data-ttu-id="5f004-199">配接器會嘗試認可交易 （在步驟 1 中建立） 的 SAP TID 與相關聯。</span><span class="sxs-lookup"><span data-stu-id="5f004-199">The adapter tries to commit the transaction associated with the SAP TID (created in step 1).</span></span>  
  
    1.  <span data-ttu-id="5f004-200">如果交易中止 （由您的應用程式） 期間呼叫在步驟 2，則配接器嘗試認可交易時發生錯誤。</span><span class="sxs-lookup"><span data-stu-id="5f004-200">If the transaction was aborted (by your application) during any of the calls in step 2, then an error occurs when the adapter tries to commit the transaction.</span></span> <span data-ttu-id="5f004-201">Sap 會傳回錯誤。</span><span class="sxs-lookup"><span data-stu-id="5f004-201">The error is returned to SAP.</span></span> <span data-ttu-id="5f004-202">移至步驟 4。</span><span class="sxs-lookup"><span data-stu-id="5f004-202">Go to step 4.</span></span>  
  
    2.  <span data-ttu-id="5f004-203">如果認可成功，TID 現在是 TID 資料庫中。</span><span class="sxs-lookup"><span data-stu-id="5f004-203">If the commit is successful, the TID is now in the TID database.</span></span> <span data-ttu-id="5f004-204">移至步驟 5。</span><span class="sxs-lookup"><span data-stu-id="5f004-204">Go to step 5.</span></span>  
  
4.  <span data-ttu-id="5f004-205">如果錯誤發生在步驟 3，或如果 SAP 回復 LUW (RESTART_OF_BACKGROUNDTASK) 而不是認可，配接器會回復交易。</span><span class="sxs-lookup"><span data-stu-id="5f004-205">If an error occurred in step 3, or if SAP rolls back the LUW (RESTART_OF_BACKGROUNDTASK) instead of committing it, the adapter rolls back the transaction.</span></span> <span data-ttu-id="5f004-206">在此情況下 TID 資料庫永遠不會保存 TID。</span><span class="sxs-lookup"><span data-stu-id="5f004-206">In this case the TID is never persisted to the TID database.</span></span>  
  
5.  <span data-ttu-id="5f004-207">SAP 系統確認 TID。</span><span class="sxs-lookup"><span data-stu-id="5f004-207">The SAP system confirms the TID.</span></span> <span data-ttu-id="5f004-208">配接器會將 TID 移除 TID 資料庫 （假設步驟已順利完成的 3 和 TID 存在於 TID 資料庫。</span><span class="sxs-lookup"><span data-stu-id="5f004-208">The adapter removes the TID from the TID database (assuming that step 3 completed successfully and the TID exists in the TID database.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="5f004-209">如果嘗試連線到 TID 資料庫 tRFC 伺服器作業期間發生錯誤，錯誤代碼，表示來自 SAP 的連入呼叫而未處理[!INCLUDE[adaptersap_short](../../includes/adaptersap-short-md.md)]會傳回到 SAP。</span><span class="sxs-lookup"><span data-stu-id="5f004-209">If an error occurs attempting to connect to the TID Database during a tRFC server operation, an error code indicating that the incoming call from SAP was not processed by the [!INCLUDE[adaptersap_short](../../includes/adaptersap-short-md.md)] is returned to SAP.</span></span>  
  
### <a name="receiving-idocs-as-a-trfc-server"></a><span data-ttu-id="5f004-210">為 tRFC 伺服器接收 Idoc</span><span class="sxs-lookup"><span data-stu-id="5f004-210">Receiving IDOCs as a tRFC server</span></span>  
 <span data-ttu-id="5f004-211">您使用[!INCLUDE[adaptersap_short](../../includes/adaptersap-short-md.md)]為 RFC 伺服器或從 SAP 系統接收 Idoc 的 tRFC 伺服器。</span><span class="sxs-lookup"><span data-stu-id="5f004-211">You use the [!INCLUDE[adaptersap_short](../../includes/adaptersap-short-md.md)] as either an RFC server or a tRFC server to receive IDOCs from the SAP system.</span></span> <span data-ttu-id="5f004-212">在任一情況下，您必須設定**ReceiveIdocFormat**繫結屬性，以指定在其中配接器應該將 IDOC 資料發出到您的應用程式的格式。</span><span class="sxs-lookup"><span data-stu-id="5f004-212">In either case, you must set the **ReceiveIdocFormat** binding property to specify the format in which the adapter should emit the IDOC data to your application.</span></span> <span data-ttu-id="5f004-213">如需有關如何使用配接器接收 idoc 用的詳細資訊，請參閱[對 sap Idoc 的作業](../../adapters-and-accelerators/adapter-sap/operations-on-idocs-in-sap.md)。</span><span class="sxs-lookup"><span data-stu-id="5f004-213">For more information about receiving IDOCs with the adapter, see [Operations on IDOCs in SAP](../../adapters-and-accelerators/adapter-sap/operations-on-idocs-in-sap.md).</span></span> <span data-ttu-id="5f004-214">如需詳細資訊[!INCLUDE[adaptersap_short](../../includes/adaptersap-short-md.md)]繫結屬性，請參閱[了解 BizTalk Adapter for mySAP Business Suite 繫結屬性](../../adapters-and-accelerators/adapter-sap/read-about-biztalk-adapter-for-mysap-business-suite-binding-properties.md)。</span><span class="sxs-lookup"><span data-stu-id="5f004-214">For more information about the [!INCLUDE[adaptersap_short](../../includes/adaptersap-short-md.md)] binding properties, see [Read about BizTalk Adapter for mySAP Business Suite binding properties](../../adapters-and-accelerators/adapter-sap/read-about-biztalk-adapter-for-mysap-business-suite-binding-properties.md).</span></span>  
  
## <a name="special-trfc-operations"></a><span data-ttu-id="5f004-215">特殊的 tRFC 作業</span><span class="sxs-lookup"><span data-stu-id="5f004-215">Special tRFC Operations</span></span>  
 <span data-ttu-id="5f004-216">[!INCLUDE[adaptersap_short](../../includes/adaptersap-short-md.md)]也可以執行 SAP 系統上的某些特殊的 tRFC 作業。</span><span class="sxs-lookup"><span data-stu-id="5f004-216">The [!INCLUDE[adaptersap_short](../../includes/adaptersap-short-md.md)] can also perform certain special tRFC operations on the SAP system.</span></span> <span data-ttu-id="5f004-217">這類的一項作業是 RfcConfirmTransID。</span><span class="sxs-lookup"><span data-stu-id="5f004-217">One such operation is RfcConfirmTransID.</span></span>  
  
- <span data-ttu-id="5f004-218">**RfcConfirmTransID。**</span><span class="sxs-lookup"><span data-stu-id="5f004-218">**RfcConfirmTransID.**</span></span> <span data-ttu-id="5f004-219">您在上叫用這項作業[!INCLUDE[adaptersap_short](../../includes/adaptersap-short-md.md)]確認對 SAP 伺服器的 tRFC 呼叫。</span><span class="sxs-lookup"><span data-stu-id="5f004-219">You invoke this operation on the [!INCLUDE[adaptersap_short](../../includes/adaptersap-short-md.md)] to confirm tRFC calls made to the SAP server.</span></span> <span data-ttu-id="5f004-220">在配接器來傳送 Idoc 至 SAP 伺服器的 tRFC 的情況下，可能需要 RfcConfirmTransID。</span><span class="sxs-lookup"><span data-stu-id="5f004-220">RfcConfirmTransID might be required in scenarios where the adapter is used to send IDOCs to the SAP server as a tRFC.</span></span> <span data-ttu-id="5f004-221">此作業，會位於**TRFC**時使用的節點[!INCLUDE[addadapterservrefshort](../../includes/addadapterservrefshort-md.md)]和[!INCLUDE[consumeadapterservshort](../../includes/consumeadapterservshort-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="5f004-221">The operation is available under the **TRFC** node when using the [!INCLUDE[addadapterservrefshort](../../includes/addadapterservrefshort-md.md)] and [!INCLUDE[consumeadapterservshort](../../includes/consumeadapterservshort-md.md)].</span></span>  
  
  <span data-ttu-id="5f004-222">如需有關的訊息結構和 RfcConfirmTransID 作業的 SOAP 動作的詳細資訊，請參閱[tRFC 作業的訊息結構描述](../../adapters-and-accelerators/adapter-sap/message-schemas-for-trfc-operations.md)。</span><span class="sxs-lookup"><span data-stu-id="5f004-222">For more information about the message structure and SOAP action for the RfcConfirmTransID operation, see [Message Schemas for tRFC Operations](../../adapters-and-accelerators/adapter-sap/message-schemas-for-trfc-operations.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="5f004-223">另請參閱</span><span class="sxs-lookup"><span data-stu-id="5f004-223">See Also</span></span>  
 [<span data-ttu-id="5f004-224">連接到 SAP 系統使用配接器</span><span class="sxs-lookup"><span data-stu-id="5f004-224">Connect to an SAP system using the adapter</span></span>](../../adapters-and-accelerators/adapter-sap/connect-to-an-sap-system-using-the-adapter.md)