---
title: 訊息修復程序 |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
helpviewer_keywords:
- repairing messages
- errors, messages
- messages, errors
- validating, messages
- messages, validating
ms.assetid: 87b97cec-5796-4684-bcf0-53285aca7ee2
caps.latest.revision: 7
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: bb8e8cd5a23cd0187b5476688a00d1ca800c45d4
ms.sourcegitcommit: 266308ec5c6a9d8d80ff298ee6051b4843c5d626
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 06/27/2018
ms.locfileid: "36999063"
---
# <a name="message-repair-process"></a><span data-ttu-id="635bb-102">Message Repair 程序</span><span class="sxs-lookup"><span data-stu-id="635bb-102">Message Repair Process</span></span>
<span data-ttu-id="635bb-103">根據預設，[!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)]會擱置失敗的訊息擱置佇列中的 MessageBox 資料庫。</span><span class="sxs-lookup"><span data-stu-id="635bb-103">By default, [!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)] suspends failed messages in the suspended queue of the MessageBox database.</span></span> <span data-ttu-id="635bb-104">此程序會處理失敗的訊息，分別從成功的訊息。</span><span class="sxs-lookup"><span data-stu-id="635bb-104">This process handles failed messages separately from successful messages.</span></span> <span data-ttu-id="635bb-105">使用此預設的機制，不過，您有擷取失敗的訊息，並加以修復的能力有限。</span><span class="sxs-lookup"><span data-stu-id="635bb-105">Using this default mechanism, however, you have a limited ability to retrieve failed messages and repair them.</span></span> <span data-ttu-id="635bb-106">訊息修復和 New Submission 功能[!INCLUDE[btaA4SWIFT2.3abbrevnonumber](../../includes/btaa4swift2-3abbrevnonumber-md.md)]可讓[!INCLUDE[btaA4SWIFT2.3abbrevnonumber](../../includes/btaa4swift2-3abbrevnonumber-md.md)]修復訊息並重新提交的使用者。</span><span class="sxs-lookup"><span data-stu-id="635bb-106">The Message Repair and New Submission feature of [!INCLUDE[btaA4SWIFT2.3abbrevnonumber](../../includes/btaa4swift2-3abbrevnonumber-md.md)] enables an [!INCLUDE[btaA4SWIFT2.3abbrevnonumber](../../includes/btaa4swift2-3abbrevnonumber-md.md)] user to repair a message and resubmit it.</span></span> <span data-ttu-id="635bb-107">另一個[!INCLUDE[btaA4SWIFT2.3abbrevnonumber](../../includes/btaa4swift2-3abbrevnonumber-md.md)]使用者接著可以確認此修復狀態，以及第三個可以核准此修復狀態。</span><span class="sxs-lookup"><span data-stu-id="635bb-107">Another [!INCLUDE[btaA4SWIFT2.3abbrevnonumber](../../includes/btaa4swift2-3abbrevnonumber-md.md)] user can then verify the repairs, and a third can approve the repairs.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="635bb-108">在此情況下，[!INCLUDE[btaA4SWIFT2.3abbrevnonumber](../../includes/btaa4swift2-3abbrevnonumber-md.md)]使用者是部門的修復工作流程中執行角色的使用者。</span><span class="sxs-lookup"><span data-stu-id="635bb-108">In this context, an [!INCLUDE[btaA4SWIFT2.3abbrevnonumber](../../includes/btaa4swift2-3abbrevnonumber-md.md)] user is a user that performs a role in a departmental repair workflow.</span></span> <span data-ttu-id="635bb-109">此 A4SWIFT 使用者已定義，而且相關聯的憑證，在 設定檔 Web 用戶端的 使用者 連結。</span><span class="sxs-lookup"><span data-stu-id="635bb-109">This A4SWIFT user is defined, and associated with a certificate, in the Users link of the Profile Web Client.</span></span> <span data-ttu-id="635bb-110">這[!INCLUDE[btaA4SWIFT2.3abbrevnonumber](../../includes/btaa4swift2-3abbrevnonumber-md.md)]使用者不是相同[!INCLUDE[btsWinNoVersion](../../includes/btswinnoversion-md.md)]使用者帳戶，如中所定義[!INCLUDE[btaA4SWIFT2.3abbrevnonumber](../../includes/btaa4swift2-3abbrevnonumber-md.md)]群組中的使用者[!INCLUDE[btsWinNoVersion](../../includes/btswinnoversion-md.md)]電腦管理公用程式。</span><span class="sxs-lookup"><span data-stu-id="635bb-110">This [!INCLUDE[btaA4SWIFT2.3abbrevnonumber](../../includes/btaa4swift2-3abbrevnonumber-md.md)] user is not the same as a [!INCLUDE[btsWinNoVersion](../../includes/btswinnoversion-md.md)] user account, as defined in the [!INCLUDE[btaA4SWIFT2.3abbrevnonumber](../../includes/btaa4swift2-3abbrevnonumber-md.md)] Users group in the [!INCLUDE[btsWinNoVersion](../../includes/btswinnoversion-md.md)] Computer Management utility.</span></span> <span data-ttu-id="635bb-111">做為個人[!INCLUDE[btaA4SWIFT2.3abbrevnonumber](../../includes/btaa4swift2-3abbrevnonumber-md.md)]使用者必須擁有[!INCLUDE[btsWinNoVersion](../../includes/btswinnoversion-md.md)]使用者帳戶，以便提交訊息時，他們可以使用該帳戶的憑證。</span><span class="sxs-lookup"><span data-stu-id="635bb-111">The person functioning as an [!INCLUDE[btaA4SWIFT2.3abbrevnonumber](../../includes/btaa4swift2-3abbrevnonumber-md.md)] user must have a [!INCLUDE[btsWinNoVersion](../../includes/btswinnoversion-md.md)] user account so that they can use that account's certificates when submitting a message.</span></span> <span data-ttu-id="635bb-112">不過，該人員也可以做為其他[!INCLUDE[btaA4SWIFT2.3abbrevnonumber](../../includes/btaa4swift2-3abbrevnonumber-md.md)]使用者： repairer、 驗證器、 核准者或建立者。</span><span class="sxs-lookup"><span data-stu-id="635bb-112">However, that person can also serve as other [!INCLUDE[btaA4SWIFT2.3abbrevnonumber](../../includes/btaa4swift2-3abbrevnonumber-md.md)] users: repairer, verifier, approver, or creator.</span></span> <span data-ttu-id="635bb-113">如需詳細資訊，請參閱 <<c0> [ 建立部門和角色 Message Repair 和 New Submission](../../adapters-and-accelerators/accelerator-swift/creating-departments-and-roles-for-message-repair-and-new-submission.md)。</span><span class="sxs-lookup"><span data-stu-id="635bb-113">For more information, see [Creating Departments and Roles for Message Repair and New Submission](../../adapters-and-accelerators/accelerator-swift/creating-departments-and-roles-for-message-repair-and-new-submission.md).</span></span>  
  
 <span data-ttu-id="635bb-114">使用此修復工作流程，[!INCLUDE[btaA4SWIFT2.3abbrevnonumber](../../includes/btaa4swift2-3abbrevnonumber-md.md)]不會擱置失敗的訊息。</span><span class="sxs-lookup"><span data-stu-id="635bb-114">With this repair workflow, [!INCLUDE[btaA4SWIFT2.3abbrevnonumber](../../includes/btaa4swift2-3abbrevnonumber-md.md)] does not suspend a failed message.</span></span> <span data-ttu-id="635bb-115">它在失敗的訊息中，執行額外的處理，然後將訊息置放在 MessageBox 中，就如同成功的訊息。</span><span class="sxs-lookup"><span data-stu-id="635bb-115">It performs additional processing on the failed message, and then drops the message into the MessageBox, just as it would a successful message.</span></span> <span data-ttu-id="635bb-116">修復協調流程會將郵件分成[!INCLUDE[btaA4SWIFT2.3abbrevnonumber](../../includes/btaa4swift2-3abbrevnonumber-md.md)]MRSR 站台，使用者可以執行其函式[!INCLUDE[btsInpathNoVersion](../../includes/btsinpathnoversion-md.md)]表單。</span><span class="sxs-lookup"><span data-stu-id="635bb-116">The repair orchestration drops the message into the [!INCLUDE[btaA4SWIFT2.3abbrevnonumber](../../includes/btaa4swift2-3abbrevnonumber-md.md)] MRSR site, where users can perform their functions in [!INCLUDE[btsInpathNoVersion](../../includes/btsinpathnoversion-md.md)] forms.</span></span>  
  
## <a name="message-validation"></a><span data-ttu-id="635bb-117">訊息驗證</span><span class="sxs-lookup"><span data-stu-id="635bb-117">Message Validation</span></span>  
 <span data-ttu-id="635bb-118">Message Repair 和 New Submission 會傳送任何訊息失敗修復 MRSR 網站的下列驗證：</span><span class="sxs-lookup"><span data-stu-id="635bb-118">Message Repair and New Submission sends any message failing the following validation to MRSR site for repair:</span></span>  
  
- <span data-ttu-id="635bb-119">一般檔案剖析器 （未剖析的訊息） 所執行的結構化驗證</span><span class="sxs-lookup"><span data-stu-id="635bb-119">Structural validation performed by the flat file parser (unparsed messages)</span></span>  
  
- <span data-ttu-id="635bb-120">XML 驗證讀取器所執行的資料驗證</span><span class="sxs-lookup"><span data-stu-id="635bb-120">Data validation performed by the XML validating reader</span></span>  
  
- <span data-ttu-id="635bb-121">執行商務規則引擎 (BRE) 的 SWIFT 網路和使用方式規則驗證</span><span class="sxs-lookup"><span data-stu-id="635bb-121">SWIFT network and usage rule validation performed by the Business Rule Engine (BRE)</span></span>  
  
  [!INCLUDE[btaA4SWIFT2.3abbrevnonumber](../../includes/btaa4swift2-3abbrevnonumber-md.md)]<span data-ttu-id="635bb-122"> 收集 SWIFT 的訊息會跟著錯誤集合物件中的驗證期間遇到任何錯誤。</span><span class="sxs-lookup"><span data-stu-id="635bb-122"> collects any errors encountered during validation in an error collection object that travels with the SWIFT message.</span></span> <span data-ttu-id="635bb-123">修復程序包含序列化成 XML，並將它附加到訊息格式錯誤的組件資訊時發生錯誤。</span><span class="sxs-lookup"><span data-stu-id="635bb-123">The repair process includes serializing error information into XML and attaching it to the message as an error part.</span></span> <span data-ttu-id="635bb-124">這項處理，也包含標示此升級的屬性，指出訊息已驗證失敗的訊息 ([!INCLUDE[btaA4SWIFT2.3abbrevnonumber](../../includes/btaa4swift2-3abbrevnonumber-md.md)]_Failed = = True)，並報告錯誤的另一個升級的屬性計算每個驗證階段。</span><span class="sxs-lookup"><span data-stu-id="635bb-124">This processing also includes marking the message with a promoted property that indicates that the message has failed validation ([!INCLUDE[btaA4SWIFT2.3abbrevnonumber](../../includes/btaa4swift2-3abbrevnonumber-md.md)]_Failed==True), and another promoted property that reports the error counts for each validation stage.</span></span> <span data-ttu-id="635bb-125">產生的多部分訊息是由下列項目所組成：</span><span class="sxs-lookup"><span data-stu-id="635bb-125">The resulting multipart message consists of the following:</span></span>  
  
- <span data-ttu-id="635bb-126">包含失敗的訊息內文部分</span><span class="sxs-lookup"><span data-stu-id="635bb-126">A body part containing the failed message</span></span>  
  
- <span data-ttu-id="635bb-127">包含錯誤集合的 XML 錯誤組件</span><span class="sxs-lookup"><span data-stu-id="635bb-127">An error part containing the error-collection XML</span></span>  
  
- <span data-ttu-id="635bb-128">升級屬性指出失敗的狀態</span><span class="sxs-lookup"><span data-stu-id="635bb-128">Promoted properties indicating the failure state</span></span>  
  
## <a name="message-repair"></a><span data-ttu-id="635bb-129">Message Repair</span><span class="sxs-lookup"><span data-stu-id="635bb-129">Message Repair</span></span>  
 <span data-ttu-id="635bb-130">內 MRSRDepartmentPolicy MRSRDepartmentRule 商務規則會判斷哪些部門將處理失敗的訊息。</span><span class="sxs-lookup"><span data-stu-id="635bb-130">The MRSRDepartmentRule business rule within the MRSRDepartmentPolicy determines which department will handle the failed message.</span></span> <span data-ttu-id="635bb-131">訊息修復協調流程會開始修復工作流程會將訊息路由至收件匣中的部門修復角色相關聯。</span><span class="sxs-lookup"><span data-stu-id="635bb-131">The message repair orchestration starts the repair workflow by routing the message to an inbox associated with the repair role in the department.</span></span> <span data-ttu-id="635bb-132">[!INCLUDE[btaA4SWIFT2.3abbrevnonumber](../../includes/btaa4swift2-3abbrevnonumber-md.md)]執行修復角色的使用者開啟中的訊息[!INCLUDE[btsInpathNoVersion](../../includes/btsinpathnoversion-md.md)]表單中，修復該郵件，然後簽署並將它提交。</span><span class="sxs-lookup"><span data-stu-id="635bb-132">The [!INCLUDE[btaA4SWIFT2.3abbrevnonumber](../../includes/btaa4swift2-3abbrevnonumber-md.md)] user performing the repair role opens the message in the [!INCLUDE[btsInpathNoVersion](../../includes/btsinpathnoversion-md.md)] form, repairs the message, and then signs and submits it.</span></span> <span data-ttu-id="635bb-133">協調流程會將修復的訊息傳送給每個修復、 重設金鑰驗證或核准的角色和工作流程已成功完成之後，會將訊息路由至傳送埠。</span><span class="sxs-lookup"><span data-stu-id="635bb-133">The orchestration routes the repaired message to each of the repair, rekey verification, or approval roles, and after the workflow has successfully completed, routes the message to the send port.</span></span>  
  
 <span data-ttu-id="635bb-134">除了驗證，[!INCLUDE[btaA4SWIFT2.3abbrevnonumber](../../includes/btaa4swift2-3abbrevnonumber-md.md)]檢查以判斷下列訊息上的簽章：</span><span class="sxs-lookup"><span data-stu-id="635bb-134">In addition to validation, [!INCLUDE[btaA4SWIFT2.3abbrevnonumber](../../includes/btaa4swift2-3abbrevnonumber-md.md)] checks the signatures on the message to determine the following:</span></span>  
  
- <span data-ttu-id="635bb-135">修復工作流程中的使用者屬於相同部門</span><span class="sxs-lookup"><span data-stu-id="635bb-135">The users in the repair workflow belong to the same department</span></span>  
  
- <span data-ttu-id="635bb-136">每位使用者已簽署一次</span><span class="sxs-lookup"><span data-stu-id="635bb-136">Each user has signed just once</span></span>  
  
- <span data-ttu-id="635bb-137">對應至使用者角色的順序符合針對該部門所定義的工作流程中的順序</span><span class="sxs-lookup"><span data-stu-id="635bb-137">The sequence of roles corresponding to the users matches the sequence in the workflow defined for that department</span></span>  
  
  <span data-ttu-id="635bb-138">多個部門的詳細資訊，請參閱[建立部門和角色 Message Repair 和 New Submission](../../adapters-and-accelerators/accelerator-swift/creating-departments-and-roles-for-message-repair-and-new-submission.md)。</span><span class="sxs-lookup"><span data-stu-id="635bb-138">For more information about departments, see [Creating Departments and Roles for Message Repair and New Submission](../../adapters-and-accelerators/accelerator-swift/creating-departments-and-roles-for-message-repair-and-new-submission.md).</span></span>  
  
  [!INCLUDE[btaA4SWIFT2.3abbrevnonumber](../../includes/btaa4swift2-3abbrevnonumber-md.md)]<span data-ttu-id="635bb-139"> 也可讓您修復未剖析的訊息。</span><span class="sxs-lookup"><span data-stu-id="635bb-139"> also enables you to repair unparsed messages.</span></span> <span data-ttu-id="635bb-140">不過，[!INCLUDE[btaA4SWIFT2.3abbrevnonumber](../../includes/btaa4swift2-3abbrevnonumber-md.md)]修復未剖析的訊息上執行不同的處理。</span><span class="sxs-lookup"><span data-stu-id="635bb-140">However, [!INCLUDE[btaA4SWIFT2.3abbrevnonumber](../../includes/btaa4swift2-3abbrevnonumber-md.md)] performs different processing on a repaired unparsed message.</span></span> <span data-ttu-id="635bb-141">如需詳細資訊，請參閱 <<c0> [ 修復未剖析的訊息](../../adapters-and-accelerators/accelerator-swift/repairing-unparsed-messages.md)。</span><span class="sxs-lookup"><span data-stu-id="635bb-141">For more information, see [Repairing Unparsed Messages](../../adapters-and-accelerators/accelerator-swift/repairing-unparsed-messages.md).</span></span>