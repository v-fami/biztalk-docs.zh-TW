---
title: "建立自訂配接器提供者 |Microsoft 文件"
ms.custom: 
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: bb93acf8-fd9d-4315-8690-f0c152a954b5
caps.latest.revision: "2"
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 1f70855621f03011c92be7b04b844122d98be48f
ms.sourcegitcommit: 5abd0ed3f9e4858ffaaec5481bfa8878595e95f7
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 11/28/2017
---
# <a name="creating-a-custom-adapter-provider"></a><span data-ttu-id="fad04-102">建立自訂配接器提供者</span><span class="sxs-lookup"><span data-stu-id="fad04-102">Creating a Custom Adapter Provider</span></span>
<span data-ttu-id="fad04-103">解析程式執行與上一節所述之後，動態解析服務會檢查結果是否端點 （不轉換）。</span><span class="sxs-lookup"><span data-stu-id="fad04-103">After a resolver executes, as described in the previous sections, the dynamic resolution service checks whether the result is an endpoint (not a transformation).</span></span> <span data-ttu-id="fad04-104">如果端點，服務會具現化配接器管理員，也就是執行個體的**AdapterMgr**類別。</span><span class="sxs-lookup"><span data-stu-id="fad04-104">If it is an endpoint, the service instantiates the adapter manager, which is an instance of the **AdapterMgr** class.</span></span>  
  
 <span data-ttu-id="fad04-105">配接器管理員驗證並修復的傳輸類型及輸出傳輸位置。</span><span class="sxs-lookup"><span data-stu-id="fad04-105">The adapter manager validates and fixes the transport type and the outbound transport location.</span></span> <span data-ttu-id="fad04-106">如果傳輸類型是仍未解決，而且 URL 開頭為"http"或"https"，配接器管理員將傳輸類型設定為 「 Wcf-wshttp"。</span><span class="sxs-lookup"><span data-stu-id="fad04-106">If the transport type is still not resolved, and if the URL begins with either "http" or "https", the adapter manager sets the transport type to "WCF-WSHttp".</span></span>  
  
 <span data-ttu-id="fad04-107">接下來，配接器管理員確認等同於有效的 Microsoft BizTalk Server 配接器的傳輸類型，然後它會傳回其屬性的命名空間。</span><span class="sxs-lookup"><span data-stu-id="fad04-107">Next, the adapter manager verifies that the transport type equates to a valid Microsoft BizTalk Server adapter, and then it returns its property namespace.</span></span> <span data-ttu-id="fad04-108">此程序只執行一次的所有介面卡，並將結果儲存在快取以避免重複的查詢其他使用相同的配接器的內送訊息。</span><span class="sxs-lookup"><span data-stu-id="fad04-108">This process runs only once for all adapters and stores the results in a cache to avoid repeated queries for other incoming messages that use the same adapter.</span></span>  
  
 <span data-ttu-id="fad04-109">配接器管理員使用的傳輸類型 (不含"**://**"後置詞) 來判斷適當的配接器提供者。</span><span class="sxs-lookup"><span data-stu-id="fad04-109">The adapter manager uses the transport type (without the "**://**" suffix) to determine the appropriate adapter provider.</span></span> <span data-ttu-id="fad04-110">配接器提供者是自訂的組件必須實作**IAdapterProvider**介面。</span><span class="sxs-lookup"><span data-stu-id="fad04-110">An adapter provider is a custom assembly that must implement the **IAdapterProvider** interface.</span></span> <span data-ttu-id="fad04-111">配接器提供者使用的內容**解析**結構**字典**来設定可讓訊息的所有通訊協定特定屬性的解析程式所產生的執行個體Microsoft BizTalk Server 執行階段引擎來執行動態解析。</span><span class="sxs-lookup"><span data-stu-id="fad04-111">The adapter provider uses the properties of the **Resolution** structure in the **Dictionary** instance generated by the resolver to set all the protocol-specific properties of the message that enables the Microsoft BizTalk Server run-time engine to perform dynamic resolution.</span></span>  
  
 <span data-ttu-id="fad04-112">像與解析程式 （如上一節中說明），動態解析機制使用的項目 Esb.config 組態檔中尋找配接器提供者。</span><span class="sxs-lookup"><span data-stu-id="fad04-112">Like with the resolver (described in the previous section), the dynamic resolution mechanism uses entries in the Esb.config configuration file to locate adapter providers.</span></span> <span data-ttu-id="fad04-113">下列 XML 顯示組態檔的區段。</span><span class="sxs-lookup"><span data-stu-id="fad04-113">The following XML shows the section of the configuration file.</span></span>  
  
```xml  
<adapterProviders cacheManager= "Adapter Providers Cache Manager"  absoluteExpiration="3600">  
     <adapterProvider name="WCF-WSHttp" type="Microsoft.Practices.ESB.Adapter.WcfWSHttp.AdapterProvider, Microsoft.Practices.ESB.Adapter.WcfWSHttp, Version=2.0.0.0, Culture=neutral, PublicKeyToken=c62dd63c784d6e22" moniker="Http,Https" />  
     <adapterProvider name="WCF-BasicHttp" type="Microsoft.Practices.ESB.Adapter.WcfBasicHttp.AdapterProvider, Microsoft.Practices.ESB.Adapter.WcfBasicHttp, Version=2.0.0.0, Culture=neutral, PublicKeyToken=c62dd63c784d6e22" moniker="Http,Https" />  
     <adapterProvider name="WCF-Custom" type="Microsoft.Practices.ESB.Adapter.WcfCustom.AdapterProvider, Microsoft.Practices.ESB.Adapter.WcfCustom, Version=2.0.0.0, Culture=neutral, PublicKeyToken=c62dd63c784d6e22" moniker="mssql" />  
     <adapterProvider name="SMTP" type="Microsoft.Practices.ESB.Adapter.SMTP.AdapterProvider, Microsoft.Practices.ESB.Adapter.SMTP, Version=2.0.0.0, Culture=neutral, PublicKeyToken=c62dd63c784d6e22" moniker="smtp" />  
     <adapterProvider name="FTP" type="Microsoft.Practices.ESB.Adapter.FTP.AdapterProvider, Microsoft.Practices.ESB.Adapter.FTP, Version=2.0.0.0, Culture=neutral, PublicKeyToken=c62dd63c784d6e22">  
          <adapterConfig>  
               <add name="DefaultUsername" value="anonymous" />  
               <add name="DefaultPassword" value="" />  
          </adapterConfig>  
     </adapterProvider>  
     <adapterProvider name="MQSeries" type="Microsoft.Practices.ESB.Adapter.MQSeries.AdapterProvider, Microsoft.Practices.ESB.Adapter.MQSeries, Version=2.0.0.0, Culture=neutral, PublicKeyToken=c62dd63c784d6e22" moniker="MQS" adapterAssembly="MQSeries, Version=3.0.1.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35" />  
     <adapterProvider name="FILE" type="Microsoft.Practices.ESB.Adapter.FILE.AdapterProvider, Microsoft.Practices.ESB.Adapter.FILE, Version=2.0.0.0, Culture=neutral, PublicKeyToken=c62dd63c784d6e22" moniker="File" />  
</adapterProviders>  
```  
  
## <a name="creating-a-custom-adapter-provider"></a><span data-ttu-id="fad04-114">建立自訂配接器提供者</span><span class="sxs-lookup"><span data-stu-id="fad04-114">Creating a Custom Adapter Provider</span></span>  
 <span data-ttu-id="fad04-115">配接器管理員 (執行個體**AdapterMgr**類別) 的組態檔中的配接器提供者尋找並載入適當的組件。</span><span class="sxs-lookup"><span data-stu-id="fad04-115">The adapter manager (an instance of the **AdapterMgr** class) looks up the adapter provider in the configuration files and loads the appropriate assembly.</span></span> <span data-ttu-id="fad04-116">動態解析機制會快取載入的所有具象實作**IAdapterProvider**介面，以避免重複的讀取組態資訊和時數個內送訊息使用載入的組件相同的配接器提供者。</span><span class="sxs-lookup"><span data-stu-id="fad04-116">The dynamic resolution mechanism caches all loaded concrete implementations of the **IAdapterProvider** interface to avoid repeated reading of configuration information and assembly loading when several incoming messages use the same adapter provider.</span></span>  
  
 <span data-ttu-id="fad04-117">最後，配接器管理員執行**SetEndPoint**之具象實作的方法**IAdapterProvider**介面和管線元件將訊息傳回至 BizTalkMessagebox 資料庫。</span><span class="sxs-lookup"><span data-stu-id="fad04-117">Finally, the adapter manager executes the **SetEndPoint** method of the concrete implementation of the **IAdapterProvider** interface, and the pipeline component returns the message to the BizTalk Message Box database.</span></span>  
  
 <span data-ttu-id="fad04-118">**若要建立自訂配接器提供者**</span><span class="sxs-lookup"><span data-stu-id="fad04-118">**To create a custom adapter provider**</span></span>  
  
1.  <span data-ttu-id="fad04-119">建立衍生自的組件**BaseAdapterProvider**基底類別，並包含**SetEndPoint**設定端點的訊息內容屬性的方法。</span><span class="sxs-lookup"><span data-stu-id="fad04-119">Create an assembly that derives from the **BaseAdapterProvider** base class and contains a **SetEndPoint** method that sets the endpoint context properties of the message.</span></span>  
  
2.  <span data-ttu-id="fad04-120">註冊配接器提供者將它加入至 Esb.config 組態檔使用 **\<adapterProvider\>** 項目以做為配接器名稱**名稱**屬性，做為類別的完整的名稱**類型**屬性，做為 moniker **moniker** （應該以逗號分隔多個值） 的屬性，以及 （選擇性） 的組件實際的配接器做**adapterAssembly**屬性。</span><span class="sxs-lookup"><span data-stu-id="fad04-120">Register the adapter provider by adding it to Esb.config configuration files using an **\<adapterProvider\>** element with a name for the adapter as the **name** attribute, the fully qualified name of the class as the **type** attribute, the moniker as the **moniker** attribute (multiple values should be separated by a comma), and optionally the assembly of the actual adapter as the **adapterAssembly** attribute.</span></span>  
  
3.  <span data-ttu-id="fad04-121">在全域組件快取中註冊新的組件。</span><span class="sxs-lookup"><span data-stu-id="fad04-121">Register the new assembly in the global assembly cache.</span></span>