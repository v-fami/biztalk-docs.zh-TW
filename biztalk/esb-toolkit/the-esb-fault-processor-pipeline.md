---
title: "ESB 錯誤處理器管線 |Microsoft 文件"
ms.custom: 
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: a57752b1-8bca-4534-9e5b-7ce721a9490a
caps.latest.revision: "3"
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: ebd9a6cecf5353ab72cea0d67b06f3402fc1716a
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 09/20/2017
---
# <a name="the-esb-fault-processor-pipeline"></a><span data-ttu-id="0db17-102">ESB 錯誤處理器管線</span><span class="sxs-lookup"><span data-stu-id="0db17-102">The ESB Fault Processor Pipeline</span></span>
<span data-ttu-id="0db17-103">[!INCLUDE[esbToolkit](../includes/esbtoolkit-md.md)]安裝名為所有的傳送埠。使用 ESBFaultProcessor 的例外狀況傳送管線。</span><span class="sxs-lookup"><span data-stu-id="0db17-103">The [!INCLUDE[esbToolkit](../includes/esbtoolkit-md.md)] installs a send port named ALL.Exceptions that uses the ESBFaultProcessor send pipeline.</span></span> <span data-ttu-id="0db17-104">圖 1 顯示所有的屬性。例外狀況傳送埠。</span><span class="sxs-lookup"><span data-stu-id="0db17-104">Figure 1 shows the properties of the ALL.Exceptions send port.</span></span>  
  
 <span data-ttu-id="0db17-105">![所有例外狀況傳送埠](../esb-toolkit/media/ch4-allexceptionssendport.gif "第 4 章第 AllExceptionsSendPort")</span><span class="sxs-lookup"><span data-stu-id="0db17-105">![All Exceptions Send Port](../esb-toolkit/media/ch4-allexceptionssendport.gif "Ch4-AllExceptionsSendPort")</span></span>  
  
 <span data-ttu-id="0db17-106">**圖 1**</span><span class="sxs-lookup"><span data-stu-id="0db17-106">**Figure 1**</span></span>  
  
 <span data-ttu-id="0db17-107">**所有的組態。例外狀況傳送埠，包括其 ESBFaultProcessor 管線的使用情形**</span><span class="sxs-lookup"><span data-stu-id="0db17-107">**The configuration of the ALL.Exceptions send port, including its use of the ESBFaultProcessor pipeline**</span></span>  
  
 <span data-ttu-id="0db17-108">ESBFaultProcessor 管線包含下列管線元件： ESB 例外狀況的編碼器、 ESB 商務活動監控 (BAM) 追蹤程式，並 ESB 轉換。</span><span class="sxs-lookup"><span data-stu-id="0db17-108">The ESBFaultProcessor pipeline contains the following pipeline components: ESB Exception Encoder, ESB Business Activity Monitoring (BAM) Tracker, and ESB Transform.</span></span>  
  
 <span data-ttu-id="0db17-109">ALL。例外狀況傳送埠訂閱所有 ESB 錯誤訊息，並由 BizTalk 失敗訊息路由機制所產生的所有訊息。</span><span class="sxs-lookup"><span data-stu-id="0db17-109">The ALL.Exceptions send port subscribes to all ESB fault messages and to all messages generated by the BizTalk Failed Message Routing mechanism.</span></span> <span data-ttu-id="0db17-110">圖 2 顯示篩選條件的所有屬性設定。例外狀況傳送埠。</span><span class="sxs-lookup"><span data-stu-id="0db17-110">Figure 2 shows the filter property settings of the ALL.Exceptions send port.</span></span>  
  
 <span data-ttu-id="0db17-111">![篩選傳送埠](../esb-toolkit/media/ch4-filtersendport.gif "第 4 章第 FilterSendPort")</span><span class="sxs-lookup"><span data-stu-id="0db17-111">![Filter Send Port](../esb-toolkit/media/ch4-filtersendport.gif "Ch4-FilterSendPort")</span></span>  
  
 <span data-ttu-id="0db17-112">**圖 2**</span><span class="sxs-lookup"><span data-stu-id="0db17-112">**Figure 2**</span></span>  
  
 <span data-ttu-id="0db17-113">**所有篩選條件屬性。例外狀況傳送連接埠定義的連接埠訂用帳戶**</span><span class="sxs-lookup"><span data-stu-id="0db17-113">**The filter property of the ALL.Exceptions send port defines the port subscription**</span></span>  
  
## <a name="the-fault-processor-pipeline-exception-encoder-component"></a><span data-ttu-id="0db17-114">錯誤處理器管線例外狀況的編碼器元件</span><span class="sxs-lookup"><span data-stu-id="0db17-114">The Fault Processor Pipeline Exception Encoder Component</span></span>  
 <span data-ttu-id="0db17-115">ESB 例外狀況的編碼器管線元件將正規化的 ESB 無法協調流程的例外狀況路由機制和 BizTalk 失敗訊息路由機制為標準的訊息，遵守 ESB 例外狀況報告中產生的錯誤訊息結構描述。</span><span class="sxs-lookup"><span data-stu-id="0db17-115">The ESB Exception Encoder pipeline component normalizes fault messages generated in the ESB Failed Orchestration Exception Routing mechanism and the BizTalk Failed Message Routing mechanism into canonical messages that comply with the ESB Exception Reporting schema.</span></span>  
  
 <span data-ttu-id="0db17-116">無法協調流程的例外狀況路由的例外狀況，元件加速功能，並且會序列化所有的錯誤訊息屬性、 XLANG 訊息、 內容屬性，以及**System.Exception**轉換為 XML 訊息的資訊。</span><span class="sxs-lookup"><span data-stu-id="0db17-116">For a Failed Orchestration Exception Routing exception, the component enriches and serializes all fault message properties, XLANG messages, context properties, and **System.Exception** information into an XML message.</span></span>  
  
 <span data-ttu-id="0db17-117">失敗訊息路由傳送的例外狀況，元件加入應用程式名稱和其他環境的屬性，來充實資料，以及它適用於輸出 XML 訊息內容結構描述命名空間。</span><span class="sxs-lookup"><span data-stu-id="0db17-117">For a Failed Message Routing exception, the component enriches the data by adding the application name and other ambient properties, and it applies the schema namespace to the outbound XML message content.</span></span>  
  
 <span data-ttu-id="0db17-118">（選擇性） ESB 例外狀況的編碼器管線元件也可以套用 Microsoft InfoPath 處理指示到傳出訊息。</span><span class="sxs-lookup"><span data-stu-id="0db17-118">Optionally, the ESB Exception Encoder pipeline component can also apply Microsoft InfoPath processing instructions to the outbound message.</span></span> <span data-ttu-id="0db17-119">您可以藉由設定管線元件的屬性在設計檢視中修改 InfoPath 指示。</span><span class="sxs-lookup"><span data-stu-id="0db17-119">You can modify the InfoPath instructions by setting the properties of the pipeline component in design view.</span></span> <span data-ttu-id="0db17-120">下列三個設計階段屬性會影響 ESB 例外狀況的編碼器管線元件的執行階段行為：</span><span class="sxs-lookup"><span data-stu-id="0db17-120">The following three design time properties affect the run-time behavior of the ESB Exception Encoder pipeline component:</span></span>  
  
-   <span data-ttu-id="0db17-121">**EscapeCDATA。**</span><span class="sxs-lookup"><span data-stu-id="0db17-121">**EscapeCDATA.**</span></span> <span data-ttu-id="0db17-122">此屬性會決定是否此元件將逸出任何**CDATA**區段中找到保存訊息，以便 InfoPath 可以正確顯示。</span><span class="sxs-lookup"><span data-stu-id="0db17-122">This property determines whether the component will escape any **CDATA** sections found in persisted messages so that InfoPath can display them correctly.</span></span>  
  
-   <span data-ttu-id="0db17-123">**FaultDocumentNamespace。**</span><span class="sxs-lookup"><span data-stu-id="0db17-123">**FaultDocumentNamespace.**</span></span> <span data-ttu-id="0db17-124">這個屬性具有預設值是**http://schemas.microsoft.biztalk.practices.esb.com/exceptionhandling**。</span><span class="sxs-lookup"><span data-stu-id="0db17-124">This property has a default value of **http://schemas.microsoft.biztalk.practices.esb.com/exceptionhandling**.</span></span> <span data-ttu-id="0db17-125">修改此設定會保存訊息使用自訂輸出的命名空間。</span><span class="sxs-lookup"><span data-stu-id="0db17-125">This can be modified to use a custom outbound namespace for the persisted messages.</span></span>  
  
-   <span data-ttu-id="0db17-126">**ProcessingInstruction。**</span><span class="sxs-lookup"><span data-stu-id="0db17-126">**ProcessingInstruction.**</span></span> <span data-ttu-id="0db17-127">這個屬性可以包含任何符合 ESB 例外狀況報告錯誤結構描述的 InfoPath 處理指示。</span><span class="sxs-lookup"><span data-stu-id="0db17-127">This property can contain any InfoPath processing instruction that complies with the ESB Exception Reporting fault schema.</span></span> <span data-ttu-id="0db17-128">[!INCLUDE[esbToolkit](../includes/esbtoolkit-md.md)]包括符合下列的處理指示的 InfoPath 範本。</span><span class="sxs-lookup"><span data-stu-id="0db17-128">The [!INCLUDE[esbToolkit](../includes/esbtoolkit-md.md)] includes an InfoPath template that conforms to the following processing instruction.</span></span>  
  
    ```  
    <?mso-infoPathSolution solutionVersion="1.0.0.346" productVersion="11.0.6565"  
    PIVersion="1.0.0.0"   
    href=file:///\\localhost\publish\Microsoft.Practices.ESB.ExceptionHandling.InfoPath.Reporting.xsn  
    name="urn:schemas-microsoft-com:office:infopath:  
    Microsoft-Practices-ESB-ExceptionHandling-InfoPath-Reporting:  
    http---schemas-microsoft-biztalk-practices-esb-com-exceptionhandling"  
    language="en-us" ?><?mso-application progid="InfoPath.Document"?>  
    ```  
  
## <a name="the-fault-processor-pipeline-bam-tracker-component"></a><span data-ttu-id="0db17-129">錯誤處理器管線 BAM 追蹤器元件</span><span class="sxs-lookup"><span data-stu-id="0db17-129">The Fault Processor Pipeline BAM Tracker Component</span></span>  
 <span data-ttu-id="0db17-130">ESB BAM 追蹤器管線元件 ESB 例外狀況的編碼器元件從接收訊息，並將所選的錯誤資料寫入 BAM 主要匯入資料表，在 ESB 例外狀況管理架構的安裝期間建立。</span><span class="sxs-lookup"><span data-stu-id="0db17-130">The ESB BAM Tracker pipeline component receives the message from the ESB Exception Encoder component and writes selected fault data to the BAM primary import tables created during the installation of the ESB Exception Management Framework.</span></span>  
  
 <span data-ttu-id="0db17-131">ESB BAM 追蹤器元件會使用**GetEventStream**管線內容，將下列欄位為活動記錄，到 BAM 主要匯入資料庫的方法：</span><span class="sxs-lookup"><span data-stu-id="0db17-131">The ESB BAM Tracker component uses the **GetEventStream** method of the pipeline context to add the following fields as an activity record to the BAM Primary Import database:</span></span>  
  
-   <span data-ttu-id="0db17-132">**應用程式**</span><span class="sxs-lookup"><span data-stu-id="0db17-132">**Application**</span></span>  
  
-   <span data-ttu-id="0db17-133">**說明**</span><span class="sxs-lookup"><span data-stu-id="0db17-133">**Description**</span></span>  
  
-   <span data-ttu-id="0db17-134">**FaultSeverity**</span><span class="sxs-lookup"><span data-stu-id="0db17-134">**FaultSeverity**</span></span>  
  
-   <span data-ttu-id="0db17-135">**ServiceName**</span><span class="sxs-lookup"><span data-stu-id="0db17-135">**ServiceName**</span></span>  
  
-   <span data-ttu-id="0db17-136">**ErrorType**</span><span class="sxs-lookup"><span data-stu-id="0db17-136">**ErrorType**</span></span>  
  
-   <span data-ttu-id="0db17-137">**F**</span><span class="sxs-lookup"><span data-stu-id="0db17-137">**FaultCode**</span></span>  
  
-   <span data-ttu-id="0db17-138">**MachineName**</span><span class="sxs-lookup"><span data-stu-id="0db17-138">**MachineName**</span></span>  
  
-   <span data-ttu-id="0db17-139">**MessageID**</span><span class="sxs-lookup"><span data-stu-id="0db17-139">**MessageID**</span></span>  
  
-   <span data-ttu-id="0db17-140">**DateTime**</span><span class="sxs-lookup"><span data-stu-id="0db17-140">**DateTime**</span></span>  
  
-   <span data-ttu-id="0db17-141">**FaultDescription**</span><span class="sxs-lookup"><span data-stu-id="0db17-141">**FaultDescription**</span></span>  
  
-   <span data-ttu-id="0db17-142">**範圍。**</span><span class="sxs-lookup"><span data-stu-id="0db17-142">**Scope**</span></span>  
  
-   <span data-ttu-id="0db17-143">**FailureCategory**</span><span class="sxs-lookup"><span data-stu-id="0db17-143">**FailureCategory**</span></span>  
  
-   <span data-ttu-id="0db17-144">**FaultGenerator**</span><span class="sxs-lookup"><span data-stu-id="0db17-144">**FaultGenerator**</span></span>  
  
-   <span data-ttu-id="0db17-145">**ServiceInstanceID**</span><span class="sxs-lookup"><span data-stu-id="0db17-145">**ServiceInstanceID**</span></span>  
  
 <span data-ttu-id="0db17-146">ESB BAM 追蹤器元件使用的訊息識別項 ( **MessageID**屬性) 值的 ESB 錯誤訊息為 BAM 活動識別碼。</span><span class="sxs-lookup"><span data-stu-id="0db17-146">The ESB BAM Tracker component uses the message identifier (the **MessageID** property) value of the ESB fault message as the BAM activity ID.</span></span> <span data-ttu-id="0db17-147">ESB BAM 追蹤器元件會公開兩個設計階段屬性，您可以變更其執行階段行為設定：</span><span class="sxs-lookup"><span data-stu-id="0db17-147">The ESB BAM Tracker component exposes two design time properties that you can set to change its run-time behavior:</span></span>  
  
-   <span data-ttu-id="0db17-148">**啟用。**</span><span class="sxs-lookup"><span data-stu-id="0db17-148">**Enabled.**</span></span> <span data-ttu-id="0db17-149">此屬性決定元件是否將處理訊息，並寫入 BAM 資料庫。</span><span class="sxs-lookup"><span data-stu-id="0db17-149">This property determines whether the component will process the message and write it to the BAM database.</span></span> <span data-ttu-id="0db17-150">當設定為**False**，元件只會將訊息傳送管線中的下一個元件。</span><span class="sxs-lookup"><span data-stu-id="0db17-150">When set to **False**, the component just sends the message to the next component in the pipeline.</span></span>  
  
-   <span data-ttu-id="0db17-151">**FaultDocumentNamespace。**</span><span class="sxs-lookup"><span data-stu-id="0db17-151">**FaultDocumentNamespace.**</span></span> <span data-ttu-id="0db17-152">這個屬性具有預設值是**http://schemas.microsoft.biztalk.practices.esb.com/exceptionhandling**。</span><span class="sxs-lookup"><span data-stu-id="0db17-152">This property has a default value of **http://schemas.microsoft.biztalk.practices.esb.com/exceptionhandling**.</span></span>  
  
## <a name="the-fault-processor-pipeline-transform-component"></a><span data-ttu-id="0db17-153">錯誤處理器管線轉換元件</span><span class="sxs-lookup"><span data-stu-id="0db17-153">The Fault Processor Pipeline Transform Component</span></span>  
 <span data-ttu-id="0db17-154">ESB 錯誤處理器管線會使用 ESB 轉換管線元件來執行轉譯格式符合結構描述，BizTalk SQL 配接器 (ExceptionSql.xsd) 編碼的 ESB 錯誤訊息的 BizTalk 對應。</span><span class="sxs-lookup"><span data-stu-id="0db17-154">The ESB Fault Processor pipeline uses the ESB Transform pipeline component to execute a BizTalk map that translates the encoded ESB fault message into a format that matches the schema for the BizTalk SQL Adapter (ExceptionSql.xsd).</span></span> <span data-ttu-id="0db17-155">然後，元件會將轉換的訊息傳遞給 SQL 配接器，ESB 管理入口網站資料庫中插入 ESB 錯誤訊息。</span><span class="sxs-lookup"><span data-stu-id="0db17-155">The component then passes the transformed message to the SQL Adapter, which inserts the ESB fault message into the ESB Management Portal database.</span></span>  
  
 <span data-ttu-id="0db17-156">ESB 轉換管線元件會公開三個可以修改，以變更其執行階段行為的設計階段屬性：</span><span class="sxs-lookup"><span data-stu-id="0db17-156">The ESB Transform pipeline component exposes three design-time properties that can be modified to change its run-time behavior:</span></span>  
  
-   <span data-ttu-id="0db17-157">**啟用。**</span><span class="sxs-lookup"><span data-stu-id="0db17-157">**Enabled.**</span></span> <span data-ttu-id="0db17-158">這個屬性會啟用或停用元件。</span><span class="sxs-lookup"><span data-stu-id="0db17-158">This property enables or disables the component.</span></span>  
  
-   <span data-ttu-id="0db17-159">**驗證。**</span><span class="sxs-lookup"><span data-stu-id="0db17-159">**Validate.**</span></span> <span data-ttu-id="0db17-160">此屬性會指定是否需要驗證訊息。</span><span class="sxs-lookup"><span data-stu-id="0db17-160">This property specifies whether a message needs to be validated.</span></span>  
  
-   <span data-ttu-id="0db17-161">**MapName。**</span><span class="sxs-lookup"><span data-stu-id="0db17-161">**MapName.**</span></span> <span data-ttu-id="0db17-162">此屬性包含必須經過執行才能轉譯 ESB 管理入口網站資料庫中儲存的訊息對應的名稱。</span><span class="sxs-lookup"><span data-stu-id="0db17-162">This property contains the name of the map that must be executed to translate the message for storage in the ESB Management Portal database.</span></span> <span data-ttu-id="0db17-163">以下是預設值。</span><span class="sxs-lookup"><span data-stu-id="0db17-163">The following is the default value.</span></span>  
  
    ```  
    Microsoft.Practices.ESB.ExceptionHandling.Maps.FaultMessage_to_ExceptionSql,  
    Microsoft.Practices.ESB.ExceptionHandling.Maps,  
    Version=2.0.0.0,  
    Culture=neutral,  
    PublicKeyToken=c2c8b2b87f54180a  
    ```  
  
 <span data-ttu-id="0db17-164">所有的管線元件可讓您完成執行之後，BizTalk SQL Server 資料庫配接器會插入 ESB 管理入口網站資料庫的錯誤訊息。</span><span class="sxs-lookup"><span data-stu-id="0db17-164">After all the pipeline components finish executing, the BizTalk SQL Server database adapter inserts the fault message into the ESB Management Portal database.</span></span>