---
title: "執行 BizTalk 失敗訊息路由 ESB 處理範例 |Microsoft 文件"
ms.custom: 
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: d2a536a0-cfc8-4ba3-adcd-2b8b580bff85
caps.latest.revision: "2"
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: a19f8c29c22638be97ae62dfea88d0d2feca6c55
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 09/20/2017
---
# <a name="running-the-biztalk-failed-message-routing-esb-processing-sample"></a><span data-ttu-id="5fda7-102">執行 BizTalk 失敗訊息路由 ESB 處理範例</span><span class="sxs-lookup"><span data-stu-id="5fda7-102">Running the BizTalk Failed Message Routing ESB Processing Sample</span></span>
<span data-ttu-id="5fda7-103">Microsoft BizTalk 失敗訊息路由 ESB 處理的範例，示範如何使用[!INCLUDE[esbToolkit](../includes/esbtoolkit-md.md)]做為通用的機制來管理、 序列化，以及轉譯中的所有條件之下發生例外狀況的例外狀況管理架構[!INCLUDE[prague](../includes/prague-md.md)].</span><span class="sxs-lookup"><span data-stu-id="5fda7-103">The Microsoft BizTalk Failed Message Routing ESB Processing sample demonstrates how you can use the [!INCLUDE[esbToolkit](../includes/esbtoolkit-md.md)] Exception Management Framework as a universal mechanism to manage, serialize, and render exceptions occurring under all conditions in [!INCLUDE[prague](../includes/prague-md.md)].</span></span> <span data-ttu-id="5fda7-104">這包括產生 BizTalk 失敗訊息路由機制和錯誤訊息從例外狀況管理架構，協調流程內所產生的例外狀況。</span><span class="sxs-lookup"><span data-stu-id="5fda7-104">This includes exceptions generated by the BizTalk Failed Message Routing mechanism and fault messages generated by the Exception Management Framework from within an orchestration.</span></span>  
  
 <span data-ttu-id="5fda7-105">BizTalk 失敗訊息路由機制是的錯誤處理功能[!INCLUDE[prague](../includes/prague-md.md)]; 藉由使用設計工具可以指定自動化的處理傳訊失敗做為替代的傳統 （現在的預設行為） 放置失敗「 擱置 」 佇列中的訊息。</span><span class="sxs-lookup"><span data-stu-id="5fda7-105">The BizTalk Failed Message Routing mechanism is the error-handling facility of [!INCLUDE[prague](../includes/prague-md.md)]; by using it, the designer can designate automated handling of messaging failures as an alternative to the traditional (now default) behavior of placing failed messages in the "Suspended" queue.</span></span> <span data-ttu-id="5fda7-106">這會自動處理路由至任何訂閱路由目的地，像是傳送埠或協調流程的錯誤訊息。</span><span class="sxs-lookup"><span data-stu-id="5fda7-106">This automated handling routes an error message to any subscribing routing destination, such as a send port or an orchestration.</span></span> <span data-ttu-id="5fda7-107">錯誤訊息是原始訊息已降級之所有先前升級屬性與選取的屬性升級至訊息內容與特定傳訊失敗相關的複製。</span><span class="sxs-lookup"><span data-stu-id="5fda7-107">The error message is a clone of the original message with all previously promoted properties demoted and with selected properties related to the specific messaging failure promoted into the message context.</span></span>  
  
 <span data-ttu-id="5fda7-108">若要啟用的接收埠或傳送埠上的 BizTalk 失敗訊息路由機制，請選取**啟用的路由失敗訊息**核取方塊，如圖 1 所示。</span><span class="sxs-lookup"><span data-stu-id="5fda7-108">To enable the BizTalk Failed Message Routing mechanism on a receive port or a send port, select the **Enable routing for failed messages** check box, as shown in Figure 1.</span></span>  
  
 <span data-ttu-id="5fda7-109">![啟用路由](../esb-toolkit/media/ch6-enabledrouting.gif "第 6 章第 EnabledRouting")</span><span class="sxs-lookup"><span data-stu-id="5fda7-109">![Enabled Routing](../esb-toolkit/media/ch6-enabledrouting.gif "Ch6-EnabledRouting")</span></span>  
  
 <span data-ttu-id="5fda7-110">**圖 1**</span><span class="sxs-lookup"><span data-stu-id="5fda7-110">**Figure 1**</span></span>  
  
 <span data-ttu-id="5fda7-111">**啟用 BizTalk 失敗訊息路由的機制**</span><span class="sxs-lookup"><span data-stu-id="5fda7-111">**Enabling the BizTalk Failed Message Routing mechanism**</span></span>  
  
 <span data-ttu-id="5fda7-112">不過，沒有任何錯誤或失敗的協調流程中發生類似的機制。</span><span class="sxs-lookup"><span data-stu-id="5fda7-112">However, there is not a similar mechanism for errors or failures occurring in an orchestration.</span></span> <span data-ttu-id="5fda7-113">相反地，在協調流程的例外狀況處理常式的程式碼可以利用例外狀況管理架構 API 來模擬 BizTalk 失敗訊息路由機制的功能。</span><span class="sxs-lookup"><span data-stu-id="5fda7-113">Instead, code within the exception handler of an orchestration can take advantage of the Exception Management Framework API to emulate the functionality of the BizTalk Failed Message Routing mechanism.</span></span>  
  
 <span data-ttu-id="5fda7-114">在此範例中，名為 EAIProcess.RequestPort_FILE 接收位置拾取檔案複製到位置 \Source\Samples\Exception Handling\Test\Filedrop\EAIProcess.RequestPort。</span><span class="sxs-lookup"><span data-stu-id="5fda7-114">In this sample, the receive location named EAIProcess.RequestPort_FILE picks up files copied to the location \Source\Samples\Exception Handling\Test\Filedrop\EAIProcess.RequestPort.</span></span>  
  
 <span data-ttu-id="5fda7-115">此外，是泛型的傳送埠命名為全部。Exceptions_FILE 設定為使用 GlobalFaultProcessor 管線安裝在例外狀況管理架構的一部分。</span><span class="sxs-lookup"><span data-stu-id="5fda7-115">Additionally, there is a generic send port named ALL.Exceptions_FILE configured to use the GlobalFaultProcessor pipeline installed as part of the Exception Management Framework.</span></span> <span data-ttu-id="5fda7-116">此連接埠會訂閱在系統中發生的所有例外狀況，這兩個 BizTalk 失敗訊息路由遞送的訊息與 ESB 錯誤訊息，如圖 2 所示。</span><span class="sxs-lookup"><span data-stu-id="5fda7-116">This port subscribes to all exceptions occurring in the system, both BizTalk failed message routing messages and ESB fault messages, as shown in Figure 2.</span></span>  
  
 <span data-ttu-id="5fda7-117">![傳送埠](../esb-toolkit/media/ch6-sendport.gif "第 6 章第傳送埠")</span><span class="sxs-lookup"><span data-stu-id="5fda7-117">![Send Port](../esb-toolkit/media/ch6-sendport.gif "Ch6-SendPort")</span></span>  
  
 <span data-ttu-id="5fda7-118">**圖 2**</span><span class="sxs-lookup"><span data-stu-id="5fda7-118">**Figure 2**</span></span>  
  
 <span data-ttu-id="5fda7-119">**ALL。例外狀況的傳送埠訂閱，所有類型的錯誤或例外狀況**</span><span class="sxs-lookup"><span data-stu-id="5fda7-119">**The ALL.Exceptions send port subscription for all types of failure or exception**</span></span>  
  
 <span data-ttu-id="5fda7-120">例外狀況管理架構正規化為單一格式的所有例外狀況，並將它們使用位置 \Source\Samples\Exception Handling\Test\Filedrop\All_Exceptions Microsoft InfoPath 處理指示序列化。</span><span class="sxs-lookup"><span data-stu-id="5fda7-120">The Exception Management Framework normalizes all exceptions to a single format and serializes them using a Microsoft InfoPath processing instruction to the location \Source\Samples\Exception Handling\Test\Filedrop\All_Exceptions.</span></span>  
  
## <a name="installation"></a><span data-ttu-id="5fda7-121">安裝</span><span class="sxs-lookup"><span data-stu-id="5fda7-121">Installation</span></span>  
 <span data-ttu-id="5fda7-122">所有例外狀況管理範例使用相同的核心服務和 BizTalk 應用程式成品。</span><span class="sxs-lookup"><span data-stu-id="5fda7-122">All the exception management samples use the same set of core services and BizTalk application artifacts.</span></span> <span data-ttu-id="5fda7-123">因此，您必須安裝要能夠管理範例執行的所有例外狀況的例外狀況管理範例成品一次。</span><span class="sxs-lookup"><span data-stu-id="5fda7-123">Therefore, you have to install the exception management sample artifacts only once to be able to run all the exception management samples.</span></span> <span data-ttu-id="5fda7-124">如需如何安裝例外狀況管理範例，請參閱[安裝例外狀況管理範例](../esb-toolkit/installing-the-exception-management-samples.md)。</span><span class="sxs-lookup"><span data-stu-id="5fda7-124">For information about how to install the exception management samples, see [Installing the Exception Management Samples](../esb-toolkit/installing-the-exception-management-samples.md).</span></span>  
  
## <a name="running-the-sample-application"></a><span data-ttu-id="5fda7-125">執行範例應用程式</span><span class="sxs-lookup"><span data-stu-id="5fda7-125">Running the Sample Application</span></span>  
 <span data-ttu-id="5fda7-126">**執行 BizTalk 失敗訊息路由 ESB 處理範例**</span><span class="sxs-lookup"><span data-stu-id="5fda7-126">**To run the BizTalk Failed Message Routing ESB Processing sample**</span></span>  
  
1.  <span data-ttu-id="5fda7-127">您第一次執行此範例之前，請確定該接收位置和傳送連接埠 URL 指向 \Source\Samples\Exception Handling\Test\Filedrop 資料夾中的適當目錄。</span><span class="sxs-lookup"><span data-stu-id="5fda7-127">Before you run this sample for the first time, make sure that the receive location and send port URL point to the appropriate directories in the \Source\Samples\Exception Handling\Test\Filedrop folder.</span></span> <span data-ttu-id="5fda7-128">接收位置應該指定資料夾 EAIProcess.RequestPort，而傳送連接埠 URL 應該指定 All_Exceptions 的資料夾。</span><span class="sxs-lookup"><span data-stu-id="5fda7-128">The receive location should specify the folder EAIProcess.RequestPort, and the send port URL should specify the folder All_Exceptions.</span></span>  
  
2.  <span data-ttu-id="5fda7-129">如果尚未執行 GlobalBank.ESB 應用程式，使用 BizTalk 管理主控台來啟動它。</span><span class="sxs-lookup"><span data-stu-id="5fda7-129">If the GlobalBank.ESB application is not already running, use the BizTalk Administration Console to start it.</span></span>  
  
3.  <span data-ttu-id="5fda7-130">從資料夾 \Source\Samples\Exception Handling\Test\Data FlatFileReceive_in.txt 具名命名 EAIProcess.RequestPort （\Source\Samples\Exception Handling\Test\Filedrop 資料夾中） 的接收位置資料夾將檔案複製。</span><span class="sxs-lookup"><span data-stu-id="5fda7-130">Copy the file named FlatFileReceive_in.txt from the folder \Source\Samples\Exception Handling\Test\Data into the receive location folder named EAIProcess.RequestPort (in the \Source\Samples\Exception Handling\Test\Filedrop folder).</span></span>  
  
4.  <span data-ttu-id="5fda7-131">這個訊息是文字檔案，而將會造成例外狀況。</span><span class="sxs-lookup"><span data-stu-id="5fda7-131">This message is a text file, and it will cause an exception.</span></span> <span data-ttu-id="5fda7-132">開啟名為 All_Exceptions （在 \Source\Samples\Exception Handling\Test\Filedrop 資料夾中） 的資料夾，然後按兩下 錯誤訊息，以開啟在 InfoPath 使用適當的範本。</span><span class="sxs-lookup"><span data-stu-id="5fda7-132">Open the folder named All_Exceptions (in the \Source\Samples\Exception Handling\Test\Filedrop folder), and then double-click the fault message to open it into InfoPath using the appropriate template.</span></span> <span data-ttu-id="5fda7-133">您會看到的 ESB 例外狀況處理機制適當序列化內容，以允許 InfoPath 進行轉譯。</span><span class="sxs-lookup"><span data-stu-id="5fda7-133">You will see that the ESB Exception Handling mechanism serializes the content appropriately to allow InfoPath to render it.</span></span>  
  
5.  <span data-ttu-id="5fda7-134">接下來，將具名 EAIProcess.RequestPort 從資料夾 \Source\Samples\Exception Handling\Test\Data soapmessage [1].xml 檔案複製接收位置資料夾中。</span><span class="sxs-lookup"><span data-stu-id="5fda7-134">Next, copy the file named soapmessage[1].xml from the folder \Source\Samples\Exception Handling\Test\Data into the EAIProcess.RequestPort receive location folder.</span></span>  
  
6.  <span data-ttu-id="5fda7-135">這個訊息是 XML 文件，其中包含 CDATA 區段內，而將會造成例外狀況。</span><span class="sxs-lookup"><span data-stu-id="5fda7-135">This message is an XML document that contains a CDATA section, and it will cause an exception.</span></span> <span data-ttu-id="5fda7-136">開啟 All_Exceptions 輸出資料夾，然後按兩下以開啟在 InfoPath 的錯誤訊息。</span><span class="sxs-lookup"><span data-stu-id="5fda7-136">Open the All_Exceptions output folder and double-click the fault message to open it into InfoPath.</span></span> <span data-ttu-id="5fda7-137">您會看到的 ESB 例外狀況處理機制適當地序列化此內容，以允許 InfoPath 進行轉譯。</span><span class="sxs-lookup"><span data-stu-id="5fda7-137">You will see that the ESB Exception Handling mechanism serializes this content appropriately to allow InfoPath to render it.</span></span>  
  
7.  <span data-ttu-id="5fda7-138">最後，將從資料夾 \Source\Samples\Exception Handling\Test\Data 具名 EAIProcess.RequestPort Csqzav01.pdf 檔案複製接收位置。</span><span class="sxs-lookup"><span data-stu-id="5fda7-138">Finally, copy the file named Csqzav01.pdf from the folder \Source\Samples\Exception Handling\Test\Data into the EAIProcess.RequestPort receive location.</span></span>  
  
8.  <span data-ttu-id="5fda7-139">這個訊息是 PDF 檔案，而將會造成例外狀況。</span><span class="sxs-lookup"><span data-stu-id="5fda7-139">This message is a PDF file, and it will cause an exception.</span></span> <span data-ttu-id="5fda7-140">開啟 All_Exceptions 輸出資料夾，然後按兩下以開啟在 InfoPath 中的錯誤訊息。</span><span class="sxs-lookup"><span data-stu-id="5fda7-140">Open the All_Exceptions output folder and double-click the fault message to open it in InfoPath.</span></span> <span data-ttu-id="5fda7-141">您會看到的 ESB 例外狀況處理機制序列化 Base 64 編碼的內容，以允許進行轉譯 InfoPath。</span><span class="sxs-lookup"><span data-stu-id="5fda7-141">You will see that the ESB Exception Handling mechanism serializes and Base-64 encodes the content to allow InfoPath to render it.</span></span>